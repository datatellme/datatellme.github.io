<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Dealing with messy data | Modern Statistics with R</title>
  <meta name="description" content="5 Dealing with messy data | Modern Statistics with R" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Dealing with messy data | Modern Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Dealing with messy data | Modern Statistics with R" />
  
  
  

<meta name="author" content="Mans Thulin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="eda.html"/>
<link rel="next" href="progchapter.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="preamble.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="Introduction.html"><a href="Introduction.html"><i class="fa fa-check"></i><b>1</b> 들어가며</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Introduction.html"><a href="Introduction.html#whatR"><i class="fa fa-check"></i><b>1.1</b> R이란?</a></li>
<li class="chapter" data-level="1.2" data-path="Introduction.html"><a href="Introduction.html#Rinstallation"><i class="fa fa-check"></i><b>1.2</b> R 설치하기</a></li>
<li class="chapter" data-level="1.3" data-path="Introduction.html"><a href="Introduction.html#RStudioinstallation"><i class="fa fa-check"></i><b>1.3</b> RStudio 설치하기</a></li>
<li class="chapter" data-level="1.4" data-path="Introduction.html"><a href="Introduction.html#LaTeXinstallation"><i class="fa fa-check"></i><b>1.4</b> 레이텍 설치하기</a></li>
<li class="chapter" data-level="1.5" data-path="Introduction.html"><a href="Introduction.html#packageinstallation"><i class="fa fa-check"></i><b>1.5</b> Packages 설치하기</a></li>
<li class="chapter" data-level="1.6" data-path="Introduction.html"><a href="Introduction.html#aboutbook"><i class="fa fa-check"></i><b>1.6</b> 이 책에 대하여</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="thebasics.html"><a href="thebasics.html"><i class="fa fa-check"></i><b>2</b> The basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="thebasics.html"><a href="thebasics.html#a-first-look-at-rstudio"><i class="fa fa-check"></i><b>2.1</b> A first look at RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="thebasics.html"><a href="thebasics.html#runningcode"><i class="fa fa-check"></i><b>2.2</b> Running R code</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="thebasics.html"><a href="thebasics.html#r-scripts"><i class="fa fa-check"></i><b>2.2.1</b> R scripts</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="thebasics.html"><a href="thebasics.html#varsandfuncs"><i class="fa fa-check"></i><b>2.3</b> Variables and functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="thebasics.html"><a href="thebasics.html#storing-data"><i class="fa fa-check"></i><b>2.3.1</b> Storing data</a></li>
<li class="chapter" data-level="2.3.2" data-path="thebasics.html"><a href="thebasics.html#whats-in-a-name"><i class="fa fa-check"></i><b>2.3.2</b> What’s in a name?</a></li>
<li class="chapter" data-level="2.3.3" data-path="thebasics.html"><a href="thebasics.html#vectors-and-data-frames"><i class="fa fa-check"></i><b>2.3.3</b> Vectors and data frames</a></li>
<li class="chapter" data-level="2.3.4" data-path="thebasics.html"><a href="thebasics.html#functions"><i class="fa fa-check"></i><b>2.3.4</b> Functions</a></li>
<li class="chapter" data-level="2.3.5" data-path="thebasics.html"><a href="thebasics.html#maths"><i class="fa fa-check"></i><b>2.3.5</b> Mathematical operations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="thebasics.html"><a href="thebasics.html#descstats"><i class="fa fa-check"></i><b>2.4</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="thebasics.html"><a href="thebasics.html#numerical-data"><i class="fa fa-check"></i><b>2.4.1</b> Numerical data</a></li>
<li class="chapter" data-level="2.4.2" data-path="thebasics.html"><a href="thebasics.html#catdata1"><i class="fa fa-check"></i><b>2.4.2</b> Categorical data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="thebasics.html"><a href="thebasics.html#plotting-numerical-data"><i class="fa fa-check"></i><b>2.5</b> Plotting numerical data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="thebasics.html"><a href="thebasics.html#our-first-plot"><i class="fa fa-check"></i><b>2.5.1</b> Our first plot</a></li>
<li class="chapter" data-level="2.5.2" data-path="thebasics.html"><a href="thebasics.html#colours-shapes-and-axis-labels"><i class="fa fa-check"></i><b>2.5.2</b> Colours, shapes and axis labels</a></li>
<li class="chapter" data-level="2.5.3" data-path="thebasics.html"><a href="thebasics.html#axis-limits-and-scales"><i class="fa fa-check"></i><b>2.5.3</b> Axis limits and scales</a></li>
<li class="chapter" data-level="2.5.4" data-path="thebasics.html"><a href="thebasics.html#comparinggroups"><i class="fa fa-check"></i><b>2.5.4</b> Comparing groups</a></li>
<li class="chapter" data-level="2.5.5" data-path="thebasics.html"><a href="thebasics.html#boxplots"><i class="fa fa-check"></i><b>2.5.5</b> Boxplots</a></li>
<li class="chapter" data-level="2.5.6" data-path="thebasics.html"><a href="thebasics.html#histograms"><i class="fa fa-check"></i><b>2.5.6</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="thebasics.html"><a href="thebasics.html#catdata2"><i class="fa fa-check"></i><b>2.6</b> Plotting categorical data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="thebasics.html"><a href="thebasics.html#bar-charts"><i class="fa fa-check"></i><b>2.6.1</b> Bar charts</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="thebasics.html"><a href="thebasics.html#saving-your-plot"><i class="fa fa-check"></i><b>2.7</b> Saving your plot</a></li>
<li class="chapter" data-level="2.8" data-path="thebasics.html"><a href="thebasics.html#troubleshooting"><i class="fa fa-check"></i><b>2.8</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datachapter.html"><a href="datachapter.html"><i class="fa fa-check"></i><b>3</b> Transforming, summarising, and analysing data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datachapter.html"><a href="datachapter.html#data-frames-and-data-types"><i class="fa fa-check"></i><b>3.1</b> Data frames and data types</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="datachapter.html"><a href="datachapter.html#types-and-structures"><i class="fa fa-check"></i><b>3.1.1</b> Types and structures</a></li>
<li class="chapter" data-level="3.1.2" data-path="datachapter.html"><a href="datachapter.html#typesoftables"><i class="fa fa-check"></i><b>3.1.2</b> Types of tables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="datachapter.html"><a href="datachapter.html#findingpoints"><i class="fa fa-check"></i><b>3.2</b> Vectors in data frames</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datachapter.html"><a href="datachapter.html#accessingelements"><i class="fa fa-check"></i><b>3.2.1</b> Accessing vectors and elements</a></li>
<li class="chapter" data-level="3.2.2" data-path="datachapter.html"><a href="datachapter.html#use-your-dollars"><i class="fa fa-check"></i><b>3.2.2</b> Use your dollars</a></li>
<li class="chapter" data-level="3.2.3" data-path="datachapter.html"><a href="datachapter.html#conditionsintro"><i class="fa fa-check"></i><b>3.2.3</b> Using conditions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datachapter.html"><a href="datachapter.html#paths"><i class="fa fa-check"></i><b>3.3</b> Importing data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datachapter.html"><a href="datachapter.html#importing-csv-files"><i class="fa fa-check"></i><b>3.3.1</b> Importing csv files</a></li>
<li class="chapter" data-level="3.3.2" data-path="datachapter.html"><a href="datachapter.html#file-paths"><i class="fa fa-check"></i><b>3.3.2</b> File paths</a></li>
<li class="chapter" data-level="3.3.3" data-path="datachapter.html"><a href="datachapter.html#importing-excel-files"><i class="fa fa-check"></i><b>3.3.3</b> Importing Excel files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datachapter.html"><a href="datachapter.html#saving-and-exporting-your-data"><i class="fa fa-check"></i><b>3.4</b> Saving and exporting your data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="datachapter.html"><a href="datachapter.html#exporting-data"><i class="fa fa-check"></i><b>3.4.1</b> Exporting data</a></li>
<li class="chapter" data-level="3.4.2" data-path="datachapter.html"><a href="datachapter.html#saving-and-loading-r-data"><i class="fa fa-check"></i><b>3.4.2</b> Saving and loading R data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datachapter.html"><a href="datachapter.html#rstudio-projects"><i class="fa fa-check"></i><b>3.5</b> RStudio projects</a></li>
<li class="chapter" data-level="3.6" data-path="datachapter.html"><a href="datachapter.html#firstttest"><i class="fa fa-check"></i><b>3.6</b> Running a t-test</a></li>
<li class="chapter" data-level="3.7" data-path="datachapter.html"><a href="datachapter.html#firstlm"><i class="fa fa-check"></i><b>3.7</b> Fitting a linear regression model</a></li>
<li class="chapter" data-level="3.8" data-path="datachapter.html"><a href="datachapter.html#grouped"><i class="fa fa-check"></i><b>3.8</b> Grouped summaries</a></li>
<li class="chapter" data-level="3.9" data-path="datachapter.html"><a href="datachapter.html#pipes"><i class="fa fa-check"></i><b>3.9</b> Using <code>%&gt;%</code> pipes</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="datachapter.html"><a href="datachapter.html#ceci-nest-pas-une-pipe"><i class="fa fa-check"></i><b>3.9.1</b> <em>Ceci n’est pas une pipe</em></a></li>
<li class="chapter" data-level="3.9.2" data-path="datachapter.html"><a href="datachapter.html#aliases-and-placeholders"><i class="fa fa-check"></i><b>3.9.2</b> Aliases and placeholders</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="datachapter.html"><a href="datachapter.html#flavours-of-r-base-and-tidyverse"><i class="fa fa-check"></i><b>3.10</b> Flavours of R: base and tidyverse</a></li>
<li class="chapter" data-level="3.11" data-path="datachapter.html"><a href="datachapter.html#ethicalguidelines"><i class="fa fa-check"></i><b>3.11</b> Ethics and good statistical practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis and unsupervised learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="eda.html"><a href="eda.html#rmarkdown"><i class="fa fa-check"></i><b>4.1</b> Reports with R Markdown</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="eda.html"><a href="eda.html#a-first-example"><i class="fa fa-check"></i><b>4.1.1</b> A first example</a></li>
<li class="chapter" data-level="4.1.2" data-path="eda.html"><a href="eda.html#formatting-text"><i class="fa fa-check"></i><b>4.1.2</b> Formatting text</a></li>
<li class="chapter" data-level="4.1.3" data-path="eda.html"><a href="eda.html#lists-tables-and-images"><i class="fa fa-check"></i><b>4.1.3</b> Lists, tables, and images</a></li>
<li class="chapter" data-level="4.1.4" data-path="eda.html"><a href="eda.html#code-chunks"><i class="fa fa-check"></i><b>4.1.4</b> Code chunks</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="eda.html"><a href="eda.html#themes"><i class="fa fa-check"></i><b>4.2</b> Customising <code>ggplot2</code> plots</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="eda.html"><a href="eda.html#using-themes"><i class="fa fa-check"></i><b>4.2.1</b> Using themes</a></li>
<li class="chapter" data-level="4.2.2" data-path="eda.html"><a href="eda.html#colourpalettes"><i class="fa fa-check"></i><b>4.2.2</b> Colour palettes</a></li>
<li class="chapter" data-level="4.2.3" data-path="eda.html"><a href="eda.html#theme-settings"><i class="fa fa-check"></i><b>4.2.3</b> Theme settings</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="eda.html"><a href="eda.html#exploring-distributions"><i class="fa fa-check"></i><b>4.3</b> Exploring distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="eda.html"><a href="eda.html#density-plots-and-frequency-polygons"><i class="fa fa-check"></i><b>4.3.1</b> Density plots and frequency polygons</a></li>
<li class="chapter" data-level="4.3.2" data-path="eda.html"><a href="eda.html#asking-questions"><i class="fa fa-check"></i><b>4.3.2</b> Asking questions</a></li>
<li class="chapter" data-level="4.3.3" data-path="eda.html"><a href="eda.html#violin-plots"><i class="fa fa-check"></i><b>4.3.3</b> Violin plots</a></li>
<li class="chapter" data-level="4.3.4" data-path="eda.html"><a href="eda.html#patchwork"><i class="fa fa-check"></i><b>4.3.4</b> Combine multiple plots into a single graphic</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="eda.html"><a href="eda.html#outliers-and-missing-data"><i class="fa fa-check"></i><b>4.4</b> Outliers and missing data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="eda.html"><a href="eda.html#detecting-outliers"><i class="fa fa-check"></i><b>4.4.1</b> Detecting outliers</a></li>
<li class="chapter" data-level="4.4.2" data-path="eda.html"><a href="eda.html#labelling-outliers"><i class="fa fa-check"></i><b>4.4.2</b> Labelling outliers</a></li>
<li class="chapter" data-level="4.4.3" data-path="eda.html"><a href="eda.html#missing-data"><i class="fa fa-check"></i><b>4.4.3</b> Missing data</a></li>
<li class="chapter" data-level="4.4.4" data-path="eda.html"><a href="eda.html#exploring-data"><i class="fa fa-check"></i><b>4.4.4</b> Exploring data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="eda.html"><a href="eda.html#trends-in-scatterplots"><i class="fa fa-check"></i><b>4.5</b> Trends in scatterplots</a></li>
<li class="chapter" data-level="4.6" data-path="eda.html"><a href="eda.html#tsplots"><i class="fa fa-check"></i><b>4.6</b> Exploring time series</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="eda.html"><a href="eda.html#annotations-and-reference-lines"><i class="fa fa-check"></i><b>4.6.1</b> Annotations and reference lines</a></li>
<li class="chapter" data-level="4.6.2" data-path="eda.html"><a href="eda.html#longitudinal-data"><i class="fa fa-check"></i><b>4.6.2</b> Longitudinal data</a></li>
<li class="chapter" data-level="4.6.3" data-path="eda.html"><a href="eda.html#path-plots"><i class="fa fa-check"></i><b>4.6.3</b> Path plots</a></li>
<li class="chapter" data-level="4.6.4" data-path="eda.html"><a href="eda.html#spaghetti-plots"><i class="fa fa-check"></i><b>4.6.4</b> Spaghetti plots</a></li>
<li class="chapter" data-level="4.6.5" data-path="eda.html"><a href="eda.html#stlsec"><i class="fa fa-check"></i><b>4.6.5</b> Seasonal plots and decompositions</a></li>
<li class="chapter" data-level="4.6.6" data-path="eda.html"><a href="eda.html#detecting-changepoints"><i class="fa fa-check"></i><b>4.6.6</b> Detecting changepoints</a></li>
<li class="chapter" data-level="4.6.7" data-path="eda.html"><a href="eda.html#interactivets"><i class="fa fa-check"></i><b>4.6.7</b> Interactive time series plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="eda.html"><a href="eda.html#polar"><i class="fa fa-check"></i><b>4.7</b> Using polar coordinates</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="eda.html"><a href="eda.html#visualising-periodic-data"><i class="fa fa-check"></i><b>4.7.1</b> Visualising periodic data</a></li>
<li class="chapter" data-level="4.7.2" data-path="eda.html"><a href="eda.html#pie-charts"><i class="fa fa-check"></i><b>4.7.2</b> Pie charts</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="eda.html"><a href="eda.html#visualising-multiple-variables"><i class="fa fa-check"></i><b>4.8</b> Visualising multiple variables</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="eda.html"><a href="eda.html#scatterplotmatrix"><i class="fa fa-check"></i><b>4.8.1</b> Scatterplot matrices</a></li>
<li class="chapter" data-level="4.8.2" data-path="eda.html"><a href="eda.html#d-scatterplots"><i class="fa fa-check"></i><b>4.8.2</b> 3D scatterplots</a></li>
<li class="chapter" data-level="4.8.3" data-path="eda.html"><a href="eda.html#correlograms"><i class="fa fa-check"></i><b>4.8.3</b> Correlograms</a></li>
<li class="chapter" data-level="4.8.4" data-path="eda.html"><a href="eda.html#adding-more-variables-to-scatterplots"><i class="fa fa-check"></i><b>4.8.4</b> Adding more variables to scatterplots</a></li>
<li class="chapter" data-level="4.8.5" data-path="eda.html"><a href="eda.html#overplotting"><i class="fa fa-check"></i><b>4.8.5</b> Overplotting</a></li>
<li class="chapter" data-level="4.8.6" data-path="eda.html"><a href="eda.html#categorical-data"><i class="fa fa-check"></i><b>4.8.6</b> Categorical data</a></li>
<li class="chapter" data-level="4.8.7" data-path="eda.html"><a href="eda.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.8.7</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>4.9</b> Principal component analysis</a></li>
<li class="chapter" data-level="4.10" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>4.10</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>4.10.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="4.10.2" data-path="eda.html"><a href="eda.html#heatmaps-and-clustering-variables"><i class="fa fa-check"></i><b>4.10.2</b> Heatmaps and clustering variables</a></li>
<li class="chapter" data-level="4.10.3" data-path="eda.html"><a href="eda.html#centroid"><i class="fa fa-check"></i><b>4.10.3</b> Centroid-based clustering</a></li>
<li class="chapter" data-level="4.10.4" data-path="eda.html"><a href="eda.html#fuzzy-clustering"><i class="fa fa-check"></i><b>4.10.4</b> Fuzzy clustering</a></li>
<li class="chapter" data-level="4.10.5" data-path="eda.html"><a href="eda.html#modelbasedclustering"><i class="fa fa-check"></i><b>4.10.5</b> Model-based clustering</a></li>
<li class="chapter" data-level="4.10.6" data-path="eda.html"><a href="eda.html#comparing-clusters"><i class="fa fa-check"></i><b>4.10.6</b> Comparing clusters</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="eda.html"><a href="eda.html#exploratory-factor-analysis"><i class="fa fa-check"></i><b>4.11</b> Exploratory factor analysis</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="eda.html"><a href="eda.html#factor-analysis"><i class="fa fa-check"></i><b>4.11.1</b> Factor analysis</a></li>
<li class="chapter" data-level="4.11.2" data-path="eda.html"><a href="eda.html#lca"><i class="fa fa-check"></i><b>4.11.2</b> Latent class analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="messychapter.html"><a href="messychapter.html"><i class="fa fa-check"></i><b>5</b> Dealing with messy data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="messychapter.html"><a href="messychapter.html#coercion"><i class="fa fa-check"></i><b>5.1</b> Changing data types</a></li>
<li class="chapter" data-level="5.2" data-path="messychapter.html"><a href="messychapter.html#lists2"><i class="fa fa-check"></i><b>5.2</b> Working with lists</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="messychapter.html"><a href="messychapter.html#splitvector"><i class="fa fa-check"></i><b>5.2.1</b> Splitting vectors into lists</a></li>
<li class="chapter" data-level="5.2.2" data-path="messychapter.html"><a href="messychapter.html#collapsing-lists-into-vectors"><i class="fa fa-check"></i><b>5.2.2</b> Collapsing lists into vectors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="messychapter.html"><a href="messychapter.html#working-with-numbers"><i class="fa fa-check"></i><b>5.3</b> Working with numbers</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="messychapter.html"><a href="messychapter.html#rounding-numbers"><i class="fa fa-check"></i><b>5.3.1</b> Rounding numbers</a></li>
<li class="chapter" data-level="5.3.2" data-path="messychapter.html"><a href="messychapter.html#sums-and-means-in-data-frames"><i class="fa fa-check"></i><b>5.3.2</b> Sums and means in data frames</a></li>
<li class="chapter" data-level="5.3.3" data-path="messychapter.html"><a href="messychapter.html#rle"><i class="fa fa-check"></i><b>5.3.3</b> Summaries of series of numbers</a></li>
<li class="chapter" data-level="5.3.4" data-path="messychapter.html"><a href="messychapter.html#scientific-notation-1e-03"><i class="fa fa-check"></i><b>5.3.4</b> Scientific notation <code>1e-03</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="messychapter.html"><a href="messychapter.html#floatingpoints"><i class="fa fa-check"></i><b>5.3.5</b> Floating point arithmetics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="messychapter.html"><a href="messychapter.html#factors"><i class="fa fa-check"></i><b>5.4</b> Working with factors</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="messychapter.html"><a href="messychapter.html#creating-factors"><i class="fa fa-check"></i><b>5.4.1</b> Creating factors</a></li>
<li class="chapter" data-level="5.4.2" data-path="messychapter.html"><a href="messychapter.html#factorlevels"><i class="fa fa-check"></i><b>5.4.2</b> Changing factor levels</a></li>
<li class="chapter" data-level="5.4.3" data-path="messychapter.html"><a href="messychapter.html#changing-the-order-of-levels"><i class="fa fa-check"></i><b>5.4.3</b> Changing the order of levels</a></li>
<li class="chapter" data-level="5.4.4" data-path="messychapter.html"><a href="messychapter.html#combining-levels"><i class="fa fa-check"></i><b>5.4.4</b> Combining levels</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="messychapter.html"><a href="messychapter.html#strings"><i class="fa fa-check"></i><b>5.5</b> Working with strings</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="messychapter.html"><a href="messychapter.html#concatenating-strings"><i class="fa fa-check"></i><b>5.5.1</b> Concatenating strings</a></li>
<li class="chapter" data-level="5.5.2" data-path="messychapter.html"><a href="messychapter.html#changing-case"><i class="fa fa-check"></i><b>5.5.2</b> Changing case</a></li>
<li class="chapter" data-level="5.5.3" data-path="messychapter.html"><a href="messychapter.html#regexp"><i class="fa fa-check"></i><b>5.5.3</b> Finding patterns using regular expressions</a></li>
<li class="chapter" data-level="5.5.4" data-path="messychapter.html"><a href="messychapter.html#sub"><i class="fa fa-check"></i><b>5.5.4</b> Substitution</a></li>
<li class="chapter" data-level="5.5.5" data-path="messychapter.html"><a href="messychapter.html#splitting-strings"><i class="fa fa-check"></i><b>5.5.5</b> Splitting strings</a></li>
<li class="chapter" data-level="5.5.6" data-path="messychapter.html"><a href="messychapter.html#variable-names"><i class="fa fa-check"></i><b>5.5.6</b> Variable names</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="messychapter.html"><a href="messychapter.html#datetime"><i class="fa fa-check"></i><b>5.6</b> Working with dates and times</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="messychapter.html"><a href="messychapter.html#date-formats"><i class="fa fa-check"></i><b>5.6.1</b> Date formats</a></li>
<li class="chapter" data-level="5.6.2" data-path="messychapter.html"><a href="messychapter.html#plotting-with-dates"><i class="fa fa-check"></i><b>5.6.2</b> Plotting with dates</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="messychapter.html"><a href="messychapter.html#data-manipulation-with-data.table-dplyr-and-tidyr"><i class="fa fa-check"></i><b>5.7</b> Data manipulation with <code>data.table</code>, <code>dplyr</code>, and <code>tidyr</code></a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="messychapter.html"><a href="messychapter.html#dtbasics"><i class="fa fa-check"></i><b>5.7.1</b> <code>data.table</code> and tidyverse syntax basics</a></li>
<li class="chapter" data-level="5.7.2" data-path="messychapter.html"><a href="messychapter.html#modifyvar"><i class="fa fa-check"></i><b>5.7.2</b> Modifying a variable</a></li>
<li class="chapter" data-level="5.7.3" data-path="messychapter.html"><a href="messychapter.html#computing-a-new-variable-based-on-existing-variables"><i class="fa fa-check"></i><b>5.7.3</b> Computing a new variable based on existing variables</a></li>
<li class="chapter" data-level="5.7.4" data-path="messychapter.html"><a href="messychapter.html#renaming-a-variable"><i class="fa fa-check"></i><b>5.7.4</b> Renaming a variable</a></li>
<li class="chapter" data-level="5.7.5" data-path="messychapter.html"><a href="messychapter.html#removing-a-variable"><i class="fa fa-check"></i><b>5.7.5</b> Removing a variable</a></li>
<li class="chapter" data-level="5.7.6" data-path="messychapter.html"><a href="messychapter.html#recodedplyr"><i class="fa fa-check"></i><b>5.7.6</b> Recoding <code>factor</code> levels</a></li>
<li class="chapter" data-level="5.7.7" data-path="messychapter.html"><a href="messychapter.html#grouped2"><i class="fa fa-check"></i><b>5.7.7</b> Grouped summaries</a></li>
<li class="chapter" data-level="5.7.8" data-path="messychapter.html"><a href="messychapter.html#fillNA"><i class="fa fa-check"></i><b>5.7.8</b> Filling in missing values</a></li>
<li class="chapter" data-level="5.7.9" data-path="messychapter.html"><a href="messychapter.html#chaining-commands-together"><i class="fa fa-check"></i><b>5.7.9</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="messychapter.html"><a href="messychapter.html#filtering"><i class="fa fa-check"></i><b>5.8</b> Filtering: select rows</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="messychapter.html"><a href="messychapter.html#filtering-using-row-numbers"><i class="fa fa-check"></i><b>5.8.1</b> Filtering using row numbers</a></li>
<li class="chapter" data-level="5.8.2" data-path="messychapter.html"><a href="messychapter.html#conditions2"><i class="fa fa-check"></i><b>5.8.2</b> Filtering using conditions</a></li>
<li class="chapter" data-level="5.8.3" data-path="messychapter.html"><a href="messychapter.html#selecting-rows-at-random"><i class="fa fa-check"></i><b>5.8.3</b> Selecting rows at random</a></li>
<li class="chapter" data-level="5.8.4" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-rows"><i class="fa fa-check"></i><b>5.8.4</b> Using regular expressions to select rows</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="messychapter.html"><a href="messychapter.html#subsetting-select-columns"><i class="fa fa-check"></i><b>5.9</b> Subsetting: select columns</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="messychapter.html"><a href="messychapter.html#selecting-a-single-column"><i class="fa fa-check"></i><b>5.9.1</b> Selecting a single column</a></li>
<li class="chapter" data-level="5.9.2" data-path="messychapter.html"><a href="messychapter.html#selecting-multiple-columns"><i class="fa fa-check"></i><b>5.9.2</b> Selecting multiple columns</a></li>
<li class="chapter" data-level="5.9.3" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-columns"><i class="fa fa-check"></i><b>5.9.3</b> Using regular expressions to select columns</a></li>
<li class="chapter" data-level="5.9.4" data-path="messychapter.html"><a href="messychapter.html#subsetusingcn"><i class="fa fa-check"></i><b>5.9.4</b> Subsetting using column numbers</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="messychapter.html"><a href="messychapter.html#sorting"><i class="fa fa-check"></i><b>5.10</b> Sorting</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="messychapter.html"><a href="messychapter.html#changing-the-column-order"><i class="fa fa-check"></i><b>5.10.1</b> Changing the column order</a></li>
<li class="chapter" data-level="5.10.2" data-path="messychapter.html"><a href="messychapter.html#changing-the-row-order"><i class="fa fa-check"></i><b>5.10.2</b> Changing the row order</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="messychapter.html"><a href="messychapter.html#reshaping"><i class="fa fa-check"></i><b>5.11</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="messychapter.html"><a href="messychapter.html#from-long-to-wide"><i class="fa fa-check"></i><b>5.11.1</b> From long to wide</a></li>
<li class="chapter" data-level="5.11.2" data-path="messychapter.html"><a href="messychapter.html#from-wide-to-long"><i class="fa fa-check"></i><b>5.11.2</b> From wide to long</a></li>
<li class="chapter" data-level="5.11.3" data-path="messychapter.html"><a href="messychapter.html#splittingcolumns"><i class="fa fa-check"></i><b>5.11.3</b> Splitting columns</a></li>
<li class="chapter" data-level="5.11.4" data-path="messychapter.html"><a href="messychapter.html#merging-columns"><i class="fa fa-check"></i><b>5.11.4</b> Merging columns</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="messychapter.html"><a href="messychapter.html#mergedata"><i class="fa fa-check"></i><b>5.12</b> Merging data from multiple tables</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="messychapter.html"><a href="messychapter.html#binds"><i class="fa fa-check"></i><b>5.12.1</b> Binds</a></li>
<li class="chapter" data-level="5.12.2" data-path="messychapter.html"><a href="messychapter.html#merging-tables-using-keys"><i class="fa fa-check"></i><b>5.12.2</b> Merging tables using keys</a></li>
<li class="chapter" data-level="5.12.3" data-path="messychapter.html"><a href="messychapter.html#inner-and-outer-joins"><i class="fa fa-check"></i><b>5.12.3</b> Inner and outer joins</a></li>
<li class="chapter" data-level="5.12.4" data-path="messychapter.html"><a href="messychapter.html#semijoins"><i class="fa fa-check"></i><b>5.12.4</b> Semijoins and antijoins</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="messychapter.html"><a href="messychapter.html#scraping-data-from-websites"><i class="fa fa-check"></i><b>5.13</b> Scraping data from websites</a></li>
<li class="chapter" data-level="5.14" data-path="messychapter.html"><a href="messychapter.html#commontasks"><i class="fa fa-check"></i><b>5.14</b> Other commons tasks</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="messychapter.html"><a href="messychapter.html#deleting-variables"><i class="fa fa-check"></i><b>5.14.1</b> Deleting variables</a></li>
<li class="chapter" data-level="5.14.2" data-path="messychapter.html"><a href="messychapter.html#foreign"><i class="fa fa-check"></i><b>5.14.2</b> Importing data from other statistical packages</a></li>
<li class="chapter" data-level="5.14.3" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-databases"><i class="fa fa-check"></i><b>5.14.3</b> Importing data from databases</a></li>
<li class="chapter" data-level="5.14.4" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-json-files"><i class="fa fa-check"></i><b>5.14.4</b> Importing data from JSON files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="progchapter.html"><a href="progchapter.html"><i class="fa fa-check"></i><b>6</b> R programming</a>
<ul>
<li class="chapter" data-level="6.1" data-path="progchapter.html"><a href="progchapter.html#functions-1"><i class="fa fa-check"></i><b>6.1</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="progchapter.html"><a href="progchapter.html#createfunctions"><i class="fa fa-check"></i><b>6.1.1</b> Creating functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="progchapter.html"><a href="progchapter.html#local-and-global-variables"><i class="fa fa-check"></i><b>6.1.2</b> Local and global variables</a></li>
<li class="chapter" data-level="6.1.3" data-path="progchapter.html"><a href="progchapter.html#willfunctionwork"><i class="fa fa-check"></i><b>6.1.3</b> Will your function work?</a></li>
<li class="chapter" data-level="6.1.4" data-path="progchapter.html"><a href="progchapter.html#more-on-arguments"><i class="fa fa-check"></i><b>6.1.4</b> More on arguments</a></li>
<li class="chapter" data-level="6.1.5" data-path="progchapter.html"><a href="progchapter.html#namespaces"><i class="fa fa-check"></i><b>6.1.5</b> Namespaces</a></li>
<li class="chapter" data-level="6.1.6" data-path="progchapter.html"><a href="progchapter.html#sourcing-other-scripts"><i class="fa fa-check"></i><b>6.1.6</b> Sourcing other scripts</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="progchapter.html"><a href="progchapter.html#morepipes"><i class="fa fa-check"></i><b>6.2</b> More on pipes</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="progchapter.html"><a href="progchapter.html#ce-ne-sont-pas-non-plus-des-pipes"><i class="fa fa-check"></i><b>6.2.1</b> <em>Ce ne sont pas non plus des pipes</em></a></li>
<li class="chapter" data-level="6.2.2" data-path="progchapter.html"><a href="progchapter.html#writing-functions-with-pipes"><i class="fa fa-check"></i><b>6.2.2</b> Writing functions with pipes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="progchapter.html"><a href="progchapter.html#conditions"><i class="fa fa-check"></i><b>6.3</b> Checking conditions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="progchapter.html"><a href="progchapter.html#if-and-else"><i class="fa fa-check"></i><b>6.3.1</b> <code>if</code> and <code>else</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="progchapter.html"><a href="progchapter.html#section"><i class="fa fa-check"></i><b>6.3.2</b> <code>&amp;</code> &amp; <code>&amp;&amp;</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="progchapter.html"><a href="progchapter.html#ifelse"><i class="fa fa-check"></i><b>6.3.3</b> <code>ifelse</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="progchapter.html"><a href="progchapter.html#switch"><i class="fa fa-check"></i><b>6.3.4</b> <code>switch</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="progchapter.html"><a href="progchapter.html#failing-gracefully"><i class="fa fa-check"></i><b>6.3.5</b> Failing gracefully</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="progchapter.html"><a href="progchapter.html#loopsection"><i class="fa fa-check"></i><b>6.4</b> Iteration using loops</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="progchapter.html"><a href="progchapter.html#forloops"><i class="fa fa-check"></i><b>6.4.1</b> <code>for</code> loops</a></li>
<li class="chapter" data-level="6.4.2" data-path="progchapter.html"><a href="progchapter.html#nestedloops"><i class="fa fa-check"></i><b>6.4.2</b> Loops within loops</a></li>
<li class="chapter" data-level="6.4.3" data-path="progchapter.html"><a href="progchapter.html#beepr"><i class="fa fa-check"></i><b>6.4.3</b> Keeping track of what’s happening</a></li>
<li class="chapter" data-level="6.4.4" data-path="progchapter.html"><a href="progchapter.html#lists"><i class="fa fa-check"></i><b>6.4.4</b> Loops and lists</a></li>
<li class="chapter" data-level="6.4.5" data-path="progchapter.html"><a href="progchapter.html#whileloop"><i class="fa fa-check"></i><b>6.4.5</b> <code>while</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="progchapter.html"><a href="progchapter.html#vectorloops"><i class="fa fa-check"></i><b>6.5</b> Iteration using vectorisation and functionals</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="progchapter.html"><a href="progchapter.html#a-first-example-with-apply"><i class="fa fa-check"></i><b>6.5.1</b> A first example with <code>apply</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="progchapter.html"><a href="progchapter.html#variations-on-a-theme"><i class="fa fa-check"></i><b>6.5.2</b> Variations on a theme</a></li>
<li class="chapter" data-level="6.5.3" data-path="progchapter.html"><a href="progchapter.html#purrr"><i class="fa fa-check"></i><b>6.5.3</b> <code>purrr</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="progchapter.html"><a href="progchapter.html#specialised-functions"><i class="fa fa-check"></i><b>6.5.4</b> Specialised functions</a></li>
<li class="chapter" data-level="6.5.5" data-path="progchapter.html"><a href="progchapter.html#exploring-data-with-functionals"><i class="fa fa-check"></i><b>6.5.5</b> Exploring data with functionals</a></li>
<li class="chapter" data-level="6.5.6" data-path="progchapter.html"><a href="progchapter.html#keep-calm-and-carry-on"><i class="fa fa-check"></i><b>6.5.6</b> Keep calm and carry on</a></li>
<li class="chapter" data-level="6.5.7" data-path="progchapter.html"><a href="progchapter.html#multiiter"><i class="fa fa-check"></i><b>6.5.7</b> Iterating over multiple variables</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="progchapter.html"><a href="progchapter.html#measureperformance"><i class="fa fa-check"></i><b>6.6</b> Measuring code performance</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="progchapter.html"><a href="progchapter.html#timing-functions"><i class="fa fa-check"></i><b>6.6.1</b> Timing functions</a></li>
<li class="chapter" data-level="6.6.2" data-path="progchapter.html"><a href="progchapter.html#measuring-memory-usage---and-a-note-on-compilation"><i class="fa fa-check"></i><b>6.6.2</b> Measuring memory usage - and a note on compilation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modchapter.html"><a href="modchapter.html"><i class="fa fa-check"></i><b>7</b> Modern classical statistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="modchapter.html"><a href="modchapter.html#simulation"><i class="fa fa-check"></i><b>7.1</b> Simulation and distributions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="modchapter.html"><a href="modchapter.html#generating-random-numbers"><i class="fa fa-check"></i><b>7.1.1</b> Generating random numbers</a></li>
<li class="chapter" data-level="7.1.2" data-path="modchapter.html"><a href="modchapter.html#distfunctions"><i class="fa fa-check"></i><b>7.1.2</b> Some common distributions</a></li>
<li class="chapter" data-level="7.1.3" data-path="modchapter.html"><a href="modchapter.html#assessing-distributional-assumptions"><i class="fa fa-check"></i><b>7.1.3</b> Assessing distributional assumptions</a></li>
<li class="chapter" data-level="7.1.4" data-path="modchapter.html"><a href="modchapter.html#monte-carlo-integration"><i class="fa fa-check"></i><b>7.1.4</b> Monte Carlo integration</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="modchapter.html"><a href="modchapter.html#ttest"><i class="fa fa-check"></i><b>7.2</b> Student’s t-test revisited</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="modchapter.html"><a href="modchapter.html#oldschoolt"><i class="fa fa-check"></i><b>7.2.1</b> The old-school t-test</a></li>
<li class="chapter" data-level="7.2.2" data-path="modchapter.html"><a href="modchapter.html#permutation-tests"><i class="fa fa-check"></i><b>7.2.2</b> Permutation tests</a></li>
<li class="chapter" data-level="7.2.3" data-path="modchapter.html"><a href="modchapter.html#the-bootstrap"><i class="fa fa-check"></i><b>7.2.3</b> The bootstrap</a></li>
<li class="chapter" data-level="7.2.4" data-path="modchapter.html"><a href="modchapter.html#saving-the-output"><i class="fa fa-check"></i><b>7.2.4</b> Saving the output</a></li>
<li class="chapter" data-level="7.2.5" data-path="modchapter.html"><a href="modchapter.html#multipletesting"><i class="fa fa-check"></i><b>7.2.5</b> Multiple testing</a></li>
<li class="chapter" data-level="7.2.6" data-path="modchapter.html"><a href="modchapter.html#hotellingst2"><i class="fa fa-check"></i><b>7.2.6</b> Multivariate testing with Hotelling’s <span class="math inline">\(T^2\)</span></a></li>
<li class="chapter" data-level="7.2.7" data-path="modchapter.html"><a href="modchapter.html#sample-size-computations-for-the-t-test"><i class="fa fa-check"></i><b>7.2.7</b> Sample size computations for the t-test</a></li>
<li class="chapter" data-level="7.2.8" data-path="modchapter.html"><a href="modchapter.html#a-bayesian-approach"><i class="fa fa-check"></i><b>7.2.8</b> A Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="modchapter.html"><a href="modchapter.html#other-common-hypothesis-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>7.3</b> Other common hypothesis tests and confidence intervals</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="modchapter.html"><a href="modchapter.html#nonparametric-tests-of-location"><i class="fa fa-check"></i><b>7.3.1</b> Nonparametric tests of location</a></li>
<li class="chapter" data-level="7.3.2" data-path="modchapter.html"><a href="modchapter.html#tests-for-correlation"><i class="fa fa-check"></i><b>7.3.2</b> Tests for correlation</a></li>
<li class="chapter" data-level="7.3.3" data-path="modchapter.html"><a href="modchapter.html#chi2-tests"><i class="fa fa-check"></i><b>7.3.3</b> <span class="math inline">\(\chi^2\)</span>-tests</a></li>
<li class="chapter" data-level="7.3.4" data-path="modchapter.html"><a href="modchapter.html#confprop"><i class="fa fa-check"></i><b>7.3.4</b> Confidence intervals for proportions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="modchapter.html"><a href="modchapter.html#ethicsinference"><i class="fa fa-check"></i><b>7.4</b> Ethical issues in statistical inference</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="modchapter.html"><a href="modchapter.html#p-hacking-and-the-file-drawer-problem"><i class="fa fa-check"></i><b>7.4.1</b> p-hacking and the file-drawer problem</a></li>
<li class="chapter" data-level="7.4.2" data-path="modchapter.html"><a href="modchapter.html#reproducibility"><i class="fa fa-check"></i><b>7.4.2</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="modchapter.html"><a href="modchapter.html#simeval"><i class="fa fa-check"></i><b>7.5</b> Evaluating statistical methods using simulation</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="modchapter.html"><a href="modchapter.html#comparing-estimators"><i class="fa fa-check"></i><b>7.5.1</b> Comparing estimators</a></li>
<li class="chapter" data-level="7.5.2" data-path="modchapter.html"><a href="modchapter.html#simtypeI"><i class="fa fa-check"></i><b>7.5.2</b> Type I error rate of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.3" data-path="modchapter.html"><a href="modchapter.html#simpower"><i class="fa fa-check"></i><b>7.5.3</b> Power of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.4" data-path="modchapter.html"><a href="modchapter.html#powerlocation"><i class="fa fa-check"></i><b>7.5.4</b> Power of some tests of location</a></li>
<li class="chapter" data-level="7.5.5" data-path="modchapter.html"><a href="modchapter.html#simadvice"><i class="fa fa-check"></i><b>7.5.5</b> Some advice on simulation studies</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="modchapter.html"><a href="modchapter.html#sscus"><i class="fa fa-check"></i><b>7.6</b> Sample size computations using simulation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="modchapter.html"><a href="modchapter.html#simcorpower"><i class="fa fa-check"></i><b>7.6.1</b> Writing your own simulation</a></li>
<li class="chapter" data-level="7.6.2" data-path="modchapter.html"><a href="modchapter.html#the-wilcoxon-mann-whitney-test"><i class="fa fa-check"></i><b>7.6.2</b> The Wilcoxon-Mann-Whitney test</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="modchapter.html"><a href="modchapter.html#bootstrap"><i class="fa fa-check"></i><b>7.7</b> Bootstrapping</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="modchapter.html"><a href="modchapter.html#a-general-approach"><i class="fa fa-check"></i><b>7.7.1</b> A general approach</a></li>
<li class="chapter" data-level="7.7.2" data-path="modchapter.html"><a href="modchapter.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>7.7.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="7.7.3" data-path="modchapter.html"><a href="modchapter.html#intervalinversion"><i class="fa fa-check"></i><b>7.7.3</b> Bootstrap hypothesis tests</a></li>
<li class="chapter" data-level="7.7.4" data-path="modchapter.html"><a href="modchapter.html#parametricbootstrap"><i class="fa fa-check"></i><b>7.7.4</b> The parametric bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="modchapter.html"><a href="modchapter.html#reporting-statistical-results"><i class="fa fa-check"></i><b>7.8</b> Reporting statistical results</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="modchapter.html"><a href="modchapter.html#what-should-you-include"><i class="fa fa-check"></i><b>7.8.1</b> What should you include?</a></li>
<li class="chapter" data-level="7.8.2" data-path="modchapter.html"><a href="modchapter.html#citing-r-packages"><i class="fa fa-check"></i><b>7.8.2</b> Citing R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>8</b> Regression models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression.html"><a href="regression.html#linearmodels"><i class="fa fa-check"></i><b>8.1</b> Linear models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression.html"><a href="regression.html#fitting-linear-models"><i class="fa fa-check"></i><b>8.1.1</b> Fitting linear models</a></li>
<li class="chapter" data-level="8.1.2" data-path="regression.html"><a href="regression.html#interactions-and-polynomial-terms"><i class="fa fa-check"></i><b>8.1.2</b> Interactions and polynomial terms</a></li>
<li class="chapter" data-level="8.1.3" data-path="regression.html"><a href="regression.html#dummy-variables"><i class="fa fa-check"></i><b>8.1.3</b> Dummy variables</a></li>
<li class="chapter" data-level="8.1.4" data-path="regression.html"><a href="regression.html#model-diagnostics"><i class="fa fa-check"></i><b>8.1.4</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.1.5" data-path="regression.html"><a href="regression.html#transformations"><i class="fa fa-check"></i><b>8.1.5</b> Transformations</a></li>
<li class="chapter" data-level="8.1.6" data-path="regression.html"><a href="regression.html#alternatives-to-lm"><i class="fa fa-check"></i><b>8.1.6</b> Alternatives to <code>lm</code></a></li>
<li class="chapter" data-level="8.1.7" data-path="regression.html"><a href="regression.html#regbootstrap"><i class="fa fa-check"></i><b>8.1.7</b> Bootstrap confidence intervals for regression coefficients</a></li>
<li class="chapter" data-level="8.1.8" data-path="regression.html"><a href="regression.html#broom"><i class="fa fa-check"></i><b>8.1.8</b> Alternative summaries with <code>broom</code></a></li>
<li class="chapter" data-level="8.1.9" data-path="regression.html"><a href="regression.html#stepwise"><i class="fa fa-check"></i><b>8.1.9</b> Variable selection</a></li>
<li class="chapter" data-level="8.1.10" data-path="regression.html"><a href="regression.html#prediction"><i class="fa fa-check"></i><b>8.1.10</b> Prediction</a></li>
<li class="chapter" data-level="8.1.11" data-path="regression.html"><a href="regression.html#multipredict"><i class="fa fa-check"></i><b>8.1.11</b> Prediction for multiple datasets</a></li>
<li class="chapter" data-level="8.1.12" data-path="regression.html"><a href="regression.html#ANOVA"><i class="fa fa-check"></i><b>8.1.12</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.13" data-path="regression.html"><a href="regression.html#bayeslm"><i class="fa fa-check"></i><b>8.1.13</b> Bayesian estimation of linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression.html"><a href="regression.html#ethical-issues-in-regression-modelling"><i class="fa fa-check"></i><b>8.2</b> Ethical issues in regression modelling</a></li>
<li class="chapter" data-level="8.3" data-path="regression.html"><a href="regression.html#generalised-linear-models"><i class="fa fa-check"></i><b>8.3</b> Generalised linear models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression.html"><a href="regression.html#logreg"><i class="fa fa-check"></i><b>8.3.1</b> Modelling proportions: Logistic regression</a></li>
<li class="chapter" data-level="8.3.2" data-path="regression.html"><a href="regression.html#bootstrap-confidence-intervals-1"><i class="fa fa-check"></i><b>8.3.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="8.3.3" data-path="regression.html"><a href="regression.html#model-diagnostics-1"><i class="fa fa-check"></i><b>8.3.3</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.3.4" data-path="regression.html"><a href="regression.html#prediction-1"><i class="fa fa-check"></i><b>8.3.4</b> Prediction</a></li>
<li class="chapter" data-level="8.3.5" data-path="regression.html"><a href="regression.html#modelling-count-data"><i class="fa fa-check"></i><b>8.3.5</b> Modelling count data</a></li>
<li class="chapter" data-level="8.3.6" data-path="regression.html"><a href="regression.html#modelling-rates"><i class="fa fa-check"></i><b>8.3.6</b> Modelling rates</a></li>
<li class="chapter" data-level="8.3.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-generalised-linear-models"><i class="fa fa-check"></i><b>8.3.7</b> Bayesian estimation of generalised linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression.html"><a href="regression.html#mixedmodels"><i class="fa fa-check"></i><b>8.4</b> Mixed models</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="regression.html"><a href="regression.html#fitting-a-linear-mixed-model"><i class="fa fa-check"></i><b>8.4.1</b> Fitting a linear mixed model</a></li>
<li class="chapter" data-level="8.4.2" data-path="regression.html"><a href="regression.html#model-diagnostics-2"><i class="fa fa-check"></i><b>8.4.2</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.4.3" data-path="regression.html"><a href="regression.html#lmmbootstrap"><i class="fa fa-check"></i><b>8.4.3</b> Bootstrapping</a></li>
<li class="chapter" data-level="8.4.4" data-path="regression.html"><a href="regression.html#nested-random-effects-and-multilevelhierarchical-models"><i class="fa fa-check"></i><b>8.4.4</b> Nested random effects and multilevel/hierarchical models</a></li>
<li class="chapter" data-level="8.4.5" data-path="regression.html"><a href="regression.html#anova-with-random-effects"><i class="fa fa-check"></i><b>8.4.5</b> ANOVA with random effects</a></li>
<li class="chapter" data-level="8.4.6" data-path="regression.html"><a href="regression.html#generalised-linear-mixed-models"><i class="fa fa-check"></i><b>8.4.6</b> Generalised linear mixed models</a></li>
<li class="chapter" data-level="8.4.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-mixed-models"><i class="fa fa-check"></i><b>8.4.7</b> Bayesian estimation of mixed models</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regression.html"><a href="regression.html#survival"><i class="fa fa-check"></i><b>8.5</b> Survival analysis</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="regression.html"><a href="regression.html#comparing-groups"><i class="fa fa-check"></i><b>8.5.1</b> Comparing groups</a></li>
<li class="chapter" data-level="8.5.2" data-path="regression.html"><a href="regression.html#the-cox-proportional-hazards-model"><i class="fa fa-check"></i><b>8.5.2</b> The Cox proportional hazards model</a></li>
<li class="chapter" data-level="8.5.3" data-path="regression.html"><a href="regression.html#accelerated-failure-time-models"><i class="fa fa-check"></i><b>8.5.3</b> Accelerated failure time models</a></li>
<li class="chapter" data-level="8.5.4" data-path="regression.html"><a href="regression.html#bayesian-survival-analysis"><i class="fa fa-check"></i><b>8.5.4</b> Bayesian survival analysis</a></li>
<li class="chapter" data-level="8.5.5" data-path="regression.html"><a href="regression.html#multivariate-survival-analysis"><i class="fa fa-check"></i><b>8.5.5</b> Multivariate survival analysis</a></li>
<li class="chapter" data-level="8.5.6" data-path="regression.html"><a href="regression.html#power-estimates-for-the-logrank-test"><i class="fa fa-check"></i><b>8.5.6</b> Power estimates for the logrank test</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="regression.html"><a href="regression.html#left-censored-data-and-nondetects"><i class="fa fa-check"></i><b>8.6</b> Left-censored data and nondetects</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="regression.html"><a href="regression.html#estimation"><i class="fa fa-check"></i><b>8.6.1</b> Estimation</a></li>
<li class="chapter" data-level="8.6.2" data-path="regression.html"><a href="regression.html#tests-of-means"><i class="fa fa-check"></i><b>8.6.2</b> Tests of means</a></li>
<li class="chapter" data-level="8.6.3" data-path="regression.html"><a href="regression.html#censored-regression"><i class="fa fa-check"></i><b>8.6.3</b> Censored regression</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="regression.html"><a href="regression.html#creating-matched-samples"><i class="fa fa-check"></i><b>8.7</b> Creating matched samples</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="regression.html"><a href="regression.html#propensity-score-matching"><i class="fa fa-check"></i><b>8.7.1</b> Propensity score matching</a></li>
<li class="chapter" data-level="8.7.2" data-path="regression.html"><a href="regression.html#stepwise-matching"><i class="fa fa-check"></i><b>8.7.2</b> Stepwise matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mlchapter.html"><a href="mlchapter.html"><i class="fa fa-check"></i><b>9</b> Predictive modelling and machine learning</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-predictive-models"><i class="fa fa-check"></i><b>9.1</b> Evaluating predictive models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-regression-models"><i class="fa fa-check"></i><b>9.1.1</b> Evaluating regression models</a></li>
<li class="chapter" data-level="9.1.2" data-path="mlchapter.html"><a href="mlchapter.html#test-training-splits"><i class="fa fa-check"></i><b>9.1.2</b> Test-training splits</a></li>
<li class="chapter" data-level="9.1.3" data-path="mlchapter.html"><a href="mlchapter.html#loocv"><i class="fa fa-check"></i><b>9.1.3</b> Leave-one-out cross-validation and <code>caret</code></a></li>
<li class="chapter" data-level="9.1.4" data-path="mlchapter.html"><a href="mlchapter.html#kfoldcv"><i class="fa fa-check"></i><b>9.1.4</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="9.1.5" data-path="mlchapter.html"><a href="mlchapter.html#twinned-observations"><i class="fa fa-check"></i><b>9.1.5</b> Twinned observations</a></li>
<li class="chapter" data-level="9.1.6" data-path="mlchapter.html"><a href="mlchapter.html#bootstrapping"><i class="fa fa-check"></i><b>9.1.6</b> Bootstrapping</a></li>
<li class="chapter" data-level="9.1.7" data-path="mlchapter.html"><a href="mlchapter.html#classifieraccuracy"><i class="fa fa-check"></i><b>9.1.7</b> Evaluating classification models</a></li>
<li class="chapter" data-level="9.1.8" data-path="mlchapter.html"><a href="mlchapter.html#decisionboundaries"><i class="fa fa-check"></i><b>9.1.8</b> Visualising decision boundaries</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="mlchapter.html"><a href="mlchapter.html#ethical-issues-in-predictive-modelling"><i class="fa fa-check"></i><b>9.2</b> Ethical issues in predictive modelling</a></li>
<li class="chapter" data-level="9.3" data-path="mlchapter.html"><a href="mlchapter.html#modellingchallenges"><i class="fa fa-check"></i><b>9.3</b> Challenges in predictive modelling</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mlchapter.html"><a href="mlchapter.html#imbalanced"><i class="fa fa-check"></i><b>9.3.1</b> Handling class imbalance</a></li>
<li class="chapter" data-level="9.3.2" data-path="mlchapter.html"><a href="mlchapter.html#varimportance"><i class="fa fa-check"></i><b>9.3.2</b> Assessing variable importance</a></li>
<li class="chapter" data-level="9.3.3" data-path="mlchapter.html"><a href="mlchapter.html#extrapolation"><i class="fa fa-check"></i><b>9.3.3</b> Extrapolation</a></li>
<li class="chapter" data-level="9.3.4" data-path="mlchapter.html"><a href="mlchapter.html#missing-data-and-imputation"><i class="fa fa-check"></i><b>9.3.4</b> Missing data and imputation</a></li>
<li class="chapter" data-level="9.3.5" data-path="mlchapter.html"><a href="mlchapter.html#endless-waiting"><i class="fa fa-check"></i><b>9.3.5</b> Endless waiting</a></li>
<li class="chapter" data-level="9.3.6" data-path="mlchapter.html"><a href="mlchapter.html#overfittingtestset"><i class="fa fa-check"></i><b>9.3.6</b> Overfitting to the test set</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mlchapter.html"><a href="mlchapter.html#regularised"><i class="fa fa-check"></i><b>9.4</b> Regularised regression models</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="mlchapter.html"><a href="mlchapter.html#ridge-regression"><i class="fa fa-check"></i><b>9.4.1</b> Ridge regression</a></li>
<li class="chapter" data-level="9.4.2" data-path="mlchapter.html"><a href="mlchapter.html#lasso"><i class="fa fa-check"></i><b>9.4.2</b> The lasso</a></li>
<li class="chapter" data-level="9.4.3" data-path="mlchapter.html"><a href="mlchapter.html#elastic-net"><i class="fa fa-check"></i><b>9.4.3</b> Elastic net</a></li>
<li class="chapter" data-level="9.4.4" data-path="mlchapter.html"><a href="mlchapter.html#choosing-the-best-model"><i class="fa fa-check"></i><b>9.4.4</b> Choosing the best model</a></li>
<li class="chapter" data-level="9.4.5" data-path="mlchapter.html"><a href="mlchapter.html#regularised-mixed-models"><i class="fa fa-check"></i><b>9.4.5</b> Regularised mixed models</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="mlchapter.html"><a href="mlchapter.html#mlmethods"><i class="fa fa-check"></i><b>9.5</b> Machine learning models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mlchapter.html"><a href="mlchapter.html#decisiontrees"><i class="fa fa-check"></i><b>9.5.1</b> Decision trees</a></li>
<li class="chapter" data-level="9.5.2" data-path="mlchapter.html"><a href="mlchapter.html#randomforests"><i class="fa fa-check"></i><b>9.5.2</b> Random forests</a></li>
<li class="chapter" data-level="9.5.3" data-path="mlchapter.html"><a href="mlchapter.html#boosted-trees"><i class="fa fa-check"></i><b>9.5.3</b> Boosted trees</a></li>
<li class="chapter" data-level="9.5.4" data-path="mlchapter.html"><a href="mlchapter.html#model-trees"><i class="fa fa-check"></i><b>9.5.4</b> Model trees</a></li>
<li class="chapter" data-level="9.5.5" data-path="mlchapter.html"><a href="mlchapter.html#discriminant-analysis"><i class="fa fa-check"></i><b>9.5.5</b> Discriminant analysis</a></li>
<li class="chapter" data-level="9.5.6" data-path="mlchapter.html"><a href="mlchapter.html#support-vector-machines"><i class="fa fa-check"></i><b>9.5.6</b> Support vector machines</a></li>
<li class="chapter" data-level="9.5.7" data-path="mlchapter.html"><a href="mlchapter.html#nearest-neighbours-classifiers"><i class="fa fa-check"></i><b>9.5.7</b> Nearest neighbours classifiers</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="mlchapter.html"><a href="mlchapter.html#tsforecast"><i class="fa fa-check"></i><b>9.6</b> Forecasting time series</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="mlchapter.html"><a href="mlchapter.html#decomposition"><i class="fa fa-check"></i><b>9.6.1</b> Decomposition</a></li>
<li class="chapter" data-level="9.6.2" data-path="mlchapter.html"><a href="mlchapter.html#forecasting-using-arima-models"><i class="fa fa-check"></i><b>9.6.2</b> Forecasting using ARIMA models</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="mlchapter.html"><a href="mlchapter.html#deploying-models"><i class="fa fa-check"></i><b>9.7</b> Deploying models</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="mlchapter.html"><a href="mlchapter.html#creating-apis-with-plumber"><i class="fa fa-check"></i><b>9.7.1</b> Creating APIs with <code>plumber</code></a></li>
<li class="chapter" data-level="9.7.2" data-path="mlchapter.html"><a href="mlchapter.html#different-types-of-output"><i class="fa fa-check"></i><b>9.7.2</b> Different types of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="advancedchapter.html"><a href="advancedchapter.html"><i class="fa fa-check"></i><b>10</b> Advanced topics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="advancedchapter.html"><a href="advancedchapter.html#moreonpackages"><i class="fa fa-check"></i><b>10.1</b> More on packages</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="advancedchapter.html"><a href="advancedchapter.html#loading-and-auto-installing-packages"><i class="fa fa-check"></i><b>10.1.1</b> Loading and auto-installing packages</a></li>
<li class="chapter" data-level="10.1.2" data-path="advancedchapter.html"><a href="advancedchapter.html#updating-r-and-your-packages"><i class="fa fa-check"></i><b>10.1.2</b> Updating R and your packages</a></li>
<li class="chapter" data-level="10.1.3" data-path="advancedchapter.html"><a href="advancedchapter.html#alternative-repositories"><i class="fa fa-check"></i><b>10.1.3</b> Alternative repositories</a></li>
<li class="chapter" data-level="10.1.4" data-path="advancedchapter.html"><a href="advancedchapter.html#removing-packages"><i class="fa fa-check"></i><b>10.1.4</b> Removing packages</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallel"><i class="fa fa-check"></i><b>10.2</b> Speeding up computations with parallelisation</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-for-loops"><i class="fa fa-check"></i><b>10.2.1</b> Parallelising <code>for</code> loops</a></li>
<li class="chapter" data-level="10.2.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-functionals"><i class="fa fa-check"></i><b>10.2.2</b> Parallelising functionals</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="advancedchapter.html"><a href="advancedchapter.html#linearalgebra"><i class="fa fa-check"></i><b>10.3</b> Linear algebra and matrices</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="advancedchapter.html"><a href="advancedchapter.html#creating-matrices"><i class="fa fa-check"></i><b>10.3.1</b> Creating matrices</a></li>
<li class="chapter" data-level="10.3.2" data-path="advancedchapter.html"><a href="advancedchapter.html#sparse-matrices"><i class="fa fa-check"></i><b>10.3.2</b> Sparse matrices</a></li>
<li class="chapter" data-level="10.3.3" data-path="advancedchapter.html"><a href="advancedchapter.html#matrix-operations"><i class="fa fa-check"></i><b>10.3.3</b> Matrix operations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration"><i class="fa fa-check"></i><b>10.4</b> Integration with other programming languages</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-c"><i class="fa fa-check"></i><b>10.4.1</b> Integration with C++</a></li>
<li class="chapter" data-level="10.4.2" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-python"><i class="fa fa-check"></i><b>10.4.2</b> Integration with Python</a></li>
<li class="chapter" data-level="10.4.3" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-tensorflow-and-pytorch"><i class="fa fa-check"></i><b>10.4.3</b> Integration with Tensorflow and PyTorch</a></li>
<li class="chapter" data-level="10.4.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-spark"><i class="fa fa-check"></i><b>10.4.4</b> Integration with Spark</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="errorchapter.html"><a href="errorchapter.html"><i class="fa fa-check"></i><b>11</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1" data-path="errorchapter.html"><a href="errorchapter.html#debugging"><i class="fa fa-check"></i><b>11.1</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="errorchapter.html"><a href="errorchapter.html#find-out-where-the-error-occured-with-traceback"><i class="fa fa-check"></i><b>11.1.1</b> Find out where the error occured with <code>traceback</code></a></li>
<li class="chapter" data-level="11.1.2" data-path="errorchapter.html"><a href="errorchapter.html#interactive-debugging-of-functions-with-debug"><i class="fa fa-check"></i><b>11.1.2</b> Interactive debugging of functions with <code>debug</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="errorchapter.html"><a href="errorchapter.html#investigate-the-environment-with-recover"><i class="fa fa-check"></i><b>11.1.3</b> Investigate the environment with <code>recover</code></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="errorchapter.html"><a href="errorchapter.html#commonerrors"><i class="fa fa-check"></i><b>11.2</b> Common error messages</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="errorchapter.html"><a href="errorchapter.html#section-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>+</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="errorchapter.html"><a href="errorchapter.html#could-not-find-function"><i class="fa fa-check"></i><b>11.2.2</b> <code>could not find function</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="errorchapter.html"><a href="errorchapter.html#object-not-found"><i class="fa fa-check"></i><b>11.2.3</b> <code>object not found</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="errorchapter.html"><a href="errorchapter.html#cannot-open-the-connection-and-no-such-file-or-directory"><i class="fa fa-check"></i><b>11.2.4</b> <code>cannot open the connection</code> and <code>No such file or directory</code></a></li>
<li class="chapter" data-level="11.2.5" data-path="errorchapter.html"><a href="errorchapter.html#invalid-description-argument"><i class="fa fa-check"></i><b>11.2.5</b> <code>invalid 'description' argument</code></a></li>
<li class="chapter" data-level="11.2.6" data-path="errorchapter.html"><a href="errorchapter.html#missing-value-where-truefalse-needed"><i class="fa fa-check"></i><b>11.2.6</b> <code>missing value where TRUE/FALSE needed</code></a></li>
<li class="chapter" data-level="11.2.7" data-path="errorchapter.html"><a href="errorchapter.html#unexpected-in-..."><i class="fa fa-check"></i><b>11.2.7</b> <code>unexpected '=' in ...</code></a></li>
<li class="chapter" data-level="11.2.8" data-path="errorchapter.html"><a href="errorchapter.html#attempt-to-apply-non-function"><i class="fa fa-check"></i><b>11.2.8</b> <code>attempt to apply non-function</code></a></li>
<li class="chapter" data-level="11.2.9" data-path="errorchapter.html"><a href="errorchapter.html#undefined-columns-selected"><i class="fa fa-check"></i><b>11.2.9</b> <code>undefined columns selected</code></a></li>
<li class="chapter" data-level="11.2.10" data-path="errorchapter.html"><a href="errorchapter.html#subscript-out-of-bounds"><i class="fa fa-check"></i><b>11.2.10</b> <code>subscript out of bounds</code></a></li>
<li class="chapter" data-level="11.2.11" data-path="errorchapter.html"><a href="errorchapter.html#object-of-type-closure-is-not-subsettable"><i class="fa fa-check"></i><b>11.2.11</b> <code>Object of type ‘closure’ is not subsettable</code></a></li>
<li class="chapter" data-level="11.2.12" data-path="errorchapter.html"><a href="errorchapter.html#operator-is-invalid-for-atomic-vectors"><i class="fa fa-check"></i><b>11.2.12</b> <code>$ operator is invalid for atomic vectors</code></a></li>
<li class="chapter" data-level="11.2.13" data-path="errorchapter.html"><a href="errorchapter.html#list-object-cannot-be-coerced-to-type-double"><i class="fa fa-check"></i><b>11.2.13</b> <code>(list) object cannot be coerced to type ‘double’</code></a></li>
<li class="chapter" data-level="11.2.14" data-path="errorchapter.html"><a href="errorchapter.html#arguments-imply-differing-number-of-rows"><i class="fa fa-check"></i><b>11.2.14</b> <code>arguments imply differing number of rows</code></a></li>
<li class="chapter" data-level="11.2.15" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-a-binary-operator"><i class="fa fa-check"></i><b>11.2.15</b> <code>non-numeric argument to a binary operator</code></a></li>
<li class="chapter" data-level="11.2.16" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-mathematical-function"><i class="fa fa-check"></i><b>11.2.16</b> <code>non-numeric argument to mathematical function</code></a></li>
<li class="chapter" data-level="11.2.17" data-path="errorchapter.html"><a href="errorchapter.html#cannot-allocate-vector-of-size-..."><i class="fa fa-check"></i><b>11.2.17</b> <code>cannot allocate vector of size ...</code></a></li>
<li class="chapter" data-level="11.2.18" data-path="errorchapter.html"><a href="errorchapter.html#error-in-plot.new-figure-margins-too-large"><i class="fa fa-check"></i><b>11.2.18</b> <code>Error in plot.new() : figure margins too large</code></a></li>
<li class="chapter" data-level="11.2.19" data-path="errorchapter.html"><a href="errorchapter.html#error-in-.call.graphicsc_palette2-.callc_palette2-null-invalid-graphics-state"><i class="fa fa-check"></i><b>11.2.19</b> <code>Error in .Call.graphics(C_palette2, .Call(C_palette2, NULL)) : invalid graphics state</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="errorchapter.html"><a href="errorchapter.html#commonwarnings"><i class="fa fa-check"></i><b>11.3</b> Common warning messages</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="errorchapter.html"><a href="errorchapter.html#replacement-has-...-rows-..."><i class="fa fa-check"></i><b>11.3.1</b> <code>replacement has ... rows ...</code></a></li>
<li class="chapter" data-level="11.3.2" data-path="errorchapter.html"><a href="errorchapter.html#iferror"><i class="fa fa-check"></i><b>11.3.2</b> <code>the condition has length &gt; 1 and only the first element will be used</code></a></li>
<li class="chapter" data-level="11.3.3" data-path="errorchapter.html"><a href="errorchapter.html#number-of-items-to-replace-is-not-a-multiple-of-replacement-length"><i class="fa fa-check"></i><b>11.3.3</b> <code>number of items to replace is not a multiple of replacement length</code></a></li>
<li class="chapter" data-level="11.3.4" data-path="errorchapter.html"><a href="errorchapter.html#longer-object-length-is-not-a-multiple-of-shorter-object-length"><i class="fa fa-check"></i><b>11.3.4</b> <code>longer object length is not a multiple of shorter object length</code></a></li>
<li class="chapter" data-level="11.3.5" data-path="errorchapter.html"><a href="errorchapter.html#nas-introduced-by-coercion"><i class="fa fa-check"></i><b>11.3.5</b> <code>NAs introduced by coercion</code></a></li>
<li class="chapter" data-level="11.3.6" data-path="errorchapter.html"><a href="errorchapter.html#package-is-not-available-for-r-version-4.x.x"><i class="fa fa-check"></i><b>11.3.6</b> <code>package is not available (for R version 4.x.x)</code></a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="errorchapter.html"><a href="errorchapter.html#installationmessages"><i class="fa fa-check"></i><b>11.4</b> Messages printed when installing <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mathschap.html"><a href="mathschap.html"><i class="fa fa-check"></i><b>12</b> Mathematical appendix</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mathschap.html"><a href="mathschap.html#bootstrapcimaths"><i class="fa fa-check"></i><b>12.1</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="12.2" data-path="mathschap.html"><a href="mathschap.html#confintequal"><i class="fa fa-check"></i><b>12.2</b> The equivalence between confidence intervals and hypothesis tests</a></li>
<li class="chapter" data-level="12.3" data-path="mathschap.html"><a href="mathschap.html#twotypesofpvalues"><i class="fa fa-check"></i><b>12.3</b> Two types of p-values</a></li>
<li class="chapter" data-level="12.4" data-path="mathschap.html"><a href="mathschap.html#deviance"><i class="fa fa-check"></i><b>12.4</b> Deviance tests</a></li>
<li class="chapter" data-level="12.5" data-path="mathschap.html"><a href="mathschap.html#regreg"><i class="fa fa-check"></i><b>12.5</b> Regularised regression</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>13</b> Solutions to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch2"><i class="fa fa-check"></i>Chapter 2</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch3"><i class="fa fa-check"></i>Chapter 3</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch4"><i class="fa fa-check"></i>Chapter 4</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch5solutions"><i class="fa fa-check"></i>Chapter 5</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch6solutions"><i class="fa fa-check"></i>Chapter 6</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7solutions"><i class="fa fa-check"></i>Chapter 7</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7bsolutions"><i class="fa fa-check"></i>Chapter 8</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch8solutions"><i class="fa fa-check"></i>Chapter 9</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>Bibliography</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references1"><i class="fa fa-check"></i>Further reading</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references2"><i class="fa fa-check"></i>Online resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="divider"></li>
<li>&copy; 2021 Mans Thulin.</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="messychapter" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Dealing with messy data<a href="messychapter.html#messychapter" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>…or, put differently, <em>welcome to the real world</em>. Real datasets are seldom as tidy and clean as those you have seen in the previous examples in this book. On the contrary, real data is messy. Things will be out of place, and formatted in the wrong way. You’ll need to filter the rows to remove those that aren’t supposed to be used in the analysis. You’ll need to remove some columns and merge others. You will need to wrestle, clean, coerce, and coax your data until it finally has the right format. Only then will you be able to actually analyse it.</p>
<p>This chapter contains a number of examples that serve as cookbook recipes for common data wrangling tasks. And as with any cookbook, you’ll find yourself returning to some recipes more or less every day, until you know them by heart, while you never find the right time to use other recipes. You do definitely not have to know all of them by heart, and can always go back and look up a recipe that you need.</p>
<p>After working with the material in this chapter, you will be able to use R to:</p>
<ul>
<li>Handle numeric and categorical data,</li>
<li>Manipulate and find patterns in text strings,</li>
<li>Work with dates and times,</li>
<li>Filter, subset, sort, and reshape your data using <code>data.table</code>, <code>dplyr</code>, and <code>tidyr</code>,</li>
<li>Split and merge datasets,</li>
<li>Scrape data from the web,</li>
<li>Import data from different file formats.</li>
</ul>
<div id="coercion" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Changing data types<a href="messychapter.html#coercion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Exercise <a href="datachapter.html#exr:ch3exc1">3.1</a> you discovered that R implicitly coerces variables into other data types when needed. For instance, if you add a <code>numeric</code> to a <code>logical</code>, the result is a <code>numeric</code>. And if you place them together in a vector, the vector will contain two <code>numeric</code> values:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="messychapter.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb351-2"><a href="messychapter.html#cb351-2" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">5</span>)</span>
<span id="cb351-3"><a href="messychapter.html#cb351-3" aria-hidden="true" tabindex="-1"></a>v1</span></code></pre></div>
<p>However, if you add a <code>numeric</code> to a <code>character</code>, the operation fails. If you put them together in a vector, both become <code>character</code> strings:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="messychapter.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;One&quot;</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb352-2"><a href="messychapter.html#cb352-2" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;One&quot;</span>, <span class="dv">5</span>)</span>
<span id="cb352-3"><a href="messychapter.html#cb352-3" aria-hidden="true" tabindex="-1"></a>v2</span></code></pre></div>
<p>There is a hierarchy for data types in R: <code>logical</code> &lt; <code>integer</code> &lt; <code>numeric</code> &lt; <code>character</code>. When variables of different types are somehow combined (with addition, put in the same vector, and so on), R will coerce both to the higher ranking type. That is why <code>v1</code> contained <code>numeric</code> variables (<code>numeric</code> is higher ranked than <code>logical</code>) and <code>v2</code> contained <code>character</code> values (<code>character</code> is higher ranked than <code>numeric</code>).</p>
<p>Automatic coercion is often useful, but will sometimes cause problems. As an example, a vector of numbers may accidentally be converted to a <code>character</code> vector, which will confuse plotting functions. Luckily it is possible to convert objects to other data types. The functions most commonly used for this are <code>as.logical</code>, <code>as.numeric</code> and <code>as.character</code>. Here are some examples of how they can be used:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="messychapter.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">1</span>)           <span class="co"># Should be TRUE</span></span>
<span id="cb353-2"><a href="messychapter.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="st">&quot;FALSE&quot;</span>)     <span class="co"># Should be FALSE</span></span>
<span id="cb353-3"><a href="messychapter.html#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="cn">TRUE</span>)        <span class="co"># Should be 1</span></span>
<span id="cb353-4"><a href="messychapter.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="st">&quot;2.718282&quot;</span>)  <span class="co"># Should be numeric 2.718282</span></span>
<span id="cb353-5"><a href="messychapter.html#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(<span class="fl">2.718282</span>)  <span class="co"># Should be the string &quot;2.718282&quot;</span></span>
<span id="cb353-6"><a href="messychapter.html#cb353-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(<span class="cn">TRUE</span>)      <span class="co"># Should be the string &quot;TRUE&quot;</span></span></code></pre></div>
<p>A word of warning though - conversion only works if R can find a natural conversion between the types. Here are some examples where conversion fails. Note that only some of them cause warning messages:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="messychapter.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="st">&quot;two&quot;</span>)                   <span class="co"># Should be 2</span></span>
<span id="cb354-2"><a href="messychapter.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="st">&quot;1+1&quot;</span>)                   <span class="co"># Should be 2</span></span>
<span id="cb354-3"><a href="messychapter.html#cb354-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="st">&quot;2,718282&quot;</span>)              <span class="co"># Should be numeric 2.718282</span></span>
<span id="cb354-4"><a href="messychapter.html#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="st">&quot;Vaccines cause autism&quot;</span>) <span class="co"># Should be FALSE</span></span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc1" class="exercise"><strong>Exercise 5.1  </strong></span>The following tasks are concerned with converting and checking data types:</p>
<ol style="list-style-type: decimal">
<li><p>What happens if you apply <code>as.logical</code> to the <code>numeric</code> values 0 and 1? What happens if you apply it to other numbers?</p></li>
<li><p>What happens if you apply <code>as.character</code> to a vector containing <code>numeric</code> values?</p></li>
<li><p>The functions <code>is.logical</code>, <code>is.numeric</code> and <code>is.character</code> can be used to check if a variable is a <code>logical</code>, <code>numeric</code> or <code>character</code>, respectively. What type of object do they return?</p></li>
<li><p>Is <code>NA</code> a <code>logical</code>, <code>numeric</code> or <code>character</code>?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions1">(Click here to go to the solution.)</a></p>
</div>
<div id="lists2" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Working with lists<a href="messychapter.html#lists2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A data structure that is very convenient for storing data of different types is <code>list</code>. You can think of a <code>list</code> as a data frame where you can put different types of objects in each column: like a <code>numeric</code> vector of length 5 in the first, a data frame in the second and a single <code>character</code> in the third<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>. Here is an example of how to create a <code>list</code> using the function of the same name:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="messychapter.html#cb355-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">my_numbers =</span> <span class="fu">c</span>(<span class="dv">86</span>, <span class="dv">42</span>, <span class="dv">57</span>, <span class="dv">61</span>, <span class="dv">22</span>),</span>
<span id="cb355-2"><a href="messychapter.html#cb355-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">my_data =</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb355-3"><a href="messychapter.html#cb355-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">my_text =</span> <span class="st">&quot;Lists are the best.&quot;</span>)</span></code></pre></div>
<p>To access the elements in the list, we can use the same <code>$</code> notation as for data frames:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="messychapter.html#cb356-1" aria-hidden="true" tabindex="-1"></a>my_list<span class="sc">$</span>my_numbers</span>
<span id="cb356-2"><a href="messychapter.html#cb356-2" aria-hidden="true" tabindex="-1"></a>my_list<span class="sc">$</span>my_data</span>
<span id="cb356-3"><a href="messychapter.html#cb356-3" aria-hidden="true" tabindex="-1"></a>my_list<span class="sc">$</span>my_text</span></code></pre></div>
<p>In addition, we can access them using indices, but using <em>double</em> brackets:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="messychapter.html#cb357-1" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="dv">1</span>]]</span>
<span id="cb357-2"><a href="messychapter.html#cb357-2" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="dv">2</span>]]</span>
<span id="cb357-3"><a href="messychapter.html#cb357-3" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="dv">3</span>]]</span></code></pre></div>
<p>To access elements within the elements of lists, additional brackets can be added. For instance, if you wish to access the second element of the <code>my_numbers</code> vector, you can use either of these:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="messychapter.html#cb358-1" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb358-2"><a href="messychapter.html#cb358-2" aria-hidden="true" tabindex="-1"></a>my_list<span class="sc">$</span>my_numbers[<span class="dv">2</span>]</span></code></pre></div>
<div id="splitvector" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Splitting vectors into lists<a href="messychapter.html#splitvector" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider the <code>airquality</code> dataset, which among other things describe the temperature on each day during a five-month period. Suppose that we wish to split the <code>airquality$Temp</code> vector into five separate vectors: one for each month. We could do this by repeated filtering, e.g.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="messychapter.html#cb359-1" aria-hidden="true" tabindex="-1"></a>temp_may <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Temp[airquality<span class="sc">$</span>Month <span class="sc">==</span> <span class="dv">5</span>]</span>
<span id="cb359-2"><a href="messychapter.html#cb359-2" aria-hidden="true" tabindex="-1"></a>temp_june <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Temp[airquality<span class="sc">$</span>Month <span class="sc">==</span> <span class="dv">6</span>]</span>
<span id="cb359-3"><a href="messychapter.html#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ...and so on.</span></span></code></pre></div>
<p>Apart from the fact that this isn’t a very good-looking solution, this would be infeasible if we needed to split our vector into a larger number of new vectors. Fortunately, there is a function that allows us to split the vector by month, storing the result as a list - <code>split</code>:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="messychapter.html#cb360-1" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">split</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month)</span>
<span id="cb360-2"><a href="messychapter.html#cb360-2" aria-hidden="true" tabindex="-1"></a>temps</span>
<span id="cb360-3"><a href="messychapter.html#cb360-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-4"><a href="messychapter.html#cb360-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To access the temperatures for June:</span></span>
<span id="cb360-5"><a href="messychapter.html#cb360-5" aria-hidden="true" tabindex="-1"></a>temps<span class="sc">$</span><span class="st">`</span><span class="at">6</span><span class="st">`</span></span>
<span id="cb360-6"><a href="messychapter.html#cb360-6" aria-hidden="true" tabindex="-1"></a>temps[[<span class="dv">2</span>]]</span>
<span id="cb360-7"><a href="messychapter.html#cb360-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-8"><a href="messychapter.html#cb360-8" aria-hidden="true" tabindex="-1"></a><span class="co"># To give more informative names to the elements in the list:</span></span>
<span id="cb360-9"><a href="messychapter.html#cb360-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temps) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;May&quot;</span>, <span class="st">&quot;June&quot;</span>, <span class="st">&quot;July&quot;</span>, <span class="st">&quot;August&quot;</span>, <span class="st">&quot;September&quot;</span>)</span>
<span id="cb360-10"><a href="messychapter.html#cb360-10" aria-hidden="true" tabindex="-1"></a>temps<span class="sc">$</span>June</span></code></pre></div>
<p>Note that, in breach of the rules for variable names in R, the original variable names here were numbers (actually <code>character</code> variables that happened to contain numeric characters). When accessing them using <code>$</code> notation, you need to put them between backticks (<code>`</code>), e.g. <code>temps$`6`</code>, to make it clear that <code>6</code> is a variable name and not a number.</p>
</div>
<div id="collapsing-lists-into-vectors" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Collapsing lists into vectors<a href="messychapter.html#collapsing-lists-into-vectors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Conversely, there are times where you want to collapse a list into a vector. This can be done using <code>unlist</code>:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="messychapter.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(temps)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc1b" class="exercise"><strong>Exercise 5.2  </strong></span>Load the <code>vas.csv</code> data from Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>. Split the <code>VAS</code> vector so that you get a list containing one vector for each patient. How can you then access the VAS values for patient 212?</p>
</div>
<p><a href="solutions.html#ch5solutions1b">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="working-with-numbers" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Working with numbers<a href="messychapter.html#working-with-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A lot of data analyses involve numbers, which typically are represented as <code>numeric</code> values in R. We’ve already seen in Section <a href="thebasics.html#maths">2.3.5</a> that there are numerous mathematical operators that can be applied to numbers in R. But there are also other functions that come in handy when working with numbers.</p>
<div id="rounding-numbers" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Rounding numbers<a href="messychapter.html#rounding-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At times you may want to round numbers, either for presentation purposes or for some other reason. There are several functions that can be used for this:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="messychapter.html#cb362-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.1241</span>, <span class="fl">3.86234</span>, <span class="fl">4.5</span>, <span class="sc">-</span><span class="fl">4.5</span>, <span class="fl">10000.1001</span>)</span>
<span id="cb362-2"><a href="messychapter.html#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(a, <span class="dv">3</span>)           <span class="co"># Rounds to 3 decimal places</span></span>
<span id="cb362-3"><a href="messychapter.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(a, <span class="dv">3</span>)          <span class="co"># Rounds to 3 significant digits</span></span>
<span id="cb362-4"><a href="messychapter.html#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(a)            <span class="co"># Rounds up to the nearest integer</span></span>
<span id="cb362-5"><a href="messychapter.html#cb362-5" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(a)              <span class="co"># Rounds down to the nearest integer</span></span>
<span id="cb362-6"><a href="messychapter.html#cb362-6" aria-hidden="true" tabindex="-1"></a><span class="fu">trunc</span>(a)              <span class="co"># Rounds to the nearest integer, toward 0</span></span>
<span id="cb362-7"><a href="messychapter.html#cb362-7" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># (note the difference in how 4.5</span></span>
<span id="cb362-8"><a href="messychapter.html#cb362-8" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#  and -4.5 are treated!)</span></span></code></pre></div>
</div>
<div id="sums-and-means-in-data-frames" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Sums and means in data frames<a href="messychapter.html#sums-and-means-in-data-frames" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When working with numerical data, you’ll frequently find yourself wanting to compute sums or means of either columns or rows of data frames. The <code>colSums</code>, <code>rowSums</code>, <code>colMeans</code> and <code>rowMeans</code> functions can be used to do this. Here is an example with an expanded version of the <code>bookstore</code> data, where three purchases have been recorded for each customer:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="messychapter.html#cb363-1" aria-hidden="true" tabindex="-1"></a>bookstore2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">purchase1 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">59</span>, <span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">22</span>, <span class="dv">160</span>,</span>
<span id="cb363-2"><a href="messychapter.html#cb363-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="dv">34</span>, <span class="dv">34</span>, <span class="dv">29</span>),</span>
<span id="cb363-3"><a href="messychapter.html#cb363-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">purchase2 =</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">67</span>, <span class="dv">9</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">81</span>,</span>
<span id="cb363-4"><a href="messychapter.html#cb363-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="dv">19</span>, <span class="dv">55</span>, <span class="dv">8</span>),</span>
<span id="cb363-5"><a href="messychapter.html#cb363-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">purchase3 =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">62</span>, <span class="dv">11</span>, <span class="dv">18</span>, <span class="dv">33</span>, <span class="dv">57</span>,</span>
<span id="cb363-6"><a href="messychapter.html#cb363-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="dv">24</span>, <span class="dv">49</span>, <span class="dv">29</span>))</span>
<span id="cb363-7"><a href="messychapter.html#cb363-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-8"><a href="messychapter.html#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(bookstore2)   <span class="co"># The total amount for customers&#39; 1st, 2nd and</span></span>
<span id="cb363-9"><a href="messychapter.html#cb363-9" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># 3rd purchases</span></span>
<span id="cb363-10"><a href="messychapter.html#cb363-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(bookstore2)   <span class="co"># The total amount for each customer</span></span>
<span id="cb363-11"><a href="messychapter.html#cb363-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(bookstore2)  <span class="co"># Mean purchase for 1st, 2nd and 3rd purchases</span></span>
<span id="cb363-12"><a href="messychapter.html#cb363-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rowMeans</span>(bookstore2)  <span class="co"># Mean purchase for each customer</span></span></code></pre></div>
<p>Moving beyond sums and means, in Section <a href="progchapter.html#vectorloops">6.5</a> you’ll learn how to apply any function to the rows or columns of a data frame.</p>
</div>
<div id="rle" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Summaries of series of numbers<a href="messychapter.html#rle" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When a <code>numeric</code> vector contains a series of consecutive measurements, as is the case e.g. in a time series, it is often of interest to compute various cumulative summaries. For instance, if the vector contains the daily revenue of a business during a month, it may be of value to know the total revenue up to each day - that is, the <em>cumulative sum</em> for each day.</p>
<p>Let’s return to the <code>a10</code> data from Section <a href="eda.html#tsplots">4.6</a>, which described the monthly anti-diabetic drug sales in Australia during 1991-2008.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="messychapter.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb364-2"><a href="messychapter.html#cb364-2" aria-hidden="true" tabindex="-1"></a>a10</span></code></pre></div>
<p>Elements 7 to 18 contain the sales for 1992. We can compute the total, highest and smallest monthly sales up to and including each month using <code>cumsum</code>, <code>cummax</code> and <code>cummin</code>:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="messychapter.html#cb365-1" aria-hidden="true" tabindex="-1"></a>a10[<span class="dv">7</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb365-2"><a href="messychapter.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(a10[<span class="dv">7</span><span class="sc">:</span><span class="dv">18</span>])  <span class="co"># Total sales</span></span>
<span id="cb365-3"><a href="messychapter.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cummax</span>(a10[<span class="dv">7</span><span class="sc">:</span><span class="dv">18</span>])  <span class="co"># Highest monthly sales</span></span>
<span id="cb365-4"><a href="messychapter.html#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cummin</span>(a10[<span class="dv">7</span><span class="sc">:</span><span class="dv">18</span>])  <span class="co"># Lowest monthly sales</span></span>
<span id="cb365-5"><a href="messychapter.html#cb365-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-6"><a href="messychapter.html#cb365-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total sales up to and including each month:</span></span>
<span id="cb365-7"><a href="messychapter.html#cb365-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="fu">cumsum</span>(a10[<span class="dv">7</span><span class="sc">:</span><span class="dv">18</span>]),</span>
<span id="cb365-8"><a href="messychapter.html#cb365-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb365-9"><a href="messychapter.html#cb365-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Total sales&quot;</span>,</span>
<span id="cb365-10"><a href="messychapter.html#cb365-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p>In addition, the <code>cumprod</code> function can be used to compute cumulative products.</p>
<p>At other times, we are interested in studying <em>run lengths</em> in series, that is, the lengths of runs of equal values in a vector. Consider the <code>upp_temp</code> vector defined in the code chunk below, which contains the daily temperatures in Uppsala, Sweden, in February 2020<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="messychapter.html#cb366-1" aria-hidden="true" tabindex="-1"></a>upp_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">5.3</span>, <span class="fl">3.2</span>, <span class="sc">-</span><span class="fl">1.4</span>, <span class="sc">-</span><span class="fl">3.4</span>, <span class="sc">-</span><span class="fl">0.6</span>, <span class="sc">-</span><span class="fl">0.6</span>, <span class="sc">-</span><span class="fl">0.8</span>, <span class="fl">2.7</span>, <span class="fl">4.2</span>, <span class="fl">5.7</span>,</span>
<span id="cb366-2"><a href="messychapter.html#cb366-2" aria-hidden="true" tabindex="-1"></a>              <span class="fl">3.1</span>, <span class="fl">2.3</span>, <span class="sc">-</span><span class="fl">0.6</span>, <span class="sc">-</span><span class="fl">1.3</span>, <span class="fl">2.9</span>, <span class="fl">6.9</span>, <span class="fl">6.2</span>, <span class="fl">6.3</span>, <span class="fl">3.2</span>, <span class="fl">0.6</span>, <span class="fl">5.5</span>,</span>
<span id="cb366-3"><a href="messychapter.html#cb366-3" aria-hidden="true" tabindex="-1"></a>              <span class="fl">6.1</span>, <span class="fl">4.4</span>, <span class="fl">1.0</span>, <span class="sc">-</span><span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">0.6</span>)</span></code></pre></div>
<p>It could be interesting to look at runs of sub-zero days, i.e. consecutive days with sub-zero temperatures. The <code>rle</code> function counts the lengths of runs of equal values in a vector. To find the length of runs of temperatures below or above zero we can use the vector defined by the condition <code>upp_temp &lt; 0</code>, the values of which are <code>TRUE</code> on sub-zero days and <code>FALSE</code> when the temperature is 0 or higher. When we apply <code>rle</code> to this vector, it returns the length and value of the runs:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="messychapter.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rle</span>(upp_temp <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code></pre></div>
<p>We first have a 2-day run of above zero temperatures (<code>FALSE</code>), then a 5-day run of sub-zero temperatures (<code>TRUE</code>), then a 5-day run of above zero temperatures, and so on.</p>
</div>
<div id="scientific-notation-1e-03" class="section level3 hasAnchor" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Scientific notation <code>1e-03</code><a href="messychapter.html#scientific-notation-1e-03" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When printing very large or very small numbers, R uses <em>scientific notation</em>, meaning that <span class="math inline">\(7,000,000\)</span> (7 followed by 6 zeroes) is displayed as (the mathematically equivalent) <span class="math inline">\(7\cdot 10^6\)</span> and <span class="math inline">\(0.0000007\)</span> is displayed as <span class="math inline">\(7\cdot 10^{-7}\)</span>. Well, almost, the <em>ten raised to the power of x</em> bit isn’t really displayed as <span class="math inline">\(10^x\)</span>, but as <code>e+x</code>, a notation used in many programming languages and calculators. Here are some examples:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="messychapter.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="dv">7000000</span></span>
<span id="cb368-2"><a href="messychapter.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0000007</span></span>
<span id="cb368-3"><a href="messychapter.html#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="fl">7e+07</span></span>
<span id="cb368-4"><a href="messychapter.html#cb368-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">30</span>)</span></code></pre></div>
<p>Scientific notation is a convenient way to display large numbers, but it’s not always desirable. If you just want to print the number, the <code>format</code> function can be used to convert it to a character, suppressing scientific notation:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="messychapter.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="dv">7000000</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>If you still want your number to be a <code>numeric</code> (as you often do), a better choice is to change the option for when R uses scientific notation. This can be done using the <code>scipen</code> argument in the <code>options</code> function:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="messychapter.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">1000</span>)</span>
<span id="cb370-2"><a href="messychapter.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="dv">7000000</span></span>
<span id="cb370-3"><a href="messychapter.html#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0000007</span></span>
<span id="cb370-4"><a href="messychapter.html#cb370-4" aria-hidden="true" tabindex="-1"></a><span class="fl">7e+07</span></span>
<span id="cb370-5"><a href="messychapter.html#cb370-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">30</span>)</span></code></pre></div>
<p>To revert this option back to the default, you can use:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="messychapter.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">0</span>)</span>
<span id="cb371-2"><a href="messychapter.html#cb371-2" aria-hidden="true" tabindex="-1"></a><span class="dv">7000000</span></span>
<span id="cb371-3"><a href="messychapter.html#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0000007</span></span>
<span id="cb371-4"><a href="messychapter.html#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="fl">7e+07</span></span>
<span id="cb371-5"><a href="messychapter.html#cb371-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">30</span>)</span></code></pre></div>
<p>Note that this option only affects how R <em>prints</em> numbers, and not how they are treated in computations.</p>
</div>
<div id="floatingpoints" class="section level3 hasAnchor" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> Floating point arithmetics<a href="messychapter.html#floatingpoints" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some numbers cannot be written in finite decimal forms. Take <span class="math inline">\(1/3\)</span> for example, the decimal form of which is <span class="math display">\[0.33333333333333333333333333333333\ldots.\]</span></p>
<p>Clearly, the computer cannot store this number exactly, as that would require an infinite memory<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a>. Because of this, numbers in computers are stored as <em>floating point numbers</em>, which aim to strike a balance between <em>range</em> (being able to store both very small and very large numbers) and <em>precision</em> (being able to represent numbers accurately). Most of the time, calculations with floating points yield exactly the results that we’d expect, but sometimes these non-exact representations of numbers will cause unexpected problems. If we wish to compute <span class="math inline">\(1.5-0.2\)</span> and <span class="math inline">\(1.1-0.2\)</span>, say, we could of course use R for that. Let’s see if it gets the answers right:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="messychapter.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.5</span> <span class="sc">-</span> <span class="fl">0.2</span></span>
<span id="cb372-2"><a href="messychapter.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.5</span> <span class="sc">-</span> <span class="fl">0.2</span> <span class="sc">==</span> <span class="fl">1.3</span>  <span class="co"># Check if 1.5-0.2=1.3</span></span>
<span id="cb372-3"><a href="messychapter.html#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span></span>
<span id="cb372-4"><a href="messychapter.html#cb372-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span> <span class="sc">==</span> <span class="fl">0.9</span>  <span class="co"># Check if 1.1-0.2=0.9</span></span></code></pre></div>
<p>The limitations of floating point arithmetics causes the second calculation to fail. To see what has happened, we can use <code>sprintf</code> to print numbers with 30 decimals (by default, R prints a rounded version with fewer decimals):</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="messychapter.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.30f&quot;</span>, <span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span>)</span>
<span id="cb373-2"><a href="messychapter.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.30f&quot;</span>, <span class="fl">0.9</span>)</span></code></pre></div>
<p>The first 12 decimals are identical, but after that the two numbers <code>1.1 - 0.2</code> and <code>0.9</code> diverge. In our other example, <span class="math inline">\(1.5 - 0.2\)</span>, we don’t encounter this problem - both <code>1.5 - 0.2</code> and <code>0.3</code> have the same floating point representation:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="messychapter.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.30f&quot;</span>, <span class="fl">1.5</span> <span class="sc">-</span> <span class="fl">0.2</span>)</span>
<span id="cb374-2"><a href="messychapter.html#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.30f&quot;</span>, <span class="fl">1.3</span>)</span></code></pre></div>
<p>The order of the operations also matters in this case. The following three calculations would all yield identical results if performed with real numbers, but in floating point arithmetics the results differ:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="messychapter.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span> <span class="sc">-</span> <span class="fl">0.9</span></span>
<span id="cb375-2"><a href="messychapter.html#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.9</span> <span class="sc">-</span> <span class="fl">0.2</span></span>
<span id="cb375-3"><a href="messychapter.html#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> (<span class="fl">0.9</span> <span class="sc">+</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p>In most cases, it won’t make a difference whether a variable is represented as <span class="math inline">\(0.90000000000000013\ldots\)</span> or <span class="math inline">\(0.90000000000000002\ldots\)</span>, but in some cases tiny differences like that can propagate and cause massive problems. A famous example of this involves the US Patriot surface-to-air defence system, which at the end of the first Gulf war missed an incoming missile due to an error in floating point arithmetics<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a>. It is important to be aware of the fact that floating point arithmetics occasionally will yield incorrect results. This can happen for numbers of any size, but is more likely to occur when very large and very small numbers appear in the same computation.</p>
<p>So, <code>1.1 - 0.2</code> and <code>0.9</code> may not be the same thing in floating point arithmetics, but at least they are <em>nearly</em> the same thing. The <code>==</code> operator checks if two numbers are exactly equal, but there is an alternative that can be used to check if two numbers are nearly equal: <code>all.equal</code>. If the two numbers are (nearly) equal, it returns <code>TRUE</code>, and if they are not, it returns a description of how they differ. In order to avoid the latter, we can use the <code>isTRUE</code> function to return <code>FALSE</code> instead:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="messychapter.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span> <span class="sc">==</span> <span class="fl">0.9</span></span>
<span id="cb376-2"><a href="messychapter.html#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fl">1.1</span> <span class="sc">-</span> <span class="fl">0.2</span>, <span class="fl">0.9</span>)</span>
<span id="cb376-3"><a href="messychapter.html#cb376-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb376-4"><a href="messychapter.html#cb376-4" aria-hidden="true" tabindex="-1"></a><span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc2" class="exercise"><strong>Exercise 5.3  </strong></span>These tasks showcase some problems that are commonly faced when working with numeric data:</p>
<ol style="list-style-type: decimal">
<li><p>The vector <code>props &lt;- c(0.1010, 0.2546, 0.6009, 0.0400, 0.0035)</code> contains proportions (which, by definition, are between 0 and 1). Convert the proportions to percentages with one decimal place.</p></li>
<li><p>Compute the highest and lowest temperatures up to and including each day in the <code>airquality</code> dataset.</p></li>
<li><p>What is the longest run of days with temperatures above 80 in the <code>airquality</code> dataset?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions2">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc3" class="exercise"><strong>Exercise 5.4  </strong></span>These tasks are concerned with floating point arithmetics:</p>
<ol style="list-style-type: decimal">
<li><p>Very large numbers, like <code>10e500</code>, are represented by <code>Inf</code> (infinity) in R. Try to find out what the largest number that can be represented as a floating point number in R is.</p></li>
<li><p>Due to an error in floating point arithmetics, <code>sqrt(2)^2 - 2</code> is not equal to <code>0</code>. Change the order of the operations so that the results is <code>0</code>.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions3">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="factors" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Working with factors<a href="messychapter.html#factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Sections <a href="thebasics.html#catdata1">2.4.2</a> and <a href="thebasics.html#catdata2">2.6</a> we looked at how to analyse and visualise categorical data, i.e data where the variables can take a fixed number of possible values that somehow correspond to groups or categories. But so far we haven’t really gone into how to handle categorical variables in R.</p>
<p>Categorical data is stored in R as <code>factor</code> variables. You may ask why a special data structure is needed for categorical data, when we could just use <code>character</code> variables to represent the categories. Indeed, the latter is what R does by default, e.g. when creating a <code>data.frame</code> object or reading data from <code>.csv</code> and <code>.xlsx</code> files.</p>
<p>Let’s say that you’ve conducted a survey on students’ smoking habits. The possible responses are <em>Never</em>, <em>Occasionally</em>, <em>Regularly</em> and <em>Heavy</em>. From 10 students, you get the following responses:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="messychapter.html#cb377-1" aria-hidden="true" tabindex="-1"></a>smoke <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Heavy&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Occasionally&quot;</span>,</span>
<span id="cb377-2"><a href="messychapter.html#cb377-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;No&quot;</span>)</span></code></pre></div>
<p>Note that the last answer is invalid - <code>No</code> was not one of the four answers that were allowed for the question.</p>
<p>You could use <code>table</code> to get a summary of how many answers of each type that you got:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="messychapter.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(smoke)</span></code></pre></div>
<p>But the categories are not presented in the correct order! There is a clear order between the different categories, <em>Never</em> &lt; <em>Occasionally</em> &lt; <em>Regularly</em> &lt; <em>Heavy</em>, but <code>table</code> doesn’t present the results in that way. Moreover, R didn’t recognise that <code>No</code> was an invalid answer, and treats it just the same as the other categories.</p>
<p>This is where <code>factor</code> variables come in. They allow you to specify which values your variable can take, and the ordering between them (if any).</p>
<div id="creating-factors" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Creating factors<a href="messychapter.html#creating-factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When creating a <code>factor</code> variable, you typically start with a <code>character</code>, <code>numeric</code> or <code>logical</code> variable, the values of which are turned into categories. To turn the <code>smoke</code> vector that you created in the previous section into a <code>factor</code>, you can use the <code>factor</code> function:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="messychapter.html#cb379-1" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke)</span></code></pre></div>
<p>You can inspect the elements, and <em>levels</em>, i.e. the values that the categorical variable takes, as follows:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="messychapter.html#cb380-1" aria-hidden="true" tabindex="-1"></a>smoke2</span>
<span id="cb380-2"><a href="messychapter.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span></code></pre></div>
<p>So far, we haven’t solved neither the problem of the categories being in the wrong order nor that invalid <code>No</code> value. To fix both these problems, we can use the <code>levels</code> argument in <code>factor</code>:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="messychapter.html#cb381-1" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Occasionally&quot;</span>,</span>
<span id="cb381-2"><a href="messychapter.html#cb381-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;Heavy&quot;</span>),</span>
<span id="cb381-3"><a href="messychapter.html#cb381-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb381-4"><a href="messychapter.html#cb381-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-5"><a href="messychapter.html#cb381-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results:</span></span>
<span id="cb381-6"><a href="messychapter.html#cb381-6" aria-hidden="true" tabindex="-1"></a>smoke2</span>
<span id="cb381-7"><a href="messychapter.html#cb381-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span>
<span id="cb381-8"><a href="messychapter.html#cb381-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(smoke2)</span></code></pre></div>
<p>You can control the order in which the levels are presented by choosing which order we write them in in the <code>levels</code> argument. The <code>ordered = TRUE</code> argument specifies that the order of the variables is <em>meaningful</em>. It can be excluded in cases where you wish to specify the order in which the categories should be presented purely for presentation purposes (e.g. when specifying whether to use the order <code>Male/Female/Other</code> or <code>Female/Male/Other</code>). Also note that the <code>No</code> answer now became an <code>NA</code>, which in the case of <code>factor</code> variables represents both missing observations and invalid observations. To find the values of <code>smoke</code> that became <code>NA</code> in <code>smoke2</code> you can use <code>which</code> and <code>is.na</code>:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="messychapter.html#cb382-1" aria-hidden="true" tabindex="-1"></a>smoke[<span class="fu">which</span>(<span class="fu">is.na</span>(smoke2))]</span></code></pre></div>
<p>By checking the original values of the <code>NA</code> elements, you can see if they should be excluded from the analysis or recoded into a proper category (<code>No</code> could for instance be recoded into <code>Never</code>). In Section <a href="messychapter.html#regexp">5.5.3</a> you’ll learn how to replace values in larger datasets automatically using regular expressions.</p>
</div>
<div id="factorlevels" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Changing factor levels<a href="messychapter.html#factorlevels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we created <code>smoke2</code>, one of the elements became an <code>NA</code>. <code>NA</code> was however not included as a level of the <code>factor</code>. Sometimes it is desirable to include <code>NA</code> as a level, for instance when you want to analyse rows with missing data. This is easily done using the <code>addNA</code> function:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="messychapter.html#cb383-1" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">addNA</span>(smoke2)</span></code></pre></div>
<p>If you wish to change the name of one or more of the <code>factor</code> levels, you can do it directly via the <code>levels</code> function. For instance, we can change the name of the <code>NA</code> category, which is the 5th level of <code>smoke2</code>, as follows:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="messychapter.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Invalid answer&quot;</span></span></code></pre></div>
<p>The above solution is a little brittle in that it relies on specifying the index of the level name, which can change if we’re not careful. More robust solutions using the <code>data.table</code> and <code>dplyr</code> packages are presented in Section <a href="messychapter.html#recodedplyr">5.7.6</a>.</p>
<p>Finally, if you’ve added more levels than what are actually used, these can be dropped using the <code>droplevels</code> function:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="messychapter.html#cb385-1" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Occasionally&quot;</span>,</span>
<span id="cb385-2"><a href="messychapter.html#cb385-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;Heavy&quot;</span>,</span>
<span id="cb385-3"><a href="messychapter.html#cb385-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Constantly&quot;</span>),</span>
<span id="cb385-4"><a href="messychapter.html#cb385-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb385-5"><a href="messychapter.html#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span>
<span id="cb385-6"><a href="messychapter.html#cb385-6" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(smoke2)</span>
<span id="cb385-7"><a href="messychapter.html#cb385-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span></code></pre></div>
</div>
<div id="changing-the-order-of-levels" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Changing the order of levels<a href="messychapter.html#changing-the-order-of-levels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now suppose that we’d like the levels of the <code>smoke2</code> variable to be presented in the reverse order: <em>Heavy</em>, <em>Regularly</em>, <em>Occasionally</em>, and <em>Never</em>. This can be done by a new call to <code>factor</code>, where the new level order is specified in the <code>levels</code> argument:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="messychapter.html#cb386-1" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Heavy&quot;</span>, <span class="st">&quot;Regularly&quot;</span>,</span>
<span id="cb386-2"><a href="messychapter.html#cb386-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Occasionally&quot;</span>, <span class="st">&quot;Never&quot;</span>))</span>
<span id="cb386-3"><a href="messychapter.html#cb386-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-4"><a href="messychapter.html#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results:</span></span>
<span id="cb386-5"><a href="messychapter.html#cb386-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span></code></pre></div>
</div>
<div id="combining-levels" class="section level3 hasAnchor" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> Combining levels<a href="messychapter.html#combining-levels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, <code>levels</code> can be used to merge categories by replacing their separate names with a single name. For instance, we can combine the smoking categories <em>Occasionally</em>, <em>Regularly</em>, and <em>Heavy</em> to a single category named <em>Yes</em>. Assuming that these are first, second and third in the list of names (as will be the case if you’ve run the last code chunk above), here’s how to do it:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="messychapter.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Yes&quot;</span></span>
<span id="cb387-2"><a href="messychapter.html#cb387-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-3"><a href="messychapter.html#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results:</span></span>
<span id="cb387-4"><a href="messychapter.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoke2)</span></code></pre></div>
<p>Alternative ways to do this are presented in Section <a href="messychapter.html#recodedplyr">5.7.6</a>.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc4" class="exercise"><strong>Exercise 5.5  </strong></span>In Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a> you learned how to create a <code>factor</code> variable from a <code>numeric</code> variable using <code>cut</code>. Return to your solution <a href="solutions.html#ch3solutions3b">(or the solution at the back of the book)</a> and do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Change the category names to <code>Mild</code>, <code>Moderate</code> and <code>Hot</code>.</p></li>
<li><p>Combine <code>Moderate</code> and <code>Hot</code> into a single level named <code>Hot</code>.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions4">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc5" class="exercise"><strong>Exercise 5.6  </strong></span>Load the <code>msleep</code> data from the <code>ggplot2</code> package. Note that categorical variable <code>vore</code> is stored as a <code>character</code>. Convert it to a <code>factor</code> by running <code>msleep$vore &lt;- factor(msleep$vore)</code>.</p>
<ol style="list-style-type: decimal">
<li><p>How are the resulting factor levels ordered? Why are they ordered in that way?</p></li>
<li><p>Compute the mean value of <code>sleep_total</code> for each <code>vore</code> group.</p></li>
<li><p>Sort the factor levels according to their <code>sleep_total</code> means. Hint: this can be done manually, or more elegantly using e.g. a combination of the functions <code>rank</code> and <code>match</code> in an intermediate step.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions5">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="strings" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Working with strings<a href="messychapter.html#strings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Text in R is represented by <code>character</code> strings. These are created using double or single quotes. I recommend double quotes for three reasons. First, it is the default in R, and is the recommended style (see e.g. <code>?Quotes</code>). Second, it improves readability - code with double quotes is easier to read because double quotes are easier to spot than single quotes. Third, it will allow you to easily use apostrophes in your strings, which single quotes don’t (because apostrophes will be interpreted as the end of the string). Single quotes can however be used if you need to include double quotes inside your string:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="messychapter.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This works:</span></span>
<span id="cb388-2"><a href="messychapter.html#cb388-2" aria-hidden="true" tabindex="-1"></a>text1 <span class="ot">&lt;-</span> <span class="st">&quot;An example of a string. Isn&#39;t this great?&quot;</span></span>
<span id="cb388-3"><a href="messychapter.html#cb388-3" aria-hidden="true" tabindex="-1"></a>text2 <span class="ot">&lt;-</span> <span class="st">&#39;Another example of a so-called &quot;string&quot;.&#39;</span></span>
<span id="cb388-4"><a href="messychapter.html#cb388-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-5"><a href="messychapter.html#cb388-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This doesn&#39;t work:</span></span>
<span id="cb388-6"><a href="messychapter.html#cb388-6" aria-hidden="true" tabindex="-1"></a>text1_fail <span class="ot">&lt;-</span> <span class="st">&#39;An example of a string. Isn&#39;</span>t this great?<span class="st">&#39;</span></span>
<span id="cb388-7"><a href="messychapter.html#cb388-7" aria-hidden="true" tabindex="-1"></a><span class="st">text2_fail &lt;- &quot;Another example of a so-called &quot;string&quot;.&quot;</span></span></code></pre></div>
<p>If you check what these two strings look like, you’ll notice something funny about <code>text2</code>:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="messychapter.html#cb389-1" aria-hidden="true" tabindex="-1"></a>text1</span>
<span id="cb389-2"><a href="messychapter.html#cb389-2" aria-hidden="true" tabindex="-1"></a>text2</span></code></pre></div>
<p>R has put backslash characters, <code>\</code>, before the double quotes. The backslash is called an <em>escape character</em>, which invokes a different interpretation of the character that follows it. In fact, you can use this to put double quotes inside a string that you define using double quotes:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="messychapter.html#cb390-1" aria-hidden="true" tabindex="-1"></a>text2_success <span class="ot">&lt;-</span> <span class="st">&quot;Another example of a so-called </span><span class="sc">\&quot;</span><span class="st">string</span><span class="sc">\&quot;</span><span class="st">.&quot;</span></span></code></pre></div>
<p>There are a number of other special characters that can be included using a backslash: <code>\n</code> for a line break (a new line) and <code>\t</code> for a tab (a long whitespace) being the most important<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="messychapter.html#cb391-1" aria-hidden="true" tabindex="-1"></a>text3 <span class="ot">&lt;-</span> <span class="st">&quot;Text...</span><span class="sc">\n\t</span><span class="st">With indented text on a new line!&quot;</span></span></code></pre></div>
<p>To print your string in the Console in a way that shows special characters instead of their escape character-versions, use the function <code>cat</code>:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="messychapter.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text3)</span></code></pre></div>
<p>You can also use <code>cat</code> to print the string to a text file…</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="messychapter.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text3, <span class="at">file =</span> <span class="st">&quot;new_findings.txt&quot;</span>)</span></code></pre></div>
<p>…and to append text at the end of a text file:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="messychapter.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Let&#39;s add even more text!&quot;</span>, <span class="at">file =</span> <span class="st">&quot;new_findings.txt&quot;</span>,</span>
<span id="cb394-2"><a href="messychapter.html#cb394-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">append =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>(Check the output by opening <code>new_findings.txt</code>!)</p>
<div id="concatenating-strings" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Concatenating strings<a href="messychapter.html#concatenating-strings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you wish to concatenate multiple strings, <code>cat</code> will do that for you:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="messychapter.html#cb395-1" aria-hidden="true" tabindex="-1"></a>first <span class="ot">&lt;-</span> <span class="st">&quot;This is the beginning of a sentence&quot;</span></span>
<span id="cb395-2"><a href="messychapter.html#cb395-2" aria-hidden="true" tabindex="-1"></a>second <span class="ot">&lt;-</span> <span class="st">&quot;and this is the end.&quot;</span></span>
<span id="cb395-3"><a href="messychapter.html#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(first, second)</span></code></pre></div>
<p>By default, <code>cat</code> places a single white space between the two strings, so that <code>"This is the beginning of a sentence"</code> and
<code>"and this is the end."</code> are concatenated to <code>"This is the beginning of a sentence and this is the end."</code>. You can change that using the <code>sep</code> argument in <code>cat</code>. You can also add as many strings as you like as input:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="messychapter.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(first, second, <span class="at">sep =</span> <span class="st">&quot;; &quot;</span>)</span>
<span id="cb396-2"><a href="messychapter.html#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(first, second, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb396-3"><a href="messychapter.html#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(first, second, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb396-4"><a href="messychapter.html#cb396-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(first, second, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="st">&quot;And this is another sentence.&quot;</span>)</span></code></pre></div>
<p>At other times, you want to concatenate two or more strings without printing them. You can then use <code>paste</code> in exactly the same way as you’d use <code>cat</code>, the exception being that <code>paste</code> returns a string instead of printing it.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="messychapter.html#cb397-1" aria-hidden="true" tabindex="-1"></a>my_sentence <span class="ot">&lt;-</span> <span class="fu">paste</span>(first, second, <span class="at">sep =</span> <span class="st">&quot;; &quot;</span>)</span>
<span id="cb397-2"><a href="messychapter.html#cb397-2" aria-hidden="true" tabindex="-1"></a>my_novel <span class="ot">&lt;-</span> <span class="fu">paste</span>(first, second, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb397-3"><a href="messychapter.html#cb397-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;And this is another sentence.&quot;</span>)</span>
<span id="cb397-4"><a href="messychapter.html#cb397-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-5"><a href="messychapter.html#cb397-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View results:</span></span>
<span id="cb397-6"><a href="messychapter.html#cb397-6" aria-hidden="true" tabindex="-1"></a>my_sentence</span>
<span id="cb397-7"><a href="messychapter.html#cb397-7" aria-hidden="true" tabindex="-1"></a>my_novel</span>
<span id="cb397-8"><a href="messychapter.html#cb397-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(my_novel)</span></code></pre></div>
<p>Finally, if you wish to create a number of similar strings based on information from other variables, you can use <code>sprintf</code>, which allows you to write a string using <code>%s</code> as a placeholder for the values that should be pulled from other variables:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="messychapter.html#cb398-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Irma&quot;</span>, <span class="st">&quot;Bea&quot;</span>, <span class="st">&quot;Lisa&quot;</span>)</span>
<span id="cb398-2"><a href="messychapter.html#cb398-2" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">59</span>, <span class="dv">36</span>)</span>
<span id="cb398-3"><a href="messychapter.html#cb398-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-4"><a href="messychapter.html#cb398-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%s is %s years old.&quot;</span>, names, ages)</span></code></pre></div>
<p>There are many more uses of <code>sprintf</code> (we’ve already seen some in Section <a href="messychapter.html#floatingpoints">5.3.5</a>), but this enough for us for now.</p>
</div>
<div id="changing-case" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Changing case<a href="messychapter.html#changing-case" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you need to translate characters from lowercase to uppercase or vice versa, that can be done using <code>toupper</code> and <code>tolower</code>:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="messychapter.html#cb399-1" aria-hidden="true" tabindex="-1"></a>my_string <span class="ot">&lt;-</span> <span class="st">&quot;SOMETIMES I SCREAM (and sometimes I whisper).&quot;</span></span>
<span id="cb399-2"><a href="messychapter.html#cb399-2" aria-hidden="true" tabindex="-1"></a><span class="fu">toupper</span>(my_string)</span>
<span id="cb399-3"><a href="messychapter.html#cb399-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(my_string)</span></code></pre></div>
<p>If you only wish to change the case of some particular element in your string, you can use <code>substr</code>, which allows you to access substrings:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="messychapter.html#cb400-1" aria-hidden="true" tabindex="-1"></a>months <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;january&quot;</span>, <span class="st">&quot;february&quot;</span>, <span class="st">&quot;march&quot;</span>, <span class="st">&quot;aripl&quot;</span>)</span>
<span id="cb400-2"><a href="messychapter.html#cb400-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-3"><a href="messychapter.html#cb400-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing characters 2-4 of months[4] with &quot;pri&quot;:</span></span>
<span id="cb400-4"><a href="messychapter.html#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(months[<span class="dv">4</span>], <span class="dv">2</span>, <span class="dv">4</span>) <span class="ot">&lt;-</span> <span class="st">&quot;pri&quot;</span></span>
<span id="cb400-5"><a href="messychapter.html#cb400-5" aria-hidden="true" tabindex="-1"></a>months</span>
<span id="cb400-6"><a href="messychapter.html#cb400-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-7"><a href="messychapter.html#cb400-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing characters 1-1 (i.e. character 1) of each element of month</span></span>
<span id="cb400-8"><a href="messychapter.html#cb400-8" aria-hidden="true" tabindex="-1"></a><span class="co"># with its uppercase version:</span></span>
<span id="cb400-9"><a href="messychapter.html#cb400-9" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(months, <span class="dv">1</span>, <span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">substr</span>(months, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb400-10"><a href="messychapter.html#cb400-10" aria-hidden="true" tabindex="-1"></a>months</span></code></pre></div>
</div>
<div id="regexp" class="section level3 hasAnchor" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> Finding patterns using regular expressions<a href="messychapter.html#regexp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Regular expressions</em>, or regexps for short, are special strings that describe patterns. They are extremely useful if you need to find, replace or otherwise manipulate a number of strings depending on whether or not a certain pattern exists in each one of them. For instance, you may want to find all strings containing only numbers and convert them to <code>numeric</code>, or find all strings that contain an email address and remove said addresses (for censoring purposes, say). Regular expressions are incredibly useful, but can be daunting. Not everyone will need them, and if this all seems a bit too much to you can safely skip this section, or just skim through it, and return to it at a later point.</p>
<p>To illustrate the use of regular expressions we will use a sheet from the <code>projects-email.xlsx</code> file from the books’ web page. In Exercise <a href="datachapter.html#exr:ch3exc5">3.9</a>, you explored the second sheet in this file, but here we’ll use the third instead. Set <code>file_path</code> to the path to the file, and then run the following code to import the data:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="messychapter.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb401-2"><a href="messychapter.html#cb401-2" aria-hidden="true" tabindex="-1"></a>contacts <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path, <span class="at">sheet =</span> <span class="dv">3</span>)</span>
<span id="cb401-3"><a href="messychapter.html#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(contacts)</span></code></pre></div>
<p>There are now three variables in <code>contacts</code>. We’ll primarily be concerned with the third one: <code>Address</code>. Some people have email addresses attached to them, others have postal addresses and some have no address at all:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="messychapter.html#cb402-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address</span></code></pre></div>
<p>You can find loads of guides on regular expressions online, but few of them are easy to use with R, the reason being that regular expressions in R sometimes require escape characters that aren’t needed in some other programming languages. In this section we’ll take a look at regular expressions, <em>as they are written in R</em>.</p>
<p>The basic building blocks of regular expressions are patterns consisting of one or more characters. If, for instance, we wish to find all occurrences of the letter <code>y</code> in a vector of strings, the regular expression describing that “pattern” is simply <code>"y"</code>. The functions used to find occurrences of patterns are called <code>grep</code> and <code>grepl</code>. They differ only in the output they return: <code>grep</code> returns the indices of the strings containing the pattern, and <code>grepl</code> returns a <code>logical</code> vector with <code>TRUE</code> at indices matching the patterns and <code>FALSE</code> at other indices.</p>
<p>To find all addresses containing a lowercase <code>y</code>, we use <code>grep</code> and <code>grepl</code> as follows:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="messychapter.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;y&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb403-2"><a href="messychapter.html#cb403-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;y&quot;</span>, contacts<span class="sc">$</span>Address)</span></code></pre></div>
<p>Note how both outputs contain the same information presented in different ways.</p>
<p>In the same way, we can look for word or substrings. For instance, we can find all addresses containing the string <code>"Edin"</code>:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="messychapter.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;Edin&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb404-2"><a href="messychapter.html#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;Edin&quot;</span>, contacts<span class="sc">$</span>Address)</span></code></pre></div>
<p>Similarly, we can also look for special characters. Perhaps we can find all email addresses by looking for strings containing the <code>@</code> symbol:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="messychapter.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;@&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb405-2"><a href="messychapter.html#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;@&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb405-3"><a href="messychapter.html#cb405-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-4"><a href="messychapter.html#cb405-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To display the addresses matching the pattern:</span></span>
<span id="cb405-5"><a href="messychapter.html#cb405-5" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;@&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p>Interestingly, this includes two rows that aren’t email addresses. To separate the email addresses from the other rows, we’ll need a more complicated regular expression, describing the pattern of an email address in more general terms. Here are four examples or regular expressions that’ll do the trick:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="messychapter.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;.+@.+[.].+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb406-2"><a href="messychapter.html#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;.+@.+</span><span class="sc">\\</span><span class="st">..+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb406-3"><a href="messychapter.html#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:graph:]]+@[[:graph:]]+[.][[:alpha:]]+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb406-4"><a href="messychapter.html#cb406-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:alnum:]._-]+@[[:alnum:]._-]+[.][[:alpha:]]+&quot;</span>,</span>
<span id="cb406-5"><a href="messychapter.html#cb406-5" aria-hidden="true" tabindex="-1"></a>     contacts<span class="sc">$</span>Address)</span></code></pre></div>
<p>To try to wrap our head around what these mean we’ll have a look at the building blocks of regular expressions. These are:</p>
<ul>
<li>Patterns describing a single character.</li>
<li>Patterns describing a class of characters, e.g. letters or numbers.</li>
<li>Repetition quantifiers describing how many repetitions of a pattern to look for.</li>
<li>Other operators.</li>
</ul>
<p>We’ve already looked at single character expressions, as well as the multi-character expression <code>"Edin"</code> which simply is a combination of four single-character expressions. Patterns describing classes of characters, e.g. characters with certain properties, are denoted by brackets <code>[]</code> (for manually defined classes) or double brackets <code>[[]]</code> (for predefined classes). One example of the latter is <code>"[[:digit:]]</code> which is a pattern that matches all digits: <code>0 1 2 3 4 5 6 7 8 9</code>. Let’s use it to find all addresses containing a number:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="messychapter.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:digit:]]&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb407-2"><a href="messychapter.html#cb407-2" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[[:digit:]]&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p>Some important predefined classes are:</p>
<ul>
<li><code>[[:lower:]]</code> matches lowercase letters,</li>
<li><code>[[:upper:]]</code> matches UPPERCASE letters,</li>
<li><code>[[:alpha:]]</code> matches both lowercase and UPPERCASE letters,</li>
<li><code>[[:digit:]]</code> matches digits: <code>0 1 2 3 4 5 6 7 8 9</code>,</li>
<li><code>[[:alnum:]]</code> matches alphanumeric characters (alphabetic characters and digits),</li>
<li><code>[[:punct:]]</code> matches punctuation characters: <code>! " # $ % &amp; ' ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _</code> { | } ~`,</li>
<li><code>[[:space:]]</code> matches space characters: space, tab, newline, and so on,</li>
<li><code>[[:graph:]]</code> matches letters, digits, and punctuation characters,</li>
<li><code>[[:print:]]</code> matches letters, digits, punctuation characters, and space characters,</li>
<li><code>.</code> matches <em>any</em> character.</li>
</ul>
<p>Examples of manually defined classes are:</p>
<ul>
<li><code>[abcd]</code> matches <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>,</li>
<li><code>[a-d]</code> matches <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>,</li>
<li><code>[aA12]</code> matches <code>a</code>, <code>A</code>, <code>1</code> and <code>2</code>,</li>
<li><code>[.]</code> matches <code>.</code>,</li>
<li><code>[.,]</code> matches <code>.</code> and <code>,</code>,</li>
<li><code>[^abcd]</code> matches anything except <code>a</code>, <code>b</code>, <code>c</code>, or <code>d</code>.</li>
</ul>
<p>So for instance, we can find all addresses that don’t contain at least one of the letters <code>y</code> and <code>z</code> using:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="messychapter.html#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[^yz]&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb408-2"><a href="messychapter.html#cb408-2" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[^yz]&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p>All of these patterns can be combined with patterns describing a single character:</p>
<ul>
<li><code>gr[ea]y</code> matches <code>grey</code> and <code>gray</code> (but not <code>greay</code>!),</li>
<li><code>b[^o]g</code> matches <code>bag</code>, <code>beg</code>, and similar strings, but not <code>bog</code>,</li>
<li><code>[.]com</code> matches <code>.com</code>.</li>
</ul>
<p>When using the patterns above, you only look for a single occurrence of the pattern. Sometimes you may want a pattern like <em>a word of 2-4 letters</em> or <em>any number of digits in a row</em>. To create these, you add repetition patterns to your regular expression:</p>
<ul>
<li><code>?</code> means that the preceding patterns is matched <em>at most once</em>, i.e. 0 or 1 time,</li>
<li><code>*</code> means that the preceding pattern is matched <em>0 or more</em> times,</li>
<li><code>+</code> means that the preceding pattern is matched <em>at least once</em>, i.e. 1 time or more,</li>
<li><code>{n}</code> means that the preceding pattern is matched <em>exactly</em> <code>n</code> times,</li>
<li><code>{n,}</code> means that the preceding pattern is matched <em>at least</em> <code>n</code> times, i.e. <code>n</code> times or more,</li>
<li><code>{n,m}</code> means that the preceding pattern is matched <em>at least</em> <code>n</code> times <em>but not more than</em> <code>m</code> times.</li>
</ul>
<p>Here are some examples of how repetition patterns can be used:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="messychapter.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are multiple ways of finding strings containing two n&#39;s</span></span>
<span id="cb409-2"><a href="messychapter.html#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in a row:</span></span>
<span id="cb409-3"><a href="messychapter.html#cb409-3" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;nn&quot;</span>, contacts<span class="sc">$</span>Address)]</span>
<span id="cb409-4"><a href="messychapter.html#cb409-4" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;n{2}&quot;</span>, contacts<span class="sc">$</span>Address)]</span>
<span id="cb409-5"><a href="messychapter.html#cb409-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-6"><a href="messychapter.html#cb409-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Find strings with words beginning with an uppercase letter, followed</span></span>
<span id="cb409-7"><a href="messychapter.html#cb409-7" aria-hidden="true" tabindex="-1"></a><span class="co"># by at least one lowercase letter:</span></span>
<span id="cb409-8"><a href="messychapter.html#cb409-8" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[[:upper:]][[:lower:]]+&quot;</span>, contacts<span class="sc">$</span>Address)]</span>
<span id="cb409-9"><a href="messychapter.html#cb409-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-10"><a href="messychapter.html#cb409-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find strings with words beginning with an uppercase letter, followed</span></span>
<span id="cb409-11"><a href="messychapter.html#cb409-11" aria-hidden="true" tabindex="-1"></a><span class="co"># by at least six lowercase letters:</span></span>
<span id="cb409-12"><a href="messychapter.html#cb409-12" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[[:upper:]][[:lower:]]{6,}&quot;</span>, contacts<span class="sc">$</span>Address)]</span>
<span id="cb409-13"><a href="messychapter.html#cb409-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-14"><a href="messychapter.html#cb409-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Find strings containing any number of letters, followed by any</span></span>
<span id="cb409-15"><a href="messychapter.html#cb409-15" aria-hidden="true" tabindex="-1"></a><span class="co"># number of digits, followed by a space:</span></span>
<span id="cb409-16"><a href="messychapter.html#cb409-16" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[[:alpha:]]+[[:digit:]]+[[:space:]]&quot;</span>,</span>
<span id="cb409-17"><a href="messychapter.html#cb409-17" aria-hidden="true" tabindex="-1"></a>                      contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p>Finally, there are some other operators that you can use to create even more complex patterns:</p>
<ul>
<li><code>|</code> alteration, picks one of multiple possible patterns. For example, <code>ab|bc</code> matches <code>ab</code> or <code>bc</code>.</li>
<li><code>()</code> parentheses are used to denote a subset of an expression that should be evaluated separately. For example, <code>colo|our</code> matches <code>colo</code> or <code>our</code> while <code>col(o|ou)r</code> matches <code>color</code> or <code>colour</code>.</li>
<li><code>^</code>, when used outside of brackets <code>[]</code>, means that the match should be found at the start of the string. For example, <code>^a</code> matches strings beginning with <code>a</code>, but not <code>"dad"</code>.</li>
<li><code>$</code> means that the match should be found at the end of the string. For example, <code>a$</code> matches strings ending with <code>a</code>, but not <code>"dad"</code>.</li>
<li><code>\\</code> escape character that can be used to match special characters like <code>.</code>, <code>^</code> and <code>$</code> (<code>\\.</code>, <code>\\^</code>, <code>\\$</code>).</li>
</ul>
<p>This may seem like a lot (and it is!), but there are in fact many more possibilities when working with regular expression. For the sake of some sorts of brevity, we’ll leave it at this for now though.</p>
<p>Let’s return to those email addresses. We saw three regular expressions that could be used to find them:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="messychapter.html#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;.+@.+[.].+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb410-2"><a href="messychapter.html#cb410-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;.+@.+</span><span class="sc">\\</span><span class="st">..+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb410-3"><a href="messychapter.html#cb410-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:graph:]]+@[[:graph:]]+[.][[:alpha:]]+&quot;</span>, contacts<span class="sc">$</span>Address)</span>
<span id="cb410-4"><a href="messychapter.html#cb410-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:alnum:]._-]+@[[:alnum:]._-]+[.][[:alpha:]]+&quot;</span>,</span>
<span id="cb410-5"><a href="messychapter.html#cb410-5" aria-hidden="true" tabindex="-1"></a>     contacts<span class="sc">$</span>Address)</span></code></pre></div>
<p>The first two of these both specify the same pattern: <em>any number of any characters, followed by an <code>@</code>, followed by any number of any characters, followed by a period <code>.</code>, followed by any number of characters</em>. This will match email addresses, but would also match strings like <code>"?=)(/x@!.a??"</code>, which isn’t a valid email address. In this case, that’s not a big issue, as our goal was to find addresses that looked like email addresses, and not to verify that the addresses were valid.</p>
<p>The third alternative has a slightly different pattern: <em>any number of letters, digits, and punctuation characters, followed by an <code>@</code>, followed by any number of letters, digits, and punctuation characters, followed by a period <code>.</code>, followed by any number of letters</em>. This too would match <code>"?=)(/x@!.a??"</code> as it allows punctuation characters that don’t usually occur in email addresses. The fourth alternative, however, won’t match <code>"?=)(/x@!.a??"</code> as it only allows letters, digits and the symbols <code>.</code>, <code>_</code> and <code>-</code> in the name and domain name of the address.</p>
</div>
<div id="sub" class="section level3 hasAnchor" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> Substitution<a href="messychapter.html#sub" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An important use of regular expressions is in substitutions, where the parts of strings that match the pattern in the expression are replaced by another string. There are two email addresses in our data that contain <code>(a)</code> instead of <code>@</code>:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="messychapter.html#cb411-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[(]a[])]&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p>If we wish to replace the <code>(a)</code> by <code>@</code>, we can do so using <code>sub</code> and <code>gsub</code>. The former replaces only the <em>first</em> occurrence of the pattern in the input vector, whereas the latter replaces <em>all</em> occurrences.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="messychapter.html#cb412-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[(]a[])]&quot;</span>, contacts<span class="sc">$</span>Address)]</span>
<span id="cb412-2"><a href="messychapter.html#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="st">&quot;[(]a[])]&quot;</span>, <span class="st">&quot;@&quot;</span>, contacts<span class="sc">$</span>Address)  <span class="co"># Replace first occurrence</span></span>
<span id="cb412-3"><a href="messychapter.html#cb412-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;[(]a[])]&quot;</span>, <span class="st">&quot;@&quot;</span>, contacts<span class="sc">$</span>Address) <span class="co"># Replace all occurrences</span></span></code></pre></div>
</div>
<div id="splitting-strings" class="section level3 hasAnchor" number="5.5.5">
<h3><span class="header-section-number">5.5.5</span> Splitting strings<a href="messychapter.html#splitting-strings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At times you want to extract only a part of a string, for example if measurements recorded in a column contains units, e.g. <code>66.8 kg</code> instead of <code>66.8</code>. To split a string into different parts, we can use <code>strsplit</code>.</p>
<p>As an example, consider the email addresses in our <code>contacts</code> data. Suppose that we want to extract the user names from all email addresses, i.e. remove the <code>@domain.topdomain</code> part. First, we store all email addresses from the data in a new vector, and then we split them at the <code>@</code> sign:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="messychapter.html#cb413-1" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> contacts<span class="sc">$</span>Address[<span class="fu">grepl</span>(</span>
<span id="cb413-2"><a href="messychapter.html#cb413-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;[[:alnum:]._-]+@[[:alnum:]._-]+[.][[:alpha:]]+&quot;</span>,</span>
<span id="cb413-3"><a href="messychapter.html#cb413-3" aria-hidden="true" tabindex="-1"></a>             contacts<span class="sc">$</span>Address)]</span>
<span id="cb413-4"><a href="messychapter.html#cb413-4" aria-hidden="true" tabindex="-1"></a>emails_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(emails, <span class="st">&quot;@&quot;</span>)</span>
<span id="cb413-5"><a href="messychapter.html#cb413-5" aria-hidden="true" tabindex="-1"></a>emails_split</span></code></pre></div>
<p><code>emails_split</code> is a <em>list</em>. In this case, it seems convenient to convert the split strings into a matrix using <code>unlist</code> and <code>matrix</code> (you may want to have a quick look at Exercise <a href="datachapter.html#exr:ch3exc1b">3.3</a> to re-familiarise yourself with <code>matrix</code>):</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="messychapter.html#cb414-1" aria-hidden="true" tabindex="-1"></a>emails_split <span class="ot">&lt;-</span> <span class="fu">unlist</span>(emails_split)</span>
<span id="cb414-2"><a href="messychapter.html#cb414-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-3"><a href="messychapter.html#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in a matrix with length(emails_split)/2 rows and 2 columns:</span></span>
<span id="cb414-4"><a href="messychapter.html#cb414-4" aria-hidden="true" tabindex="-1"></a>emails_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(emails_split,</span>
<span id="cb414-5"><a href="messychapter.html#cb414-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(emails_split)<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb414-6"><a href="messychapter.html#cb414-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb414-7"><a href="messychapter.html#cb414-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb414-8"><a href="messychapter.html#cb414-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-9"><a href="messychapter.html#cb414-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract usernames:</span></span>
<span id="cb414-10"><a href="messychapter.html#cb414-10" aria-hidden="true" tabindex="-1"></a>emails_matrix[,<span class="dv">1</span>]</span></code></pre></div>
<p>Similarly, when working with data stored in data frames, it is sometimes desirable to split a column containing strings into two columns. Some convenience functions for this are discussed in Section <a href="messychapter.html#splittingcolumns">5.11.3</a>.</p>
</div>
<div id="variable-names" class="section level3 hasAnchor" number="5.5.6">
<h3><span class="header-section-number">5.5.6</span> Variable names<a href="messychapter.html#variable-names" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Variable names can be very messy, particularly when they are imported from files. You can access and manipulate the variable names of a data frame using <code>names</code>:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="messychapter.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(contacts)</span>
<span id="cb415-2"><a href="messychapter.html#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(contacts)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;ID number&quot;</span></span>
<span id="cb415-3"><a href="messychapter.html#cb415-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[aA]&quot;</span>, <span class="fu">names</span>(contacts))</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc6" class="exercise"><strong>Exercise 5.7  </strong></span><a href="http://www.modernstatisticswithr.com/data.zip">Download the file <code>handkerchief.csv</code> from the book’s web page</a>. It contains a short list of prices of Italian handkerchiefs from the <a href="https://books.google.se/books?id=rUxiAAAAcAAJ">1769 publication</a> <em>Prices in those branches of the weaving manufactory, called, the black branch, and, the fancy branch</em>. Load the data in a data frame in R and then do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Read the documentation for the function <code>nchar</code>. What does it do? Apply it to the <code>Italian.handkerchief</code> column of your data frame.</p></li>
<li><p>Use <code>grep</code> to find out how many rows of the <code>Italian.handkerchief</code> column that contain numbers.</p></li>
<li><p>Find a way to extract the prices in shillings (S) and pence (D) from the <code>Price</code> column, storing these in two new <code>numeric</code> variables in your data frame.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions6">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc65" class="exercise"><strong>Exercise 5.8  </strong></span><a href="http://www.modernstatisticswithr.com/data.zip">Download the <code>oslo-biomarkers.xlsx</code> data from the book’s web page</a>. It contains data from a medical study about patients with disc herniations, performed at the Oslo University Hospital, Ullevål (this is a modified<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a> version of the data analysed by Moen et al. (2016)). Blood samples were collected from a number of patients with disc herniations at three time points: 0 weeks (first visit at the hospital), 6 weeks and 12 months. The levels of some biomarkers related to inflammation were measured in each blood sample. The first column in the spreadsheet contains information about the patient ID and the time point of sampling. Load the data and check its structure. Each patient is uniquely identified by their ID number. How many patients were included in the study?</p>
</div>
<p><a href="solutions.html#ch5solutions65">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc7" class="exercise"><strong>Exercise 5.9  </strong></span>What patterns do the following regular expressions describe? Apply them to the <code>Address</code> vector of the <code>contacts</code> data to check that you interpreted them correctly.</p>
<ol style="list-style-type: decimal">
<li><p><code>"$g"</code></p></li>
<li><p><code>"^[^[[:digit:]]"</code></p></li>
<li><p><code>"a(s|l)"</code></p></li>
<li><p><code>"[[:lower:]]+[.][[:lower:]]+"</code></p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions7">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc7b" class="exercise"><strong>Exercise 5.10  </strong></span>Write code that, given a string, creates a vector containing all words from the string, with one word in each element and no punctuation marks. Apply it to the following string to check that it works:</p>
</div>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="messychapter.html#cb416-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;This is an example of a sentence, with 10 words. Here are 4 more!&quot;</span></span></code></pre></div>
<p><a href="solutions.html#ch5solutions7b">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="datetime" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Working with dates and times<a href="messychapter.html#datetime" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data describing dates and times can be complex, not least because they can be written is so many different formats. 1 April 2020 can be written as <code>2020-04-01</code>, <code>20/04/01</code>, <code>200401</code>, <code>1/4 2020</code>, <code>4/1/20</code>, <code>1 Apr 20</code>, and a myriad of other ways. 5 past 6 in the evening can be written as <code>18:05</code> or <code>6.05 pm</code>. In addition to this ambiguity, time zones, daylight saving time, leap years and even leap seconds make working with dates and times even more complicated.</p>
<p>The default in R is to use the ISO8601 standards, meaning that dates are written as YYYY-MM-DD and that times are written using the 24-hour hh:mm:ss format. In order to avoid confusion, you should always use these, unless you have <em>very</em> strong reasons not to.</p>
<p>Dates in R are represented as <code>Date</code> objects, and dates with times as <code>POSIXct</code> objects. The examples below are concerned with <code>Date</code> objects, but you will explore <code>POSIXct</code> too, in Exercise <a href="messychapter.html#exr:ch5exc8">5.12</a>.</p>
<div id="date-formats" class="section level3 hasAnchor" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Date formats<a href="messychapter.html#date-formats" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>as.Date</code> function tries to coerce a <code>character</code> string to a date. For some formats, it will automatically succeed, whereas for others, you have to provide the format of the date manually. To complicate things further, what formats work automatically will depend on your system settings. Consequently, the safest option is always to specify the format of your dates, to make sure that the code still will run if you at some point have to execute it on a different machine. To help describe date formats, R has a number of tokens to describe days, months and years:</p>
<ul>
<li><code>%d</code> - day of the month as a number (01-31).</li>
<li><code>%m</code> - month of the year as a number (01-12).</li>
<li><code>%y</code> - year without century (00-99).</li>
<li><code>%Y</code> - year with century (e.g. 2020).</li>
</ul>
<p>Here are some examples of date formats, all describing 1 April 2020 - try them both with and without specifying the format to see what happens:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="messychapter.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2020-04-01&quot;</span>)</span>
<span id="cb417-2"><a href="messychapter.html#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2020-04-01&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb417-3"><a href="messychapter.html#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;4/1/20&quot;</span>)</span>
<span id="cb417-4"><a href="messychapter.html#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;4/1/20&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)</span>
<span id="cb417-5"><a href="messychapter.html#cb417-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-6"><a href="messychapter.html#cb417-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sometimes dates are expressed as the number of days since a</span></span>
<span id="cb417-7"><a href="messychapter.html#cb417-7" aria-hidden="true" tabindex="-1"></a><span class="co"># certain date. For instance, 1 April 2020 is 43,920 days after</span></span>
<span id="cb417-8"><a href="messychapter.html#cb417-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 January 1900:</span></span>
<span id="cb417-9"><a href="messychapter.html#cb417-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="dv">43920</span>, <span class="at">origin =</span> <span class="st">&quot;1900-01-01&quot;</span>)</span></code></pre></div>
<p>If the date includes month or weekday names, you can use tokens to describe that as well:</p>
<ul>
<li><code>%b</code> - abbreviated month name, e.g. <code>Jan</code>, <code>Feb</code>.</li>
<li><code>%B</code> - full month name, e.g. <code>January</code>, <code>February</code>.</li>
<li><code>%a</code> - abbreviated weekday, e.g. <code>Mon</code>, <code>Tue</code>.</li>
<li><code>%A</code> - full weekday, e.g. <code>Monday</code>, <code>Tuesday</code>.</li>
</ul>
<p>Things become a little more complicated now though, because R will interpret the names as if they were written in the language set in your <em>locale</em>, which contains a number of settings related your language and region. To find out what language is in your locale, you can use:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="messychapter.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>)</span></code></pre></div>
<p>I’m writing this on a machine with Swedish locale settings (my output from the above code chunk is <code>"sv_SE.UTF-8"</code>). The Swedish word for <em>Wednesday</em> is <em>onsdag</em><a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>, and therefore the following code doesn’t work on my machine:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="messychapter.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;Wednesday 1 April 2020&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%A %d %B %Y&quot;</span>)</span></code></pre></div>
<p>However, if I translate it to Swedish, it runs just fine:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="messychapter.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;Onsdag 1 april 2020&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%A %d %B %Y&quot;</span>)</span></code></pre></div>
<p>You may at times need to make similar translations of dates. One option is to use <code>gsub</code> to translate the names of months and weekdays into the correct language (see Section <a href="messychapter.html#sub">5.5.4</a>). Alternatively, you can change the locale settings. On most systems, the following setting will allow you to read English months and days properly:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="messychapter.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>, <span class="st">&quot;C&quot;</span>)</span></code></pre></div>
<p>The locale settings will revert to the defaults the next time you start R.</p>
<p>Conversely, you may want to extract a substring from a <code>Date</code> object, for instance the day of the month. This can be done using <code>strftime</code>, using the same tokens as above. Here are some examples, including one with the token <code>%j</code>, which can be used to extract the day of the year:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="messychapter.html#cb422-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-04-01&quot;</span>, <span class="st">&quot;2021-01-29&quot;</span>, <span class="st">&quot;2021-02-22&quot;</span>),</span>
<span id="cb422-2"><a href="messychapter.html#cb422-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb422-3"><a href="messychapter.html#cb422-3" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb422-4"><a href="messychapter.html#cb422-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the day of the month:</span></span>
<span id="cb422-5"><a href="messychapter.html#cb422-5" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(dates, <span class="at">format =</span> <span class="st">&quot;%d&quot;</span>)</span>
<span id="cb422-6"><a href="messychapter.html#cb422-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-7"><a href="messychapter.html#cb422-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the month:</span></span>
<span id="cb422-8"><a href="messychapter.html#cb422-8" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(dates, <span class="at">format =</span> <span class="st">&quot;%m&quot;</span>)</span>
<span id="cb422-9"><a href="messychapter.html#cb422-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-10"><a href="messychapter.html#cb422-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the year:</span></span>
<span id="cb422-11"><a href="messychapter.html#cb422-11" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(dates, <span class="at">format =</span> <span class="st">&quot;%Y&quot;</span>)</span>
<span id="cb422-12"><a href="messychapter.html#cb422-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-13"><a href="messychapter.html#cb422-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the day of the year:</span></span>
<span id="cb422-14"><a href="messychapter.html#cb422-14" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(dates, <span class="at">format =</span> <span class="st">&quot;%j&quot;</span>)</span></code></pre></div>
<p>Should you need to, you can of course convert these objects from <code>character</code> to <code>numeric</code> using <code>as.numeric</code>.</p>
<p>For a complete list of tokens that can be used to describe date patterns, see <code>?strftime</code>.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc75" class="exercise"><strong>Exercise 5.11  </strong></span>Consider the following <code>Date</code> vector:</p>
</div>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="messychapter.html#cb423-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2015-01-01&quot;</span>, <span class="st">&quot;1984-03-12&quot;</span>, <span class="st">&quot;2012-09-08&quot;</span>),</span>
<span id="cb423-2"><a href="messychapter.html#cb423-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Apply the functions <code>weekdays</code>, <code>months</code> and <code>quarters</code> to the vector. What do they do?</p></li>
<li><p>Use the <code>julian</code> function to find out how many days passed between 1970-01-01 and the dates in <code>dates</code>.</p></li>
</ol>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc8" class="exercise"><strong>Exercise 5.12  </strong></span>Consider the three <code>character</code> objects created below:</p>
</div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="messychapter.html#cb424-1" aria-hidden="true" tabindex="-1"></a>time1 <span class="ot">&lt;-</span> <span class="st">&quot;2020-04-01 13:20&quot;</span></span>
<span id="cb424-2"><a href="messychapter.html#cb424-2" aria-hidden="true" tabindex="-1"></a>time2 <span class="ot">&lt;-</span> <span class="st">&quot;2020-04-01 14:30&quot;</span></span>
<span id="cb424-3"><a href="messychapter.html#cb424-3" aria-hidden="true" tabindex="-1"></a>time3 <span class="ot">&lt;-</span> <span class="st">&quot;2020-04-03 18:58&quot;</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>What happens if you convert the three variables to <code>Date</code> objects using <code>as.Date</code> without specifying the date format?</p></li>
<li><p>Convert <code>time1</code> to a <code>Date</code> object and add <code>1</code> to it. What is the result?</p></li>
<li><p>Convert <code>time3</code> and <code>time1</code> to <code>Date</code> objects and subtract them. What is the result?</p></li>
<li><p>Convert <code>time2</code> and <code>time1</code> to <code>Date</code> objects and subtract them. What is the result?</p></li>
<li><p>What happens if you convert the three variables to <code>POSIXct</code> date and time objects using <code>as.POSIXct</code> without specifying the date format?</p></li>
<li><p>Convert <code>time3</code> and <code>time1</code> to <code>POSIXct</code> objects and subtract them. What is the result?</p></li>
<li><p>Convert <code>time2</code> and <code>time1</code> to <code>POSIXct</code> objects and subtract them. What is the result?</p></li>
<li><p>Use the <code>difftime</code> to repeat the calculation in task 6, but with the result presented in hours.</p></li>
</ol>
<p><a href="solutions.html#ch5solutions8">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc8b" class="exercise"><strong>Exercise 5.13  </strong></span>In some fields, e.g. economics, data is often aggregated on a quarter-year level, as in these examples:</p>
</div>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="messychapter.html#cb425-1" aria-hidden="true" tabindex="-1"></a>qvec1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2020 Q4&quot;</span>, <span class="st">&quot;2021 Q1&quot;</span>, <span class="st">&quot;2021 Q2&quot;</span>)</span>
<span id="cb425-2"><a href="messychapter.html#cb425-2" aria-hidden="true" tabindex="-1"></a>qvec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Q4/20&quot;</span>, <span class="st">&quot;Q1/21&quot;</span>, <span class="st">&quot;Q2/21&quot;</span>)</span>
<span id="cb425-3"><a href="messychapter.html#cb425-3" aria-hidden="true" tabindex="-1"></a>qvec3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Q4-2020&quot;</span>, <span class="st">&quot;Q1-2021&quot;</span>, <span class="st">&quot;Q2-2021&quot;</span>)</span></code></pre></div>
<p>To convert <code>qvec1</code> to a <code>Date</code> object, we can use <code>as.yearqtr</code> from the <code>zoo</code> package in two ways:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="messychapter.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb426-2"><a href="messychapter.html#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">as.yearqtr</span>(qvec1, <span class="at">format =</span> <span class="st">&quot;%Y Q%q&quot;</span>))</span>
<span id="cb426-3"><a href="messychapter.html#cb426-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">as.yearqtr</span>(qvec1, <span class="at">format =</span> <span class="st">&quot;%Y Q%q&quot;</span>), <span class="at">frac =</span> <span class="dv">1</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Describe the results. What is the difference? Which do you think is preferable?</p></li>
<li><p>Convert <code>qvec2</code> and <code>qvec3</code> to <code>Date</code> objects in the same way. Make sure that you get the <code>format</code> argument, which describes the date format, right.</p></li>
</ol>
<p><a href="solutions.html#ch5solutions8b">(Click here to go to the solution.)</a></p>
</div>
<div id="plotting-with-dates" class="section level3 hasAnchor" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Plotting with dates<a href="messychapter.html#plotting-with-dates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>ggplot2</code> automatically recognises <code>Date</code> objects and will usually plot them in a nice way. That only works if it actually has the dates though. Consider the following plot, which we created in Section <a href="eda.html#interactivets">4.6.7</a> - it shows the daily electricity demand in Victoria, Australia in 2014:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="messychapter.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb427-2"><a href="messychapter.html#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb427-3"><a href="messychapter.html#cb427-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-4"><a href="messychapter.html#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the plot object</span></span>
<span id="cb427-5"><a href="messychapter.html#cb427-5" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(elecdaily[,<span class="st">&quot;Demand&quot;</span>])</span>
<span id="cb427-6"><a href="messychapter.html#cb427-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-7"><a href="messychapter.html#cb427-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the interactive plot</span></span>
<span id="cb427-8"><a href="messychapter.html#cb427-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>When you hover the points, the formatting of the dates looks odd. We’d like to have proper dates instead. In order to do so, we’ll use <code>seq.Date</code> to create a sequence of dates, ranging from 2014-01-01 to 2014-12-31:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="messychapter.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a data frame with better formatted dates</span></span>
<span id="cb428-2"><a href="messychapter.html#cb428-2" aria-hidden="true" tabindex="-1"></a>elecdaily2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(elecdaily)</span>
<span id="cb428-3"><a href="messychapter.html#cb428-3" aria-hidden="true" tabindex="-1"></a>elecdaily2<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2014-01-01&quot;</span>),</span>
<span id="cb428-4"><a href="messychapter.html#cb428-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.Date</span>(<span class="st">&quot;2014-12-31&quot;</span>),</span>
<span id="cb428-5"><a href="messychapter.html#cb428-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb428-6"><a href="messychapter.html#cb428-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-7"><a href="messychapter.html#cb428-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the plot object</span></span>
<span id="cb428-8"><a href="messychapter.html#cb428-8" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elecdaily2, <span class="fu">aes</span>(Date, Demand)) <span class="sc">+</span></span>
<span id="cb428-9"><a href="messychapter.html#cb428-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span>
<span id="cb428-10"><a href="messychapter.html#cb428-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb428-11"><a href="messychapter.html#cb428-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the interactive plot</span></span>
<span id="cb428-12"><a href="messychapter.html#cb428-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p><code>seq.Date</code> can be used analogously to create sequences where there is a week, month, quarter or year between each element of the sequence, by changing the <code>by</code> argument.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc9" class="exercise"><strong>Exercise 5.14  </strong></span>Return to the plot from Exercise <a href="eda.html#exr:ch4exc4">4.12</a>, which was created using</p>
</div>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="messychapter.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb429-2"><a href="messychapter.html#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily, <span class="at">facets =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>You’ll notice that the x-axis shows week numbers rather than dates (the dates in the <code>elecdaily</code> time series object are formatted as weeks with decimal numbers). Make a time series plot of the <code>Demand</code> variable with dates (2014-01-01 to 2014-12-31) along the x-axis (your solution is likely to rely on standard R techniques rather than <code>autoplot</code>).</p>
<p><a href="solutions.html#ch5solutions9">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc10" class="exercise"><strong>Exercise 5.15  </strong></span>Create an interactive version time series plot of the <code>a10</code> anti-diabetic drug sales data, as in Section <a href="eda.html#interactivets">4.6.7</a>. Make sure that the dates are correctly displayed.</p>
</div>
<p><a href="solutions.html#ch5solutions10">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="data-manipulation-with-data.table-dplyr-and-tidyr" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Data manipulation with <code>data.table</code>, <code>dplyr</code>, and <code>tidyr</code><a href="messychapter.html#data-manipulation-with-data.table-dplyr-and-tidyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the remainder of this chapter, we will use three packages that contain functions for fast and efficient data manipulation: <code>data.table</code> and the tidyverse packages <code>dplyr</code> and <code>tidyr</code>. To begin with, it is therefore a good idea to install them. And while you wait for the installation to finish, read on.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="messychapter.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;data.table&quot;</span>))</span></code></pre></div>
<p>There is almost always more than one way to solve a problem in R. We now know how to access vectors and elements in data frames, e.g. to compute means. We also know how to modify and add variables to data frames. Indeed, you can do just about anything using the functions in base R. Sometimes, however, those solutions become rather cumbersome, as they can require a fair amount of programming and verbose code. <code>data.table</code> and the tidyverse packages offer simpler solutions and speed up the workflow for these types of problems. Both can be used for the same tasks. You can learn one of them or both. The syntax used for <code>data.table</code> is often more concise and arguably more consistent than that in <code>dplyr</code> (it is in essence an extension of the <code>[i, j]</code> notation that we have already used for data frames). Second, it is fast and memory-efficient, which makes a huge difference if you are working with big data (you’ll see this for yourself in Section <a href="progchapter.html#measureperformance">6.6</a>). On the other hand, many people prefer the syntax in <code>dplyr</code> and <code>tidyr</code>, which lends itself exceptionally well for usage with pipes. If you work with small or medium-sized datasets, the difference in performance between the two packages is negligible. <code>dplyr</code> is also much better suited for working directly with databases, which is a huge selling point if your data already is in a database<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a>.</p>
<p>In the sections below, we will see how to perform different operations using both <code>data.table</code> and the tidyverse packages. Perhaps you already know which one that you want to use (<code>data.table</code> if performance is important to you, <code>dplyr</code>+<code>tidyr</code> if you like to use pipes or will be doing a lot of work with databases). If not, you can use these examples to guide your choice. Or not choose at all! I regularly use both packages myself, to harness the strength of both. There is no harm in knowing how to use both a hammer and a screwdriver.</p>
<div id="dtbasics" class="section level3 hasAnchor" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> <code>data.table</code> and tidyverse syntax basics<a href="messychapter.html#dtbasics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>data.table</code> relies heavily on the <code>[i, j]</code> notation that is used for data frames in R. It also adds a third element: <code>[i, j, by]</code>. Using this, R selects the rows indicated by <code>i</code>, the columns indicated by <code>j</code> and groups them by <code>by</code>. This makes it easy e.g. to compute grouped summaries.</p>
<p>With the tidyverse packages you will instead use new functions with names like <code>filter</code> and <code>summarise</code> to perform operations on your data. These are typically combined using the pipe operator, <code>%&gt;%</code>, which makes the code flow nicely from left to right.</p>
<p>It’s almost time to look at some examples of what this actually looks like in practice. First though, now that you’ve installed <code>data.table</code> and <code>dplyr</code>, it’s time to load them (we’ll get to <code>tidyr</code> a little later). We’ll also create a <code>data.table</code> version of the <code>airquality</code> data, which we’ll use in the examples below. This is required in order to use <code>data.table</code> syntax, as it only works on <code>data.table</code> objects. Luckily, <code>dplyr</code> works perfectly when used on <code>data.table</code> objects, so we can use the same object for the examples for both packages.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="messychapter.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb431-2"><a href="messychapter.html#cb431-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb431-3"><a href="messychapter.html#cb431-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-4"><a href="messychapter.html#cb431-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(airquality)</span></code></pre></div>
<p>When importing data from csv files, you can import them as <code>data.table</code> objects instead of <code>data.frame</code> objects by replacing <code>read.csv</code> with <code>fread</code> from the <code>data.table</code> package. The latter function also has the benefit of being substantially faster when importing large (several MB’s) csv files.</p>
<p>Note that, similar to what we saw in Section <a href="messychapter.html#splitvector">5.2.1</a>, variables in imported data frames can have names that would not be allowed in base R, for instance including forbidden characters like <code>-</code>. <code>data.table</code> and <code>dplyr</code> allow you to work with such variables by wrapping their names in apostrophes: referring to the illegally named variable as <code>illegal-character-name</code> won’t work, but <code>`illegal-character-name`</code> will.</p>
</div>
<div id="modifyvar" class="section level3 hasAnchor" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Modifying a variable<a href="messychapter.html#modifyvar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a first example, let’s consider how to use <code>data.table</code> and <code>dplyr</code> to modify a variable in a data frame. The wind speed in <code>airquality</code> is measured in miles per hour. We can convert that to metres per second by multiplying the speed by 0.44704. Using only base R, we’d do this using <code>airquality$Wind &lt;- airquality$Wind * 0.44704</code>. With <code>data.table</code> we can instead do this using <code>[i, j]</code> notation, and with <code>dplyr</code> we can do it by using a function called <code>mutate</code> (because it “mutates” your data).</p>
<p>Change wind speed to m/s instead of mph:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="messychapter.html#cb432-1" aria-hidden="true" tabindex="-1"></a>aq[, Wind <span class="sc">:</span><span class="er">=</span> Wind <span class="sc">*</span> <span class="fl">0.44704</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="messychapter.html#cb433-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Wind =</span></span>
<span id="cb433-2"><a href="messychapter.html#cb433-2" aria-hidden="true" tabindex="-1"></a>         Wind <span class="sc">*</span> <span class="fl">0.44704</span>) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<p>Note that when using <code>data.table</code>, there is not an explicit assignment. We don’t use <code>&lt;-</code> to assign the new data frame to <code>aq</code> - instead the assignment happens automatically. This means that you have to be a little bit careful, so that you don’t inadvertently make changes to your data when playing around with it.</p>
<p>In this case, using <code>data.table</code> or <code>dplyr</code> doesn’t make anything easier. Where these packages really shine is when we attempt more complicated operations. Before that though, let’s look at a few more simple examples.</p>
</div>
<div id="computing-a-new-variable-based-on-existing-variables" class="section level3 hasAnchor" number="5.7.3">
<h3><span class="header-section-number">5.7.3</span> Computing a new variable based on existing variables<a href="messychapter.html#computing-a-new-variable-based-on-existing-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What if we wish to create new variables based on other variables in the data frame? For instance, maybe we want to create a <em>dummy variable</em> called <code>Hot</code>, containing a <code>logical</code> that describes whether a day was hot (temperature above 90 - <code>TRUE</code>) or not (<code>FALSE</code>). That is, we wish to check the condition <code>Temp &gt; 90</code> for each row, and put the resulting <code>logical</code> in the new variable <code>Hot</code>.</p>
<p>Add a dummy variable describing whether it is hotter than 90:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="messychapter.html#cb434-1" aria-hidden="true" tabindex="-1"></a>aq[, Hot <span class="sc">:</span><span class="er">=</span> Temp <span class="sc">&gt;</span> <span class="dv">90</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="messychapter.html#cb435-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Hot =</span> Temp <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
</div>
<div id="renaming-a-variable" class="section level3 hasAnchor" number="5.7.4">
<h3><span class="header-section-number">5.7.4</span> Renaming a variable<a href="messychapter.html#renaming-a-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To change the name of a variable, we can use <code>setnames</code> from <code>data.table</code> or <code>rename</code> from <code>dplyr</code>. Let’s change the name of the variable <code>Hot</code> that we created in the previous section, to <code>HotDay</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="messychapter.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(aq, <span class="st">&quot;Hot&quot;</span>, <span class="st">&quot;HotDay&quot;</span>)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="messychapter.html#cb437-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">HotDay =</span> Hot) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
</div>
<div id="removing-a-variable" class="section level3 hasAnchor" number="5.7.5">
<h3><span class="header-section-number">5.7.5</span> Removing a variable<a href="messychapter.html#removing-a-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Maybe adding <code>Hot</code> to the data frame wasn’t such a great idea after all. How can we remove it?</p>
<p>Removing <code>Hot</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="messychapter.html#cb438-1" aria-hidden="true" tabindex="-1"></a>aq[, Hot <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="messychapter.html#cb439-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Hot) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<p>If we wish to remove multiple columns at once, the syntax is similar:</p>
<p>Removing multiple columns:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="messychapter.html#cb440-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">c</span>(<span class="st">&quot;Month&quot;</span>, <span class="st">&quot;Day&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="messychapter.html#cb441-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Month, <span class="sc">-</span>Day) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc11" class="exercise"><strong>Exercise 5.16  </strong></span>Load the VAS pain data <code>vas.csv</code> from Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>. Then do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Remove the columns <code>X</code> and <code>X.1</code>.</p></li>
<li><p>Add a dummy variable called <code>highVAS</code> that indicates whether a patient’s <code>VAS</code> is 7 or greater on any given day.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions11">(Click here to go to the solution.)</a></p>
</div>
<div id="recodedplyr" class="section level3 hasAnchor" number="5.7.6">
<h3><span class="header-section-number">5.7.6</span> Recoding <code>factor</code> levels<a href="messychapter.html#recodedplyr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Changing the names of <code>factor</code> levels in base R typically relies on using indices of level names, as in Section <a href="messychapter.html#factorlevels">5.4.2</a>. This can be avoided using <code>data.table</code> or the <code>recode</code> function in <code>dplyr</code>. We return to the <code>smoke</code> example from Section <a href="messychapter.html#factors">5.4</a> and put it in a <code>data.table</code>:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="messychapter.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb442-2"><a href="messychapter.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb442-3"><a href="messychapter.html#cb442-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-4"><a href="messychapter.html#cb442-4" aria-hidden="true" tabindex="-1"></a>smoke <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Heavy&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Occasionally&quot;</span>,</span>
<span id="cb442-5"><a href="messychapter.html#cb442-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;No&quot;</span>)</span>
<span id="cb442-6"><a href="messychapter.html#cb442-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-7"><a href="messychapter.html#cb442-7" aria-hidden="true" tabindex="-1"></a>smoke2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(smoke, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Never&quot;</span>, <span class="st">&quot;Occasionally&quot;</span>,</span>
<span id="cb442-8"><a href="messychapter.html#cb442-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Regularly&quot;</span>, <span class="st">&quot;Heavy&quot;</span>),</span>
<span id="cb442-9"><a href="messychapter.html#cb442-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb442-10"><a href="messychapter.html#cb442-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-11"><a href="messychapter.html#cb442-11" aria-hidden="true" tabindex="-1"></a>smoke3 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(smoke2)</span></code></pre></div>
<p>Suppose that we want to change the levels’ names to abbreviated versions: <em>Nvr</em>, <em>Occ</em>, <em>Reg</em> and <em>Hvy</em>. Here’s how to do this:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="messychapter.html#cb443-1" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Nvr&quot;</span>, <span class="st">&quot;Occ&quot;</span>, <span class="st">&quot;Reg&quot;</span>, <span class="st">&quot;Hvy&quot;</span>)</span>
<span id="cb443-2"><a href="messychapter.html#cb443-2" aria-hidden="true" tabindex="-1"></a>smoke3[.(<span class="at">smoke2 =</span> <span class="fu">levels</span>(smoke2), <span class="at">to =</span> new_names),</span>
<span id="cb443-3"><a href="messychapter.html#cb443-3" aria-hidden="true" tabindex="-1"></a>         on <span class="ot">=</span> <span class="st">&quot;smoke2&quot;</span>,</span>
<span id="cb443-4"><a href="messychapter.html#cb443-4" aria-hidden="true" tabindex="-1"></a>         smoke2 <span class="sc">:</span><span class="er">=</span> i.to]</span>
<span id="cb443-5"><a href="messychapter.html#cb443-5" aria-hidden="true" tabindex="-1"></a>smoke3[, smoke2 <span class="sc">:</span><span class="er">=</span> <span class="fu">droplevels</span>(smoke2)]</span></code></pre></div>
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="messychapter.html#cb444-1" aria-hidden="true" tabindex="-1"></a>smoke3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">smoke2 =</span> <span class="fu">recode</span>(smoke2,</span>
<span id="cb444-2"><a href="messychapter.html#cb444-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Never&quot;</span> <span class="ot">=</span> <span class="st">&quot;Nvr&quot;</span>,</span>
<span id="cb444-3"><a href="messychapter.html#cb444-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Occasionally&quot;</span> <span class="ot">=</span> <span class="st">&quot;Occ&quot;</span>,</span>
<span id="cb444-4"><a href="messychapter.html#cb444-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Regularly&quot;</span> <span class="ot">=</span> <span class="st">&quot;Reg&quot;</span>,</span>
<span id="cb444-5"><a href="messychapter.html#cb444-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Heavy&quot;</span> <span class="ot">=</span> <span class="st">&quot;Hvy&quot;</span>))</span></code></pre></div>
<p>Next, we can combine the <em>Occ</em>, <em>Reg</em> and <em>Hvy</em> levels into a single level, called <em>Yes</em>:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="messychapter.html#cb445-1" aria-hidden="true" tabindex="-1"></a>smoke3[.(<span class="at">smoke2 =</span> <span class="fu">c</span>(<span class="st">&quot;Occ&quot;</span>, <span class="st">&quot;Reg&quot;</span>, <span class="st">&quot;Hvy&quot;</span>), <span class="at">to =</span> <span class="st">&quot;Yes&quot;</span>),</span>
<span id="cb445-2"><a href="messychapter.html#cb445-2" aria-hidden="true" tabindex="-1"></a>       on <span class="ot">=</span> <span class="st">&quot;smoke2&quot;</span>,</span>
<span id="cb445-3"><a href="messychapter.html#cb445-3" aria-hidden="true" tabindex="-1"></a>       smoke2 <span class="sc">:</span><span class="er">=</span> i.to]</span></code></pre></div>
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="messychapter.html#cb446-1" aria-hidden="true" tabindex="-1"></a>smoke3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">smoke2 =</span> <span class="fu">recode</span>(smoke2,</span>
<span id="cb446-2"><a href="messychapter.html#cb446-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Occ&quot;</span> <span class="ot">=</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb446-3"><a href="messychapter.html#cb446-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Reg&quot;</span> <span class="ot">=</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb446-4"><a href="messychapter.html#cb446-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Hvy&quot;</span> <span class="ot">=</span> <span class="st">&quot;Yes&quot;</span>))</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc14" class="exercise"><strong>Exercise 5.17  </strong></span>In Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a> you learned how to create a <code>factor</code> variable from a <code>numeric</code> variable using <code>cut</code>. Return to your solution <a href="solutions.html#ch3solutions3b">(or the solution at the back of the book)</a> and do the following using <code>data.table</code> and/or <code>dplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Change the category names to <code>Mild</code>, <code>Moderate</code> and <code>Hot</code>.</p></li>
<li><p>Combine <code>Moderate</code> and <code>Hot</code> into a single level named <code>Hot</code>.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions14">(Click here to go to the solution.)</a></p>
</div>
<div id="grouped2" class="section level3 hasAnchor" number="5.7.7">
<h3><span class="header-section-number">5.7.7</span> Grouped summaries<a href="messychapter.html#grouped2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ve already seen how we can use <code>aggregate</code> and <code>by</code> to create grouped summaries. However, in many cases it is as easy or easier to use <code>data.table</code> or <code>dplyr</code> for such summaries.</p>
<p>To begin with, let’s load the packages again (in case you don’t already have them loaded), and let’s recreate the <code>aq</code> <code>data.table</code>, which we made a bit of a mess of by removing some important columns in the previous section:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="messychapter.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb447-2"><a href="messychapter.html#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb447-3"><a href="messychapter.html#cb447-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-4"><a href="messychapter.html#cb447-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">data.table</span>(airquality)</span></code></pre></div>
<p>Now, let’s compute the mean temperature for each month. Both <code>data.table</code> and <code>dplyr</code> will return a data frame with the results. In the <code>data.table</code> approach, assigning a name to the summary statistic (<code>mean</code>, in this case) is optional, but not in <code>dplyr</code>.</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="messychapter.html#cb448-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">mean</span>(Temp), Month]</span>
<span id="cb448-2"><a href="messychapter.html#cb448-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or, to assign a name:</span></span>
<span id="cb448-3"><a href="messychapter.html#cb448-3" aria-hidden="true" tabindex="-1"></a>aq[, .(<span class="at">meanTemp =</span> <span class="fu">mean</span>(Temp)),</span>
<span id="cb448-4"><a href="messychapter.html#cb448-4" aria-hidden="true" tabindex="-1"></a>   Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="messychapter.html#cb449-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb449-2"><a href="messychapter.html#cb449-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">meanTemp =</span></span>
<span id="cb449-3"><a href="messychapter.html#cb449-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">mean</span>(Temp))</span></code></pre></div>
</div>
</table>
<p>You’ll recall that if we apply <code>mean</code> to a vector containing <code>NA</code> values, it will return <code>NA</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="messychapter.html#cb450-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">mean</span>(Ozone), Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="messychapter.html#cb451-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb451-2"><a href="messychapter.html#cb451-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">meanTemp =</span></span>
<span id="cb451-3"><a href="messychapter.html#cb451-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">mean</span>(Ozone))</span></code></pre></div>
</div>
</table>
<p>In order to avoid this, we can pass the argument <code>na.rm = TRUE</code> to <code>mean</code>, just as we would in other contexts. To compute the mean ozone concentration for each month, ignoring <code>NA</code> values:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="messychapter.html#cb452-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">mean</span>(Ozone, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb452-2"><a href="messychapter.html#cb452-2" aria-hidden="true" tabindex="-1"></a>   Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="messychapter.html#cb453-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb453-2"><a href="messychapter.html#cb453-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">meanTemp =</span></span>
<span id="cb453-3"><a href="messychapter.html#cb453-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">mean</span>(Ozone,</span>
<span id="cb453-4"><a href="messychapter.html#cb453-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<p>What if we want to compute a grouped summary statistic involving two variables? For instance, the correlation between temperature and wind speed for each month?</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="messychapter.html#cb454-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">cor</span>(Temp, Wind), Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="messychapter.html#cb455-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb455-2"><a href="messychapter.html#cb455-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">cor =</span></span>
<span id="cb455-3"><a href="messychapter.html#cb455-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cor</span>(Temp, Wind))</span></code></pre></div>
</div>
</table>
<p>The syntax for computing multiple grouped statistics is similar. We compute both the mean temperature and the correlation for each month:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="messychapter.html#cb456-1" aria-hidden="true" tabindex="-1"></a>aq[, .(<span class="at">meanTemp =</span> <span class="fu">mean</span>(Temp), </span>
<span id="cb456-2"><a href="messychapter.html#cb456-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">cor =</span> <span class="fu">cor</span>(Temp, Wind)),</span>
<span id="cb456-3"><a href="messychapter.html#cb456-3" aria-hidden="true" tabindex="-1"></a>   Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="messychapter.html#cb457-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb457-2"><a href="messychapter.html#cb457-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">meanTemp =</span></span>
<span id="cb457-3"><a href="messychapter.html#cb457-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mean</span>(Temp),</span>
<span id="cb457-4"><a href="messychapter.html#cb457-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cor =</span></span>
<span id="cb457-5"><a href="messychapter.html#cb457-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cor</span>(Temp, Wind))</span></code></pre></div>
</div>
</table>
<p>At times, you’ll want to compute summaries for all variables that share some property. As an example, you may want to compute the mean of all <code>numeric</code> variables in your data frame. In <code>dplyr</code> there is a convenience function called <code>across</code> that can be used for this: <code>summarise(across(where(is.numeric), mean))</code> will compute the mean of all numeric variables. In <code>data.table</code>, we can instead utilise the <code>apply</code> family of functions from base R, that we’ll study in Section <a href="progchapter.html#vectorloops">6.5</a>. To compute the mean of all <code>numeric</code> variables:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="messychapter.html#cb458-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">lapply</span>(.SD, mean),</span>
<span id="cb458-2"><a href="messychapter.html#cb458-2" aria-hidden="true" tabindex="-1"></a>   Month,</span>
<span id="cb458-3"><a href="messychapter.html#cb458-3" aria-hidden="true" tabindex="-1"></a>   .SDcols <span class="ot">=</span> <span class="fu">names</span>(aq)[</span>
<span id="cb458-4"><a href="messychapter.html#cb458-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(aq, is.numeric)]]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="messychapter.html#cb459-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb459-2"><a href="messychapter.html#cb459-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb459-3"><a href="messychapter.html#cb459-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">where</span>(is.numeric),</span>
<span id="cb459-4"><a href="messychapter.html#cb459-4" aria-hidden="true" tabindex="-1"></a>         mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<p>Both packages have special functions for counting the number of observations in groups: <code>.N</code> for <code>data.table</code> and <code>n</code> for <code>dplyr</code>. For instance, we can count the number of days in each month:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="messychapter.html#cb460-1" aria-hidden="true" tabindex="-1"></a>aq[, .N, Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="messychapter.html#cb461-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb461-2"><a href="messychapter.html#cb461-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">days =</span> <span class="fu">n</span>())</span></code></pre></div>
</div>
</table>
<p>Similarly, you can count the number of unique values of variables using <code>uniqueN</code> for <code>data.table</code> and <code>n_distinct</code> for <code>dplyr</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="messychapter.html#cb462-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">uniqueN</span>(Month)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="messychapter.html#cb463-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">months =</span></span>
<span id="cb463-2"><a href="messychapter.html#cb463-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">n_distinct</span>(Month))</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc12" class="exercise"><strong>Exercise 5.18  </strong></span>Load the VAS pain data <code>vas.csv</code> from Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>. Then do the following using <code>data.table</code> and/or <code>dplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the mean VAS for each patient.</p></li>
<li><p>Compute the lowest and highest VAS recorded for each patient.</p></li>
<li><p>Compute the number of high-VAS days, defined as days with where the VAS was at least 7, for each patient.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions12">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc13" class="exercise"><strong>Exercise 5.19  </strong></span>We return to the <code>datasauRus</code> package and the <code>datasaurus_dozen</code> dataset from Exercise <a href="datachapter.html#exr:ch3exc9">3.13</a>. Check its structure and then do the following using <code>data.table</code> and/or <code>dplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the mean of <code>x</code>, mean of <code>y</code>, standard deviation of <code>x</code>, standard deviation of <code>y</code>, and correlation between <code>x</code> and <code>y</code>, grouped by <code>dataset</code>. Are there any differences between the 12 datasets?</p></li>
<li><p>Make a scatterplot of <code>x</code> against <code>y</code> for each dataset. Are there any differences between the 12 datasets?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions13">(Click here to go to the solution.)</a></p>
</div>
<div id="fillNA" class="section level3 hasAnchor" number="5.7.8">
<h3><span class="header-section-number">5.7.8</span> Filling in missing values<a href="messychapter.html#fillNA" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In some cases, you may want to fill missing values of a variable with the previous non-missing entry. To see an example of this, let’s create a version of <code>aq</code> where the value of <code>Month</code> are missing for some days:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="messychapter.html#cb464-1" aria-hidden="true" tabindex="-1"></a>aq<span class="sc">$</span>Month[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">36</span><span class="sc">:</span><span class="dv">39</span>, <span class="dv">70</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb464-2"><a href="messychapter.html#cb464-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-3"><a href="messychapter.html#cb464-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Some values of Month are now missing:</span></span>
<span id="cb464-4"><a href="messychapter.html#cb464-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aq)</span></code></pre></div>
<p>To fill the missing values with the last non-missing entry, we can now use <code>nafill</code> or <code>fill</code> as follows:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="messychapter.html#cb465-1" aria-hidden="true" tabindex="-1"></a>aq[, Month <span class="sc">:</span><span class="er">=</span> <span class="fu">nafill</span>(</span>
<span id="cb465-2"><a href="messychapter.html#cb465-2" aria-hidden="true" tabindex="-1"></a>      Month, <span class="st">&quot;locf&quot;</span>)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="messychapter.html#cb466-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">fill</span>(Month) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<p>To instead fill the missing values with the <em>next</em> non-missing entry:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="messychapter.html#cb467-1" aria-hidden="true" tabindex="-1"></a>aq[, Month <span class="sc">:</span><span class="er">=</span> <span class="fu">nafill</span>(</span>
<span id="cb467-2"><a href="messychapter.html#cb467-2" aria-hidden="true" tabindex="-1"></a>      Month, <span class="st">&quot;nocb&quot;</span>)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="messychapter.html#cb468-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">fill</span>(Month,</span>
<span id="cb468-2"><a href="messychapter.html#cb468-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span>) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc13b" class="exercise"><strong>Exercise 5.20  </strong></span>Load the VAS pain data <code>vas.csv</code> from Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>. Fill the missing values in the <code>Visit</code> column with the last non-missing value.</p>
</div>
<p><a href="solutions.html#ch5solutions13b">(Click here to go to the solution.)</a></p>
</div>
<div id="chaining-commands-together" class="section level3 hasAnchor" number="5.7.9">
<h3><span class="header-section-number">5.7.9</span> Chaining commands together<a href="messychapter.html#chaining-commands-together" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When working with tidyverse packages, commands are usually chained together using <code>%&gt;%</code> pipes. When using <code>data.table</code>, commands are chained by repeated use of <code>[]</code> brackets on the same line. This is probably best illustrated using an example. Assume again that there are missing values in <code>Month</code> in <code>aq</code>:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="messychapter.html#cb469-1" aria-hidden="true" tabindex="-1"></a>aq<span class="sc">$</span>Month[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">36</span><span class="sc">:</span><span class="dv">39</span>, <span class="dv">70</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>To fill in the missing values with the last non-missing entry (Section <a href="messychapter.html#fillNA">5.7.8</a>) and then count the number of days in each month (Section <a href="messychapter.html#grouped2">5.7.7</a>), we can do as follows.</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="messychapter.html#cb470-1" aria-hidden="true" tabindex="-1"></a>aq[, Month <span class="sc">:</span><span class="er">=</span> <span class="fu">nafill</span>(Month, <span class="st">&quot;locf&quot;</span>)][, .N, Month]</span></code></pre></div>
<p>With <code>tidyr</code> and <code>dplyr</code>:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="messychapter.html#cb471-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">fill</span>(Month) <span class="sc">%&gt;%</span> </span>
<span id="cb471-2"><a href="messychapter.html#cb471-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb471-3"><a href="messychapter.html#cb471-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">days =</span> <span class="fu">n</span>())</span></code></pre></div>
</div>
</div>
<div id="filtering" class="section level2 hasAnchor" number="5.8">
<h2><span class="header-section-number">5.8</span> Filtering: select rows<a href="messychapter.html#filtering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You’ll frequently want to filter away some rows from your data. Perhaps you only want to select rows where a variable exceeds some value, or want to exclude rows with <code>NA</code> values. This can be done in several different ways: using row numbers, using conditions, at random, or using regular expressions. Let’s have a look at them, one by one. We’ll use <code>aq</code>, the <code>data.table</code> version of <code>airquality</code> that we created before, for the examples.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="messychapter.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb472-2"><a href="messychapter.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb472-3"><a href="messychapter.html#cb472-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-4"><a href="messychapter.html#cb472-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">data.table</span>(airquality)</span></code></pre></div>
<div id="filtering-using-row-numbers" class="section level3 hasAnchor" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> Filtering using row numbers<a href="messychapter.html#filtering-using-row-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you know the row numbers of the rows that you wish to remove (perhaps you’ve found them using <code>which</code>, as in Section <a href="datachapter.html#conditionsintro">3.2.3</a>?), you can use those numbers for filtering. Here are four examples.</p>
<p>To select the third row:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="messychapter.html#cb473-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="dv">3</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="messychapter.html#cb474-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</table>
<p>To select rows 3 to 5:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="messychapter.html#cb475-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="messychapter.html#cb476-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
</div>
</table>
<p>To select rows 3, 7 and 15:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="messychapter.html#cb477-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">15</span>),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="messychapter.html#cb478-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">15</span>))</span></code></pre></div>
</div>
</table>
<p>To select all rows except rows 3, 7 and 15:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="messychapter.html#cb479-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">15</span>),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="messychapter.html#cb480-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">15</span>))</span></code></pre></div>
</div>
</table>
</div>
<div id="conditions2" class="section level3 hasAnchor" number="5.8.2">
<h3><span class="header-section-number">5.8.2</span> Filtering using conditions<a href="messychapter.html#conditions2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Filtering is often done using conditions, e.g. to select observations with certain properties. Here are some examples:</p>
<p>To select rows where <code>Temp</code> is greater than 90:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="messychapter.html#cb481-1" aria-hidden="true" tabindex="-1"></a>aq[Temp <span class="sc">&gt;</span> <span class="dv">90</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="messychapter.html#cb482-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Temp <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code></pre></div>
</div>
</table>
<p>To select rows where <code>Month</code> is 6 (June):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="messychapter.html#cb483-1" aria-hidden="true" tabindex="-1"></a>aq[Month <span class="sc">==</span> <span class="dv">6</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="messychapter.html#cb484-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Month <span class="sc">==</span> <span class="dv">6</span>)</span></code></pre></div>
</div>
</table>
<p>To select rows where <code>Temp</code> is greater than 90 and <code>Month</code> is 6 (June):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="messychapter.html#cb485-1" aria-hidden="true" tabindex="-1"></a>aq[Temp <span class="sc">&gt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> Month <span class="sc">==</span> <span class="dv">6</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="messychapter.html#cb486-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Temp <span class="sc">&gt;</span> <span class="dv">90</span>,</span>
<span id="cb486-2"><a href="messychapter.html#cb486-2" aria-hidden="true" tabindex="-1"></a>              Month <span class="sc">==</span> <span class="dv">6</span>)</span></code></pre></div>
</div>
</table>
<p>To select rows where <code>Temp</code> is between 80 and 90 (including 80 and 90):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="messychapter.html#cb487-1" aria-hidden="true" tabindex="-1"></a>aq[Temp <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">90</span>),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="messychapter.html#cb488-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(Temp,</span>
<span id="cb488-2"><a href="messychapter.html#cb488-2" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">80</span>, <span class="dv">90</span>))</span></code></pre></div>
</div>
</table>
<p>To select the 5 rows with the highest <code>Temp</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="messychapter.html#cb489-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">frankv</span>(<span class="sc">-</span>Temp,</span>
<span id="cb489-2"><a href="messychapter.html#cb489-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">ties.method =</span> <span class="st">&quot;min&quot;</span>) <span class="sc">&lt;=</span> <span class="dv">5</span>,</span>
<span id="cb489-3"><a href="messychapter.html#cb489-3" aria-hidden="true" tabindex="-1"></a>   ]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="messychapter.html#cb490-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="dv">5</span>, Temp)</span></code></pre></div>
</div>
</table>
<p>In this case, the above code returns more than 5 rows because of ties.</p>
<p>To remove duplicate rows:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="messychapter.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(aq)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="messychapter.html#cb492-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> distinct</span></code></pre></div>
</div>
</table>
<p>To remove rows with missing data (<code>NA</code> values) in at least one variable:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="messychapter.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(aq)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="messychapter.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb494-2"><a href="messychapter.html#cb494-2" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> drop_na</span></code></pre></div>
</div>
</table>
<p>To remove rows with missing <code>Ozone</code> values:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="messychapter.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(aq, <span class="st">&quot;Ozone&quot;</span>)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="messychapter.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb496-2"><a href="messychapter.html#cb496-2" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(<span class="st">&quot;Ozone&quot;</span>)</span></code></pre></div>
</div>
</table>
<p>At times, you want to filter your data based on whether the observations are connected to observations in a different dataset. Such filters are known as semijoins and antijoins, and are discussed in Section <a href="messychapter.html#semijoins">5.12.4</a>.</p>
</div>
<div id="selecting-rows-at-random" class="section level3 hasAnchor" number="5.8.3">
<h3><span class="header-section-number">5.8.3</span> Selecting rows at random<a href="messychapter.html#selecting-rows-at-random" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In some situations, for instance when training and evaluating machine learning models, you may wish to draw a random sample from your data. This is done using the <code>sample</code> (<code>data.table</code>) and <code>sample_n</code> (<code>dplyr</code>) functions.</p>
<p>To select 5 rows at random:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="messychapter.html#cb497-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">sample</span>(.N, <span class="dv">5</span>),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="messychapter.html#cb498-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code></pre></div>
</div>
</table>
<p>If you run the code multiple times, you will get different results each time. See Section <a href="modchapter.html#simulation">7.1</a> for more on random sampling and how it can be used.</p>
</div>
<div id="using-regular-expressions-to-select-rows" class="section level3 hasAnchor" number="5.8.4">
<h3><span class="header-section-number">5.8.4</span> Using regular expressions to select rows<a href="messychapter.html#using-regular-expressions-to-select-rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In some cases, particularly when working with text data, you’ll want to filter using regular expressions (see Section <a href="messychapter.html#regexp">5.5.3</a>). <code>data.table</code> has a convenience function called <code>%like%</code> that can be used to call <code>grepl</code> in an alternative (less opaque?) way. With <code>dplyr</code> we use <code>grepl</code> in the usual fashion. To have some text data to try this out on, we’ll use this data frame, which contains descriptions of some dogs:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="messychapter.html#cb499-1" aria-hidden="true" tabindex="-1"></a>dogs <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Name =</span> <span class="fu">c</span>(<span class="st">&quot;Bianca&quot;</span>, <span class="st">&quot;Bella&quot;</span>, <span class="st">&quot;Mimmi&quot;</span>, <span class="st">&quot;Daisy&quot;</span>,</span>
<span id="cb499-2"><a href="messychapter.html#cb499-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Ernst&quot;</span>, <span class="st">&quot;Smulan&quot;</span>),</span>
<span id="cb499-3"><a href="messychapter.html#cb499-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Breed =</span> <span class="fu">c</span>(<span class="st">&quot;Greyhound&quot;</span>, <span class="st">&quot;Greyhound&quot;</span>, <span class="st">&quot;Pug&quot;</span>, <span class="st">&quot;Poodle&quot;</span>,</span>
<span id="cb499-4"><a href="messychapter.html#cb499-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Bedlington Terrier&quot;</span>, <span class="st">&quot;Boxer&quot;</span>),</span>
<span id="cb499-5"><a href="messychapter.html#cb499-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Desc =</span> <span class="fu">c</span>(<span class="st">&quot;Fast, playful&quot;</span>, <span class="st">&quot;Fast, easily worried&quot;</span>,</span>
<span id="cb499-6"><a href="messychapter.html#cb499-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;Intense, small, loud&quot;</span>,</span>
<span id="cb499-7"><a href="messychapter.html#cb499-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;Majestic, protective, playful&quot;</span>,</span>
<span id="cb499-8"><a href="messychapter.html#cb499-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;Playful, relaxed&quot;</span>,</span>
<span id="cb499-9"><a href="messychapter.html#cb499-9" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;Loving, cuddly, playful&quot;</span>))</span>
<span id="cb499-10"><a href="messychapter.html#cb499-10" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dogs)</span></code></pre></div>
<p>To select all rows with names beginning with B:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="messychapter.html#cb500-1" aria-hidden="true" tabindex="-1"></a>dogs[Name <span class="sc">%like%</span> <span class="st">&quot;^B&quot;</span>,]</span>
<span id="cb500-2"><a href="messychapter.html#cb500-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or:</span></span>
<span id="cb500-3"><a href="messychapter.html#cb500-3" aria-hidden="true" tabindex="-1"></a>dogs[<span class="fu">grepl</span>(<span class="st">&quot;^B&quot;</span>, Name),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="messychapter.html#cb501-1" aria-hidden="true" tabindex="-1"></a>dogs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;B[a-z]&quot;</span>,</span>
<span id="cb501-2"><a href="messychapter.html#cb501-2" aria-hidden="true" tabindex="-1"></a>                      Name))</span></code></pre></div>
</div>
</table>
<p>To select all rows where <code>Desc</code> includes the word <code>playful</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="messychapter.html#cb502-1" aria-hidden="true" tabindex="-1"></a>dogs[Desc <span class="sc">%like%</span> <span class="st">&quot;[pP]layful&quot;</span>,]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="messychapter.html#cb503-1" aria-hidden="true" tabindex="-1"></a>dogs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;[pP]layful&quot;</span>,</span>
<span id="cb503-2"><a href="messychapter.html#cb503-2" aria-hidden="true" tabindex="-1"></a>                      Desc))</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc15" class="exercise"><strong>Exercise 5.21  </strong></span><a href="http://www.modernstatisticswithr.com/data.zip">Download the <code>ucdp-onesided-191.csv</code> data file from the book’s web page</a>. It contains data about international attacks on civilians by governments and formally organised armed groups during the period 1989-2018, collected as part of the Uppsala Conflict Data Program (Eck &amp; Hultman, 2007; Petterson et al., 2019). Among other things, it contains information about the actor (attacker), the fatality rate, and attack location. Load the data and check its structure.</p>
<ol style="list-style-type: decimal">
<li><p>Filter the rows so that only conflicts that took place in Colombia are retained. How many different actors were responsible for attacks in Colombia during the period?</p></li>
<li><p>Using the <code>best_fatality_estimate</code> column to estimate fatalities, calculate the number of worldwide fatalities caused by government attacks on civilians during 1989-2018.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions15">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch5exc16" class="exercise"><strong>Exercise 5.22  </strong></span>Load the <code>oslo-biomarkers.xlsx</code> data from Exercise <a href="messychapter.html#exr:ch5exc65">5.8</a>. Use <code>data.table</code> and/or <code>dplyr</code> to do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Select only the measurements from blood samples taken at 12 months.</p></li>
<li><p>Select only the measurements from the patient with ID number 6.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions16">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="subsetting-select-columns" class="section level2 hasAnchor" number="5.9">
<h2><span class="header-section-number">5.9</span> Subsetting: select columns<a href="messychapter.html#subsetting-select-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another common situation is that you want to remove some variables from your data. Perhaps the variables aren’t of interest in a particular analysis that you’re going to perform, or perhaps you’ve simply imported more variables than you need. As with rows, this can be done using numbers, names or regular expressions. Let’s look at some examples using the <code>aq</code> data:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="messychapter.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb504-2"><a href="messychapter.html#cb504-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb504-3"><a href="messychapter.html#cb504-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-4"><a href="messychapter.html#cb504-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">data.table</span>(airquality)</span></code></pre></div>
<div id="selecting-a-single-column" class="section level3 hasAnchor" number="5.9.1">
<h3><span class="header-section-number">5.9.1</span> Selecting a single column<a href="messychapter.html#selecting-a-single-column" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When selecting a single column from a data frame, you sometimes want to extract the column as a vector and sometimes as a single-column data frame (for instance if you are going to pass it to a function that takes a data frame as input). You should be a little bit careful when doing this, to make sure that you get the column in the correct format:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="messychapter.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return a vector:</span></span>
<span id="cb505-2"><a href="messychapter.html#cb505-2" aria-hidden="true" tabindex="-1"></a>aq<span class="sc">$</span>Temp</span>
<span id="cb505-3"><a href="messychapter.html#cb505-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb505-4"><a href="messychapter.html#cb505-4" aria-hidden="true" tabindex="-1"></a>aq[, Temp]</span>
<span id="cb505-5"><a href="messychapter.html#cb505-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-6"><a href="messychapter.html#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Return a data.table:</span></span>
<span id="cb505-7"><a href="messychapter.html#cb505-7" aria-hidden="true" tabindex="-1"></a>aq[, <span class="st">&quot;Temp&quot;</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="messychapter.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return a vector:</span></span>
<span id="cb506-2"><a href="messychapter.html#cb506-2" aria-hidden="true" tabindex="-1"></a>aq<span class="sc">$</span>Temp</span>
<span id="cb506-3"><a href="messychapter.html#cb506-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb506-4"><a href="messychapter.html#cb506-4" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Temp)</span>
<span id="cb506-5"><a href="messychapter.html#cb506-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-6"><a href="messychapter.html#cb506-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Return a tibble:</span></span>
<span id="cb506-7"><a href="messychapter.html#cb506-7" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(Temp)</span></code></pre></div>
</div>
</table>
</div>
<div id="selecting-multiple-columns" class="section level3 hasAnchor" number="5.9.2">
<h3><span class="header-section-number">5.9.2</span> Selecting multiple columns<a href="messychapter.html#selecting-multiple-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Selecting multiple columns is more straightforward, as the object that is returned always will be a data frame. Here are some examples.</p>
<p>To select <code>Temp</code>, <code>Month</code> and <code>Day</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="messychapter.html#cb507-1" aria-hidden="true" tabindex="-1"></a>aq[, .(Temp, Month, Day)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="messychapter.html#cb508-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(Temp, Month, Day)</span></code></pre></div>
</div>
</table>
<p>To select all columns between <code>Wind</code> and <code>Month</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="messychapter.html#cb509-1" aria-hidden="true" tabindex="-1"></a>aq[, Wind<span class="sc">:</span>Month]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="messychapter.html#cb510-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(Wind<span class="sc">:</span>Month)</span></code></pre></div>
</div>
</table>
<p>To select all columns except <code>Month</code> and <code>Day</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="messychapter.html#cb511-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;Month&quot;</span>, <span class="st">&quot;Day&quot;</span>)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="messychapter.html#cb512-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Month, <span class="sc">-</span>Day)</span></code></pre></div>
</div>
</table>
<p>To select all numeric variables (which for the <code>aq</code> data is all variables!):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="messychapter.html#cb513-1" aria-hidden="true" tabindex="-1"></a>aq[, <span class="fu">sapply</span>(msleep, class) <span class="sc">==</span></span>
<span id="cb513-2"><a href="messychapter.html#cb513-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;numeric&quot;</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="messychapter.html#cb514-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span></code></pre></div>
</div>
</table>
<p>To remove columns with missing (<code>NA</code>) values:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="messychapter.html#cb515-1" aria-hidden="true" tabindex="-1"></a>aq[, .SD,</span>
<span id="cb515-2"><a href="messychapter.html#cb515-2" aria-hidden="true" tabindex="-1"></a>   .SDcols <span class="ot">=</span> <span class="fu">colSums</span>(</span>
<span id="cb515-3"><a href="messychapter.html#cb515-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">is.na</span>(aq)) <span class="sc">==</span> <span class="dv">0</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="messychapter.html#cb516-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span></code></pre></div>
</div>
</table>
</div>
<div id="using-regular-expressions-to-select-columns" class="section level3 hasAnchor" number="5.9.3">
<h3><span class="header-section-number">5.9.3</span> Using regular expressions to select columns<a href="messychapter.html#using-regular-expressions-to-select-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In <code>data.table</code>, using regular expressions to select columns is done using <code>grep</code>. <code>dplyr</code> differs in that it has several convenience functions for selecting columns, like <code>starts_with</code>, <code>ends_with</code>, <code>contains</code>. As an example, we can select variables the name of which contains the letter <code>n</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="messychapter.html#cb517-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">&quot;n&quot;</span>, <span class="fu">names</span>(aq))</span>
<span id="cb517-2"><a href="messychapter.html#cb517-2" aria-hidden="true" tabindex="-1"></a>aq[, ..vars]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="messychapter.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># contains is a convenience</span></span>
<span id="cb518-2"><a href="messychapter.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function for checking if a name</span></span>
<span id="cb518-3"><a href="messychapter.html#cb518-3" aria-hidden="true" tabindex="-1"></a><span class="co"># contains a string:</span></span>
<span id="cb518-4"><a href="messychapter.html#cb518-4" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;n&quot;</span>))</span>
<span id="cb518-5"><a href="messychapter.html#cb518-5" aria-hidden="true" tabindex="-1"></a><span class="co"># matches can be used with any</span></span>
<span id="cb518-6"><a href="messychapter.html#cb518-6" aria-hidden="true" tabindex="-1"></a><span class="co"># regular expression:</span></span>
<span id="cb518-7"><a href="messychapter.html#cb518-7" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;n&quot;</span>))  </span></code></pre></div>
</div>
</table>
</div>
<div id="subsetusingcn" class="section level3 hasAnchor" number="5.9.4">
<h3><span class="header-section-number">5.9.4</span> Subsetting using column numbers<a href="messychapter.html#subsetusingcn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is also possible to subsetting using column numbers, but you need to be careful if you want to use that approach. Column numbers can change, for instance if a variable is removed from the data frame. More importantly, however, using column numbers can yield different results depending on what type of data table you’re using. Let’s have a look at what happens if we use this approach with different types of data tables:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="messychapter.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data.frame:</span></span>
<span id="cb519-2"><a href="messychapter.html#cb519-2" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airquality)</span>
<span id="cb519-3"><a href="messychapter.html#cb519-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[,<span class="dv">2</span>])</span>
<span id="cb519-4"><a href="messychapter.html#cb519-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-5"><a href="messychapter.html#cb519-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table:</span></span>
<span id="cb519-6"><a href="messychapter.html#cb519-6" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(airquality)</span>
<span id="cb519-7"><a href="messychapter.html#cb519-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[,<span class="dv">2</span>])</span>
<span id="cb519-8"><a href="messychapter.html#cb519-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-9"><a href="messychapter.html#cb519-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble:</span></span>
<span id="cb519-10"><a href="messychapter.html#cb519-10" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(airquality)</span>
<span id="cb519-11"><a href="messychapter.html#cb519-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[,<span class="dv">2</span>])</span></code></pre></div>
<p>As you can see, <code>aq[, 2]</code> returns a vector, a data table or a tibble, depending on what type of object <code>aq</code> is. Unfortunately, this approach is used by several R packages, and can cause problems, because it may return the wrong type of object.</p>
<p>A better approach is to use <code>aq[[2]]</code>, which works the same for data frames, data tables and tibbles, returning a vector:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="messychapter.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data.frame:</span></span>
<span id="cb520-2"><a href="messychapter.html#cb520-2" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airquality)</span>
<span id="cb520-3"><a href="messychapter.html#cb520-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[[<span class="dv">2</span>]])</span>
<span id="cb520-4"><a href="messychapter.html#cb520-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-5"><a href="messychapter.html#cb520-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table:</span></span>
<span id="cb520-6"><a href="messychapter.html#cb520-6" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(airquality)</span>
<span id="cb520-7"><a href="messychapter.html#cb520-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[[<span class="dv">2</span>]])</span>
<span id="cb520-8"><a href="messychapter.html#cb520-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-9"><a href="messychapter.html#cb520-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble:</span></span>
<span id="cb520-10"><a href="messychapter.html#cb520-10" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(airquality)</span>
<span id="cb520-11"><a href="messychapter.html#cb520-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(aq[[<span class="dv">2</span>]])</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc17" class="exercise"><strong>Exercise 5.23  </strong></span>Return to the <code>ucdp-onesided-191.csv</code> data from Exercise <a href="messychapter.html#exr:ch5exc15">5.21</a>. To have a cleaner and less bloated dataset to work with, it can make sense to remove some columns. Select only the <code>actor_name</code>, <code>year</code>, <code>best_fatality_estimate</code> and <code>location</code> columns.</p>
</div>
<p><a href="solutions.html#ch5solutions17">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="sorting" class="section level2 hasAnchor" number="5.10">
<h2><span class="header-section-number">5.10</span> Sorting<a href="messychapter.html#sorting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sometimes you don’t want to filter rows, but rearrange their order according to their values for some variable. Similarly, you may want to change the order of the columns in your data. I often do this after merging data from different tables (as we’ll do in Section <a href="messychapter.html#mergedata">5.12</a>). This is often useful for presentation purposes, but can at times also aid in analyses.</p>
<div id="changing-the-column-order" class="section level3 hasAnchor" number="5.10.1">
<h3><span class="header-section-number">5.10.1</span> Changing the column order<a href="messychapter.html#changing-the-column-order" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is straightforward to change column positions using <code>setcolorder</code> in <code>data.table</code> and <code>relocate</code> in <code>dplyr</code>.</p>
<p>To put <code>Month</code> and <code>Day</code> in the first two columns, without rearranging the other columns:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="messychapter.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(aq, <span class="fu">c</span>(<span class="st">&quot;Month&quot;</span>, <span class="st">&quot;Day&quot;</span>))</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="messychapter.html#cb522-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="st">&quot;Month&quot;</span>, <span class="st">&quot;Day&quot;</span>)</span></code></pre></div>
</div>
</table>
</div>
<div id="changing-the-row-order" class="section level3 hasAnchor" number="5.10.2">
<h3><span class="header-section-number">5.10.2</span> Changing the row order<a href="messychapter.html#changing-the-row-order" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In <code>data.table</code>, <code>order</code> is used for sorting rows, and in <code>dplyr</code>, <code>arrange</code> is used (sometimes in combination with <code>desc</code>). The syntax differs depending on whether you wish to sort your rows in ascending or descending order. We will illustrate this using the <code>airquality</code> data.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="messychapter.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb523-2"><a href="messychapter.html#cb523-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb523-3"><a href="messychapter.html#cb523-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-4"><a href="messychapter.html#cb523-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">data.table</span>(airquality)</span></code></pre></div>
<p>First of all, if you’re just looking to sort a single vector, rather than an entire data frame, the quickest way to do so is to use <code>sort</code>:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="messychapter.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(aq<span class="sc">$</span>Wind)</span>
<span id="cb524-2"><a href="messychapter.html#cb524-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(aq<span class="sc">$</span>Wind, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb524-3"><a href="messychapter.html#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>))</span></code></pre></div>
<p>If you’re looking to sort an entire data frame by one or more variables, you need to move beyond <code>sort</code>. To sort rows by <code>Wind</code> (<em>ascending</em> order):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="messychapter.html#cb525-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">order</span>(Wind),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="messychapter.html#cb526-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Wind)</span></code></pre></div>
</div>
</table>
<p>To sort rows by <code>Wind</code> (<em>descending</em> order):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="messychapter.html#cb527-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">order</span>(<span class="sc">-</span>Wind),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="messychapter.html#cb528-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="sc">-</span>Wind)</span>
<span id="cb528-2"><a href="messychapter.html#cb528-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb528-3"><a href="messychapter.html#cb528-3" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Wind))</span></code></pre></div>
</div>
</table>
<p>To sort rows, first by <code>Temp</code> (ascending order) and then by <code>Wind</code> (descending order):</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="messychapter.html#cb529-1" aria-hidden="true" tabindex="-1"></a>aq[<span class="fu">order</span>(Temp, <span class="sc">-</span>Wind),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="messychapter.html#cb530-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Temp, <span class="fu">desc</span>(Wind))</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc18" class="exercise"><strong>Exercise 5.24  </strong></span>Load the <code>oslo-biomarkers.xlsx</code> data from Exercise <a href="messychapter.html#exr:ch5exc65">5.8</a>. Note that it is not ordered in a natural way. Reorder it by patient ID instead.</p>
</div>
<p><a href="solutions.html#ch5solutions18">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="reshaping" class="section level2 hasAnchor" number="5.11">
<h2><span class="header-section-number">5.11</span> Reshaping data<a href="messychapter.html#reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>gapminder</code> dataset from the <code>gapminder</code> package contains information about life expectancy, population size and GDP per capita for 142 countries for 12 years from the period 1952-2007. To begin with, let’s have a look at the data<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="messychapter.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb531-2"><a href="messychapter.html#cb531-2" aria-hidden="true" tabindex="-1"></a>?gapminder</span>
<span id="cb531-3"><a href="messychapter.html#cb531-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(gapminder)</span></code></pre></div>
<p>Each row contains data for one country and one year, meaning that the data for each country is spread over 12 rows. This is known as <em>long data</em> or <em>long format</em>. As another option, we could store it in <em>wide format</em>, where the data is formatted so that all observations corresponding to a country are stored on the same row:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="messychapter.html#cb532-1" aria-hidden="true" tabindex="-1"></a>Country        Continent   lifeExp1952 lifeExp1957 lifeExp1962 ...</span>
<span id="cb532-2"><a href="messychapter.html#cb532-2" aria-hidden="true" tabindex="-1"></a>Afghanistan    Asia         <span class="fl">28.8</span>        <span class="fl">30.2</span>        <span class="fl">32.0</span>       ...</span>
<span id="cb532-3"><a href="messychapter.html#cb532-3" aria-hidden="true" tabindex="-1"></a>Albania        Europe       <span class="fl">55.2</span>        <span class="fl">59.3</span>        <span class="fl">64.8</span>       ...</span></code></pre></div>
<p>Sometimes it makes sense to spread an observation over multiple rows (long format), and sometimes it makes more sense to spread a variable across multiple columns (wide format). Some analyses require long data, whereas others require wide data. And if you’re unlucky, data will arrive in the wrong format for the analysis you need to do. In this section, you’ll learn how to transform your data from long to wide, and back again.</p>
<div id="from-long-to-wide" class="section level3 hasAnchor" number="5.11.1">
<h3><span class="header-section-number">5.11.1</span> From long to wide<a href="messychapter.html#from-long-to-wide" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When going from a long format to a wide format, you choose columns to group the observations by (in the <code>gapminder</code> case: <code>country</code> and maybe also <code>continent</code>), columns to take values names from (<code>lifeExp</code>, <code>pop</code> and <code>gdpPercap</code>), and columns to create variable names from (<code>year</code>).</p>
<p>In <code>data.table</code>, the transformation from long to wide is done using the <code>dcast</code> function. <code>dplyr</code> does not contain functions for such transformations, but its sibling, the tidyverse package <code>tidyr</code>, does.</p>
<p>The <code>tidyr</code> function used for long-to-wide formatting is <code>pivot_wider</code>. First, we convert the <code>gapminder</code> data frame to a <code>data.table</code> object:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="messychapter.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb533-2"><a href="messychapter.html#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb533-3"><a href="messychapter.html#cb533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-4"><a href="messychapter.html#cb533-4" aria-hidden="true" tabindex="-1"></a>gm <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(gapminder)</span></code></pre></div>
<p>To transform the <code>gm</code> data from long to wide and store it as <code>gmw</code>:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="messychapter.html#cb534-1" aria-hidden="true" tabindex="-1"></a>gmw <span class="ot">&lt;-</span> <span class="fu">dcast</span>(gm, country <span class="sc">+</span> continent <span class="sc">~</span> year,</span>
<span id="cb534-2"><a href="messychapter.html#cb534-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;pop&quot;</span>, <span class="st">&quot;lifeExp&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>))</span></code></pre></div>
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="messychapter.html#cb535-1" aria-hidden="true" tabindex="-1"></a>gm <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(country, continent),</span>
<span id="cb535-2"><a href="messychapter.html#cb535-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> year,</span>
<span id="cb535-3"><a href="messychapter.html#cb535-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> </span>
<span id="cb535-4"><a href="messychapter.html#cb535-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(pop, lifeExp, gdpPercap)) <span class="ot">-&gt;</span> gmw</span></code></pre></div>
</div>
<div id="from-wide-to-long" class="section level3 hasAnchor" number="5.11.2">
<h3><span class="header-section-number">5.11.2</span> From wide to long<a href="messychapter.html#from-wide-to-long" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ve now seen how to transform the long format <code>gapminder</code> data to the wide format <code>gmw</code> data. But what if we want to go from wide format to long? Let’s see if we can transform <code>gmw</code> back to the long format.</p>
<p>In <code>data.table</code>, wide-to-long formatting is done using <code>melt</code>, and in <code>dplyr</code> it is done using <code>pivot_longer</code>.</p>
<p>To transform the <code>gmw</code> data from long to wide:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="messychapter.html#cb536-1" aria-hidden="true" tabindex="-1"></a>gm <span class="ot">&lt;-</span> <span class="fu">melt</span>(gmw, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;continent&quot;</span>),</span>
<span id="cb536-2"><a href="messychapter.html#cb536-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">measure.vars =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">37</span>)</span></code></pre></div>
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="messychapter.html#cb537-1" aria-hidden="true" tabindex="-1"></a>gmw <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">names</span>(gmw)[<span class="dv">2</span><span class="sc">:</span><span class="dv">37</span>],</span>
<span id="cb537-2"><a href="messychapter.html#cb537-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb537-3"><a href="messychapter.html#cb537-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="ot">-&gt;</span> gm</span></code></pre></div>
<p>The resulting data frames are perhaps <em>too</em> long, with each variable (<code>pop</code>, <code>lifeExp</code> and <code>gdpPercapita</code>) being put on a different row. To make it look like the original dataset, we must first split the <code>variable</code> variable (into a column with variable names and column with years) and then make the data frame a little wider again. That is the topic of the next section.</p>
</div>
<div id="splittingcolumns" class="section level3 hasAnchor" number="5.11.3">
<h3><span class="header-section-number">5.11.3</span> Splitting columns<a href="messychapter.html#splittingcolumns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the too long <code>gm</code> data that you created at the end of the last section, the observations in the <code>variable</code> column look like <code>pop_1952</code> and <code>gdpPercap_2007</code>, i.e. are of the form <code>variableName_year</code>. We’d like to split them into two columns: one with variable names and one with years. <code>dplyr</code> has a function called <code>tstrsplit</code> for this purpose, and <code>tidyr</code> has <code>separate</code>.</p>
<p>To split the <code>variable</code> column at the underscore <code>_</code>, and then reformat <code>gm</code> to look like the original <code>gapminder</code> data:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="messychapter.html#cb538-1" aria-hidden="true" tabindex="-1"></a>gm[, <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;year&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable,</span>
<span id="cb538-2"><a href="messychapter.html#cb538-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;_&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb538-3"><a href="messychapter.html#cb538-3" aria-hidden="true" tabindex="-1"></a>gm <span class="ot">&lt;-</span> <span class="fu">dcast</span>(gm, country <span class="sc">+</span> year <span class="sc">~</span>  variable,</span>
<span id="cb538-4"><a href="messychapter.html#cb538-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;value&quot;</span>))</span></code></pre></div>
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="messychapter.html#cb539-1" aria-hidden="true" tabindex="-1"></a>gm <span class="sc">%&gt;%</span> <span class="fu">separate</span>(variable,</span>
<span id="cb539-2"><a href="messychapter.html#cb539-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb539-3"><a href="messychapter.html#cb539-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb539-4"><a href="messychapter.html#cb539-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(country, continent, year),</span>
<span id="cb539-5"><a href="messychapter.html#cb539-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> variable,</span>
<span id="cb539-6"><a href="messychapter.html#cb539-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> value) <span class="ot">-&gt;</span> gm</span></code></pre></div>
</div>
<div id="merging-columns" class="section level3 hasAnchor" number="5.11.4">
<h3><span class="header-section-number">5.11.4</span> Merging columns<a href="messychapter.html#merging-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similarly, you may at times want to merge two columns, for instance if one contains the day+month part of a date and the other contains the year. An example of such a situation can be found in the <code>airquality</code> dataset, where we may want to merge the <code>Day</code> and <code>Month</code> columns into a new <code>Date</code> column. Let’s re-create the <code>aq</code> <code>data.table</code> object one last time:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="messychapter.html#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb540-2"><a href="messychapter.html#cb540-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb540-3"><a href="messychapter.html#cb540-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-4"><a href="messychapter.html#cb540-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(airquality)</span></code></pre></div>
<p>If we wanted to create a <code>Date</code> column containing the year (1973), month and day for each observation, we could use <code>paste</code> and <code>as.Date</code>:</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="messychapter.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">paste</span>(<span class="dv">1973</span>, aq<span class="sc">$</span>Month, aq<span class="sc">$</span>Day, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))</span></code></pre></div>
<p>The natural <code>data.table</code> approach is just this, whereas <code>tidyr</code> offers a function called <code>unite</code> to merge columns, which can be combined with <code>mutate</code> to paste the year to the date. To merge the <code>Month</code> and <code>Day</code> columns with a year and convert it to a <code>Date</code> object:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="messychapter.html#cb542-1" aria-hidden="true" tabindex="-1"></a>aq[, Date <span class="sc">:</span><span class="er">=</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(<span class="dv">1973</span>,</span>
<span id="cb542-2"><a href="messychapter.html#cb542-2" aria-hidden="true" tabindex="-1"></a>                     aq<span class="sc">$</span>Month,</span>
<span id="cb542-3"><a href="messychapter.html#cb542-3" aria-hidden="true" tabindex="-1"></a>                     aq<span class="sc">$</span>Day,</span>
<span id="cb542-4"><a href="messychapter.html#cb542-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code> and <code>dplyr</code>:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="messychapter.html#cb543-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="st">&quot;Date&quot;</span>, Month, Day,</span>
<span id="cb543-2"><a href="messychapter.html#cb543-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb543-3"><a href="messychapter.html#cb543-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(</span>
<span id="cb543-4"><a href="messychapter.html#cb543-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste</span>(<span class="dv">1973</span>,</span>
<span id="cb543-5"><a href="messychapter.html#cb543-5" aria-hidden="true" tabindex="-1"></a>               Date,</span>
<span id="cb543-6"><a href="messychapter.html#cb543-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)))</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc19" class="exercise"><strong>Exercise 5.25  </strong></span>Load the <code>oslo-biomarkers.xlsx</code> data from Exercise <a href="messychapter.html#exr:ch5exc65">5.8</a>. Then do the following using <code>data.table</code> and/or <code>dplyr</code>/<code>tidyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Split the <code>PatientID.timepoint</code> column in two parts: one with the patient ID and one with the timepoint.</p></li>
<li><p>Sort the table by patient ID, in numeric order.</p></li>
<li><p>Reformat the data from long to wide, keeping only the IL-8 and VEGF-A measurements.</p></li>
</ol>
<p>Save the resulting data frame - you will need it again in Exercise <a href="messychapter.html#exr:ch5exc20">5.26</a>!</p>
</div>
<p><a href="solutions.html#ch5solutions19">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="mergedata" class="section level2 hasAnchor" number="5.12">
<h2><span class="header-section-number">5.12</span> Merging data from multiple tables<a href="messychapter.html#mergedata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is common that data is spread over multiple tables: different sheets in Excel files, different <code>.csv</code> files, or different tables in databases. Consequently, it is important to be able to merge data from different tables.</p>
<p>As a first example, let’s study the sales datasets available from the books web page: <code>sales-rev.csv</code> and <code>sales-weather.csv</code>. The first dataset describes the daily revenue for a business in the first quarter of 2020, and the second describes the weather in the region (somewhere in Sweden) during the same period<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a>. Store their respective paths as <code>file_path1</code> and <code>file_path2</code> and then load them:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="messychapter.html#cb544-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path1, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb544-2"><a href="messychapter.html#cb544-2" aria-hidden="true" tabindex="-1"></a>weather_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path2, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb544-3"><a href="messychapter.html#cb544-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb544-4"><a href="messychapter.html#cb544-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rev_data)</span>
<span id="cb544-5"><a href="messychapter.html#cb544-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(rev_data)</span>
<span id="cb544-6"><a href="messychapter.html#cb544-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb544-7"><a href="messychapter.html#cb544-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(weather_data)</span>
<span id="cb544-8"><a href="messychapter.html#cb544-8" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(weather_data)</span></code></pre></div>
<div id="binds" class="section level3 hasAnchor" number="5.12.1">
<h3><span class="header-section-number">5.12.1</span> Binds<a href="messychapter.html#binds" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest types of merges are <em>binds</em>, which can be used when you have two tables where either the rows or the columns <em>match each other exactly</em>. To illustrate what this may look like, we will use <code>data.table</code>/<code>dplyr</code> to create subsets of the business revenue data. First, we format the tables as <code>data.table</code> objects and the <code>DATE</code> columns as <code>Date</code> objects:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="messychapter.html#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb545-2"><a href="messychapter.html#cb545-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb545-3"><a href="messychapter.html#cb545-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-4"><a href="messychapter.html#cb545-4" aria-hidden="true" tabindex="-1"></a>rev_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(rev_data)</span>
<span id="cb545-5"><a href="messychapter.html#cb545-5" aria-hidden="true" tabindex="-1"></a>rev_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(rev_data<span class="sc">$</span>DATE)</span>
<span id="cb545-6"><a href="messychapter.html#cb545-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-7"><a href="messychapter.html#cb545-7" aria-hidden="true" tabindex="-1"></a>weather_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(weather_data)</span>
<span id="cb545-8"><a href="messychapter.html#cb545-8" aria-hidden="true" tabindex="-1"></a>weather_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(weather_data<span class="sc">$</span>DATE)</span></code></pre></div>
<p>Next, we wish to subtract three subsets: the revenue in January (<code>rev_jan</code>), the revenue in February (<code>rev_feb</code>) and the weather in January (<code>weather_jan</code>).</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="messychapter.html#cb546-1" aria-hidden="true" tabindex="-1"></a>rev_jan <span class="ot">&lt;-</span> rev_data[DATE <span class="sc">%between%</span></span>
<span id="cb546-2"><a href="messychapter.html#cb546-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">&quot;2020-01-01&quot;</span>,</span>
<span id="cb546-3"><a href="messychapter.html#cb546-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;2020-01-31&quot;</span>),]</span>
<span id="cb546-4"><a href="messychapter.html#cb546-4" aria-hidden="true" tabindex="-1"></a>rev_feb <span class="ot">&lt;-</span> rev_data[DATE <span class="sc">%between%</span></span>
<span id="cb546-5"><a href="messychapter.html#cb546-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">&quot;2020-02-01&quot;</span>,</span>
<span id="cb546-6"><a href="messychapter.html#cb546-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;2020-02-29&quot;</span>),]</span>
<span id="cb546-7"><a href="messychapter.html#cb546-7" aria-hidden="true" tabindex="-1"></a>weather_jan <span class="ot">&lt;-</span> weather_data[DATE</span>
<span id="cb546-8"><a href="messychapter.html#cb546-8" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">%between%</span></span>
<span id="cb546-9"><a href="messychapter.html#cb546-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="st">&quot;2020-01-01&quot;</span>,</span>
<span id="cb546-10"><a href="messychapter.html#cb546-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;2020-01-31&quot;</span>),]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="messychapter.html#cb547-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(DATE,</span>
<span id="cb547-2"><a href="messychapter.html#cb547-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>),</span>
<span id="cb547-3"><a href="messychapter.html#cb547-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>))</span>
<span id="cb547-4"><a href="messychapter.html#cb547-4" aria-hidden="true" tabindex="-1"></a>                    ) <span class="ot">-&gt;</span> rev_jan</span>
<span id="cb547-5"><a href="messychapter.html#cb547-5" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(DATE,</span>
<span id="cb547-6"><a href="messychapter.html#cb547-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-02-01&quot;</span>),</span>
<span id="cb547-7"><a href="messychapter.html#cb547-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-02-29&quot;</span>))</span>
<span id="cb547-8"><a href="messychapter.html#cb547-8" aria-hidden="true" tabindex="-1"></a>                    ) <span class="ot">-&gt;</span> rev_feb</span>
<span id="cb547-9"><a href="messychapter.html#cb547-9" aria-hidden="true" tabindex="-1"></a>weather_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(</span>
<span id="cb547-10"><a href="messychapter.html#cb547-10" aria-hidden="true" tabindex="-1"></a>            DATE,</span>
<span id="cb547-11"><a href="messychapter.html#cb547-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>),</span>
<span id="cb547-12"><a href="messychapter.html#cb547-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>))</span>
<span id="cb547-13"><a href="messychapter.html#cb547-13" aria-hidden="true" tabindex="-1"></a>                 ) <span class="ot">-&gt;</span> weather_jan</span></code></pre></div>
</div>
</table>
<p>A quick look at the structure of the data reveals some similarities:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="messychapter.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rev_jan)</span>
<span id="cb548-2"><a href="messychapter.html#cb548-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rev_feb)</span>
<span id="cb548-3"><a href="messychapter.html#cb548-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(weather_jan)</span></code></pre></div>
<p>The rows in <code>rev_jan</code> correspond one-to-one to the <em>rows</em> in <code>weather_jan</code>, with both tables being sorted in exactly the same way. We could therefore <em>bind their columns</em>, i.e. add the columns of <code>weather_jan</code> to <code>rev_jan</code>.</p>
<p><code>rev_jan</code> and <code>rev_feb</code> contain the same <em>columns</em>. We could therefore <em>bind their rows</em>, i.e. add the rows of <code>rev_feb</code> to <code>rev_jan</code>. To perform these operations, we can use either base R or <code>dplyr</code>:</p>
<table>
<div class="column-left">
<p>With base R:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="messychapter.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join columns of datasets that</span></span>
<span id="cb549-2"><a href="messychapter.html#cb549-2" aria-hidden="true" tabindex="-1"></a><span class="co"># have the same rows:</span></span>
<span id="cb549-3"><a href="messychapter.html#cb549-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(rev_jan, weather_jan)</span>
<span id="cb549-4"><a href="messychapter.html#cb549-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-5"><a href="messychapter.html#cb549-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join rows of datasets that have</span></span>
<span id="cb549-6"><a href="messychapter.html#cb549-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the same columns:</span></span>
<span id="cb549-7"><a href="messychapter.html#cb549-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(rev_jan, rev_feb)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="messychapter.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join columns of datasets that</span></span>
<span id="cb550-2"><a href="messychapter.html#cb550-2" aria-hidden="true" tabindex="-1"></a><span class="co"># have the same rows:</span></span>
<span id="cb550-3"><a href="messychapter.html#cb550-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(rev_jan, weather_jan)</span>
<span id="cb550-4"><a href="messychapter.html#cb550-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-5"><a href="messychapter.html#cb550-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join rows of datasets that have</span></span>
<span id="cb550-6"><a href="messychapter.html#cb550-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the same columns:</span></span>
<span id="cb550-7"><a href="messychapter.html#cb550-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(rev_jan, rev_feb)</span></code></pre></div>
</div>
</table>
</div>
<div id="merging-tables-using-keys" class="section level3 hasAnchor" number="5.12.2">
<h3><span class="header-section-number">5.12.2</span> Merging tables using keys<a href="messychapter.html#merging-tables-using-keys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A closer look at the business revenue data reveals that <code>rev_data</code> contains observations from 90 days whereas <code>weather_data</code> only contains data for 87 days; revenue data for 2020-03-01 is missing, and weather data for 2020-02-05, 2020-02-06, 2020-03-10, and 2020-03-29 are missing.</p>
<p>Suppose that we want to study how weather affects the revenue of the business. In order to do so, we must merge the two tables. We cannot use a simple column bind, because the two tables have different numbers of rows. If we attempt a bind, R will produce a merged table by recycling the first few rows from <code>rev_data</code> - note that the two <code>DATE</code> columns aren’t properly aligned:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="messychapter.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">cbind</span>(rev_data, weather_data))</span></code></pre></div>
<p>Clearly, this is not the desired output! We need a way to connect the rows in <code>rev_data</code> with the right rows in <code>weather_data</code>. Put differently, we need something that allows us to connect the observations in one table to those in another. Variables used to connect tables are known as <em>keys</em>, and must in some way uniquely identify observations. In this case the <code>DATE</code> column gives us the key - each observation is uniquely determined by it’s <code>DATE</code>. So to combine the two tables, we can combine rows from <code>rev_data</code> with the rows from <code>weather_data</code> that have the same <code>DATE</code> values. In the following sections, we’ll look at different ways of merging tables using <code>data.table</code> and <code>dplyr</code>.</p>
<p>But first, a word of warning: finding the right keys for merging tables is not always straightforward. For a more complex example, consider the <code>nycflights13</code> package, which contains five separate but connected datasets:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="messychapter.html#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb552-2"><a href="messychapter.html#cb552-2" aria-hidden="true" tabindex="-1"></a>?airlines  <span class="co"># Names and carrier codes of airlines.</span></span>
<span id="cb552-3"><a href="messychapter.html#cb552-3" aria-hidden="true" tabindex="-1"></a>?airports  <span class="co"># Information about airports.</span></span>
<span id="cb552-4"><a href="messychapter.html#cb552-4" aria-hidden="true" tabindex="-1"></a>?flights   <span class="co"># Departure and arrival times and delay information for</span></span>
<span id="cb552-5"><a href="messychapter.html#cb552-5" aria-hidden="true" tabindex="-1"></a>           <span class="co"># flights.</span></span>
<span id="cb552-6"><a href="messychapter.html#cb552-6" aria-hidden="true" tabindex="-1"></a>?planes    <span class="co"># Information about planes.</span></span>
<span id="cb552-7"><a href="messychapter.html#cb552-7" aria-hidden="true" tabindex="-1"></a>?weather   <span class="co"># Hourly meteorological data for airports.</span></span></code></pre></div>
<p>Perhaps you want to include weather information with the flight data, to study how weather affects delays. Or perhaps you wish to include information about the longitude and latitude of airports (from <code>airports</code>) in the <code>weather</code> dataset. In <code>airports</code>, each observation can be uniquely identified in three different ways: either by its airport code <code>faa</code>, its name <code>name</code> or its latitude and longitude, <code>lat</code> and <code>lon</code>:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="messychapter.html#cb553-1" aria-hidden="true" tabindex="-1"></a>?airports</span>
<span id="cb553-2"><a href="messychapter.html#cb553-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(airports)</span></code></pre></div>
<p>If we want to use either of these options as a key when merging with <code>airports</code> data with another table, that table should also contain the same key.</p>
<p>The <code>weather</code> data requires no less than four variables to identify each observation: <code>origin</code>, <code>month</code>, <code>day</code> and <code>hour</code>:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="messychapter.html#cb554-1" aria-hidden="true" tabindex="-1"></a>?weather</span>
<span id="cb554-2"><a href="messychapter.html#cb554-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(weather)</span></code></pre></div>
<p>It is not perfectly clear from the documentation, but the <code>origin</code> variable is actually the FAA airport code of the airport corresponding to the weather measurements. If we wish to add longitude and latitude to the weather data, we could therefore use <code>faa</code> from <code>airports</code> as a key.</p>
</div>
<div id="inner-and-outer-joins" class="section level3 hasAnchor" number="5.12.3">
<h3><span class="header-section-number">5.12.3</span> Inner and outer joins<a href="messychapter.html#inner-and-outer-joins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An operation that combines columns from two tables is called a <em>join</em>. There are two main types of joins: <em>inner joins</em> and <em>outer joins</em>.</p>
<ul>
<li><em>Inner joins</em>: create a table containing all observations for which the key appeared in both tables. So if we perform an inner join on the <code>rev_data</code> and <code>weather_data</code> tables using <code>DATE</code> as the key, it won’t contain data for the days that are missing from either the revenue table or the weather table.</li>
</ul>
<p>In contrast, outer joins create a table retaining rows, even if there is no match in the other table. There are three types of outer joins:</p>
<ul>
<li><em>Left join</em>: retains all rows from the first table. In the revenue example, this means all dates present in <code>rev_data</code>.</li>
<li><em>Right join</em>: retains all rows from the second table. In the revenue example, this means all dates present in <code>weather_data</code>.</li>
<li><em>Full join</em>: retains all rows present in at least one of the tables. In the revenue example, this means all dates present in at least one of <code>rev_data</code> and <code>weather_data</code>.</li>
</ul>
<p>We will use the <code>rev_data</code> and <code>weather_data</code> datasets to exemplify the different types of joins. To begin with, we convert them to <code>data.table</code> objects (which is optional if you wish to use <code>dplyr</code>):</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="messychapter.html#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb555-2"><a href="messychapter.html#cb555-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb555-3"><a href="messychapter.html#cb555-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-4"><a href="messychapter.html#cb555-4" aria-hidden="true" tabindex="-1"></a>rev_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(rev_data)</span>
<span id="cb555-5"><a href="messychapter.html#cb555-5" aria-hidden="true" tabindex="-1"></a>weather_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(weather_data)</span></code></pre></div>
<p>Remember that revenue data for 2020-03-01 is missing, and weather data for 2020-02-05, 2020-02-06, 2020-03-10, and 2020-03-29 are missing. This means that out of the 91 days in the period, only 86 have complete data. If we perform an inner join, the resulting table should therefore have 86 rows.</p>
<p>To perform and inner join of <code>rev_data</code> and <code>weather_data</code> using <code>DATE</code> as key:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="messychapter.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(rev_data, weather_data,</span>
<span id="cb556-2"><a href="messychapter.html#cb556-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span>
<span id="cb556-3"><a href="messychapter.html#cb556-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-4"><a href="messychapter.html#cb556-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or:</span></span>
<span id="cb556-5"><a href="messychapter.html#cb556-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(rev_data, DATE)</span>
<span id="cb556-6"><a href="messychapter.html#cb556-6" aria-hidden="true" tabindex="-1"></a>rev_data[weather_data, nomatch <span class="ot">=</span> <span class="dv">0</span>]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="messychapter.html#cb557-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(</span>
<span id="cb557-2"><a href="messychapter.html#cb557-2" aria-hidden="true" tabindex="-1"></a>                weather_data,</span>
<span id="cb557-3"><a href="messychapter.html#cb557-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
<p>A left join will retain the 90 dates present in <code>rev_data</code>. To perform a(n outer) left join of <code>rev_data</code> and <code>weather_data</code> using <code>DATE</code> as key:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="messychapter.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(rev_data, weather_data, </span>
<span id="cb558-2"><a href="messychapter.html#cb558-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span>
<span id="cb558-3"><a href="messychapter.html#cb558-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-4"><a href="messychapter.html#cb558-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or:</span></span>
<span id="cb558-5"><a href="messychapter.html#cb558-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(weather_data, DATE)</span>
<span id="cb558-6"><a href="messychapter.html#cb558-6" aria-hidden="true" tabindex="-1"></a>weather_data[rev_data]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="messychapter.html#cb559-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(</span>
<span id="cb559-2"><a href="messychapter.html#cb559-2" aria-hidden="true" tabindex="-1"></a>                weather_data,</span>
<span id="cb559-3"><a href="messychapter.html#cb559-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
<p>A right join will retain the 87 dates present in <code>weather_data</code>. To perform a(n outer) right join of <code>rev_data</code> and <code>weather_data</code> using <code>DATE</code> as key:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="messychapter.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(rev_data, weather_data, </span>
<span id="cb560-2"><a href="messychapter.html#cb560-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.y =</span> <span class="cn">TRUE</span>, <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span>
<span id="cb560-3"><a href="messychapter.html#cb560-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb560-4"><a href="messychapter.html#cb560-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or:</span></span>
<span id="cb560-5"><a href="messychapter.html#cb560-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(rev_data, DATE)</span>
<span id="cb560-6"><a href="messychapter.html#cb560-6" aria-hidden="true" tabindex="-1"></a>rev_data[weather_data]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="messychapter.html#cb561-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(</span>
<span id="cb561-2"><a href="messychapter.html#cb561-2" aria-hidden="true" tabindex="-1"></a>                  weather_data,</span>
<span id="cb561-3"><a href="messychapter.html#cb561-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
<p>A full join will retain the 91 dates present in at least one of <code>rev_data</code> and <code>weather_data</code>. To perform a(n outer) full join of <code>rev_data</code> and <code>weather_data</code> using <code>DATE</code> as key:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="messychapter.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(rev_data, weather_data, </span>
<span id="cb562-2"><a href="messychapter.html#cb562-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">all =</span> <span class="cn">TRUE</span>, <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="messychapter.html#cb563-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(</span>
<span id="cb563-2"><a href="messychapter.html#cb563-2" aria-hidden="true" tabindex="-1"></a>                weather_data,</span>
<span id="cb563-3"><a href="messychapter.html#cb563-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
</div>
<div id="semijoins" class="section level3 hasAnchor" number="5.12.4">
<h3><span class="header-section-number">5.12.4</span> Semijoins and antijoins<a href="messychapter.html#semijoins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Semijoins and antijoins are similar to joins, but work on observations rather than variables. That is, they are used for filtering one table using data from another table:</p>
<ul>
<li><em>Semijoin</em>: retains all observations in the first table that have a match in the second table.</li>
<li><em>Antijoin</em>: retains all observations in the first table that <em>do not</em> have a match in the second table.</li>
</ul>
<p>The same thing can be achieved using the filtering techniques of Section <a href="messychapter.html#filtering">5.8</a>, but semijoins and antijoins are simpler to use when the filtering relies on conditions from another table.</p>
<p>Suppose that we are interested in the revenue of our business for days in February with subzero temperatures. First, we can create a table called <code>filter_data</code> listing all such days:</p>
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="messychapter.html#cb564-1" aria-hidden="true" tabindex="-1"></a>rev_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(rev_data<span class="sc">$</span>DATE)</span>
<span id="cb564-2"><a href="messychapter.html#cb564-2" aria-hidden="true" tabindex="-1"></a>weather_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(weather_data<span class="sc">$</span>DATE)</span>
<span id="cb564-3"><a href="messychapter.html#cb564-3" aria-hidden="true" tabindex="-1"></a>filter_data <span class="ot">&lt;-</span> weather_data[TEMPERATURE <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> </span>
<span id="cb564-4"><a href="messychapter.html#cb564-4" aria-hidden="true" tabindex="-1"></a>                            DATE <span class="sc">%between%</span></span>
<span id="cb564-5"><a href="messychapter.html#cb564-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">&quot;2020-02-01&quot;</span>,</span>
<span id="cb564-6"><a href="messychapter.html#cb564-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;2020-02-29&quot;</span>),]</span></code></pre></div>
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="messychapter.html#cb565-1" aria-hidden="true" tabindex="-1"></a>rev_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(rev_data<span class="sc">$</span>DATE)</span>
<span id="cb565-2"><a href="messychapter.html#cb565-2" aria-hidden="true" tabindex="-1"></a>weather_data<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(weather_data<span class="sc">$</span>DATE)</span>
<span id="cb565-3"><a href="messychapter.html#cb565-3" aria-hidden="true" tabindex="-1"></a>weather_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TEMPERATURE <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb565-4"><a href="messychapter.html#cb565-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">between</span>(DATE,</span>
<span id="cb565-5"><a href="messychapter.html#cb565-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">as.Date</span>(<span class="st">&quot;2020-02-01&quot;</span>),</span>
<span id="cb565-6"><a href="messychapter.html#cb565-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">as.Date</span>(<span class="st">&quot;2020-02-29&quot;</span>))</span>
<span id="cb565-7"><a href="messychapter.html#cb565-7" aria-hidden="true" tabindex="-1"></a>                                 ) <span class="ot">-&gt;</span> filter_data</span></code></pre></div>
<p>Next, we can use a semijoin to extract the rows of <code>rev_data</code> corresponding to the days of <code>filter_data</code>:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="messychapter.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(rev_data, DATE)</span>
<span id="cb566-2"><a href="messychapter.html#cb566-2" aria-hidden="true" tabindex="-1"></a>rev_data[rev_data[filter_data,</span>
<span id="cb566-3"><a href="messychapter.html#cb566-3" aria-hidden="true" tabindex="-1"></a>                  which <span class="ot">=</span> <span class="cn">TRUE</span>]]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="messychapter.html#cb567-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(</span>
<span id="cb567-2"><a href="messychapter.html#cb567-2" aria-hidden="true" tabindex="-1"></a>                filter_data,</span>
<span id="cb567-3"><a href="messychapter.html#cb567-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
<p>If instead we wanted to find all days <em>except</em> the days in February with subzero temperatures, we could perform an antijoin:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="messychapter.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(rev_data, DATE)</span>
<span id="cb568-2"><a href="messychapter.html#cb568-2" aria-hidden="true" tabindex="-1"></a>rev_data[<span class="sc">!</span>filter_data]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="messychapter.html#cb569-1" aria-hidden="true" tabindex="-1"></a>rev_data <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(</span>
<span id="cb569-2"><a href="messychapter.html#cb569-2" aria-hidden="true" tabindex="-1"></a>                filter_data,</span>
<span id="cb569-3"><a href="messychapter.html#cb569-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">&quot;DATE&quot;</span>)</span></code></pre></div>
</div>
</table>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc20" class="exercise"><strong>Exercise 5.26  </strong></span>We return to the <code>oslo-biomarkers.xlsx</code> data from Exercises <a href="messychapter.html#exr:ch5exc65">5.8</a> and <a href="messychapter.html#exr:ch5exc19">5.25</a>. Load the data frame that you created in Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a> (or copy the code from <a href="solutions.html#ch5solutions19">its solution</a>). You should also load the <code>oslo-covariates.xlsx</code> data from the book’s web page - it contains information about the patients, such as age, gender and smoking habits.</p>
<p>Then do the following using <code>data.table</code> and/or <code>dplyr</code>/<code>tidyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Merge the wide data frame from Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a> with the <code>oslo-covariates.xlsx</code> data, using patient ID as key.</p></li>
<li><p>Use the <code>oslo-covariates.xlsx</code> data to select data for smokers from the wide data frame Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a>.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch5solutions20">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="scraping-data-from-websites" class="section level2 hasAnchor" number="5.13">
<h2><span class="header-section-number">5.13</span> Scraping data from websites<a href="messychapter.html#scraping-data-from-websites" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Web scraping</em> is the process of extracting data from a webpage. For instance, let’s say that we’d like to download the list of Nobel laureates from the Wikipedia page <a href="https://en.wikipedia.org/wiki/List_of_Nobel_laureates" class="uri">https://en.wikipedia.org/wiki/List_of_Nobel_laureates</a>. As with most sites, the text and formatting of the page is stored in an HTML file. In most browsers, you can view the HTML code by right-clicking on the page and choosing <em>View page source</em>. As you can see, all the information from the table can be found there, albeit in a format that is only just human-readable:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb570-1"><a href="messychapter.html#cb570-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb570-2"><a href="messychapter.html#cb570-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tbody&gt;&lt;tr&gt;</span></span>
<span id="cb570-3"><a href="messychapter.html#cb570-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th&gt;</span>Year</span>
<span id="cb570-4"><a href="messychapter.html#cb570-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-5"><a href="messychapter.html#cb570-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;18%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_laureates_in_Physics&quot;</span></span>
<span id="cb570-6"><a href="messychapter.html#cb570-6" aria-hidden="true" tabindex="-1"></a><span class="ot">  title=</span><span class="st">&quot;List of Nobel laureates in Physics&quot;</span><span class="kw">&gt;</span>Physics<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-7"><a href="messychapter.html#cb570-7" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-8"><a href="messychapter.html#cb570-8" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;16%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_laureates_in_Chemistry&quot;</span></span>
<span id="cb570-9"><a href="messychapter.html#cb570-9" aria-hidden="true" tabindex="-1"></a><span class="ot">title=</span><span class="st">&quot;List of Nobel laureates in Chemistry&quot;</span><span class="kw">&gt;</span>Chemistry<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-10"><a href="messychapter.html#cb570-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-11"><a href="messychapter.html#cb570-11" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;18%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_laureates_in_Physiology_</span></span>
<span id="cb570-12"><a href="messychapter.html#cb570-12" aria-hidden="true" tabindex="-1"></a><span class="st">or_Medicine&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;List of Nobel laureates in Physiology or Medicine</span></span>
<span id="cb570-13"><a href="messychapter.html#cb570-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="kw">&gt;</span>Physiology<span class="kw">&lt;br</span> <span class="kw">/&gt;</span>or Medicine<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-14"><a href="messychapter.html#cb570-14" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-15"><a href="messychapter.html#cb570-15" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;16%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_laureates_in_Literature&quot;</span></span>
<span id="cb570-16"><a href="messychapter.html#cb570-16" aria-hidden="true" tabindex="-1"></a><span class="ot">title=</span><span class="st">&quot;List of Nobel laureates in Literature&quot;</span><span class="kw">&gt;</span>Literature<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-17"><a href="messychapter.html#cb570-17" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-18"><a href="messychapter.html#cb570-18" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;16%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_Peace_Prize_laureates&quot;</span></span>
<span id="cb570-19"><a href="messychapter.html#cb570-19" aria-hidden="true" tabindex="-1"></a><span class="ot">title=</span><span class="st">&quot;List of Nobel Peace Prize laureates&quot;</span><span class="kw">&gt;</span>Peace<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-20"><a href="messychapter.html#cb570-20" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;</span></span>
<span id="cb570-21"><a href="messychapter.html#cb570-21" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;th</span> <span class="er">width</span><span class="ot">=</span><span class="st">&quot;15%&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/List_of_Nobel_laureates_in_Economics&quot;</span></span>
<span id="cb570-22"><a href="messychapter.html#cb570-22" aria-hidden="true" tabindex="-1"></a><span class="ot">class=</span><span class="st">&quot;mw-redirect&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;List of Nobel laureates in Economics&quot;</span><span class="kw">&gt;</span></span>
<span id="cb570-23"><a href="messychapter.html#cb570-23" aria-hidden="true" tabindex="-1"></a>  Economics<span class="kw">&lt;/a&gt;&lt;br</span> <span class="kw">/&gt;</span>(The Sveriges Riksbank Prize)<span class="kw">&lt;sup</span> <span class="er">id</span><span class="ot">=</span><span class="st">&quot;cite_ref-</span></span>
<span id="cb570-24"><a href="messychapter.html#cb570-24" aria-hidden="true" tabindex="-1"></a><span class="st">11&quot;</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;reference&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;#cite_note-11&quot;</span><span class="kw">&gt;</span><span class="dv">&amp;#91;</span>11<span class="dv">&amp;#93;</span><span class="kw">&lt;/a&gt;&lt;/sup&gt;</span></span>
<span id="cb570-25"><a href="messychapter.html#cb570-25" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/th&gt;&lt;/tr&gt;</span></span>
<span id="cb570-26"><a href="messychapter.html#cb570-26" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tr&gt;</span></span>
<span id="cb570-27"><a href="messychapter.html#cb570-27" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;td</span> <span class="er">align</span><span class="ot">=</span><span class="st">&quot;center&quot;</span><span class="kw">&gt;</span>1901</span>
<span id="cb570-28"><a href="messychapter.html#cb570-28" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/td&gt;</span></span>
<span id="cb570-29"><a href="messychapter.html#cb570-29" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;td&gt;&lt;span</span> <span class="er">data-sort-value</span><span class="ot">=</span><span class="st">&quot;Röntgen, Wilhelm&quot;</span><span class="kw">&gt;&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;vcard&quot;</span><span class="kw">&gt;&lt;span</span></span>
<span id="cb570-30"><a href="messychapter.html#cb570-30" aria-hidden="true" tabindex="-1"></a><span class="ot">class=</span><span class="st">&quot;fn&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/Wilhelm_R%C3%B6ntgen&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;Wilhelm</span></span>
<span id="cb570-31"><a href="messychapter.html#cb570-31" aria-hidden="true" tabindex="-1"></a><span class="st">Röntgen&quot;</span><span class="kw">&gt;</span>  Wilhelm Röntgen<span class="kw">&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span></span>
<span id="cb570-32"><a href="messychapter.html#cb570-32" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/td&gt;</span></span>
<span id="cb570-33"><a href="messychapter.html#cb570-33" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;td&gt;&lt;span</span> <span class="er">data-sort-value</span><span class="ot">=</span><span class="st">&quot;Hoff, Jacobus Henricus van </span><span class="dv">&amp;#39;</span><span class="st">t&quot;</span><span class="kw">&gt;&lt;span</span></span>
<span id="cb570-34"><a href="messychapter.html#cb570-34" aria-hidden="true" tabindex="-1"></a><span class="ot">class=</span><span class="st">&quot;vcard&quot;</span><span class="kw">&gt;&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;fn&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/Jacobus_Henricus_van_</span></span>
<span id="cb570-35"><a href="messychapter.html#cb570-35" aria-hidden="true" tabindex="-1"></a><span class="st">%27t_Hoff&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;Jacobus Henricus van </span><span class="dv">&amp;#39;</span><span class="st">t Hoff&quot;</span><span class="kw">&gt;</span>Jacobus Henricus</span>
<span id="cb570-36"><a href="messychapter.html#cb570-36" aria-hidden="true" tabindex="-1"></a>van &#39;t Hoff<span class="kw">&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span></span>
<span id="cb570-37"><a href="messychapter.html#cb570-37" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/td&gt;</span></span>
<span id="cb570-38"><a href="messychapter.html#cb570-38" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;td&gt;&lt;span</span> <span class="er">data-sort-value</span><span class="ot">=</span><span class="st">&quot;von Behring, Emil Adolf&quot;</span><span class="kw">&gt;&lt;span</span> <span class="er">class</span><span class="ot">=</span></span>
<span id="cb570-39"><a href="messychapter.html#cb570-39" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;vcard&quot;</span><span class="kw">&gt;</span></span>
<span id="cb570-40"><a href="messychapter.html#cb570-40" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;fn&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/wiki/Emil_Adolf_von_Behring&quot;</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;mw-</span></span>
<span id="cb570-41"><a href="messychapter.html#cb570-41" aria-hidden="true" tabindex="-1"></a><span class="st">redirect&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;Emil Adolf von Behring&quot;</span><span class="kw">&gt;</span>Emil Adolf von Behring<span class="kw">&lt;/a&gt;</span></span>
<span id="cb570-42"><a href="messychapter.html#cb570-42" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span></span>
<span id="cb570-43"><a href="messychapter.html#cb570-43" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/td&gt;</span></span>
<span id="cb570-44"><a href="messychapter.html#cb570-44" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
<p>To get hold of the data from the table, we could perhaps select all rows, copy them and paste them into a spreadsheet software such as Excel. But it would be much more convenient to be able to just import the table to R straight from the HTML file. Because tables written in HTML follow specific formats, it is possible to write code that automatically converts them to data frames in R. The <code>rvest</code> package contains a number of functions for that. Let’s install it:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="messychapter.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rvest&quot;</span>)</span></code></pre></div>
<p>To read the entire Wikipedia page, we use:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="messychapter.html#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb572-2"><a href="messychapter.html#cb572-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://en.wikipedia.org/wiki/List_of_Nobel_laureates&quot;</span></span>
<span id="cb572-3"><a href="messychapter.html#cb572-3" aria-hidden="true" tabindex="-1"></a>wiki <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span></code></pre></div>
<p>The object <code>wiki</code> now contains all the information from the page - you can have a quick look at it by using <code>html_text</code>:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="messychapter.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">html_text</span>(wiki)</span></code></pre></div>
<p>That is more information than we need. To extract all tables from <code>wiki</code>, we can use <code>html_nodes</code>:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="messychapter.html#cb574-1" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(wiki, <span class="st">&quot;table&quot;</span>)</span>
<span id="cb574-2"><a href="messychapter.html#cb574-2" aria-hidden="true" tabindex="-1"></a>tables</span></code></pre></div>
<p>The first table, starting with the HTML code</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb575-1"><a href="messychapter.html#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;wikitable sortable&quot;</span><span class="kw">&gt;&lt;tbody&gt;</span>\n<span class="kw">&lt;tr&gt;</span>\n<span class="kw">&lt;th&gt;</span>Year\n<span class="kw">&lt;/th&gt;</span></span></code></pre></div>
<p>is the one we are looking for. To transform it to a data frame, we use <code>html_table</code> as follows:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="messychapter.html#cb576-1" aria-hidden="true" tabindex="-1"></a>laureates <span class="ot">&lt;-</span> <span class="fu">html_table</span>(tables[[<span class="dv">1</span>]], <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb576-2"><a href="messychapter.html#cb576-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(laureates)</span></code></pre></div>
<p>The <code>rvest</code> package can also be used for extracting data from more complex website structures using the <a href="https://selectorgadget.com/">SelectorGadget</a> tool in the web browser <a href="https://www.google.com/chrome/">Chrome</a>. This let’s you select the page elements that you wish to scrape in your browser, and helps you create the code needed to import them to R. For an example of how to use it, run <code>vignette("selectorgadget")</code>.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch5exc21" class="exercise"><strong>Exercise 5.27  </strong></span>Scrape the table containing different keytar models from <a href="https://en.wikipedia.org/wiki/List_of_keytars" class="uri">https://en.wikipedia.org/wiki/List_of_keytars</a>. Perform the necessary operations to convert the <code>Dates</code> column to <code>numeric</code>.</p>
</div>
<p><a href="solutions.html#ch5solutions21">(Click here to go to the solution.)</a></p>
</div>
<div id="commontasks" class="section level2 hasAnchor" number="5.14">
<h2><span class="header-section-number">5.14</span> Other commons tasks<a href="messychapter.html#commontasks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="deleting-variables" class="section level3 hasAnchor" number="5.14.1">
<h3><span class="header-section-number">5.14.1</span> Deleting variables<a href="messychapter.html#deleting-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you no longer need a variable, you can delete it using <code>rm</code>:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="messychapter.html#cb577-1" aria-hidden="true" tabindex="-1"></a>my_variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, pi)</span>
<span id="cb577-2"><a href="messychapter.html#cb577-2" aria-hidden="true" tabindex="-1"></a>my_variable</span>
<span id="cb577-3"><a href="messychapter.html#cb577-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(my_variable)</span>
<span id="cb577-4"><a href="messychapter.html#cb577-4" aria-hidden="true" tabindex="-1"></a>my_variable</span></code></pre></div>
<p>This can be useful for instance if you have loaded a data frame that no longer is needed and takes up a lot of memory. If you, for some reason, want to wipe all your variables, you can use <code>ls</code>, which returns a vector containing the names of all variables, in combination with <code>rm</code>:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="messychapter.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this at your own risk! This deletes all currently loaded</span></span>
<span id="cb578-2"><a href="messychapter.html#cb578-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variables.</span></span>
<span id="cb578-3"><a href="messychapter.html#cb578-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-4"><a href="messychapter.html#cb578-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment to run:</span></span>
<span id="cb578-5"><a href="messychapter.html#cb578-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span></code></pre></div>
<p>Variables are automatically deleted when you exit R (unless you choose to save your workspace). On the rare occasions where I want to wipe all variables from memory, I usually do a restart instead of using <code>rm</code>.</p>
</div>
<div id="foreign" class="section level3 hasAnchor" number="5.14.2">
<h3><span class="header-section-number">5.14.2</span> Importing data from other statistical packages<a href="messychapter.html#foreign" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>foreign</code> library contains functions for importing data from other statistical packages, such as Stata (<code>read.dta</code>), Minitab (<code>read.mtp</code>), SPSS (<code>read.spss</code>), and SAS (XPORT files, <code>read.xport</code>). They work just like <code>read.csv</code> (see Section <a href="datachapter.html#paths">3.3</a>), with additional arguments specific to the file format used for the statistical package in question.</p>
</div>
<div id="importing-data-from-databases" class="section level3 hasAnchor" number="5.14.3">
<h3><span class="header-section-number">5.14.3</span> Importing data from databases<a href="messychapter.html#importing-data-from-databases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R and RStudio have excellent support for connecting to databases. However, this requires some knowledge about databases and topics like ODBC drivers, and is therefore beyond the scope of the book. More information about using databases with R can be found at <a href="https://db.rstudio.com/" class="uri">https://db.rstudio.com/</a>.</p>
</div>
<div id="importing-data-from-json-files" class="section level3 hasAnchor" number="5.14.4">
<h3><span class="header-section-number">5.14.4</span> Importing data from JSON files<a href="messychapter.html#importing-data-from-json-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>JSON is a common file format for transmitting data between different systems. It is often used in web server systems where users can request data. One example of this is found in the JSON file at
<a href="https://opendata-download-metobs.smhi.se/api/version/1.0/parameter/2/station/98210/period/latest-months/data.json" class="uri">https://opendata-download-metobs.smhi.se/api/version/1.0/parameter/2/station/98210/period/latest-months/data.json</a>. It contains daily mean temperatures from Stockholm, Sweden, during the last few months, accessible from the Swedish Meteorological and Hydrological Institute’s server. Have a look at it in your web browser, and then install the <code>jsonlite</code> package:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="messychapter.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;jsonlite&quot;</span>)</span></code></pre></div>
<p>We’ll use the <code>fromJSON</code> function from <code>jsonlite</code> to import the data:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="messychapter.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb580-2"><a href="messychapter.html#cb580-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;https://opendata-download-metobs.smhi.se/api/version/&quot;</span>,</span>
<span id="cb580-3"><a href="messychapter.html#cb580-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;1.0/parameter/2/station/98210/period/latest-months/&quot;</span>,</span>
<span id="cb580-4"><a href="messychapter.html#cb580-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;data.json&quot;</span>,</span>
<span id="cb580-5"><a href="messychapter.html#cb580-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb580-6"><a href="messychapter.html#cb580-6" aria-hidden="true" tabindex="-1"></a>stockholm <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb580-7"><a href="messychapter.html#cb580-7" aria-hidden="true" tabindex="-1"></a>stockholm</span></code></pre></div>
<p>By design, JSON files contain lists, and so <code>stockholm</code> is a <code>list</code> object. The temperature data that we were looking for is (in this particular case) contained in the list element called <code>value</code>:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="messychapter.html#cb581-1" aria-hidden="true" tabindex="-1"></a>stockholm<span class="sc">$</span>value</span></code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="30">
<li id="fn30"><p>In fact, the opposite is true: under the hood, a data frame is a list of vectors of equal length.<a href="messychapter.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>Courtesy of the Department of Earth Sciences at Uppsala University.<a href="messychapter.html#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>This is not strictly speaking true; if we use base 3, <span class="math inline">\(1/3\)</span> is written as <span class="math inline">\(0.1\)</span> which can be stored in a finite memory. But then other numbers become problematic instead.<a href="messychapter.html#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p>Not in R though.<a href="messychapter.html#fnref33" class="footnote-back">↩︎</a></p></li>
<li id="fn34"><p>See <code>?Quotes</code> for a complete list.<a href="messychapter.html#fnref34" class="footnote-back">↩︎</a></p></li>
<li id="fn35"><p>For patient confidentiality purposes.<a href="messychapter.html#fnref35" class="footnote-back">↩︎</a></p></li>
<li id="fn36"><p>The Swedish <em>onsdag</em> and English <em>Wednesday</em> both derive from the proto-Germanic <em>Wodensdag</em>, Odin’s day, in honour of the old Germanic god of that name.<a href="messychapter.html#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>There is also a package called <code>dtplyr</code>, which allows you to use the fast functions from <code>data.table</code> with <code>dplyr</code> syntax. It is useful if you are working with big data, already know <code>dplyr</code> and don’t want to learn <code>data.table</code>. If that isn’t an accurate description of you, you can safely ignore <code>dtplyr</code> for now.<a href="messychapter.html#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>You may need to install the package first, using <code>install.packages("gapminder")</code>.<a href="messychapter.html#fnref38" class="footnote-back">↩︎</a></p></li>
<li id="fn39"><p>I’ve intentionally left out the details regarding the business - these are real sales data from a client, which can be sensitive information.<a href="messychapter.html#fnref39" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="eda.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="progchapter.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
