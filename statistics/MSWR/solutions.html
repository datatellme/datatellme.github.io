<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Solutions to exercises | Modern Statistics with R</title>
  <meta name="description" content="13 Solutions to exercises | Modern Statistics with R" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Solutions to exercises | Modern Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Solutions to exercises | Modern Statistics with R" />
  
  
  

<meta name="author" content="Mans Thulin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mathschap.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="preamble.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="Introduction.html"><a href="Introduction.html"><i class="fa fa-check"></i><b>1</b> 들어가며</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Introduction.html"><a href="Introduction.html#whatR"><i class="fa fa-check"></i><b>1.1</b> R이란?</a></li>
<li class="chapter" data-level="1.2" data-path="Introduction.html"><a href="Introduction.html#Rinstallation"><i class="fa fa-check"></i><b>1.2</b> R 설치하기</a></li>
<li class="chapter" data-level="1.3" data-path="Introduction.html"><a href="Introduction.html#RStudioinstallation"><i class="fa fa-check"></i><b>1.3</b> RStudio 설치하기</a></li>
<li class="chapter" data-level="1.4" data-path="Introduction.html"><a href="Introduction.html#LaTeXinstallation"><i class="fa fa-check"></i><b>1.4</b> 레이텍 설치하기</a></li>
<li class="chapter" data-level="1.5" data-path="Introduction.html"><a href="Introduction.html#packageinstallation"><i class="fa fa-check"></i><b>1.5</b> Packages 설치하기</a></li>
<li class="chapter" data-level="1.6" data-path="Introduction.html"><a href="Introduction.html#aboutbook"><i class="fa fa-check"></i><b>1.6</b> 이 책에 대하여</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="thebasics.html"><a href="thebasics.html"><i class="fa fa-check"></i><b>2</b> The basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="thebasics.html"><a href="thebasics.html#a-first-look-at-rstudio"><i class="fa fa-check"></i><b>2.1</b> A first look at RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="thebasics.html"><a href="thebasics.html#runningcode"><i class="fa fa-check"></i><b>2.2</b> Running R code</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="thebasics.html"><a href="thebasics.html#r-scripts"><i class="fa fa-check"></i><b>2.2.1</b> R scripts</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="thebasics.html"><a href="thebasics.html#varsandfuncs"><i class="fa fa-check"></i><b>2.3</b> Variables and functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="thebasics.html"><a href="thebasics.html#storing-data"><i class="fa fa-check"></i><b>2.3.1</b> Storing data</a></li>
<li class="chapter" data-level="2.3.2" data-path="thebasics.html"><a href="thebasics.html#whats-in-a-name"><i class="fa fa-check"></i><b>2.3.2</b> What’s in a name?</a></li>
<li class="chapter" data-level="2.3.3" data-path="thebasics.html"><a href="thebasics.html#vectors-and-data-frames"><i class="fa fa-check"></i><b>2.3.3</b> Vectors and data frames</a></li>
<li class="chapter" data-level="2.3.4" data-path="thebasics.html"><a href="thebasics.html#functions"><i class="fa fa-check"></i><b>2.3.4</b> Functions</a></li>
<li class="chapter" data-level="2.3.5" data-path="thebasics.html"><a href="thebasics.html#maths"><i class="fa fa-check"></i><b>2.3.5</b> Mathematical operations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="thebasics.html"><a href="thebasics.html#descstats"><i class="fa fa-check"></i><b>2.4</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="thebasics.html"><a href="thebasics.html#numerical-data"><i class="fa fa-check"></i><b>2.4.1</b> Numerical data</a></li>
<li class="chapter" data-level="2.4.2" data-path="thebasics.html"><a href="thebasics.html#catdata1"><i class="fa fa-check"></i><b>2.4.2</b> Categorical data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="thebasics.html"><a href="thebasics.html#plotting-numerical-data"><i class="fa fa-check"></i><b>2.5</b> Plotting numerical data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="thebasics.html"><a href="thebasics.html#our-first-plot"><i class="fa fa-check"></i><b>2.5.1</b> Our first plot</a></li>
<li class="chapter" data-level="2.5.2" data-path="thebasics.html"><a href="thebasics.html#colours-shapes-and-axis-labels"><i class="fa fa-check"></i><b>2.5.2</b> Colours, shapes and axis labels</a></li>
<li class="chapter" data-level="2.5.3" data-path="thebasics.html"><a href="thebasics.html#axis-limits-and-scales"><i class="fa fa-check"></i><b>2.5.3</b> Axis limits and scales</a></li>
<li class="chapter" data-level="2.5.4" data-path="thebasics.html"><a href="thebasics.html#comparinggroups"><i class="fa fa-check"></i><b>2.5.4</b> Comparing groups</a></li>
<li class="chapter" data-level="2.5.5" data-path="thebasics.html"><a href="thebasics.html#boxplots"><i class="fa fa-check"></i><b>2.5.5</b> Boxplots</a></li>
<li class="chapter" data-level="2.5.6" data-path="thebasics.html"><a href="thebasics.html#histograms"><i class="fa fa-check"></i><b>2.5.6</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="thebasics.html"><a href="thebasics.html#catdata2"><i class="fa fa-check"></i><b>2.6</b> Plotting categorical data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="thebasics.html"><a href="thebasics.html#bar-charts"><i class="fa fa-check"></i><b>2.6.1</b> Bar charts</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="thebasics.html"><a href="thebasics.html#saving-your-plot"><i class="fa fa-check"></i><b>2.7</b> Saving your plot</a></li>
<li class="chapter" data-level="2.8" data-path="thebasics.html"><a href="thebasics.html#troubleshooting"><i class="fa fa-check"></i><b>2.8</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datachapter.html"><a href="datachapter.html"><i class="fa fa-check"></i><b>3</b> Transforming, summarising, and analysing data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datachapter.html"><a href="datachapter.html#data-frames-and-data-types"><i class="fa fa-check"></i><b>3.1</b> Data frames and data types</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="datachapter.html"><a href="datachapter.html#types-and-structures"><i class="fa fa-check"></i><b>3.1.1</b> Types and structures</a></li>
<li class="chapter" data-level="3.1.2" data-path="datachapter.html"><a href="datachapter.html#typesoftables"><i class="fa fa-check"></i><b>3.1.2</b> Types of tables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="datachapter.html"><a href="datachapter.html#findingpoints"><i class="fa fa-check"></i><b>3.2</b> Vectors in data frames</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datachapter.html"><a href="datachapter.html#accessingelements"><i class="fa fa-check"></i><b>3.2.1</b> Accessing vectors and elements</a></li>
<li class="chapter" data-level="3.2.2" data-path="datachapter.html"><a href="datachapter.html#use-your-dollars"><i class="fa fa-check"></i><b>3.2.2</b> Use your dollars</a></li>
<li class="chapter" data-level="3.2.3" data-path="datachapter.html"><a href="datachapter.html#conditionsintro"><i class="fa fa-check"></i><b>3.2.3</b> Using conditions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datachapter.html"><a href="datachapter.html#paths"><i class="fa fa-check"></i><b>3.3</b> Importing data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datachapter.html"><a href="datachapter.html#importing-csv-files"><i class="fa fa-check"></i><b>3.3.1</b> Importing csv files</a></li>
<li class="chapter" data-level="3.3.2" data-path="datachapter.html"><a href="datachapter.html#file-paths"><i class="fa fa-check"></i><b>3.3.2</b> File paths</a></li>
<li class="chapter" data-level="3.3.3" data-path="datachapter.html"><a href="datachapter.html#importing-excel-files"><i class="fa fa-check"></i><b>3.3.3</b> Importing Excel files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datachapter.html"><a href="datachapter.html#saving-and-exporting-your-data"><i class="fa fa-check"></i><b>3.4</b> Saving and exporting your data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="datachapter.html"><a href="datachapter.html#exporting-data"><i class="fa fa-check"></i><b>3.4.1</b> Exporting data</a></li>
<li class="chapter" data-level="3.4.2" data-path="datachapter.html"><a href="datachapter.html#saving-and-loading-r-data"><i class="fa fa-check"></i><b>3.4.2</b> Saving and loading R data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datachapter.html"><a href="datachapter.html#rstudio-projects"><i class="fa fa-check"></i><b>3.5</b> RStudio projects</a></li>
<li class="chapter" data-level="3.6" data-path="datachapter.html"><a href="datachapter.html#firstttest"><i class="fa fa-check"></i><b>3.6</b> Running a t-test</a></li>
<li class="chapter" data-level="3.7" data-path="datachapter.html"><a href="datachapter.html#firstlm"><i class="fa fa-check"></i><b>3.7</b> Fitting a linear regression model</a></li>
<li class="chapter" data-level="3.8" data-path="datachapter.html"><a href="datachapter.html#grouped"><i class="fa fa-check"></i><b>3.8</b> Grouped summaries</a></li>
<li class="chapter" data-level="3.9" data-path="datachapter.html"><a href="datachapter.html#pipes"><i class="fa fa-check"></i><b>3.9</b> Using <code>%&gt;%</code> pipes</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="datachapter.html"><a href="datachapter.html#ceci-nest-pas-une-pipe"><i class="fa fa-check"></i><b>3.9.1</b> <em>Ceci n’est pas une pipe</em></a></li>
<li class="chapter" data-level="3.9.2" data-path="datachapter.html"><a href="datachapter.html#aliases-and-placeholders"><i class="fa fa-check"></i><b>3.9.2</b> Aliases and placeholders</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="datachapter.html"><a href="datachapter.html#flavours-of-r-base-and-tidyverse"><i class="fa fa-check"></i><b>3.10</b> Flavours of R: base and tidyverse</a></li>
<li class="chapter" data-level="3.11" data-path="datachapter.html"><a href="datachapter.html#ethicalguidelines"><i class="fa fa-check"></i><b>3.11</b> Ethics and good statistical practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis and unsupervised learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="eda.html"><a href="eda.html#rmarkdown"><i class="fa fa-check"></i><b>4.1</b> Reports with R Markdown</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="eda.html"><a href="eda.html#a-first-example"><i class="fa fa-check"></i><b>4.1.1</b> A first example</a></li>
<li class="chapter" data-level="4.1.2" data-path="eda.html"><a href="eda.html#formatting-text"><i class="fa fa-check"></i><b>4.1.2</b> Formatting text</a></li>
<li class="chapter" data-level="4.1.3" data-path="eda.html"><a href="eda.html#lists-tables-and-images"><i class="fa fa-check"></i><b>4.1.3</b> Lists, tables, and images</a></li>
<li class="chapter" data-level="4.1.4" data-path="eda.html"><a href="eda.html#code-chunks"><i class="fa fa-check"></i><b>4.1.4</b> Code chunks</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="eda.html"><a href="eda.html#themes"><i class="fa fa-check"></i><b>4.2</b> Customising <code>ggplot2</code> plots</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="eda.html"><a href="eda.html#using-themes"><i class="fa fa-check"></i><b>4.2.1</b> Using themes</a></li>
<li class="chapter" data-level="4.2.2" data-path="eda.html"><a href="eda.html#colourpalettes"><i class="fa fa-check"></i><b>4.2.2</b> Colour palettes</a></li>
<li class="chapter" data-level="4.2.3" data-path="eda.html"><a href="eda.html#theme-settings"><i class="fa fa-check"></i><b>4.2.3</b> Theme settings</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="eda.html"><a href="eda.html#exploring-distributions"><i class="fa fa-check"></i><b>4.3</b> Exploring distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="eda.html"><a href="eda.html#density-plots-and-frequency-polygons"><i class="fa fa-check"></i><b>4.3.1</b> Density plots and frequency polygons</a></li>
<li class="chapter" data-level="4.3.2" data-path="eda.html"><a href="eda.html#asking-questions"><i class="fa fa-check"></i><b>4.3.2</b> Asking questions</a></li>
<li class="chapter" data-level="4.3.3" data-path="eda.html"><a href="eda.html#violin-plots"><i class="fa fa-check"></i><b>4.3.3</b> Violin plots</a></li>
<li class="chapter" data-level="4.3.4" data-path="eda.html"><a href="eda.html#patchwork"><i class="fa fa-check"></i><b>4.3.4</b> Combine multiple plots into a single graphic</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="eda.html"><a href="eda.html#outliers-and-missing-data"><i class="fa fa-check"></i><b>4.4</b> Outliers and missing data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="eda.html"><a href="eda.html#detecting-outliers"><i class="fa fa-check"></i><b>4.4.1</b> Detecting outliers</a></li>
<li class="chapter" data-level="4.4.2" data-path="eda.html"><a href="eda.html#labelling-outliers"><i class="fa fa-check"></i><b>4.4.2</b> Labelling outliers</a></li>
<li class="chapter" data-level="4.4.3" data-path="eda.html"><a href="eda.html#missing-data"><i class="fa fa-check"></i><b>4.4.3</b> Missing data</a></li>
<li class="chapter" data-level="4.4.4" data-path="eda.html"><a href="eda.html#exploring-data"><i class="fa fa-check"></i><b>4.4.4</b> Exploring data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="eda.html"><a href="eda.html#trends-in-scatterplots"><i class="fa fa-check"></i><b>4.5</b> Trends in scatterplots</a></li>
<li class="chapter" data-level="4.6" data-path="eda.html"><a href="eda.html#tsplots"><i class="fa fa-check"></i><b>4.6</b> Exploring time series</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="eda.html"><a href="eda.html#annotations-and-reference-lines"><i class="fa fa-check"></i><b>4.6.1</b> Annotations and reference lines</a></li>
<li class="chapter" data-level="4.6.2" data-path="eda.html"><a href="eda.html#longitudinal-data"><i class="fa fa-check"></i><b>4.6.2</b> Longitudinal data</a></li>
<li class="chapter" data-level="4.6.3" data-path="eda.html"><a href="eda.html#path-plots"><i class="fa fa-check"></i><b>4.6.3</b> Path plots</a></li>
<li class="chapter" data-level="4.6.4" data-path="eda.html"><a href="eda.html#spaghetti-plots"><i class="fa fa-check"></i><b>4.6.4</b> Spaghetti plots</a></li>
<li class="chapter" data-level="4.6.5" data-path="eda.html"><a href="eda.html#stlsec"><i class="fa fa-check"></i><b>4.6.5</b> Seasonal plots and decompositions</a></li>
<li class="chapter" data-level="4.6.6" data-path="eda.html"><a href="eda.html#detecting-changepoints"><i class="fa fa-check"></i><b>4.6.6</b> Detecting changepoints</a></li>
<li class="chapter" data-level="4.6.7" data-path="eda.html"><a href="eda.html#interactivets"><i class="fa fa-check"></i><b>4.6.7</b> Interactive time series plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="eda.html"><a href="eda.html#polar"><i class="fa fa-check"></i><b>4.7</b> Using polar coordinates</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="eda.html"><a href="eda.html#visualising-periodic-data"><i class="fa fa-check"></i><b>4.7.1</b> Visualising periodic data</a></li>
<li class="chapter" data-level="4.7.2" data-path="eda.html"><a href="eda.html#pie-charts"><i class="fa fa-check"></i><b>4.7.2</b> Pie charts</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="eda.html"><a href="eda.html#visualising-multiple-variables"><i class="fa fa-check"></i><b>4.8</b> Visualising multiple variables</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="eda.html"><a href="eda.html#scatterplotmatrix"><i class="fa fa-check"></i><b>4.8.1</b> Scatterplot matrices</a></li>
<li class="chapter" data-level="4.8.2" data-path="eda.html"><a href="eda.html#d-scatterplots"><i class="fa fa-check"></i><b>4.8.2</b> 3D scatterplots</a></li>
<li class="chapter" data-level="4.8.3" data-path="eda.html"><a href="eda.html#correlograms"><i class="fa fa-check"></i><b>4.8.3</b> Correlograms</a></li>
<li class="chapter" data-level="4.8.4" data-path="eda.html"><a href="eda.html#adding-more-variables-to-scatterplots"><i class="fa fa-check"></i><b>4.8.4</b> Adding more variables to scatterplots</a></li>
<li class="chapter" data-level="4.8.5" data-path="eda.html"><a href="eda.html#overplotting"><i class="fa fa-check"></i><b>4.8.5</b> Overplotting</a></li>
<li class="chapter" data-level="4.8.6" data-path="eda.html"><a href="eda.html#categorical-data"><i class="fa fa-check"></i><b>4.8.6</b> Categorical data</a></li>
<li class="chapter" data-level="4.8.7" data-path="eda.html"><a href="eda.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.8.7</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>4.9</b> Principal component analysis</a></li>
<li class="chapter" data-level="4.10" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>4.10</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>4.10.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="4.10.2" data-path="eda.html"><a href="eda.html#heatmaps-and-clustering-variables"><i class="fa fa-check"></i><b>4.10.2</b> Heatmaps and clustering variables</a></li>
<li class="chapter" data-level="4.10.3" data-path="eda.html"><a href="eda.html#centroid"><i class="fa fa-check"></i><b>4.10.3</b> Centroid-based clustering</a></li>
<li class="chapter" data-level="4.10.4" data-path="eda.html"><a href="eda.html#fuzzy-clustering"><i class="fa fa-check"></i><b>4.10.4</b> Fuzzy clustering</a></li>
<li class="chapter" data-level="4.10.5" data-path="eda.html"><a href="eda.html#modelbasedclustering"><i class="fa fa-check"></i><b>4.10.5</b> Model-based clustering</a></li>
<li class="chapter" data-level="4.10.6" data-path="eda.html"><a href="eda.html#comparing-clusters"><i class="fa fa-check"></i><b>4.10.6</b> Comparing clusters</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="eda.html"><a href="eda.html#exploratory-factor-analysis"><i class="fa fa-check"></i><b>4.11</b> Exploratory factor analysis</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="eda.html"><a href="eda.html#factor-analysis"><i class="fa fa-check"></i><b>4.11.1</b> Factor analysis</a></li>
<li class="chapter" data-level="4.11.2" data-path="eda.html"><a href="eda.html#lca"><i class="fa fa-check"></i><b>4.11.2</b> Latent class analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="messychapter.html"><a href="messychapter.html"><i class="fa fa-check"></i><b>5</b> Dealing with messy data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="messychapter.html"><a href="messychapter.html#coercion"><i class="fa fa-check"></i><b>5.1</b> Changing data types</a></li>
<li class="chapter" data-level="5.2" data-path="messychapter.html"><a href="messychapter.html#lists2"><i class="fa fa-check"></i><b>5.2</b> Working with lists</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="messychapter.html"><a href="messychapter.html#splitvector"><i class="fa fa-check"></i><b>5.2.1</b> Splitting vectors into lists</a></li>
<li class="chapter" data-level="5.2.2" data-path="messychapter.html"><a href="messychapter.html#collapsing-lists-into-vectors"><i class="fa fa-check"></i><b>5.2.2</b> Collapsing lists into vectors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="messychapter.html"><a href="messychapter.html#working-with-numbers"><i class="fa fa-check"></i><b>5.3</b> Working with numbers</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="messychapter.html"><a href="messychapter.html#rounding-numbers"><i class="fa fa-check"></i><b>5.3.1</b> Rounding numbers</a></li>
<li class="chapter" data-level="5.3.2" data-path="messychapter.html"><a href="messychapter.html#sums-and-means-in-data-frames"><i class="fa fa-check"></i><b>5.3.2</b> Sums and means in data frames</a></li>
<li class="chapter" data-level="5.3.3" data-path="messychapter.html"><a href="messychapter.html#rle"><i class="fa fa-check"></i><b>5.3.3</b> Summaries of series of numbers</a></li>
<li class="chapter" data-level="5.3.4" data-path="messychapter.html"><a href="messychapter.html#scientific-notation-1e-03"><i class="fa fa-check"></i><b>5.3.4</b> Scientific notation <code>1e-03</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="messychapter.html"><a href="messychapter.html#floatingpoints"><i class="fa fa-check"></i><b>5.3.5</b> Floating point arithmetics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="messychapter.html"><a href="messychapter.html#factors"><i class="fa fa-check"></i><b>5.4</b> Working with factors</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="messychapter.html"><a href="messychapter.html#creating-factors"><i class="fa fa-check"></i><b>5.4.1</b> Creating factors</a></li>
<li class="chapter" data-level="5.4.2" data-path="messychapter.html"><a href="messychapter.html#factorlevels"><i class="fa fa-check"></i><b>5.4.2</b> Changing factor levels</a></li>
<li class="chapter" data-level="5.4.3" data-path="messychapter.html"><a href="messychapter.html#changing-the-order-of-levels"><i class="fa fa-check"></i><b>5.4.3</b> Changing the order of levels</a></li>
<li class="chapter" data-level="5.4.4" data-path="messychapter.html"><a href="messychapter.html#combining-levels"><i class="fa fa-check"></i><b>5.4.4</b> Combining levels</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="messychapter.html"><a href="messychapter.html#strings"><i class="fa fa-check"></i><b>5.5</b> Working with strings</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="messychapter.html"><a href="messychapter.html#concatenating-strings"><i class="fa fa-check"></i><b>5.5.1</b> Concatenating strings</a></li>
<li class="chapter" data-level="5.5.2" data-path="messychapter.html"><a href="messychapter.html#changing-case"><i class="fa fa-check"></i><b>5.5.2</b> Changing case</a></li>
<li class="chapter" data-level="5.5.3" data-path="messychapter.html"><a href="messychapter.html#regexp"><i class="fa fa-check"></i><b>5.5.3</b> Finding patterns using regular expressions</a></li>
<li class="chapter" data-level="5.5.4" data-path="messychapter.html"><a href="messychapter.html#sub"><i class="fa fa-check"></i><b>5.5.4</b> Substitution</a></li>
<li class="chapter" data-level="5.5.5" data-path="messychapter.html"><a href="messychapter.html#splitting-strings"><i class="fa fa-check"></i><b>5.5.5</b> Splitting strings</a></li>
<li class="chapter" data-level="5.5.6" data-path="messychapter.html"><a href="messychapter.html#variable-names"><i class="fa fa-check"></i><b>5.5.6</b> Variable names</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="messychapter.html"><a href="messychapter.html#datetime"><i class="fa fa-check"></i><b>5.6</b> Working with dates and times</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="messychapter.html"><a href="messychapter.html#date-formats"><i class="fa fa-check"></i><b>5.6.1</b> Date formats</a></li>
<li class="chapter" data-level="5.6.2" data-path="messychapter.html"><a href="messychapter.html#plotting-with-dates"><i class="fa fa-check"></i><b>5.6.2</b> Plotting with dates</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="messychapter.html"><a href="messychapter.html#data-manipulation-with-data.table-dplyr-and-tidyr"><i class="fa fa-check"></i><b>5.7</b> Data manipulation with <code>data.table</code>, <code>dplyr</code>, and <code>tidyr</code></a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="messychapter.html"><a href="messychapter.html#dtbasics"><i class="fa fa-check"></i><b>5.7.1</b> <code>data.table</code> and tidyverse syntax basics</a></li>
<li class="chapter" data-level="5.7.2" data-path="messychapter.html"><a href="messychapter.html#modifyvar"><i class="fa fa-check"></i><b>5.7.2</b> Modifying a variable</a></li>
<li class="chapter" data-level="5.7.3" data-path="messychapter.html"><a href="messychapter.html#computing-a-new-variable-based-on-existing-variables"><i class="fa fa-check"></i><b>5.7.3</b> Computing a new variable based on existing variables</a></li>
<li class="chapter" data-level="5.7.4" data-path="messychapter.html"><a href="messychapter.html#renaming-a-variable"><i class="fa fa-check"></i><b>5.7.4</b> Renaming a variable</a></li>
<li class="chapter" data-level="5.7.5" data-path="messychapter.html"><a href="messychapter.html#removing-a-variable"><i class="fa fa-check"></i><b>5.7.5</b> Removing a variable</a></li>
<li class="chapter" data-level="5.7.6" data-path="messychapter.html"><a href="messychapter.html#recodedplyr"><i class="fa fa-check"></i><b>5.7.6</b> Recoding <code>factor</code> levels</a></li>
<li class="chapter" data-level="5.7.7" data-path="messychapter.html"><a href="messychapter.html#grouped2"><i class="fa fa-check"></i><b>5.7.7</b> Grouped summaries</a></li>
<li class="chapter" data-level="5.7.8" data-path="messychapter.html"><a href="messychapter.html#fillNA"><i class="fa fa-check"></i><b>5.7.8</b> Filling in missing values</a></li>
<li class="chapter" data-level="5.7.9" data-path="messychapter.html"><a href="messychapter.html#chaining-commands-together"><i class="fa fa-check"></i><b>5.7.9</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="messychapter.html"><a href="messychapter.html#filtering"><i class="fa fa-check"></i><b>5.8</b> Filtering: select rows</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="messychapter.html"><a href="messychapter.html#filtering-using-row-numbers"><i class="fa fa-check"></i><b>5.8.1</b> Filtering using row numbers</a></li>
<li class="chapter" data-level="5.8.2" data-path="messychapter.html"><a href="messychapter.html#conditions2"><i class="fa fa-check"></i><b>5.8.2</b> Filtering using conditions</a></li>
<li class="chapter" data-level="5.8.3" data-path="messychapter.html"><a href="messychapter.html#selecting-rows-at-random"><i class="fa fa-check"></i><b>5.8.3</b> Selecting rows at random</a></li>
<li class="chapter" data-level="5.8.4" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-rows"><i class="fa fa-check"></i><b>5.8.4</b> Using regular expressions to select rows</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="messychapter.html"><a href="messychapter.html#subsetting-select-columns"><i class="fa fa-check"></i><b>5.9</b> Subsetting: select columns</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="messychapter.html"><a href="messychapter.html#selecting-a-single-column"><i class="fa fa-check"></i><b>5.9.1</b> Selecting a single column</a></li>
<li class="chapter" data-level="5.9.2" data-path="messychapter.html"><a href="messychapter.html#selecting-multiple-columns"><i class="fa fa-check"></i><b>5.9.2</b> Selecting multiple columns</a></li>
<li class="chapter" data-level="5.9.3" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-columns"><i class="fa fa-check"></i><b>5.9.3</b> Using regular expressions to select columns</a></li>
<li class="chapter" data-level="5.9.4" data-path="messychapter.html"><a href="messychapter.html#subsetusingcn"><i class="fa fa-check"></i><b>5.9.4</b> Subsetting using column numbers</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="messychapter.html"><a href="messychapter.html#sorting"><i class="fa fa-check"></i><b>5.10</b> Sorting</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="messychapter.html"><a href="messychapter.html#changing-the-column-order"><i class="fa fa-check"></i><b>5.10.1</b> Changing the column order</a></li>
<li class="chapter" data-level="5.10.2" data-path="messychapter.html"><a href="messychapter.html#changing-the-row-order"><i class="fa fa-check"></i><b>5.10.2</b> Changing the row order</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="messychapter.html"><a href="messychapter.html#reshaping"><i class="fa fa-check"></i><b>5.11</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="messychapter.html"><a href="messychapter.html#from-long-to-wide"><i class="fa fa-check"></i><b>5.11.1</b> From long to wide</a></li>
<li class="chapter" data-level="5.11.2" data-path="messychapter.html"><a href="messychapter.html#from-wide-to-long"><i class="fa fa-check"></i><b>5.11.2</b> From wide to long</a></li>
<li class="chapter" data-level="5.11.3" data-path="messychapter.html"><a href="messychapter.html#splittingcolumns"><i class="fa fa-check"></i><b>5.11.3</b> Splitting columns</a></li>
<li class="chapter" data-level="5.11.4" data-path="messychapter.html"><a href="messychapter.html#merging-columns"><i class="fa fa-check"></i><b>5.11.4</b> Merging columns</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="messychapter.html"><a href="messychapter.html#mergedata"><i class="fa fa-check"></i><b>5.12</b> Merging data from multiple tables</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="messychapter.html"><a href="messychapter.html#binds"><i class="fa fa-check"></i><b>5.12.1</b> Binds</a></li>
<li class="chapter" data-level="5.12.2" data-path="messychapter.html"><a href="messychapter.html#merging-tables-using-keys"><i class="fa fa-check"></i><b>5.12.2</b> Merging tables using keys</a></li>
<li class="chapter" data-level="5.12.3" data-path="messychapter.html"><a href="messychapter.html#inner-and-outer-joins"><i class="fa fa-check"></i><b>5.12.3</b> Inner and outer joins</a></li>
<li class="chapter" data-level="5.12.4" data-path="messychapter.html"><a href="messychapter.html#semijoins"><i class="fa fa-check"></i><b>5.12.4</b> Semijoins and antijoins</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="messychapter.html"><a href="messychapter.html#scraping-data-from-websites"><i class="fa fa-check"></i><b>5.13</b> Scraping data from websites</a></li>
<li class="chapter" data-level="5.14" data-path="messychapter.html"><a href="messychapter.html#commontasks"><i class="fa fa-check"></i><b>5.14</b> Other commons tasks</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="messychapter.html"><a href="messychapter.html#deleting-variables"><i class="fa fa-check"></i><b>5.14.1</b> Deleting variables</a></li>
<li class="chapter" data-level="5.14.2" data-path="messychapter.html"><a href="messychapter.html#foreign"><i class="fa fa-check"></i><b>5.14.2</b> Importing data from other statistical packages</a></li>
<li class="chapter" data-level="5.14.3" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-databases"><i class="fa fa-check"></i><b>5.14.3</b> Importing data from databases</a></li>
<li class="chapter" data-level="5.14.4" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-json-files"><i class="fa fa-check"></i><b>5.14.4</b> Importing data from JSON files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="progchapter.html"><a href="progchapter.html"><i class="fa fa-check"></i><b>6</b> R programming</a>
<ul>
<li class="chapter" data-level="6.1" data-path="progchapter.html"><a href="progchapter.html#functions-1"><i class="fa fa-check"></i><b>6.1</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="progchapter.html"><a href="progchapter.html#createfunctions"><i class="fa fa-check"></i><b>6.1.1</b> Creating functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="progchapter.html"><a href="progchapter.html#local-and-global-variables"><i class="fa fa-check"></i><b>6.1.2</b> Local and global variables</a></li>
<li class="chapter" data-level="6.1.3" data-path="progchapter.html"><a href="progchapter.html#willfunctionwork"><i class="fa fa-check"></i><b>6.1.3</b> Will your function work?</a></li>
<li class="chapter" data-level="6.1.4" data-path="progchapter.html"><a href="progchapter.html#more-on-arguments"><i class="fa fa-check"></i><b>6.1.4</b> More on arguments</a></li>
<li class="chapter" data-level="6.1.5" data-path="progchapter.html"><a href="progchapter.html#namespaces"><i class="fa fa-check"></i><b>6.1.5</b> Namespaces</a></li>
<li class="chapter" data-level="6.1.6" data-path="progchapter.html"><a href="progchapter.html#sourcing-other-scripts"><i class="fa fa-check"></i><b>6.1.6</b> Sourcing other scripts</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="progchapter.html"><a href="progchapter.html#morepipes"><i class="fa fa-check"></i><b>6.2</b> More on pipes</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="progchapter.html"><a href="progchapter.html#ce-ne-sont-pas-non-plus-des-pipes"><i class="fa fa-check"></i><b>6.2.1</b> <em>Ce ne sont pas non plus des pipes</em></a></li>
<li class="chapter" data-level="6.2.2" data-path="progchapter.html"><a href="progchapter.html#writing-functions-with-pipes"><i class="fa fa-check"></i><b>6.2.2</b> Writing functions with pipes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="progchapter.html"><a href="progchapter.html#conditions"><i class="fa fa-check"></i><b>6.3</b> Checking conditions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="progchapter.html"><a href="progchapter.html#if-and-else"><i class="fa fa-check"></i><b>6.3.1</b> <code>if</code> and <code>else</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="progchapter.html"><a href="progchapter.html#section"><i class="fa fa-check"></i><b>6.3.2</b> <code>&amp;</code> &amp; <code>&amp;&amp;</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="progchapter.html"><a href="progchapter.html#ifelse"><i class="fa fa-check"></i><b>6.3.3</b> <code>ifelse</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="progchapter.html"><a href="progchapter.html#switch"><i class="fa fa-check"></i><b>6.3.4</b> <code>switch</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="progchapter.html"><a href="progchapter.html#failing-gracefully"><i class="fa fa-check"></i><b>6.3.5</b> Failing gracefully</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="progchapter.html"><a href="progchapter.html#loopsection"><i class="fa fa-check"></i><b>6.4</b> Iteration using loops</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="progchapter.html"><a href="progchapter.html#forloops"><i class="fa fa-check"></i><b>6.4.1</b> <code>for</code> loops</a></li>
<li class="chapter" data-level="6.4.2" data-path="progchapter.html"><a href="progchapter.html#nestedloops"><i class="fa fa-check"></i><b>6.4.2</b> Loops within loops</a></li>
<li class="chapter" data-level="6.4.3" data-path="progchapter.html"><a href="progchapter.html#beepr"><i class="fa fa-check"></i><b>6.4.3</b> Keeping track of what’s happening</a></li>
<li class="chapter" data-level="6.4.4" data-path="progchapter.html"><a href="progchapter.html#lists"><i class="fa fa-check"></i><b>6.4.4</b> Loops and lists</a></li>
<li class="chapter" data-level="6.4.5" data-path="progchapter.html"><a href="progchapter.html#whileloop"><i class="fa fa-check"></i><b>6.4.5</b> <code>while</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="progchapter.html"><a href="progchapter.html#vectorloops"><i class="fa fa-check"></i><b>6.5</b> Iteration using vectorisation and functionals</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="progchapter.html"><a href="progchapter.html#a-first-example-with-apply"><i class="fa fa-check"></i><b>6.5.1</b> A first example with <code>apply</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="progchapter.html"><a href="progchapter.html#variations-on-a-theme"><i class="fa fa-check"></i><b>6.5.2</b> Variations on a theme</a></li>
<li class="chapter" data-level="6.5.3" data-path="progchapter.html"><a href="progchapter.html#purrr"><i class="fa fa-check"></i><b>6.5.3</b> <code>purrr</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="progchapter.html"><a href="progchapter.html#specialised-functions"><i class="fa fa-check"></i><b>6.5.4</b> Specialised functions</a></li>
<li class="chapter" data-level="6.5.5" data-path="progchapter.html"><a href="progchapter.html#exploring-data-with-functionals"><i class="fa fa-check"></i><b>6.5.5</b> Exploring data with functionals</a></li>
<li class="chapter" data-level="6.5.6" data-path="progchapter.html"><a href="progchapter.html#keep-calm-and-carry-on"><i class="fa fa-check"></i><b>6.5.6</b> Keep calm and carry on</a></li>
<li class="chapter" data-level="6.5.7" data-path="progchapter.html"><a href="progchapter.html#multiiter"><i class="fa fa-check"></i><b>6.5.7</b> Iterating over multiple variables</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="progchapter.html"><a href="progchapter.html#measureperformance"><i class="fa fa-check"></i><b>6.6</b> Measuring code performance</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="progchapter.html"><a href="progchapter.html#timing-functions"><i class="fa fa-check"></i><b>6.6.1</b> Timing functions</a></li>
<li class="chapter" data-level="6.6.2" data-path="progchapter.html"><a href="progchapter.html#measuring-memory-usage---and-a-note-on-compilation"><i class="fa fa-check"></i><b>6.6.2</b> Measuring memory usage - and a note on compilation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modchapter.html"><a href="modchapter.html"><i class="fa fa-check"></i><b>7</b> Modern classical statistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="modchapter.html"><a href="modchapter.html#simulation"><i class="fa fa-check"></i><b>7.1</b> Simulation and distributions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="modchapter.html"><a href="modchapter.html#generating-random-numbers"><i class="fa fa-check"></i><b>7.1.1</b> Generating random numbers</a></li>
<li class="chapter" data-level="7.1.2" data-path="modchapter.html"><a href="modchapter.html#distfunctions"><i class="fa fa-check"></i><b>7.1.2</b> Some common distributions</a></li>
<li class="chapter" data-level="7.1.3" data-path="modchapter.html"><a href="modchapter.html#assessing-distributional-assumptions"><i class="fa fa-check"></i><b>7.1.3</b> Assessing distributional assumptions</a></li>
<li class="chapter" data-level="7.1.4" data-path="modchapter.html"><a href="modchapter.html#monte-carlo-integration"><i class="fa fa-check"></i><b>7.1.4</b> Monte Carlo integration</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="modchapter.html"><a href="modchapter.html#ttest"><i class="fa fa-check"></i><b>7.2</b> Student’s t-test revisited</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="modchapter.html"><a href="modchapter.html#oldschoolt"><i class="fa fa-check"></i><b>7.2.1</b> The old-school t-test</a></li>
<li class="chapter" data-level="7.2.2" data-path="modchapter.html"><a href="modchapter.html#permutation-tests"><i class="fa fa-check"></i><b>7.2.2</b> Permutation tests</a></li>
<li class="chapter" data-level="7.2.3" data-path="modchapter.html"><a href="modchapter.html#the-bootstrap"><i class="fa fa-check"></i><b>7.2.3</b> The bootstrap</a></li>
<li class="chapter" data-level="7.2.4" data-path="modchapter.html"><a href="modchapter.html#saving-the-output"><i class="fa fa-check"></i><b>7.2.4</b> Saving the output</a></li>
<li class="chapter" data-level="7.2.5" data-path="modchapter.html"><a href="modchapter.html#multipletesting"><i class="fa fa-check"></i><b>7.2.5</b> Multiple testing</a></li>
<li class="chapter" data-level="7.2.6" data-path="modchapter.html"><a href="modchapter.html#hotellingst2"><i class="fa fa-check"></i><b>7.2.6</b> Multivariate testing with Hotelling’s <span class="math inline">\(T^2\)</span></a></li>
<li class="chapter" data-level="7.2.7" data-path="modchapter.html"><a href="modchapter.html#sample-size-computations-for-the-t-test"><i class="fa fa-check"></i><b>7.2.7</b> Sample size computations for the t-test</a></li>
<li class="chapter" data-level="7.2.8" data-path="modchapter.html"><a href="modchapter.html#a-bayesian-approach"><i class="fa fa-check"></i><b>7.2.8</b> A Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="modchapter.html"><a href="modchapter.html#other-common-hypothesis-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>7.3</b> Other common hypothesis tests and confidence intervals</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="modchapter.html"><a href="modchapter.html#nonparametric-tests-of-location"><i class="fa fa-check"></i><b>7.3.1</b> Nonparametric tests of location</a></li>
<li class="chapter" data-level="7.3.2" data-path="modchapter.html"><a href="modchapter.html#tests-for-correlation"><i class="fa fa-check"></i><b>7.3.2</b> Tests for correlation</a></li>
<li class="chapter" data-level="7.3.3" data-path="modchapter.html"><a href="modchapter.html#chi2-tests"><i class="fa fa-check"></i><b>7.3.3</b> <span class="math inline">\(\chi^2\)</span>-tests</a></li>
<li class="chapter" data-level="7.3.4" data-path="modchapter.html"><a href="modchapter.html#confprop"><i class="fa fa-check"></i><b>7.3.4</b> Confidence intervals for proportions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="modchapter.html"><a href="modchapter.html#ethicsinference"><i class="fa fa-check"></i><b>7.4</b> Ethical issues in statistical inference</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="modchapter.html"><a href="modchapter.html#p-hacking-and-the-file-drawer-problem"><i class="fa fa-check"></i><b>7.4.1</b> p-hacking and the file-drawer problem</a></li>
<li class="chapter" data-level="7.4.2" data-path="modchapter.html"><a href="modchapter.html#reproducibility"><i class="fa fa-check"></i><b>7.4.2</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="modchapter.html"><a href="modchapter.html#simeval"><i class="fa fa-check"></i><b>7.5</b> Evaluating statistical methods using simulation</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="modchapter.html"><a href="modchapter.html#comparing-estimators"><i class="fa fa-check"></i><b>7.5.1</b> Comparing estimators</a></li>
<li class="chapter" data-level="7.5.2" data-path="modchapter.html"><a href="modchapter.html#simtypeI"><i class="fa fa-check"></i><b>7.5.2</b> Type I error rate of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.3" data-path="modchapter.html"><a href="modchapter.html#simpower"><i class="fa fa-check"></i><b>7.5.3</b> Power of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.4" data-path="modchapter.html"><a href="modchapter.html#powerlocation"><i class="fa fa-check"></i><b>7.5.4</b> Power of some tests of location</a></li>
<li class="chapter" data-level="7.5.5" data-path="modchapter.html"><a href="modchapter.html#simadvice"><i class="fa fa-check"></i><b>7.5.5</b> Some advice on simulation studies</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="modchapter.html"><a href="modchapter.html#sscus"><i class="fa fa-check"></i><b>7.6</b> Sample size computations using simulation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="modchapter.html"><a href="modchapter.html#simcorpower"><i class="fa fa-check"></i><b>7.6.1</b> Writing your own simulation</a></li>
<li class="chapter" data-level="7.6.2" data-path="modchapter.html"><a href="modchapter.html#the-wilcoxon-mann-whitney-test"><i class="fa fa-check"></i><b>7.6.2</b> The Wilcoxon-Mann-Whitney test</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="modchapter.html"><a href="modchapter.html#bootstrap"><i class="fa fa-check"></i><b>7.7</b> Bootstrapping</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="modchapter.html"><a href="modchapter.html#a-general-approach"><i class="fa fa-check"></i><b>7.7.1</b> A general approach</a></li>
<li class="chapter" data-level="7.7.2" data-path="modchapter.html"><a href="modchapter.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>7.7.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="7.7.3" data-path="modchapter.html"><a href="modchapter.html#intervalinversion"><i class="fa fa-check"></i><b>7.7.3</b> Bootstrap hypothesis tests</a></li>
<li class="chapter" data-level="7.7.4" data-path="modchapter.html"><a href="modchapter.html#parametricbootstrap"><i class="fa fa-check"></i><b>7.7.4</b> The parametric bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="modchapter.html"><a href="modchapter.html#reporting-statistical-results"><i class="fa fa-check"></i><b>7.8</b> Reporting statistical results</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="modchapter.html"><a href="modchapter.html#what-should-you-include"><i class="fa fa-check"></i><b>7.8.1</b> What should you include?</a></li>
<li class="chapter" data-level="7.8.2" data-path="modchapter.html"><a href="modchapter.html#citing-r-packages"><i class="fa fa-check"></i><b>7.8.2</b> Citing R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>8</b> Regression models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression.html"><a href="regression.html#linearmodels"><i class="fa fa-check"></i><b>8.1</b> Linear models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression.html"><a href="regression.html#fitting-linear-models"><i class="fa fa-check"></i><b>8.1.1</b> Fitting linear models</a></li>
<li class="chapter" data-level="8.1.2" data-path="regression.html"><a href="regression.html#interactions-and-polynomial-terms"><i class="fa fa-check"></i><b>8.1.2</b> Interactions and polynomial terms</a></li>
<li class="chapter" data-level="8.1.3" data-path="regression.html"><a href="regression.html#dummy-variables"><i class="fa fa-check"></i><b>8.1.3</b> Dummy variables</a></li>
<li class="chapter" data-level="8.1.4" data-path="regression.html"><a href="regression.html#model-diagnostics"><i class="fa fa-check"></i><b>8.1.4</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.1.5" data-path="regression.html"><a href="regression.html#transformations"><i class="fa fa-check"></i><b>8.1.5</b> Transformations</a></li>
<li class="chapter" data-level="8.1.6" data-path="regression.html"><a href="regression.html#alternatives-to-lm"><i class="fa fa-check"></i><b>8.1.6</b> Alternatives to <code>lm</code></a></li>
<li class="chapter" data-level="8.1.7" data-path="regression.html"><a href="regression.html#regbootstrap"><i class="fa fa-check"></i><b>8.1.7</b> Bootstrap confidence intervals for regression coefficients</a></li>
<li class="chapter" data-level="8.1.8" data-path="regression.html"><a href="regression.html#broom"><i class="fa fa-check"></i><b>8.1.8</b> Alternative summaries with <code>broom</code></a></li>
<li class="chapter" data-level="8.1.9" data-path="regression.html"><a href="regression.html#stepwise"><i class="fa fa-check"></i><b>8.1.9</b> Variable selection</a></li>
<li class="chapter" data-level="8.1.10" data-path="regression.html"><a href="regression.html#prediction"><i class="fa fa-check"></i><b>8.1.10</b> Prediction</a></li>
<li class="chapter" data-level="8.1.11" data-path="regression.html"><a href="regression.html#multipredict"><i class="fa fa-check"></i><b>8.1.11</b> Prediction for multiple datasets</a></li>
<li class="chapter" data-level="8.1.12" data-path="regression.html"><a href="regression.html#ANOVA"><i class="fa fa-check"></i><b>8.1.12</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.13" data-path="regression.html"><a href="regression.html#bayeslm"><i class="fa fa-check"></i><b>8.1.13</b> Bayesian estimation of linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression.html"><a href="regression.html#ethical-issues-in-regression-modelling"><i class="fa fa-check"></i><b>8.2</b> Ethical issues in regression modelling</a></li>
<li class="chapter" data-level="8.3" data-path="regression.html"><a href="regression.html#generalised-linear-models"><i class="fa fa-check"></i><b>8.3</b> Generalised linear models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression.html"><a href="regression.html#logreg"><i class="fa fa-check"></i><b>8.3.1</b> Modelling proportions: Logistic regression</a></li>
<li class="chapter" data-level="8.3.2" data-path="regression.html"><a href="regression.html#bootstrap-confidence-intervals-1"><i class="fa fa-check"></i><b>8.3.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="8.3.3" data-path="regression.html"><a href="regression.html#model-diagnostics-1"><i class="fa fa-check"></i><b>8.3.3</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.3.4" data-path="regression.html"><a href="regression.html#prediction-1"><i class="fa fa-check"></i><b>8.3.4</b> Prediction</a></li>
<li class="chapter" data-level="8.3.5" data-path="regression.html"><a href="regression.html#modelling-count-data"><i class="fa fa-check"></i><b>8.3.5</b> Modelling count data</a></li>
<li class="chapter" data-level="8.3.6" data-path="regression.html"><a href="regression.html#modelling-rates"><i class="fa fa-check"></i><b>8.3.6</b> Modelling rates</a></li>
<li class="chapter" data-level="8.3.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-generalised-linear-models"><i class="fa fa-check"></i><b>8.3.7</b> Bayesian estimation of generalised linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression.html"><a href="regression.html#mixedmodels"><i class="fa fa-check"></i><b>8.4</b> Mixed models</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="regression.html"><a href="regression.html#fitting-a-linear-mixed-model"><i class="fa fa-check"></i><b>8.4.1</b> Fitting a linear mixed model</a></li>
<li class="chapter" data-level="8.4.2" data-path="regression.html"><a href="regression.html#model-diagnostics-2"><i class="fa fa-check"></i><b>8.4.2</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.4.3" data-path="regression.html"><a href="regression.html#lmmbootstrap"><i class="fa fa-check"></i><b>8.4.3</b> Bootstrapping</a></li>
<li class="chapter" data-level="8.4.4" data-path="regression.html"><a href="regression.html#nested-random-effects-and-multilevelhierarchical-models"><i class="fa fa-check"></i><b>8.4.4</b> Nested random effects and multilevel/hierarchical models</a></li>
<li class="chapter" data-level="8.4.5" data-path="regression.html"><a href="regression.html#anova-with-random-effects"><i class="fa fa-check"></i><b>8.4.5</b> ANOVA with random effects</a></li>
<li class="chapter" data-level="8.4.6" data-path="regression.html"><a href="regression.html#generalised-linear-mixed-models"><i class="fa fa-check"></i><b>8.4.6</b> Generalised linear mixed models</a></li>
<li class="chapter" data-level="8.4.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-mixed-models"><i class="fa fa-check"></i><b>8.4.7</b> Bayesian estimation of mixed models</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regression.html"><a href="regression.html#survival"><i class="fa fa-check"></i><b>8.5</b> Survival analysis</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="regression.html"><a href="regression.html#comparing-groups"><i class="fa fa-check"></i><b>8.5.1</b> Comparing groups</a></li>
<li class="chapter" data-level="8.5.2" data-path="regression.html"><a href="regression.html#the-cox-proportional-hazards-model"><i class="fa fa-check"></i><b>8.5.2</b> The Cox proportional hazards model</a></li>
<li class="chapter" data-level="8.5.3" data-path="regression.html"><a href="regression.html#accelerated-failure-time-models"><i class="fa fa-check"></i><b>8.5.3</b> Accelerated failure time models</a></li>
<li class="chapter" data-level="8.5.4" data-path="regression.html"><a href="regression.html#bayesian-survival-analysis"><i class="fa fa-check"></i><b>8.5.4</b> Bayesian survival analysis</a></li>
<li class="chapter" data-level="8.5.5" data-path="regression.html"><a href="regression.html#multivariate-survival-analysis"><i class="fa fa-check"></i><b>8.5.5</b> Multivariate survival analysis</a></li>
<li class="chapter" data-level="8.5.6" data-path="regression.html"><a href="regression.html#power-estimates-for-the-logrank-test"><i class="fa fa-check"></i><b>8.5.6</b> Power estimates for the logrank test</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="regression.html"><a href="regression.html#left-censored-data-and-nondetects"><i class="fa fa-check"></i><b>8.6</b> Left-censored data and nondetects</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="regression.html"><a href="regression.html#estimation"><i class="fa fa-check"></i><b>8.6.1</b> Estimation</a></li>
<li class="chapter" data-level="8.6.2" data-path="regression.html"><a href="regression.html#tests-of-means"><i class="fa fa-check"></i><b>8.6.2</b> Tests of means</a></li>
<li class="chapter" data-level="8.6.3" data-path="regression.html"><a href="regression.html#censored-regression"><i class="fa fa-check"></i><b>8.6.3</b> Censored regression</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="regression.html"><a href="regression.html#creating-matched-samples"><i class="fa fa-check"></i><b>8.7</b> Creating matched samples</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="regression.html"><a href="regression.html#propensity-score-matching"><i class="fa fa-check"></i><b>8.7.1</b> Propensity score matching</a></li>
<li class="chapter" data-level="8.7.2" data-path="regression.html"><a href="regression.html#stepwise-matching"><i class="fa fa-check"></i><b>8.7.2</b> Stepwise matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mlchapter.html"><a href="mlchapter.html"><i class="fa fa-check"></i><b>9</b> Predictive modelling and machine learning</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-predictive-models"><i class="fa fa-check"></i><b>9.1</b> Evaluating predictive models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-regression-models"><i class="fa fa-check"></i><b>9.1.1</b> Evaluating regression models</a></li>
<li class="chapter" data-level="9.1.2" data-path="mlchapter.html"><a href="mlchapter.html#test-training-splits"><i class="fa fa-check"></i><b>9.1.2</b> Test-training splits</a></li>
<li class="chapter" data-level="9.1.3" data-path="mlchapter.html"><a href="mlchapter.html#loocv"><i class="fa fa-check"></i><b>9.1.3</b> Leave-one-out cross-validation and <code>caret</code></a></li>
<li class="chapter" data-level="9.1.4" data-path="mlchapter.html"><a href="mlchapter.html#kfoldcv"><i class="fa fa-check"></i><b>9.1.4</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="9.1.5" data-path="mlchapter.html"><a href="mlchapter.html#twinned-observations"><i class="fa fa-check"></i><b>9.1.5</b> Twinned observations</a></li>
<li class="chapter" data-level="9.1.6" data-path="mlchapter.html"><a href="mlchapter.html#bootstrapping"><i class="fa fa-check"></i><b>9.1.6</b> Bootstrapping</a></li>
<li class="chapter" data-level="9.1.7" data-path="mlchapter.html"><a href="mlchapter.html#classifieraccuracy"><i class="fa fa-check"></i><b>9.1.7</b> Evaluating classification models</a></li>
<li class="chapter" data-level="9.1.8" data-path="mlchapter.html"><a href="mlchapter.html#decisionboundaries"><i class="fa fa-check"></i><b>9.1.8</b> Visualising decision boundaries</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="mlchapter.html"><a href="mlchapter.html#ethical-issues-in-predictive-modelling"><i class="fa fa-check"></i><b>9.2</b> Ethical issues in predictive modelling</a></li>
<li class="chapter" data-level="9.3" data-path="mlchapter.html"><a href="mlchapter.html#modellingchallenges"><i class="fa fa-check"></i><b>9.3</b> Challenges in predictive modelling</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mlchapter.html"><a href="mlchapter.html#imbalanced"><i class="fa fa-check"></i><b>9.3.1</b> Handling class imbalance</a></li>
<li class="chapter" data-level="9.3.2" data-path="mlchapter.html"><a href="mlchapter.html#varimportance"><i class="fa fa-check"></i><b>9.3.2</b> Assessing variable importance</a></li>
<li class="chapter" data-level="9.3.3" data-path="mlchapter.html"><a href="mlchapter.html#extrapolation"><i class="fa fa-check"></i><b>9.3.3</b> Extrapolation</a></li>
<li class="chapter" data-level="9.3.4" data-path="mlchapter.html"><a href="mlchapter.html#missing-data-and-imputation"><i class="fa fa-check"></i><b>9.3.4</b> Missing data and imputation</a></li>
<li class="chapter" data-level="9.3.5" data-path="mlchapter.html"><a href="mlchapter.html#endless-waiting"><i class="fa fa-check"></i><b>9.3.5</b> Endless waiting</a></li>
<li class="chapter" data-level="9.3.6" data-path="mlchapter.html"><a href="mlchapter.html#overfittingtestset"><i class="fa fa-check"></i><b>9.3.6</b> Overfitting to the test set</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mlchapter.html"><a href="mlchapter.html#regularised"><i class="fa fa-check"></i><b>9.4</b> Regularised regression models</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="mlchapter.html"><a href="mlchapter.html#ridge-regression"><i class="fa fa-check"></i><b>9.4.1</b> Ridge regression</a></li>
<li class="chapter" data-level="9.4.2" data-path="mlchapter.html"><a href="mlchapter.html#lasso"><i class="fa fa-check"></i><b>9.4.2</b> The lasso</a></li>
<li class="chapter" data-level="9.4.3" data-path="mlchapter.html"><a href="mlchapter.html#elastic-net"><i class="fa fa-check"></i><b>9.4.3</b> Elastic net</a></li>
<li class="chapter" data-level="9.4.4" data-path="mlchapter.html"><a href="mlchapter.html#choosing-the-best-model"><i class="fa fa-check"></i><b>9.4.4</b> Choosing the best model</a></li>
<li class="chapter" data-level="9.4.5" data-path="mlchapter.html"><a href="mlchapter.html#regularised-mixed-models"><i class="fa fa-check"></i><b>9.4.5</b> Regularised mixed models</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="mlchapter.html"><a href="mlchapter.html#mlmethods"><i class="fa fa-check"></i><b>9.5</b> Machine learning models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mlchapter.html"><a href="mlchapter.html#decisiontrees"><i class="fa fa-check"></i><b>9.5.1</b> Decision trees</a></li>
<li class="chapter" data-level="9.5.2" data-path="mlchapter.html"><a href="mlchapter.html#randomforests"><i class="fa fa-check"></i><b>9.5.2</b> Random forests</a></li>
<li class="chapter" data-level="9.5.3" data-path="mlchapter.html"><a href="mlchapter.html#boosted-trees"><i class="fa fa-check"></i><b>9.5.3</b> Boosted trees</a></li>
<li class="chapter" data-level="9.5.4" data-path="mlchapter.html"><a href="mlchapter.html#model-trees"><i class="fa fa-check"></i><b>9.5.4</b> Model trees</a></li>
<li class="chapter" data-level="9.5.5" data-path="mlchapter.html"><a href="mlchapter.html#discriminant-analysis"><i class="fa fa-check"></i><b>9.5.5</b> Discriminant analysis</a></li>
<li class="chapter" data-level="9.5.6" data-path="mlchapter.html"><a href="mlchapter.html#support-vector-machines"><i class="fa fa-check"></i><b>9.5.6</b> Support vector machines</a></li>
<li class="chapter" data-level="9.5.7" data-path="mlchapter.html"><a href="mlchapter.html#nearest-neighbours-classifiers"><i class="fa fa-check"></i><b>9.5.7</b> Nearest neighbours classifiers</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="mlchapter.html"><a href="mlchapter.html#tsforecast"><i class="fa fa-check"></i><b>9.6</b> Forecasting time series</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="mlchapter.html"><a href="mlchapter.html#decomposition"><i class="fa fa-check"></i><b>9.6.1</b> Decomposition</a></li>
<li class="chapter" data-level="9.6.2" data-path="mlchapter.html"><a href="mlchapter.html#forecasting-using-arima-models"><i class="fa fa-check"></i><b>9.6.2</b> Forecasting using ARIMA models</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="mlchapter.html"><a href="mlchapter.html#deploying-models"><i class="fa fa-check"></i><b>9.7</b> Deploying models</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="mlchapter.html"><a href="mlchapter.html#creating-apis-with-plumber"><i class="fa fa-check"></i><b>9.7.1</b> Creating APIs with <code>plumber</code></a></li>
<li class="chapter" data-level="9.7.2" data-path="mlchapter.html"><a href="mlchapter.html#different-types-of-output"><i class="fa fa-check"></i><b>9.7.2</b> Different types of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="advancedchapter.html"><a href="advancedchapter.html"><i class="fa fa-check"></i><b>10</b> Advanced topics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="advancedchapter.html"><a href="advancedchapter.html#moreonpackages"><i class="fa fa-check"></i><b>10.1</b> More on packages</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="advancedchapter.html"><a href="advancedchapter.html#loading-and-auto-installing-packages"><i class="fa fa-check"></i><b>10.1.1</b> Loading and auto-installing packages</a></li>
<li class="chapter" data-level="10.1.2" data-path="advancedchapter.html"><a href="advancedchapter.html#updating-r-and-your-packages"><i class="fa fa-check"></i><b>10.1.2</b> Updating R and your packages</a></li>
<li class="chapter" data-level="10.1.3" data-path="advancedchapter.html"><a href="advancedchapter.html#alternative-repositories"><i class="fa fa-check"></i><b>10.1.3</b> Alternative repositories</a></li>
<li class="chapter" data-level="10.1.4" data-path="advancedchapter.html"><a href="advancedchapter.html#removing-packages"><i class="fa fa-check"></i><b>10.1.4</b> Removing packages</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallel"><i class="fa fa-check"></i><b>10.2</b> Speeding up computations with parallelisation</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-for-loops"><i class="fa fa-check"></i><b>10.2.1</b> Parallelising <code>for</code> loops</a></li>
<li class="chapter" data-level="10.2.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-functionals"><i class="fa fa-check"></i><b>10.2.2</b> Parallelising functionals</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="advancedchapter.html"><a href="advancedchapter.html#linearalgebra"><i class="fa fa-check"></i><b>10.3</b> Linear algebra and matrices</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="advancedchapter.html"><a href="advancedchapter.html#creating-matrices"><i class="fa fa-check"></i><b>10.3.1</b> Creating matrices</a></li>
<li class="chapter" data-level="10.3.2" data-path="advancedchapter.html"><a href="advancedchapter.html#sparse-matrices"><i class="fa fa-check"></i><b>10.3.2</b> Sparse matrices</a></li>
<li class="chapter" data-level="10.3.3" data-path="advancedchapter.html"><a href="advancedchapter.html#matrix-operations"><i class="fa fa-check"></i><b>10.3.3</b> Matrix operations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration"><i class="fa fa-check"></i><b>10.4</b> Integration with other programming languages</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-c"><i class="fa fa-check"></i><b>10.4.1</b> Integration with C++</a></li>
<li class="chapter" data-level="10.4.2" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-python"><i class="fa fa-check"></i><b>10.4.2</b> Integration with Python</a></li>
<li class="chapter" data-level="10.4.3" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-tensorflow-and-pytorch"><i class="fa fa-check"></i><b>10.4.3</b> Integration with Tensorflow and PyTorch</a></li>
<li class="chapter" data-level="10.4.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-spark"><i class="fa fa-check"></i><b>10.4.4</b> Integration with Spark</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="errorchapter.html"><a href="errorchapter.html"><i class="fa fa-check"></i><b>11</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1" data-path="errorchapter.html"><a href="errorchapter.html#debugging"><i class="fa fa-check"></i><b>11.1</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="errorchapter.html"><a href="errorchapter.html#find-out-where-the-error-occured-with-traceback"><i class="fa fa-check"></i><b>11.1.1</b> Find out where the error occured with <code>traceback</code></a></li>
<li class="chapter" data-level="11.1.2" data-path="errorchapter.html"><a href="errorchapter.html#interactive-debugging-of-functions-with-debug"><i class="fa fa-check"></i><b>11.1.2</b> Interactive debugging of functions with <code>debug</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="errorchapter.html"><a href="errorchapter.html#investigate-the-environment-with-recover"><i class="fa fa-check"></i><b>11.1.3</b> Investigate the environment with <code>recover</code></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="errorchapter.html"><a href="errorchapter.html#commonerrors"><i class="fa fa-check"></i><b>11.2</b> Common error messages</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="errorchapter.html"><a href="errorchapter.html#section-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>+</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="errorchapter.html"><a href="errorchapter.html#could-not-find-function"><i class="fa fa-check"></i><b>11.2.2</b> <code>could not find function</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="errorchapter.html"><a href="errorchapter.html#object-not-found"><i class="fa fa-check"></i><b>11.2.3</b> <code>object not found</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="errorchapter.html"><a href="errorchapter.html#cannot-open-the-connection-and-no-such-file-or-directory"><i class="fa fa-check"></i><b>11.2.4</b> <code>cannot open the connection</code> and <code>No such file or directory</code></a></li>
<li class="chapter" data-level="11.2.5" data-path="errorchapter.html"><a href="errorchapter.html#invalid-description-argument"><i class="fa fa-check"></i><b>11.2.5</b> <code>invalid 'description' argument</code></a></li>
<li class="chapter" data-level="11.2.6" data-path="errorchapter.html"><a href="errorchapter.html#missing-value-where-truefalse-needed"><i class="fa fa-check"></i><b>11.2.6</b> <code>missing value where TRUE/FALSE needed</code></a></li>
<li class="chapter" data-level="11.2.7" data-path="errorchapter.html"><a href="errorchapter.html#unexpected-in-..."><i class="fa fa-check"></i><b>11.2.7</b> <code>unexpected '=' in ...</code></a></li>
<li class="chapter" data-level="11.2.8" data-path="errorchapter.html"><a href="errorchapter.html#attempt-to-apply-non-function"><i class="fa fa-check"></i><b>11.2.8</b> <code>attempt to apply non-function</code></a></li>
<li class="chapter" data-level="11.2.9" data-path="errorchapter.html"><a href="errorchapter.html#undefined-columns-selected"><i class="fa fa-check"></i><b>11.2.9</b> <code>undefined columns selected</code></a></li>
<li class="chapter" data-level="11.2.10" data-path="errorchapter.html"><a href="errorchapter.html#subscript-out-of-bounds"><i class="fa fa-check"></i><b>11.2.10</b> <code>subscript out of bounds</code></a></li>
<li class="chapter" data-level="11.2.11" data-path="errorchapter.html"><a href="errorchapter.html#object-of-type-closure-is-not-subsettable"><i class="fa fa-check"></i><b>11.2.11</b> <code>Object of type ‘closure’ is not subsettable</code></a></li>
<li class="chapter" data-level="11.2.12" data-path="errorchapter.html"><a href="errorchapter.html#operator-is-invalid-for-atomic-vectors"><i class="fa fa-check"></i><b>11.2.12</b> <code>$ operator is invalid for atomic vectors</code></a></li>
<li class="chapter" data-level="11.2.13" data-path="errorchapter.html"><a href="errorchapter.html#list-object-cannot-be-coerced-to-type-double"><i class="fa fa-check"></i><b>11.2.13</b> <code>(list) object cannot be coerced to type ‘double’</code></a></li>
<li class="chapter" data-level="11.2.14" data-path="errorchapter.html"><a href="errorchapter.html#arguments-imply-differing-number-of-rows"><i class="fa fa-check"></i><b>11.2.14</b> <code>arguments imply differing number of rows</code></a></li>
<li class="chapter" data-level="11.2.15" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-a-binary-operator"><i class="fa fa-check"></i><b>11.2.15</b> <code>non-numeric argument to a binary operator</code></a></li>
<li class="chapter" data-level="11.2.16" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-mathematical-function"><i class="fa fa-check"></i><b>11.2.16</b> <code>non-numeric argument to mathematical function</code></a></li>
<li class="chapter" data-level="11.2.17" data-path="errorchapter.html"><a href="errorchapter.html#cannot-allocate-vector-of-size-..."><i class="fa fa-check"></i><b>11.2.17</b> <code>cannot allocate vector of size ...</code></a></li>
<li class="chapter" data-level="11.2.18" data-path="errorchapter.html"><a href="errorchapter.html#error-in-plot.new-figure-margins-too-large"><i class="fa fa-check"></i><b>11.2.18</b> <code>Error in plot.new() : figure margins too large</code></a></li>
<li class="chapter" data-level="11.2.19" data-path="errorchapter.html"><a href="errorchapter.html#error-in-.call.graphicsc_palette2-.callc_palette2-null-invalid-graphics-state"><i class="fa fa-check"></i><b>11.2.19</b> <code>Error in .Call.graphics(C_palette2, .Call(C_palette2, NULL)) : invalid graphics state</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="errorchapter.html"><a href="errorchapter.html#commonwarnings"><i class="fa fa-check"></i><b>11.3</b> Common warning messages</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="errorchapter.html"><a href="errorchapter.html#replacement-has-...-rows-..."><i class="fa fa-check"></i><b>11.3.1</b> <code>replacement has ... rows ...</code></a></li>
<li class="chapter" data-level="11.3.2" data-path="errorchapter.html"><a href="errorchapter.html#iferror"><i class="fa fa-check"></i><b>11.3.2</b> <code>the condition has length &gt; 1 and only the first element will be used</code></a></li>
<li class="chapter" data-level="11.3.3" data-path="errorchapter.html"><a href="errorchapter.html#number-of-items-to-replace-is-not-a-multiple-of-replacement-length"><i class="fa fa-check"></i><b>11.3.3</b> <code>number of items to replace is not a multiple of replacement length</code></a></li>
<li class="chapter" data-level="11.3.4" data-path="errorchapter.html"><a href="errorchapter.html#longer-object-length-is-not-a-multiple-of-shorter-object-length"><i class="fa fa-check"></i><b>11.3.4</b> <code>longer object length is not a multiple of shorter object length</code></a></li>
<li class="chapter" data-level="11.3.5" data-path="errorchapter.html"><a href="errorchapter.html#nas-introduced-by-coercion"><i class="fa fa-check"></i><b>11.3.5</b> <code>NAs introduced by coercion</code></a></li>
<li class="chapter" data-level="11.3.6" data-path="errorchapter.html"><a href="errorchapter.html#package-is-not-available-for-r-version-4.x.x"><i class="fa fa-check"></i><b>11.3.6</b> <code>package is not available (for R version 4.x.x)</code></a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="errorchapter.html"><a href="errorchapter.html#installationmessages"><i class="fa fa-check"></i><b>11.4</b> Messages printed when installing <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mathschap.html"><a href="mathschap.html"><i class="fa fa-check"></i><b>12</b> Mathematical appendix</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mathschap.html"><a href="mathschap.html#bootstrapcimaths"><i class="fa fa-check"></i><b>12.1</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="12.2" data-path="mathschap.html"><a href="mathschap.html#confintequal"><i class="fa fa-check"></i><b>12.2</b> The equivalence between confidence intervals and hypothesis tests</a></li>
<li class="chapter" data-level="12.3" data-path="mathschap.html"><a href="mathschap.html#twotypesofpvalues"><i class="fa fa-check"></i><b>12.3</b> Two types of p-values</a></li>
<li class="chapter" data-level="12.4" data-path="mathschap.html"><a href="mathschap.html#deviance"><i class="fa fa-check"></i><b>12.4</b> Deviance tests</a></li>
<li class="chapter" data-level="12.5" data-path="mathschap.html"><a href="mathschap.html#regreg"><i class="fa fa-check"></i><b>12.5</b> Regularised regression</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>13</b> Solutions to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch2"><i class="fa fa-check"></i>Chapter 2</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch3"><i class="fa fa-check"></i>Chapter 3</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch4"><i class="fa fa-check"></i>Chapter 4</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch5solutions"><i class="fa fa-check"></i>Chapter 5</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch6solutions"><i class="fa fa-check"></i>Chapter 6</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7solutions"><i class="fa fa-check"></i>Chapter 7</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7bsolutions"><i class="fa fa-check"></i>Chapter 8</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch8solutions"><i class="fa fa-check"></i>Chapter 9</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>Bibliography</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references1"><i class="fa fa-check"></i>Further reading</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references2"><i class="fa fa-check"></i>Online resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="divider"></li>
<li>&copy; 2021 Mans Thulin.</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="solutions" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Solutions to exercises<a href="solutions.html#solutions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="solutionsch2" class="section level2 unnumbered hasAnchor">
<h2>Chapter 2<a href="solutions.html#solutionsch2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch2bsolutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc1">2.1</a><a href="solutions.html#ch2bsolutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Type the following code into the Console window:</p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="solutions.html#cb1154-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">*</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">6</span> <span class="sc">*</span> <span class="dv">7</span> <span class="sc">*</span> <span class="dv">8</span> <span class="sc">*</span> <span class="dv">9</span> <span class="sc">*</span> <span class="dv">10</span></span></code></pre></div>
<p>The answer is <span class="math inline">\(3,628,800\)</span>.</p>
<p><a href="thebasics.html#exr:ch2bexc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc2">2.2</a><a href="solutions.html#ch2bsolutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To compute the sum and assign it to <code>a</code>, we use:</li>
</ol>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="solutions.html#cb1155-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">924</span> <span class="sc">+</span> <span class="dv">124</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To compute the square of <code>a</code> we can use:</li>
</ol>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="solutions.html#cb1156-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">*</span>a</span></code></pre></div>
<p>The answer is <span class="math inline">\(1,098,304\)</span>.</p>
<p>As you’ll soon see in other examples, the square can also be computed using:</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="solutions.html#cb1157-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc3">2.3</a><a href="solutions.html#ch2bsolutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>When an invalid character is used in a variable name, an error message is displayed in the Console window. Different characters will render different error messages. For instance, <code>net-income &lt;- income - taxes</code> yields the error message <code>Error in net - income &lt;- income - taxes : object 'net' not found</code>. This may seem a little cryptic (and it is!), but what it means is that R is trying to compute the difference between the variables <code>net</code> and <code>income</code>, because that is how R interprets <code>net-income</code>, and fails because the variable <code>net</code> does not exist. As you become more experienced with R, the error messages will start making more and more sense (at least in most cases).</p></li>
<li><p>If you put R code as a comment, it will be treated as a comment, meaning that it won’t run. This is actually hugely useful, for instance when you’re looking for errors in your code - you can comment away lines of code and see if the rest of the code runs without them.</p></li>
<li><p>Semicolons can be used to write multiple commands on a single line - both will run as if they were on separate lines. If you like, you can add more semicolons to run even more commands.</p></li>
<li><p>The value to the right is assigned to both variables. Note, however, that any operations you perform on one variable won’t affect the other. For instance, if you change the value of one of them, the other will remain unchanged:</p></li>
</ol>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="solutions.html#cb1158-1" aria-hidden="true" tabindex="-1"></a>income2 <span class="ot">&lt;-</span> taxes2 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1158-2"><a href="solutions.html#cb1158-2" aria-hidden="true" tabindex="-1"></a>income2; taxes2 <span class="co"># Check that both are 100</span></span>
<span id="cb1158-3"><a href="solutions.html#cb1158-3" aria-hidden="true" tabindex="-1"></a>taxes2 <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="co"># income2 doesn&#39;t change</span></span>
<span id="cb1158-4"><a href="solutions.html#cb1158-4" aria-hidden="true" tabindex="-1"></a>income2; taxes2 <span class="co"># Check values</span></span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc4">2.4</a><a href="solutions.html#ch2bsolutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To create the vectors, use <code>c</code>:</li>
</ol>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="solutions.html#cb1159-1" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">158</span>, <span class="dv">170</span>, <span class="dv">172</span>, <span class="dv">181</span>, <span class="dv">196</span>)</span>
<span id="cb1159-2"><a href="solutions.html#cb1159-2" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">80</span>, <span class="dv">62</span>, <span class="dv">75</span>, <span class="dv">115</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To combine the two vectors into a data frame, use <code>data.frame</code></li>
</ol>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="solutions.html#cb1160-1" aria-hidden="true" tabindex="-1"></a>hw_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(height, weight)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions4b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc4b">2.5</a><a href="solutions.html#ch2bsolutions4b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The vector created using:</p>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="solutions.html#cb1161-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span></code></pre></div>
<p>is <span class="math inline">\((1,2,3,4,5)\)</span>. Similarly,</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="solutions.html#cb1162-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span></span></code></pre></div>
<p>gives us the same vector in reverse order: <span class="math inline">\((5,4,3,2,1)\)</span>. To create the vector <span class="math inline">\((1,2,3,4,5,4,3,2,1)\)</span> we can therefore use:</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="solutions.html#cb1163-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc4b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc5">2.6</a><a href="solutions.html#ch2bsolutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To compute the mean height, use the <code>mean</code> function:</li>
</ol>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="solutions.html#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(height)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To compute the correlation between the two variables, use <code>cor</code>:</li>
</ol>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="solutions.html#cb1165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(height, weight)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc6">2.7</a><a href="solutions.html#ch2bsolutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p><code>length</code> computes the length (i.e. the number of elements) of a vector. <code>length(height)</code> returns the value <code>5</code>, because the vector is 5 elements long.</p></li>
<li><p><code>sort</code> sorts a vector. The parameter <code>decreasing</code> can be used to decide whether the elements should be sorted in ascending (<code>sort(weights, decreasing = FALSE)</code>) or descending (<code>sort(weights, decreasing = TRUE)</code>) order. To sort the weights in ascending order, we can use <code>sort(weight)</code>. Note, however, that the resulting sorted vector won’t be stored in the variable <code>weight</code> unless we write <code>weight &lt;- sort(weight)</code>!</p></li>
</ol>
<p><a href="thebasics.html#exr:ch2bexc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc7">2.8</a><a href="solutions.html#ch2bsolutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\sqrt{\pi}=1.772454\ldots\)</span>:</li>
</ol>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="solutions.html#cb1166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(pi)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><span class="math inline">\(e^2\cdot log(4)=10.24341\ldots\)</span>:</li>
</ol>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="solutions.html#cb1167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">4</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch2bsolutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2bexc8">2.9</a><a href="solutions.html#ch2bsolutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The expression <span class="math inline">\(1/x\)</span> tends to infinity as <span class="math inline">\(x\rightarrow 0\)</span>, and so R returns <span class="math inline">\(\infty\)</span> as the answer in this case:</li>
</ol>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="solutions.html#cb1168-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="dv">0</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The division <span class="math inline">\(0/0\)</span> is undefined, and R returns <code>NaN</code>, which stands for Not a Number:</li>
</ol>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="solutions.html#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span><span class="sc">/</span><span class="dv">0</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><span class="math inline">\(\sqrt{-1}\)</span> is undefined (as long as we stick to real numbers), and so R returns <code>NaN</code>. The <code>sqrt</code> function also provides an error message saying that <code>NaN</code> values were produced.</li>
</ol>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="solutions.html#cb1170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<p>If you want to use complex numbers for some reason, you can write the complex number <span class="math inline">\(a+bi\)</span> as <code>complex(1, a, b)</code>. Using complex numbers, the square root of <span class="math inline">\(-1\)</span> is <span class="math inline">\(i\)</span>:</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="solutions.html#cb1171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">complex</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2bexc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc1">2.10</a><a href="solutions.html#solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>View the documentation, where the data is described:</li>
</ol>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="solutions.html#cb1172-1" aria-hidden="true" tabindex="-1"></a>?diamonds </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Have a look at the structure of the data:</li>
</ol>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="solutions.html#cb1173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diamonds)</span></code></pre></div>
<p>This shows you the number of observations (53,940) and variables (10), and the variable types. There are three different data types here: <code>num</code> (numerical), <code>Ord.factor</code> (ordered factor, i.e. an ordered categorical variable) and <code>int</code> (integer, a numerical variable that only takes integer values).</p>
<ol start="3" style="list-style-type: decimal">
<li>To compute the descriptive statistics, we can use:</li>
</ol>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="solutions.html#cb1174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diamonds)</span></code></pre></div>
<p>In the summary, missing values show up as NA’s. There are no NA’s here, and hence no missing values.</p>
<p><a href="thebasics.html#exr:ch2exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc2">2.11</a><a href="solutions.html#solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="solutions.html#cb1175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(sleep_total, awake)) <span class="sc">+</span></span>
<span id="cb1175-2"><a href="solutions.html#cb1175-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>The points follow a declining line. The reason for this is that at any given time, an animal is either awake or asleep, so the total sleep time plus the awake time is always 24 hours for all animals. Consequently, the points lie on the line given by <code>awake=24-sleep_total</code>.</p>
<p><a href="thebasics.html#exr:ch2exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc3">2.12</a><a href="solutions.html#solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="solutions.html#cb1176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price, <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb1176-2"><a href="solutions.html#cb1176-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1176-3"><a href="solutions.html#cb1176-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Weight of diamond (carat)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1176-4"><a href="solutions.html#cb1176-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Price (USD)&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can change the opacity of the points by adding an <code>alpha</code> argument to <code>geom_point</code>. This is useful when the plot contains overlapping points:</li>
</ol>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="solutions.html#cb1177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price, <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb1177-2"><a href="solutions.html#cb1177-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1177-3"><a href="solutions.html#cb1177-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Weight of diamond (carat)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1177-4"><a href="solutions.html#cb1177-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Price (USD)&quot;</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc4">2.13</a><a href="solutions.html#solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To set different shapes for different values of <code>cut</code> we use:</li>
</ol>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="solutions.html#cb1178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price, <span class="at">colour =</span> cut, <span class="at">shape =</span> cut)) <span class="sc">+</span></span>
<span id="cb1178-2"><a href="solutions.html#cb1178-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1178-3"><a href="solutions.html#cb1178-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Weight of diamond (carat)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1178-4"><a href="solutions.html#cb1178-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Price (USD)&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can then change the size of the points as follows. The resulting figure is unfortunately not that informative in this case.</li>
</ol>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="solutions.html#cb1179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price, <span class="at">colour =</span> cut,</span>
<span id="cb1179-2"><a href="solutions.html#cb1179-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> cut, <span class="at">size =</span> x)) <span class="sc">+</span></span>
<span id="cb1179-3"><a href="solutions.html#cb1179-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1179-4"><a href="solutions.html#cb1179-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Weight of diamond (carat)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1179-5"><a href="solutions.html#cb1179-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Price (USD)&quot;</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc5">2.14</a><a href="solutions.html#solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the <code>scale_axis_log10</code> options:</p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="solutions.html#cb1180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt, <span class="at">colour =</span> sleep_total)) <span class="sc">+</span> </span>
<span id="cb1180-2"><a href="solutions.html#cb1180-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1180-3"><a href="solutions.html#cb1180-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Body weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1180-4"><a href="solutions.html#cb1180-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1180-5"><a href="solutions.html#cb1180-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1180-6"><a href="solutions.html#cb1180-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc6">2.15</a><a href="solutions.html#solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We use <code>facet_wrap(~ cut)</code> to create the facetting:</li>
</ol>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="solutions.html#cb1181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span> </span>
<span id="cb1181-2"><a href="solutions.html#cb1181-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1181-3"><a href="solutions.html#cb1181-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To set the number of rows, we add an <code>nrow</code> argument to <code>facet_wrap</code>:</li>
</ol>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="solutions.html#cb1182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span> </span>
<span id="cb1182-2"><a href="solutions.html#cb1182-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1182-3"><a href="solutions.html#cb1182-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut, <span class="at">nrow =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc7">2.16</a><a href="solutions.html#solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="solutions.html#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb1183-2"><a href="solutions.html#cb1183-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To change the colours of the boxes, we add <code>colour</code> (outline colour) and <code>fill</code> (box colour) arguments to <code>geom_boxplot</code>:</li>
</ol>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="solutions.html#cb1184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb1184-2"><a href="solutions.html#cb1184-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">colour =</span> <span class="st">&quot;magenta&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;turquoise&quot;</span>)</span></code></pre></div>
<p>(No, I don’t really recommend using this particular combination of colours.)</p>
<ol start="3" style="list-style-type: decimal">
<li><code>reorder(cut, price, median)</code> changes the order of the <code>cut</code> categories based on their median <code>price</code> values.</li>
</ol>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="solutions.html#cb1185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(<span class="fu">reorder</span>(cut, price, median), price)) <span class="sc">+</span></span>
<span id="cb1185-2"><a href="solutions.html#cb1185-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">colour =</span> <span class="st">&quot;magenta&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;turquoise&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><code>geom_jitter</code> can be used to plot the individual observations on top of the histogram. Because there are so many observations in this dataset, we must set a small size and a low alpha in order not to cover the boxes completely.</li>
</ol>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="solutions.html#cb1186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(<span class="fu">reorder</span>(cut, price), price)) <span class="sc">+</span></span>
<span id="cb1186-2"><a href="solutions.html#cb1186-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">colour =</span> <span class="st">&quot;magenta&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;turquoise&quot;</span>) <span class="sc">+</span></span>
<span id="cb1186-3"><a href="solutions.html#cb1186-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc8">2.17</a><a href="solutions.html#solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="solutions.html#cb1187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price)) <span class="sc">+</span></span>
<span id="cb1187-2"><a href="solutions.html#cb1187-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we facet the histograms using <code>cut</code>:</li>
</ol>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="solutions.html#cb1188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price)) <span class="sc">+</span></span>
<span id="cb1188-2"><a href="solutions.html#cb1188-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb1188-3"><a href="solutions.html#cb1188-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, by reading the documentation <code>?geom_histogram</code> we find that we can add outlines using the <code>colour</code> argument:</li>
</ol>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="solutions.html#cb1189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price)) <span class="sc">+</span></span>
<span id="cb1189-2"><a href="solutions.html#cb1189-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1189-3"><a href="solutions.html#cb1189-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> cut)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc9">2.18</a><a href="solutions.html#solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="solutions.html#cb1190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut)) <span class="sc">+</span></span>
<span id="cb1190-2"><a href="solutions.html#cb1190-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To set different colours for the bars, we can use <code>fill</code>, either to set the colours manually or using default colours (by adding a colour aesthetic):</li>
</ol>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="solutions.html#cb1191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set colours manually:</span></span>
<span id="cb1191-2"><a href="solutions.html#cb1191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut)) <span class="sc">+</span></span>
<span id="cb1191-3"><a href="solutions.html#cb1191-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;purple&quot;</span>))</span>
<span id="cb1191-4"><a href="solutions.html#cb1191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1191-5"><a href="solutions.html#cb1191-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use defaults:</span></span>
<span id="cb1191-6"><a href="solutions.html#cb1191-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1191-7"><a href="solutions.html#cb1191-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>()</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>width</code> lets us control the bar width:</li>
</ol>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="solutions.html#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1192-2"><a href="solutions.html#cb1192-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>By adding <code>fill = clarity</code> to <code>aes</code> we create stacked bar charts:</li>
</ol>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="solutions.html#cb1193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, <span class="at">fill =</span> clarity)) <span class="sc">+</span></span>
<span id="cb1193-2"><a href="solutions.html#cb1193-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>()</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>By adding <code>position = "dodge"</code> to <code>geom_bar</code> we obtain grouped bar charts:</li>
</ol>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="solutions.html#cb1194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, <span class="at">fill =</span> clarity)) <span class="sc">+</span></span>
<span id="cb1194-2"><a href="solutions.html#cb1194-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><code>coord_flip</code> flips the coordinate system, yielding a horizontal bar plot:</li>
</ol>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="solutions.html#cb1195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut)) <span class="sc">+</span></span>
<span id="cb1195-2"><a href="solutions.html#cb1195-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb1195-3"><a href="solutions.html#cb1195-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="thebasics.html#exr:ch2exc10">2.19</a><a href="solutions.html#solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To save the png file, use</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="solutions.html#cb1196-1" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(sleep_total, sleep_rem)) <span class="sc">+</span></span>
<span id="cb1196-2"><a href="solutions.html#cb1196-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span>
<span id="cb1196-3"><a href="solutions.html#cb1196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1196-4"><a href="solutions.html#cb1196-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;filename.png&quot;</span>, myPlot, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>To change the resolution, we use the <code>dpi</code> argument:</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="solutions.html#cb1197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;filename.png&quot;</span>, myPlot, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi=</span><span class="dv">600</span>)</span></code></pre></div>
<p><a href="thebasics.html#exr:ch2exc10">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="solutionsch3" class="section level2 unnumbered hasAnchor">
<h2>Chapter 3<a href="solutions.html#solutionsch3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch3solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc1">3.1</a><a href="solutions.html#ch3solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Both approaches render a <code>character</code> object with the text <code>A rainy day in Edinburgh</code>:</li>
</ol>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="solutions.html#cb1198-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;A rainy day in Edinburgh&quot;</span></span>
<span id="cb1198-2"><a href="solutions.html#cb1198-2" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb1198-3"><a href="solutions.html#cb1198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span>
<span id="cb1198-4"><a href="solutions.html#cb1198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-5"><a href="solutions.html#cb1198-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&#39;A rainy day in Edinburgh&#39;</span></span>
<span id="cb1198-6"><a href="solutions.html#cb1198-6" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb1198-7"><a href="solutions.html#cb1198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span></code></pre></div>
<p>That is, you are free to choose whether to use single or double quotation marks. I tend to use double quotation marks, because I was raised to believe that double quotation marks are superior in every way (well, that, and the fact that I think that they make code easier to read simply because they are easier to notice).</p>
<ol start="2" style="list-style-type: decimal">
<li>The first two sums are <code>numeric</code> whereas the third is <code>integer</code></li>
</ol>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="solutions.html#cb1199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>)    <span class="co"># numeric</span></span>
<span id="cb1199-2"><a href="solutions.html#cb1199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(1L <span class="sc">+</span> <span class="dv">2</span>)   <span class="co"># numeric</span></span>
<span id="cb1199-3"><a href="solutions.html#cb1199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span> (1L <span class="sc">+</span> 2L) <span class="co"># integer</span></span></code></pre></div>
<p>If we mix <code>numeric</code> and <code>integer</code> variables, the result is a <code>numeric</code>. But as long as we stick to just <code>integer</code> variables, the result is usually an <code>integer</code>. There are exceptions though - computing <code>2L/3L</code> won’t result in an <code>integer</code> because… well, because it’s not an integer.</p>
<ol start="3" style="list-style-type: decimal">
<li>When we run <code>"Hello" + 1</code> we receive an error message:</li>
</ol>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="solutions.html#cb1200-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="st">&quot;Hello&quot;</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1200-2"><a href="solutions.html#cb1200-2" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="st">&quot;Hello&quot;</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">:</span> non<span class="sc">-</span>numeric argument to binary operator</span></code></pre></div>
<p>In R, binary operators are mathematical operators like <code>+</code>, <code>-</code>, <code>*</code> and <code>/</code> that takes two numbers and returns a number. Because <code>"Hello"</code> is a <code>character</code> and not a <code>numeric</code>, it fails in this case. So, in English the error message reads <code>Error in "Hello" + 1 : trying to perform addition with something that is not a number</code>. Maybe you know a bit of algebra and want to say <em>hey, we</em> can <em>add characters together, like in <span class="math inline">\(a^2+b^2=c^2\)</span>!</em>. Which I guess is correct. But R doesn’t do algebraic calculations, but numerical ones - that is, all letters involved in the computations must represent actual numbers. <code>a^2+b^2=c^2</code> will work only if <code>a</code>, <code>b</code> and <code>c</code> all have numbers assigned to them.</p>
<ol start="4" style="list-style-type: decimal">
<li>Combining <code>numeric</code> and a <code>logical</code> variables turns out to be very useful in some problems. The result is always numeric, with <code>FALSE</code> being treated as the number <code>0</code> and <code>TRUE</code> being treated as the number <code>1</code> in the computations:</li>
</ol>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="solutions.html#cb1201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="cn">FALSE</span> <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb1201-2"><a href="solutions.html#cb1201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="cn">TRUE</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions1c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc1c">3.2</a><a href="solutions.html#ch3solutions1c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The functions return information about the data frame:</p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1202-1"><a href="solutions.html#cb1202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(airquality) <span class="co"># Number of columns of the data frame</span></span>
<span id="cb1202-2"><a href="solutions.html#cb1202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(airquality) <span class="co"># Number of rows of the data frame</span></span>
<span id="cb1202-3"><a href="solutions.html#cb1202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airquality) <span class="co"># Number of rows, followed by number of columns</span></span>
<span id="cb1202-4"><a href="solutions.html#cb1202-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(airquality) <span class="co"># The name of the variables in the data frame</span></span>
<span id="cb1202-5"><a href="solutions.html#cb1202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(airquality) <span class="co"># The name of the rows in the data frame</span></span>
<span id="cb1202-6"><a href="solutions.html#cb1202-6" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># (indices unless the rows have been named)</span></span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc1c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions1b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc1b">3.3</a><a href="solutions.html#ch3solutions1b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To create the matrices, we need to set the number of rows <code>nrow</code>, the number of columns <code>ncol</code> and whether to use the elements of the vector <code>x</code> to fill the matrix by rows or by columns (<code>byrow</code>). To create</p>
<p><span class="math display">\[\begin{pmatrix}
  1 &amp; 2 &amp; 3\\
  4 &amp; 5 &amp; 6
\end{pmatrix}\]</span></p>
<p>we use:</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="solutions.html#cb1203-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb1203-2"><a href="solutions.html#cb1203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-3"><a href="solutions.html#cb1203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(x, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>And to create</p>
<p><span class="math display">\[\begin{pmatrix}
  1 &amp; 4\\
  2 &amp; 5\\
  3 &amp; 6
\end{pmatrix}\]</span></p>
<p>we use:</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="solutions.html#cb1204-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb1204-2"><a href="solutions.html#cb1204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-3"><a href="solutions.html#cb1204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(x, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We’ll do a deep-dive on <code>matrix</code> objects in Section <a href="advancedchapter.html#linearalgebra">10.3</a>.</p>
<p><a href="datachapter.html#exr:ch3exc1b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc2">3.4</a><a href="solutions.html#ch3solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>In the <code>[i, j]</code> notation, <code>i</code> is the row number and <code>j</code> is the column number. In this case, <code>airquality[, 3]</code>, we have j=3 and therefore asks for the 3rd <em>column</em>, not the 3rd row. To get the third row, we’d use <code>airquality[3,]</code> instead.</p></li>
<li><p>To extract the first five rows, we can use:</p></li>
</ol>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1205-1"><a href="solutions.html#cb1205-1" aria-hidden="true" tabindex="-1"></a>airquality[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb1205-2"><a href="solutions.html#cb1205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb1205-3"><a href="solutions.html#cb1205-3" aria-hidden="true" tabindex="-1"></a>airquality[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),]</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>First, we use <code>names(airquality)</code> to check the column numbers of the two variables. <code>Wind</code> is column 3 and <code>Temp</code> is column 4, so we can access them using <code>airquality[,3]</code> and <code>airquality[,4]</code> respectively. Thus, we can compute the correlation using:</li>
</ol>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="solutions.html#cb1206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(airquality[,<span class="dv">3</span>], airquality[,<span class="dv">4</span>])</span></code></pre></div>
<p>Alternatively, we could refer to the variables using the column names:</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="solutions.html#cb1207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(airquality[,<span class="st">&quot;Wind&quot;</span>], airquality[,<span class="st">&quot;Temp&quot;</span>])</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>To extract all columns except <code>Temp</code> and <code>Wind</code>, we use a minus sign <code>-</code> and a vector containing their indices:</li>
</ol>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="solutions.html#cb1208-1" aria-hidden="true" tabindex="-1"></a>airquality[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions2p5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc2p5">3.5</a><a href="solutions.html#ch3solutions2p5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To add the new variable, we can use:</li>
</ol>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1209-1"><a href="solutions.html#cb1209-1" aria-hidden="true" tabindex="-1"></a>bookstore<span class="sc">$</span>rev_per_minute <span class="ot">&lt;-</span> bookstore<span class="sc">$</span>purchase <span class="sc">/</span> bookstore<span class="sc">$</span>visit_length</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>By using <code>View(bookstore)</code> or looking at the data in the Console window using <code>bookstore</code>, we see that the customer in question is on row 6 of the data. To replace the value, we can use:</li>
</ol>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="solutions.html#cb1210-1" aria-hidden="true" tabindex="-1"></a>bookstore<span class="sc">$</span>purchase[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="dv">16</span></span></code></pre></div>
<p>Note that the value of <code>rev_per_minute</code> hasn’t been changed by this operation. We will therefore need to compute it again, to update its value:</p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="solutions.html#cb1211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can either compute it again for all customers:</span></span>
<span id="cb1211-2"><a href="solutions.html#cb1211-2" aria-hidden="true" tabindex="-1"></a>bookstore<span class="sc">$</span>rev_per_minute <span class="ot">&lt;-</span> bookstore<span class="sc">$</span>purchase <span class="sc">/</span> bookstore<span class="sc">$</span>visit_length</span>
<span id="cb1211-3"><a href="solutions.html#cb1211-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ...or just for customer number 6:</span></span>
<span id="cb1211-4"><a href="solutions.html#cb1211-4" aria-hidden="true" tabindex="-1"></a>bookstore<span class="sc">$</span>rev_per_minute[<span class="dv">6</span>] <span class="ot">&lt;-</span> bookstore<span class="sc">$</span>purchase[<span class="dv">6</span>] <span class="sc">/</span> bookstore<span class="sc">$</span>visit_length[<span class="dv">6</span>]</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc2p5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc3">3.6</a><a href="solutions.html#ch3solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The coldest day was the day with the lowest temperature:</li>
</ol>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1212-1"><a href="solutions.html#cb1212-1" aria-hidden="true" tabindex="-1"></a>airquality[<span class="fu">which.min</span>(airquality<span class="sc">$</span>Temp),]</span></code></pre></div>
<p>We see that the 5th day in the period, May 5, was the coldest, with a temperature of 56 degrees Fahrenheit.</p>
<ol start="2" style="list-style-type: decimal">
<li>To find out how many days the wind speed was greater than 17 mph, we use <code>sum</code>:</li>
</ol>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="solutions.html#cb1213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(airquality<span class="sc">$</span>Wind <span class="sc">&gt;</span> <span class="dv">17</span>)</span></code></pre></div>
<p>Because there are so few days fulfilling this condition, we could also easily have solved this by just looking at the rows for those days and counting them:</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="solutions.html#cb1214-1" aria-hidden="true" tabindex="-1"></a>airquality[airquality<span class="sc">$</span>Wind <span class="sc">&gt;</span> <span class="dv">17</span>,]</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Missing data are represented by <code>NA</code> values in R, and so we wish to check how many <code>NA</code> elements there are in the <code>Ozone</code> vector. We do this by combining <code>is.na</code> and <code>sum</code> and find that there are 37 missing values:</li>
</ol>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="solutions.html#cb1215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(airquality<span class="sc">$</span>Ozone))</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>In this case, we need to use an ampersand <code>&amp;</code> sign to combine the two conditions:</li>
</ol>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="solutions.html#cb1216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(airquality<span class="sc">$</span>Temp <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">&amp;</span> airquality<span class="sc">$</span>Wind <span class="sc">&gt;</span> <span class="dv">10</span>)</span></code></pre></div>
<p>We find that there are 22 such days in the data.</p>
<p><a href="datachapter.html#exr:ch3exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions3b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a><a href="solutions.html#ch3solutions3b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We should use the <code>breaks</code> argument to set the interval bounds in <code>cut</code>:</p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="solutions.html#cb1217-1" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>TempCat <span class="ot">&lt;-</span> <span class="fu">cut</span>(airquality<span class="sc">$</span>Temp,</span>
<span id="cb1217-2"><a href="solutions.html#cb1217-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">110</span>))</span></code></pre></div>
<p>To see the number of days in each category, we can use <code>summary</code>:</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="solutions.html#cb1218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airquality<span class="sc">$</span>TempCat)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc3b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a><a href="solutions.html#ch3solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The variable <code>X</code> represents the empty column between <code>Visit</code> and <code>VAS</code>. In the <code>X.1</code> column the researchers have made comments on two rows (rows 692 and 1153), causing R to read this otherwise empty column. If we wish, we can remove these columns from the data using the syntax from Section <a href="datachapter.html#accessingelements">3.2.1</a>:</li>
</ol>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="solutions.html#cb1219-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> vas[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>)]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We remove the <code>sep = ";"</code> argument:</li>
</ol>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="solutions.html#cb1220-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>…and receive the following error message:</p>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="solutions.html#cb1221-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">read.table</span>(<span class="at">file =</span> file, <span class="at">header =</span> header, <span class="at">sep =</span> sep,</span>
<span id="cb1221-2"><a href="solutions.html#cb1221-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">quote =</span> quote,  <span class="sc">:</span> </span>
<span id="cb1221-3"><a href="solutions.html#cb1221-3" aria-hidden="true" tabindex="-1"></a>  duplicate <span class="st">&#39;row.names&#39;</span> are not allowed</span></code></pre></div>
<p>By default, <code>read.csv</code> uses commas, <code>,</code>, as column delimiters. In this case it fails to read the file, because it uses semicolons instead.</p>
<ol start="3" style="list-style-type: decimal">
<li>Next, we remove the <code>dec = ","</code> argument:</li>
</ol>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="solutions.html#cb1222-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb1222-2"><a href="solutions.html#cb1222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vas)</span></code></pre></div>
<p><code>read.csv</code> reads the data without any error messages, but now <code>VAS</code> has become a <code>character</code> vector. By default, <code>read.csv</code> assumes that the file uses decimal points rather than decimals commas. When we don’t specify that the file has decimal commas, <code>read.csv</code> interprets <code>0,4</code> as text rather than a number.</p>
<ol start="4" style="list-style-type: decimal">
<li>Next, we remove the <code>skip = 4</code> argument:</li>
</ol>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="solutions.html#cb1223-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb1223-2"><a href="solutions.html#cb1223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vas)</span>
<span id="cb1223-3"><a href="solutions.html#cb1223-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vas)</span></code></pre></div>
<p><code>read.csv</code> looks for column names on the first row that it reads. <code>skip = 4</code> tells the function to skip the first 4 rows of the <code>.csv</code> file (which in this case were blank or contain other information about the data). When it doesn’t skip those lines, the only text on the first row is <code>Data updated 2020-04-25</code>. This then becomes the name of the first column, and the remaining columns are named <code>X</code>, <code>X.1</code>, <code>X.2</code>, and so on.</p>
<ol start="5" style="list-style-type: decimal">
<li>Finally, we change <code>skip = 4</code> to <code>skip = 5</code>:</li>
</ol>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1224-1"><a href="solutions.html#cb1224-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">5</span>)</span>
<span id="cb1224-2"><a href="solutions.html#cb1224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vas)</span>
<span id="cb1224-3"><a href="solutions.html#cb1224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vas)</span></code></pre></div>
<p>In this case, <code>read.csv</code> skips the first 5 rows, which includes row 5, on which the variable names are given. It still looks for variable names on the first row that it reads though, meaning that the data values from the first observation become variable names instead of data points. An <code>X</code> is added at the beginning of the variable names, because variable names in R cannot begin with a number.</p>
<p><a href="datachapter.html#exr:ch3exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc5">3.9</a><a href="solutions.html#ch3solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>First, set <code>file_path</code> to the path to <code>projects-email.xlsx</code>. Then we can use <code>read.xlsx</code> from the <code>openxlsx</code> package. The argument <code>sheet</code> lets us select which sheet to read:</li>
</ol>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="solutions.html#cb1225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1225-2"><a href="solutions.html#cb1225-2" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb1225-3"><a href="solutions.html#cb1225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1225-4"><a href="solutions.html#cb1225-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(emails)</span>
<span id="cb1225-5"><a href="solutions.html#cb1225-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(emails)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To obtain a vector containing the email addresses without any duplicates, we apply <code>unique</code> to the vector containing the e-mail addresses. That vector is called <code>E-mail</code> with a hyphen <code>-</code>. We cannot access it using <code>emails$E-mail</code>, because R will interpret that as <code>email$E - mail</code>, and neither the vector <code>email$E</code> nor the variable <code>mail</code> exist. Instead, we can do one of the following:</li>
</ol>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1226-1"><a href="solutions.html#cb1226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(emails[,<span class="dv">3</span>])</span>
<span id="cb1226-2"><a href="solutions.html#cb1226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(emails<span class="sc">$</span><span class="st">&quot;E-mail&quot;</span>)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc6">3.10</a><a href="solutions.html#ch3solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We set <code>file_path</code> to the path to <code>vas-transposed.csv</code> and then read it:</li>
</ol>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="solutions.html#cb1227-1" aria-hidden="true" tabindex="-1"></a>vast <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1227-2"><a href="solutions.html#cb1227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vast)</span>
<span id="cb1227-3"><a href="solutions.html#cb1227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(vast)</span></code></pre></div>
<p>It is a data frame with 4 rows and 2366 variables.</p>
<ol start="2" style="list-style-type: decimal">
<li>Adding <code>row.names = 1</code> lets us read the row names:</li>
</ol>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1228-1"><a href="solutions.html#cb1228-1" aria-hidden="true" tabindex="-1"></a>vast <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb1228-2"><a href="solutions.html#cb1228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(vast)</span></code></pre></div>
<p>This data frame only contains 2365 variables, because the leftmost column is now the row names and not a variable.</p>
<ol start="3" style="list-style-type: decimal">
<li><code>t</code> lets us rotate the data into the format that we are used to. If we only apply <code>t</code> though, the resulting object is a <code>matrix</code> and not a <code>data.frame</code>. If we want it to be a <code>data.frame</code>, we must also make a call to <code>as.data.frame</code>:</li>
</ol>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1229-1"><a href="solutions.html#cb1229-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">t</span>(vast)</span>
<span id="cb1229-2"><a href="solutions.html#cb1229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vas)</span>
<span id="cb1229-3"><a href="solutions.html#cb1229-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-4"><a href="solutions.html#cb1229-4" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(vast))</span>
<span id="cb1229-5"><a href="solutions.html#cb1229-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vas)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions6bb" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc6bb">3.11</a><a href="solutions.html#ch3solutions6bb" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit the model and use <code>summary</code> to print estimates and p-values:</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1230-1"><a href="solutions.html#cb1230-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp <span class="sc">+</span> wt <span class="sc">+</span> cyl <span class="sc">+</span> am, <span class="at">data =</span> mtcars)</span>
<span id="cb1230-2"><a href="solutions.html#cb1230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p><code>hp</code> and <code>wt</code> are significant at the 5 % level, but <code>cyl</code> and <code>am</code> are not.</p>
<p><a href="datachapter.html#exr:ch3exc6bb">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc8">3.12</a><a href="solutions.html#ch3solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path for <code>vas.csv</code> and read the data as in Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>::</p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="solutions.html#cb1231-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we compute the mean VAS for each patient:</li>
</ol>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1232-1"><a href="solutions.html#cb1232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(VAS <span class="sc">~</span> ID, <span class="at">data =</span> vas, <span class="at">FUN =</span> mean)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we compute the lowest and highest VAS recorded for each patient:</li>
</ol>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="solutions.html#cb1233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(VAS <span class="sc">~</span> ID, <span class="at">data =</span> vas, <span class="at">FUN =</span> min)</span>
<span id="cb1233-2"><a href="solutions.html#cb1233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(VAS <span class="sc">~</span> ID, <span class="at">data =</span> vas, <span class="at">FUN =</span> max)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we compute the number of high-VAS days for each patient. One way to do this is to create a <code>logical</code> vector by <code>VAS &gt;= 7</code> and then compute its sum.</li>
</ol>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1234-1"><a href="solutions.html#cb1234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>((VAS <span class="sc">&gt;=</span> <span class="dv">7</span>) <span class="sc">~</span> ID, <span class="at">data =</span> vas, <span class="at">FUN =</span> sum)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc9">3.13</a><a href="solutions.html#ch3solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First we load and inspect the data:</p>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="solutions.html#cb1235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasauRus)</span>
<span id="cb1235-2"><a href="solutions.html#cb1235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(datasaurus_dozen)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we compute summary statistics grouped by <code>dataset</code>:</li>
</ol>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1236-1"><a href="solutions.html#cb1236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(x, y) <span class="sc">~</span> dataset, <span class="at">data =</span> datasaurus_dozen, <span class="at">FUN =</span> mean)</span>
<span id="cb1236-2"><a href="solutions.html#cb1236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(x, y) <span class="sc">~</span> dataset, <span class="at">data =</span> datasaurus_dozen, <span class="at">FUN =</span> sd)</span>
<span id="cb1236-3"><a href="solutions.html#cb1236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1236-4"><a href="solutions.html#cb1236-4" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(datasaurus_dozen[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], datasaurus_dozen<span class="sc">$</span>dataset, cor)</span></code></pre></div>
<p>The summary statistics for all datasets are virtually identical.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we make scatterplots. Here is a solution using <code>ggplot2</code>:</li>
</ol>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="solutions.html#cb1237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1237-2"><a href="solutions.html#cb1237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datasaurus_dozen, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> dataset)) <span class="sc">+</span></span>
<span id="cb1237-3"><a href="solutions.html#cb1237-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1237-4"><a href="solutions.html#cb1237-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> dataset, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Clearly, the datasets are <em>very</em> different! This is a great example of how simply computing summary statistics is not enough. They tell a part of the story, yes, but only a part.</p>
<p><a href="datachapter.html#exr:ch3exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc10">3.14</a><a href="solutions.html#ch3solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the <code>magrittr</code> package and create <code>x</code>:</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="solutions.html#cb1238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1238-2"><a href="solutions.html#cb1238-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>sqrt(mean(x))</code> can be rewritten as:</li>
</ol>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="solutions.html#cb1239-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> mean <span class="sc">%&gt;%</span> sqrt</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>mean(sqrt(x))</code> can be rewritten as:</li>
</ol>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="solutions.html#cb1240-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> sqrt <span class="sc">%&gt;%</span> mean</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>sort(x^2-5)[1:2]</code> can be rewritten as:</li>
</ol>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="solutions.html#cb1241-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> <span class="fu">raise_to_power</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">subtract</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">extract</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch3solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="datachapter.html#exr:ch3exc11">3.15</a><a href="solutions.html#ch3solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can use <code>inset</code> to add the new variable:</p>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1242-1"><a href="solutions.html#cb1242-1" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">48</span>, <span class="dv">47</span>, <span class="dv">71</span>, <span class="dv">22</span>, <span class="dv">80</span>, <span class="dv">48</span>, <span class="dv">30</span>, <span class="dv">31</span>)</span>
<span id="cb1242-2"><a href="solutions.html#cb1242-2" aria-hidden="true" tabindex="-1"></a>purchase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">59</span>, <span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">22</span>, <span class="dv">160</span>, <span class="dv">34</span>, <span class="dv">34</span>, <span class="dv">29</span>)</span>
<span id="cb1242-3"><a href="solutions.html#cb1242-3" aria-hidden="true" tabindex="-1"></a>visit_length <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">20</span>, <span class="dv">22</span>, <span class="dv">12</span>, <span class="dv">31</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)</span>
<span id="cb1242-4"><a href="solutions.html#cb1242-4" aria-hidden="true" tabindex="-1"></a>bookstore <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(age, purchase, visit_length)</span>
<span id="cb1242-5"><a href="solutions.html#cb1242-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1242-6"><a href="solutions.html#cb1242-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1242-7"><a href="solutions.html#cb1242-7" aria-hidden="true" tabindex="-1"></a>bookstore <span class="sc">%&gt;%</span> <span class="fu">inset</span>(<span class="st">&quot;rev_per_minute&quot;</span>,</span>
<span id="cb1242-8"><a href="solutions.html#cb1242-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value =</span> .<span class="sc">$</span>purchase <span class="sc">/</span> .<span class="sc">$</span>visit_length)</span></code></pre></div>
<p><a href="datachapter.html#exr:ch3exc11">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="solutionsch4" class="section level2 unnumbered hasAnchor">
<h2>Chapter 4<a href="solutions.html#solutionsch4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch4solutions0" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc0">4.1</a><a href="solutions.html#ch4solutions0" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We change the background colour of the entire plot to <code>lightblue</code>.</li>
</ol>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="solutions.html#cb1243-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1243-2"><a href="solutions.html#cb1243-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we change the font of the legend to <code>serif</code>.</li>
</ol>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1244-1"><a href="solutions.html#cb1244-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1244-2"><a href="solutions.html#cb1244-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1244-3"><a href="solutions.html#cb1244-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb1244-4"><a href="solutions.html#cb1244-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>We remove the grid:</li>
</ol>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="solutions.html#cb1245-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1245-2"><a href="solutions.html#cb1245-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1245-3"><a href="solutions.html#cb1245-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb1245-4"><a href="solutions.html#cb1245-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb1245-5"><a href="solutions.html#cb1245-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1245-6"><a href="solutions.html#cb1245-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Finally, we change the colour of the axis ticks to <code>orange</code> and increase their width:</li>
</ol>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="solutions.html#cb1246-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1246-2"><a href="solutions.html#cb1246-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>),</span>
<span id="cb1246-3"><a href="solutions.html#cb1246-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb1246-4"><a href="solutions.html#cb1246-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb1246-5"><a href="solutions.html#cb1246-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1246-6"><a href="solutions.html#cb1246-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1246-7"><a href="solutions.html#cb1246-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>))</span></code></pre></div>
<p>It doesn’t look all that great, does it? Let’s just stick to the default theme in the remaining examples.</p>
<p><a href="eda.html#exr:ch4exc0">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc9">4.2</a><a href="solutions.html#ch4solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We can use the <code>bw</code> argument to control the smoothness of the curves:</li>
</ol>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="solutions.html#cb1247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb1247-2"><a href="solutions.html#cb1247-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">bw =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can fill the areas under the density curves by adding <code>fill</code> to the <code>aes</code>:</li>
</ol>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="solutions.html#cb1248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">colour =</span> cut, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1248-2"><a href="solutions.html#cb1248-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">bw =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Because the densities overlap, it’d be better to make the fill colours slightly transparent. We add <code>alpha</code> to the geom:</li>
</ol>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="solutions.html#cb1249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">colour =</span> cut, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1249-2"><a href="solutions.html#cb1249-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">bw =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>A similar plot can be created using <code>geom_density_ridges</code> from the <code>ggridges</code> package. Note that you must set <code>y = cut</code> in the <code>aes</code>, because the densities should be separated by cut.</li>
</ol>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="solutions.html#cb1250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggridges&quot;</span>)</span>
<span id="cb1250-2"><a href="solutions.html#cb1250-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb1250-3"><a href="solutions.html#cb1250-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1250-4"><a href="solutions.html#cb1250-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, cut, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1250-5"><a href="solutions.html#cb1250-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>()</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc10">4.3</a><a href="solutions.html#ch4solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use <code>xlim</code> to set the boundaries of the x-axis and <code>bindwidth</code> to decrease the bin width:</p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="solutions.html#cb1251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat)) <span class="sc">+</span></span>
<span id="cb1251-2"><a href="solutions.html#cb1251-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb1251-3"><a href="solutions.html#cb1251-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">3</span>)</span></code></pre></div>
<p>It appears that carat values that are just above multiples of 0.25 are more common than other values. We’ll explore that next.</p>
<p><a href="eda.html#exr:ch4exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc11">4.4</a><a href="solutions.html#ch4solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We set the colours using the <code>fill</code> aesthetic:</li>
</ol>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="solutions.html#cb1252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1252-2"><a href="solutions.html#cb1252-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we remove the legend:</li>
</ol>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="solutions.html#cb1253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb1253-2"><a href="solutions.html#cb1253-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb1253-3"><a href="solutions.html#cb1253-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>We add boxplots by adding an additional <code>geom</code> to the plot. Increasing the width of the violins and decreasing the width of the boxplots creates a better figure. We also move the <code>fill = cut</code> aesthetic from <code>ggplot</code> to <code>geom_violin</code> so that the boxplots use the default colours instead of different colours for each category.</li>
</ol>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1254-1"><a href="solutions.html#cb1254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb1254-2"><a href="solutions.html#cb1254-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cut), <span class="at">width =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb1254-3"><a href="solutions.html#cb1254-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1254-4"><a href="solutions.html#cb1254-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Finally, we can create a horizontal version of the figure in the same way we did for boxplots in Section <a href="thebasics.html#exr:ch2exc9">2.18</a>: by adding <code>coord_flip()</code> to the plot:</li>
</ol>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="solutions.html#cb1255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb1255-2"><a href="solutions.html#cb1255-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cut), <span class="at">width =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb1255-3"><a href="solutions.html#cb1255-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1255-4"><a href="solutions.html#cb1255-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1255-5"><a href="solutions.html#cb1255-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc11">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions12" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc12">4.5</a><a href="solutions.html#ch4solutions12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can create an interactive scatterplot using:</p>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1256-1"><a href="solutions.html#cb1256-1" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(x, y,</span>
<span id="cb1256-2"><a href="solutions.html#cb1256-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Row:&quot;</span>, <span class="fu">rownames</span>(diamonds)))) <span class="sc">+</span></span>
<span id="cb1256-3"><a href="solutions.html#cb1256-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span>
<span id="cb1256-4"><a href="solutions.html#cb1256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1256-5"><a href="solutions.html#cb1256-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>There are outliers along the y-axis on rows 24,068 and 49,190. There are also some points for which <span class="math inline">\(x=0\)</span>. Examples include rows 11,183 and 49,558. It isn’t clear from the plot, but in total there are 8 such points, 7 of which have both <span class="math inline">\(x=0\)</span> and <span class="math inline">\(y=0\)</span>. To view all such diamonds, you can use <code>filter(diamonds, x==0)</code>. These observations must be due to data errors, since diamonds can’t have 0 width. The high <span class="math inline">\(y\)</span>-values also seem suspicious - carat is a measure of diamond weight, and if these diamonds really were 10 times longer than others then we would probably expect them to have unusually high carat values as well (which they don’t).</p>
<p><a href="eda.html#exr:ch4exc12">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions13" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc13">4.6</a><a href="solutions.html#ch4solutions13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The two outliers are the only observations for which <span class="math inline">\(y&gt;20\)</span>, so we use that as our condition:</p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="solutions.html#cb1257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb1257-2"><a href="solutions.html#cb1257-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1257-3"><a href="solutions.html#cb1257-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(y <span class="sc">&gt;</span> <span class="dv">20</span>, <span class="fu">rownames</span>(diamonds), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb1257-4"><a href="solutions.html#cb1257-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fl">1.1</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc13">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions14" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc14">4.7</a><a href="solutions.html#ch4solutions14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="solutions.html#cb1258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of diamonds, then replace x-values greater than 9</span></span>
<span id="cb1258-2"><a href="solutions.html#cb1258-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with NA:</span></span>
<span id="cb1258-3"><a href="solutions.html#cb1258-3" aria-hidden="true" tabindex="-1"></a>diamonds2 <span class="ot">&lt;-</span> diamonds</span>
<span id="cb1258-4"><a href="solutions.html#cb1258-4" aria-hidden="true" tabindex="-1"></a>diamonds2[diamonds2<span class="sc">$</span>x <span class="sc">&gt;</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1258-5"><a href="solutions.html#cb1258-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1258-6"><a href="solutions.html#cb1258-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the scatterplot</span></span>
<span id="cb1258-7"><a href="solutions.html#cb1258-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(carat, price, <span class="at">colour =</span> <span class="fu">is.na</span>(x))) <span class="sc">+</span></span>
<span id="cb1258-8"><a href="solutions.html#cb1258-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>In this plot, we see that virtually all high carat diamonds have missing <code>x</code> values. This seems to indicate that there is a systematic pattern to the missing data (which of course is correct in this case!), and we should proceed with any analyses of <code>x</code> with caution.</p>
<p><a href="eda.html#exr:ch4exc14">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions15" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc15">4.8</a><a href="solutions.html#ch4solutions15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The code below is an example of what your analysis can look like, with some remarks as comments:</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="solutions.html#cb1259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Investigate missing data</span></span>
<span id="cb1259-2"><a href="solutions.html#cb1259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(flights2))</span>
<span id="cb1259-3"><a href="solutions.html#cb1259-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Not too much missing data in this dataset!</span></span>
<span id="cb1259-4"><a href="solutions.html#cb1259-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(flights2[<span class="fu">is.na</span>(flights2<span class="sc">$</span>air_time),])</span>
<span id="cb1259-5"><a href="solutions.html#cb1259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Flights with missing data tend to have several missing variables.</span></span>
<span id="cb1259-6"><a href="solutions.html#cb1259-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1259-7"><a href="solutions.html#cb1259-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge plots to compare different carriers (boxplots, facetted</span></span>
<span id="cb1259-8"><a href="solutions.html#cb1259-8" aria-hidden="true" tabindex="-1"></a><span class="co"># histograms and violin plots could also be used)</span></span>
<span id="cb1259-9"><a href="solutions.html#cb1259-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb1259-10"><a href="solutions.html#cb1259-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights2, <span class="fu">aes</span>(arr_delay, carrier, <span class="at">fill =</span> carrier)) <span class="sc">+</span></span>
<span id="cb1259-11"><a href="solutions.html#cb1259-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb1259-12"><a href="solutions.html#cb1259-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1259-13"><a href="solutions.html#cb1259-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">250</span>)</span>
<span id="cb1259-14"><a href="solutions.html#cb1259-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Some airlines (e.g. EV) appear to have a larger spread than others</span></span>
<span id="cb1259-15"><a href="solutions.html#cb1259-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1259-16"><a href="solutions.html#cb1259-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights2, <span class="fu">aes</span>(dep_delay, carrier, <span class="at">fill =</span> carrier)) <span class="sc">+</span></span>
<span id="cb1259-17"><a href="solutions.html#cb1259-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb1259-18"><a href="solutions.html#cb1259-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1259-19"><a href="solutions.html#cb1259-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">100</span>)</span>
<span id="cb1259-20"><a href="solutions.html#cb1259-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Some airlines (e.g. EV) appear to have a larger spread others</span></span>
<span id="cb1259-21"><a href="solutions.html#cb1259-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1259-22"><a href="solutions.html#cb1259-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights2, <span class="fu">aes</span>(air_time, carrier, <span class="at">fill =</span> carrier)) <span class="sc">+</span></span>
<span id="cb1259-23"><a href="solutions.html#cb1259-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb1259-24"><a href="solutions.html#cb1259-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1259-25"><a href="solutions.html#cb1259-25" aria-hidden="true" tabindex="-1"></a><span class="co"># VX only do long-distance flights, whereas MQ, FL and 9E only do</span></span>
<span id="cb1259-26"><a href="solutions.html#cb1259-26" aria-hidden="true" tabindex="-1"></a><span class="co"># shorter flights</span></span>
<span id="cb1259-27"><a href="solutions.html#cb1259-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1259-28"><a href="solutions.html#cb1259-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Make scatterplots and label outliers with flight numbers</span></span>
<span id="cb1259-29"><a href="solutions.html#cb1259-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights2, <span class="fu">aes</span>(dep_delay, arr_delay, <span class="at">colour =</span> carrier)) <span class="sc">+</span></span>
<span id="cb1259-30"><a href="solutions.html#cb1259-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1259-31"><a href="solutions.html#cb1259-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">300</span>,</span>
<span id="cb1259-32"><a href="solutions.html#cb1259-32" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">paste</span>(<span class="st">&quot;Flight&quot;</span>, flight), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb1259-33"><a href="solutions.html#cb1259-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb1259-34"><a href="solutions.html#cb1259-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1259-35"><a href="solutions.html#cb1259-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights2, <span class="fu">aes</span>(air_time, arr_delay, <span class="at">colour =</span> carrier)) <span class="sc">+</span></span>
<span id="cb1259-36"><a href="solutions.html#cb1259-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1259-37"><a href="solutions.html#cb1259-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(air_time <span class="sc">&gt;</span> <span class="dv">400</span> <span class="sc">|</span> arr_delay <span class="sc">&gt;</span> <span class="dv">300</span>,</span>
<span id="cb1259-38"><a href="solutions.html#cb1259-38" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste</span>(<span class="st">&quot;Flight&quot;</span>, flight), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb1259-39"><a href="solutions.html#cb1259-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc15">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc1">4.9</a><a href="solutions.html#ch4solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To decrease the smoothness of the line, we use the <code>span</code> argument in <code>geom_smooth</code>. The default is <code>geom_smooth(span = 0.75)</code>. Decreasing this values yields a very different fit:</li>
</ol>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="solutions.html#cb1260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb1260-2"><a href="solutions.html#cb1260-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1260-3"><a href="solutions.html#cb1260-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">span =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1260-4"><a href="solutions.html#cb1260-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1260-5"><a href="solutions.html#cb1260-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb1260-6"><a href="solutions.html#cb1260-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>More smoothing is probably preferable in this case. The relationship appears to be fairly weak, and appears to be roughly linear.</p>
<ol start="2" style="list-style-type: decimal">
<li>We can use the <code>method</code> argument in <code>geom_smooth</code> to fit a straight line using <code>lm</code> instead of LOESS:</li>
</ol>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="solutions.html#cb1261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb1261-2"><a href="solutions.html#cb1261-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1261-3"><a href="solutions.html#cb1261-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb1261-4"><a href="solutions.html#cb1261-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1261-5"><a href="solutions.html#cb1261-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb1261-6"><a href="solutions.html#cb1261-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>To remove the confidence interval from the plot, we set <code>se = FALSE</code> in <code>geom_smooth</code>:</li>
</ol>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="solutions.html#cb1262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb1262-2"><a href="solutions.html#cb1262-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1262-3"><a href="solutions.html#cb1262-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1262-4"><a href="solutions.html#cb1262-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1262-5"><a href="solutions.html#cb1262-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb1262-6"><a href="solutions.html#cb1262-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Finally, we can change the colour of the smoothing line using the <code>colour</code> argument:</li>
</ol>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="solutions.html#cb1263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb1263-2"><a href="solutions.html#cb1263-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1263-3"><a href="solutions.html#cb1263-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1263-4"><a href="solutions.html#cb1263-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1263-5"><a href="solutions.html#cb1263-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb1263-6"><a href="solutions.html#cb1263-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc2">4.10</a><a href="solutions.html#ch4solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Adding the <code>geom_smooth</code> geom with the default settings produces a trend line that does not capture seasonality:</li>
</ol>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="solutions.html#cb1264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10) <span class="sc">+</span></span>
<span id="cb1264-2"><a href="solutions.html#cb1264-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can change the axes labels using <code>xlab</code> and <code>ylab</code>:</li>
</ol>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1265-1"><a href="solutions.html#cb1265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10) <span class="sc">+</span></span>
<span id="cb1265-2"><a href="solutions.html#cb1265-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb1265-3"><a href="solutions.html#cb1265-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb1265-4"><a href="solutions.html#cb1265-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales ($ million)&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>ggtitle</code> adds a title to the figure:</li>
</ol>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="solutions.html#cb1266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10) <span class="sc">+</span></span>
<span id="cb1266-2"><a href="solutions.html#cb1266-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb1266-3"><a href="solutions.html#cb1266-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb1266-4"><a href="solutions.html#cb1266-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales ($ million)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1266-5"><a href="solutions.html#cb1266-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Anti-diabetic drug sales in Australia&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The <code>colour</code> argument can be passed to <code>autoplot</code> to change the colour of the time series line:</li>
</ol>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="solutions.html#cb1267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1267-2"><a href="solutions.html#cb1267-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb1267-3"><a href="solutions.html#cb1267-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb1267-4"><a href="solutions.html#cb1267-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales ($ million)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1267-5"><a href="solutions.html#cb1267-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Anti-diabetic drug sales in Australia&quot;</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc3">4.11</a><a href="solutions.html#ch4solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The text can be added by using <code>annotate(geom = "text", ...)</code>. In order not to draw the text on top of the circle, you can shift the x-value of the text (the appropriate shift depends on the size of your plot window):</li>
</ol>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="solutions.html#cb1268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gold) <span class="sc">+</span></span>
<span id="cb1268-2"><a href="solutions.html#cb1268-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">x =</span> spike_date, <span class="at">y =</span> gold[spike_date], </span>
<span id="cb1268-3"><a href="solutions.html#cb1268-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb1268-4"><a href="solutions.html#cb1268-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>) <span class="sc">+</span></span>
<span id="cb1268-5"><a href="solutions.html#cb1268-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> spike_date <span class="sc">-</span> <span class="dv">100</span>,</span>
<span id="cb1268-6"><a href="solutions.html#cb1268-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> gold[spike_date], </span>
<span id="cb1268-7"><a href="solutions.html#cb1268-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">&quot;Incorrect value!&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can remove the erroneous value by replacing it with <code>NA</code> in the time series:</li>
</ol>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="solutions.html#cb1269-1" aria-hidden="true" tabindex="-1"></a>gold[spike_date] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1269-2"><a href="solutions.html#cb1269-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gold)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we can add a reference line using <code>geom_hline</code>:</li>
</ol>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="solutions.html#cb1270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gold) <span class="sc">+</span></span>
<span id="cb1270-2"><a href="solutions.html#cb1270-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">400</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc4">4.12</a><a href="solutions.html#ch4solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We can specify which variables to include in the plot as follows:</li>
</ol>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="solutions.html#cb1271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily[, <span class="fu">c</span>(<span class="st">&quot;Demand&quot;</span>, <span class="st">&quot;Temperature&quot;</span>)], <span class="at">facets =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>This produces a terrible-looking label for the y-axis, which we can remove by setting the y-label to <code>NULL</code>:</p>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="solutions.html#cb1272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily[, <span class="fu">c</span>(<span class="st">&quot;Demand&quot;</span>, <span class="st">&quot;Temperature&quot;</span>)], <span class="at">facets =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1272-2"><a href="solutions.html#cb1272-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>As before, we can add smoothers using <code>geom_smooth</code>:</li>
</ol>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="solutions.html#cb1273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily[, <span class="fu">c</span>(<span class="st">&quot;Demand&quot;</span>, <span class="st">&quot;Temperature&quot;</span>)], <span class="at">facets =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1273-2"><a href="solutions.html#cb1273-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb1273-3"><a href="solutions.html#cb1273-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc5">4.13</a><a href="solutions.html#ch4solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We set the size of the points using <code>geom_point(size)</code>:</li>
</ol>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1274-1"><a href="solutions.html#cb1274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elecdaily2, <span class="fu">aes</span>(Temperature, Demand, <span class="at">colour =</span> day)) <span class="sc">+</span></span>
<span id="cb1274-2"><a href="solutions.html#cb1274-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1274-3"><a href="solutions.html#cb1274-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To add annotations, we use <code>annotate</code> and some code to find the days of the lowest and highest temperatures:</li>
</ol>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="solutions.html#cb1275-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Lowest temperature</span></span>
<span id="cb1275-2"><a href="solutions.html#cb1275-2" aria-hidden="true" tabindex="-1"></a>lowest <span class="ot">&lt;-</span> <span class="fu">which.min</span>(elecdaily2<span class="sc">$</span>Temperature)</span>
<span id="cb1275-3"><a href="solutions.html#cb1275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1275-4"><a href="solutions.html#cb1275-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Highest temperature</span></span>
<span id="cb1275-5"><a href="solutions.html#cb1275-5" aria-hidden="true" tabindex="-1"></a>highest <span class="ot">&lt;-</span> <span class="fu">which.max</span>(elecdaily2<span class="sc">$</span>Temperature)</span>
<span id="cb1275-6"><a href="solutions.html#cb1275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1275-7"><a href="solutions.html#cb1275-7" aria-hidden="true" tabindex="-1"></a><span class="do">## We shift the y-values of the text so that it appears above</span></span>
<span id="cb1275-8"><a href="solutions.html#cb1275-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the points</span></span>
<span id="cb1275-9"><a href="solutions.html#cb1275-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elecdaily2, <span class="fu">aes</span>(Temperature, Demand, <span class="at">colour =</span> day)) <span class="sc">+</span></span>
<span id="cb1275-10"><a href="solutions.html#cb1275-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1275-11"><a href="solutions.html#cb1275-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb1275-12"><a href="solutions.html#cb1275-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> elecdaily2<span class="sc">$</span>Temperature[lowest],</span>
<span id="cb1275-13"><a href="solutions.html#cb1275-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> elecdaily2<span class="sc">$</span>Demand[lowest] <span class="sc">+</span> <span class="dv">4</span>, </span>
<span id="cb1275-14"><a href="solutions.html#cb1275-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> elecdaily2<span class="sc">$</span>day[lowest]) <span class="sc">+</span></span>
<span id="cb1275-15"><a href="solutions.html#cb1275-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> elecdaily2<span class="sc">$</span>Temperature[highest],</span>
<span id="cb1275-16"><a href="solutions.html#cb1275-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> elecdaily2<span class="sc">$</span>Demand[highest] <span class="sc">+</span> <span class="dv">4</span>, </span>
<span id="cb1275-17"><a href="solutions.html#cb1275-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> elecdaily2<span class="sc">$</span>day[highest])</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc6">4.14</a><a href="solutions.html#ch4solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can specify <code>aes(group)</code> <em>for a particular geom only</em> as follows:</p>
<div class="sourceCode" id="cb1276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1276-1"><a href="solutions.html#cb1276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height, <span class="at">colour =</span> Subject)) <span class="sc">+</span> </span>
<span id="cb1276-2"><a href="solutions.html#cb1276-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1276-3"><a href="solutions.html#cb1276-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> Subject)) <span class="sc">+</span></span>
<span id="cb1276-4"><a href="solutions.html#cb1276-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><code>Subject</code> is now used for grouping the points used to draw the lines (i.e. for <code>geom_line</code>), but not for <code>geom_smooth</code>, which now uses all the points to create a trend line showing the average height of the boys over time.</p>
<p><a href="eda.html#exr:ch4exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc7">4.15</a><a href="solutions.html#ch4solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Code for producing the three plots is given below:</p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="solutions.html#cb1277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fma)</span>
<span id="cb1277-2"><a href="solutions.html#cb1277-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1277-3"><a href="solutions.html#cb1277-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot</span></span>
<span id="cb1277-4"><a href="solutions.html#cb1277-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(writing) <span class="sc">+</span></span>
<span id="cb1277-5"><a href="solutions.html#cb1277-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb1277-6"><a href="solutions.html#cb1277-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales (francs)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1277-7"><a href="solutions.html#cb1277-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Sales of printing and writing paper&quot;</span>)</span>
<span id="cb1277-8"><a href="solutions.html#cb1277-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1277-9"><a href="solutions.html#cb1277-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal plot</span></span>
<span id="cb1277-10"><a href="solutions.html#cb1277-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(writing, <span class="at">year.labels =</span> <span class="cn">TRUE</span>, <span class="at">year.labels.left =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1277-11"><a href="solutions.html#cb1277-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales (francs)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1277-12"><a href="solutions.html#cb1277-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Seasonal plot of sales of printing and writing paper&quot;</span>)</span>
<span id="cb1277-13"><a href="solutions.html#cb1277-13" aria-hidden="true" tabindex="-1"></a><span class="co"># There is a huge dip in sales in August, when many French offices are</span></span>
<span id="cb1277-14"><a href="solutions.html#cb1277-14" aria-hidden="true" tabindex="-1"></a><span class="co"># closed due to holidays.</span></span>
<span id="cb1277-15"><a href="solutions.html#cb1277-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1277-16"><a href="solutions.html#cb1277-16" aria-hidden="true" tabindex="-1"></a><span class="co"># stl-decomposition</span></span>
<span id="cb1277-17"><a href="solutions.html#cb1277-17" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">stl</span>(writing, <span class="at">s.window =</span> <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb1277-18"><a href="solutions.html#cb1277-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Seasonal decomposition of paper sales time series&quot;</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions75" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc75">4.16</a><a href="solutions.html#ch4solutions75" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the <code>cpt.var</code> functions with the default settings:</p>
<div class="sourceCode" id="cb1278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1278-1"><a href="solutions.html#cb1278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1278-2"><a href="solutions.html#cb1278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb1278-3"><a href="solutions.html#cb1278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(changepoint)</span>
<span id="cb1278-4"><a href="solutions.html#cb1278-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1278-5"><a href="solutions.html#cb1278-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1278-6"><a href="solutions.html#cb1278-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the time series:</span></span>
<span id="cb1278-7"><a href="solutions.html#cb1278-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily[,<span class="st">&quot;Demand&quot;</span>])</span>
<span id="cb1278-8"><a href="solutions.html#cb1278-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1278-9"><a href="solutions.html#cb1278-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot points where there are changes in the variance:</span></span>
<span id="cb1278-10"><a href="solutions.html#cb1278-10" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cpt.var</span>(elecdaily[,<span class="st">&quot;Demand&quot;</span>]))</span></code></pre></div>
<p>The variance is greater in the beginning of the year, and then appears to be more or less constant. Perhaps this can be explained by temperature?</p>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1279-1"><a href="solutions.html#cb1279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the time series:</span></span>
<span id="cb1279-2"><a href="solutions.html#cb1279-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily[,<span class="st">&quot;Temperature&quot;</span>])</span></code></pre></div>
<p>We see that the high-variance period coincides with peaks and large oscillations in temperature, which would cause the energy demand to increase and decrease more than usual, making the variance greater.</p>
<p><a href="eda.html#exr:ch4exc75">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions75b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc75b">4.17</a><a href="solutions.html#ch4solutions75b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>By adding a copy of the observation for month 12, with the <code>Month</code> value replaced by 0, we can connect the endpoints to form a continuous curve:</p>
<div class="sourceCode" id="cb1280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1280-1"><a href="solutions.html#cb1280-1" aria-hidden="true" tabindex="-1"></a>Cape_Town_weather[<span class="dv">13</span>,] <span class="ot">&lt;-</span> Cape_Town_weather[<span class="dv">12</span>,]</span>
<span id="cb1280-2"><a href="solutions.html#cb1280-2" aria-hidden="true" tabindex="-1"></a>Cape_Town_weather<span class="sc">$</span>Month[<span class="dv">13</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1280-3"><a href="solutions.html#cb1280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1280-4"><a href="solutions.html#cb1280-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Cape_Town_weather, <span class="fu">aes</span>(Month, Temp_C)) <span class="sc">+</span></span>
<span id="cb1280-5"><a href="solutions.html#cb1280-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1280-6"><a href="solutions.html#cb1280-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb1280-7"><a href="solutions.html#cb1280-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">12</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc75b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions16" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc16">4.18</a><a href="solutions.html#ch4solutions16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As for all <code>ggplot2</code> plots, we can use <code>ggtitle</code> to add a title to the plot:</p>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="solutions.html#cb1281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)],</span>
<span id="cb1281-2"><a href="solutions.html#cb1281-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">colour =</span> diamonds<span class="sc">$</span>cut, <span class="at">alpha =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1281-3"><a href="solutions.html#cb1281-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Numeric variables in the diamonds dataset&quot;</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc16">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions17" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc17">4.19</a><a href="solutions.html#ch4solutions17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We create the correlogram using <code>ggcorr</code> as follows:</li>
</ol>
<div class="sourceCode" id="cb1282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1282-1"><a href="solutions.html#cb1282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)])</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>method</code> allows us to control which correlation coefficient to use:</li>
</ol>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="solutions.html#cb1283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)],</span>
<span id="cb1283-2"><a href="solutions.html#cb1283-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;pairwise&quot;</span>, <span class="st">&quot;spearman&quot;</span>))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>nbreaks</code> is used to create a categorical colour scale:</li>
</ol>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1284-1"><a href="solutions.html#cb1284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)],</span>
<span id="cb1284-2"><a href="solutions.html#cb1284-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;pairwise&quot;</span>, <span class="st">&quot;spearman&quot;</span>),</span>
<span id="cb1284-3"><a href="solutions.html#cb1284-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">nbreaks =</span> <span class="dv">5</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><code>low</code> and <code>high</code> can be used to control the colours at the endpoints of the scale:</li>
</ol>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="solutions.html#cb1285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)],</span>
<span id="cb1285-2"><a href="solutions.html#cb1285-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;pairwise&quot;</span>, <span class="st">&quot;spearman&quot;</span>),</span>
<span id="cb1285-3"><a href="solutions.html#cb1285-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">nbreaks =</span> <span class="dv">5</span>,</span>
<span id="cb1285-4"><a href="solutions.html#cb1285-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">high =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>(Yes, the default colours are a better choice!)</p>
<p><a href="eda.html#exr:ch4exc17">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions18" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc18">4.20</a><a href="solutions.html#ch4solutions18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We replace <code>colour = vore</code> in the <code>aes</code> by <code>fill = vore</code> and add <code>colour = "black", shape = 21</code> to <code>geom_point</code>. The points now get black borders, which makes them a bit sharper:</li>
</ol>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1286-1"><a href="solutions.html#cb1286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">fill =</span> vore, <span class="at">size =</span> bodywt)) <span class="sc">+</span></span>
<span id="cb1286-2"><a href="solutions.html#cb1286-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1286-3"><a href="solutions.html#cb1286-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;log(Brain weight)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1286-4"><a href="solutions.html#cb1286-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sleep total (h)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1286-5"><a href="solutions.html#cb1286-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1286-6"><a href="solutions.html#cb1286-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">trans =</span> <span class="st">&quot;sqrt&quot;</span>,</span>
<span id="cb1286-7"><a href="solutions.html#cb1286-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">name =</span> <span class="st">&quot;Square root of</span><span class="sc">\n</span><span class="st">body weight&quot;</span>) <span class="sc">+</span></span>
<span id="cb1286-8"><a href="solutions.html#cb1286-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Feeding behaviour&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can use <code>ggplotly</code> to create an interactive version of the plot. Adding <code>text</code> to the <code>aes</code> allows us to include more information when hovering points:</li>
</ol>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1287-1"><a href="solutions.html#cb1287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1287-2"><a href="solutions.html#cb1287-2" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">fill =</span> vore,</span>
<span id="cb1287-3"><a href="solutions.html#cb1287-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">size =</span> bodywt, <span class="at">text =</span> name)) <span class="sc">+</span></span>
<span id="cb1287-4"><a href="solutions.html#cb1287-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1287-5"><a href="solutions.html#cb1287-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;log(Brain weight)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1287-6"><a href="solutions.html#cb1287-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sleep total (h)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1287-7"><a href="solutions.html#cb1287-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1287-8"><a href="solutions.html#cb1287-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">trans =</span> <span class="st">&quot;sqrt&quot;</span>,</span>
<span id="cb1287-9"><a href="solutions.html#cb1287-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">name =</span> <span class="st">&quot;Square root of</span><span class="sc">\n</span><span class="st">body weight&quot;</span>) <span class="sc">+</span></span>
<span id="cb1287-10"><a href="solutions.html#cb1287-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Feeding behaviour&quot;</span>)</span>
<span id="cb1287-11"><a href="solutions.html#cb1287-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1287-12"><a href="solutions.html#cb1287-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc18">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions19" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc19">4.21</a><a href="solutions.html#ch4solutions19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We create the tile plot using <code>geom_tile</code>. By setting <code>fun = max</code> we obtain the highest price in each bin:</li>
</ol>
<div class="sourceCode" id="cb1288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1288-1"><a href="solutions.html#cb1288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth, <span class="at">z =</span> price)) <span class="sc">+</span></span>
<span id="cb1288-2"><a href="solutions.html#cb1288-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;summary_2d&quot;</span>, <span class="at">fun =</span> max) <span class="sc">+</span></span>
<span id="cb1288-3"><a href="solutions.html#cb1288-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Highest prices for diamonds with different depths</span></span>
<span id="cb1288-4"><a href="solutions.html#cb1288-4" aria-hidden="true" tabindex="-1"></a><span class="st">              and tables&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can create the bin plot using either <code>geom_bin2d</code> or <code>geom_hex</code>:</li>
</ol>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1289-1"><a href="solutions.html#cb1289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb1289-2"><a href="solutions.html#cb1289-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>Diamonds with carat around 0.3 and price around 1000 have the highest bin counts.</p>
<p><a href="eda.html#exr:ch4exc19">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions20" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc20">4.22</a><a href="solutions.html#ch4solutions20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>VS2 and Ideal is the most common combination:</li>
</ol>
<div class="sourceCode" id="cb1290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1290-1"><a href="solutions.html#cb1290-1" aria-hidden="true" tabindex="-1"></a>diamonds2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(carat <span class="sc">~</span> cut <span class="sc">+</span> clarity, <span class="at">data =</span> diamonds,</span>
<span id="cb1290-2"><a href="solutions.html#cb1290-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> length)</span>
<span id="cb1290-3"><a href="solutions.html#cb1290-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds2)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Count&quot;</span></span>
<span id="cb1290-4"><a href="solutions.html#cb1290-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(clarity, cut, <span class="at">fill =</span> Count)) <span class="sc">+</span></span>
<span id="cb1290-5"><a href="solutions.html#cb1290-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>As for continuous variables, we can use <code>geom_tile</code> with the arguments <code>stat = "summary_2d", fun = mean</code> to display the average prices for different combinations. SI2 and Premium is the combination with the highest average price:</li>
</ol>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1291-1"><a href="solutions.html#cb1291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(clarity, cut, <span class="at">z =</span> price)) <span class="sc">+</span></span>
<span id="cb1291-2"><a href="solutions.html#cb1291-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;summary_2d&quot;</span>, <span class="at">fun =</span> mean) <span class="sc">+</span></span>
<span id="cb1291-3"><a href="solutions.html#cb1291-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Mean prices for diamonds with different</span></span>
<span id="cb1291-4"><a href="solutions.html#cb1291-4" aria-hidden="true" tabindex="-1"></a><span class="st">              clarities and cuts&quot;</span>)</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc20">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions21" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc21">4.23</a><a href="solutions.html#ch4solutions21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We create the scatterplot using:</li>
</ol>
<div class="sourceCode" id="cb1292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1292-1"><a href="solutions.html#cb1292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb1292-2"><a href="solutions.html#cb1292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1292-3"><a href="solutions.html#cb1292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1292-4"><a href="solutions.html#cb1292-4" aria-hidden="true" tabindex="-1"></a>gapminder2007 <span class="ot">&lt;-</span> gapminder[gapminder<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2007</span>,]</span>
<span id="cb1292-5"><a href="solutions.html#cb1292-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1292-6"><a href="solutions.html#cb1292-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(gapminder2007[, <span class="fu">c</span>(<span class="st">&quot;lifeExp&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>)],</span>
<span id="cb1292-7"><a href="solutions.html#cb1292-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">colour =</span> gapminder2007<span class="sc">$</span>continent, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb1292-8"><a href="solutions.html#cb1292-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">&quot;na&quot;</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The interactive facetted bubble plot is created using:</li>
</ol>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="solutions.html#cb1293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1293-2"><a href="solutions.html#cb1293-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1293-3"><a href="solutions.html#cb1293-3" aria-hidden="true" tabindex="-1"></a>gapminder2007 <span class="ot">&lt;-</span> gapminder[gapminder<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2007</span>,]</span>
<span id="cb1293-4"><a href="solutions.html#cb1293-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1293-5"><a href="solutions.html#cb1293-5" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gapminder2007, <span class="fu">aes</span>(gdpPercap, lifeExp, <span class="at">size =</span> pop,</span>
<span id="cb1293-6"><a href="solutions.html#cb1293-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colour =</span> country)) <span class="sc">+</span></span>
<span id="cb1293-7"><a href="solutions.html#cb1293-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1293-8"><a href="solutions.html#cb1293-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1293-9"><a href="solutions.html#cb1293-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb1293-10"><a href="solutions.html#cb1293-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> country_colors) <span class="sc">+</span></span>
<span id="cb1293-11"><a href="solutions.html#cb1293-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1293-12"><a href="solutions.html#cb1293-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> continent)</span>
<span id="cb1293-13"><a href="solutions.html#cb1293-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1293-14"><a href="solutions.html#cb1293-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>Well done, you just visualised 5 variables in a facetted bubble plot!</p>
<p><a href="eda.html#exr:ch4exc21">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions22" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc22">4.24</a><a href="solutions.html#ch4solutions22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Fixed wing multi engine Boeings are the most common planes:</li>
</ol>
<div class="sourceCode" id="cb1294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1294-1"><a href="solutions.html#cb1294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb1294-2"><a href="solutions.html#cb1294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1294-3"><a href="solutions.html#cb1294-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1294-4"><a href="solutions.html#cb1294-4" aria-hidden="true" tabindex="-1"></a>planes2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(tailnum <span class="sc">~</span> type <span class="sc">+</span> manufacturer, <span class="at">data =</span> planes,</span>
<span id="cb1294-5"><a href="solutions.html#cb1294-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> length)</span>
<span id="cb1294-6"><a href="solutions.html#cb1294-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1294-7"><a href="solutions.html#cb1294-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(planes2, <span class="fu">aes</span>(type, manufacturer, <span class="at">fill =</span> tailnum)) <span class="sc">+</span></span>
<span id="cb1294-8"><a href="solutions.html#cb1294-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The fixed wing multi engine Airbus has the highest average number of seats:</li>
</ol>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="solutions.html#cb1295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(planes, <span class="fu">aes</span>(type, manufacturer, <span class="at">z =</span> seats)) <span class="sc">+</span></span>
<span id="cb1295-2"><a href="solutions.html#cb1295-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;summary_2d&quot;</span>, <span class="at">fun =</span> mean) <span class="sc">+</span></span>
<span id="cb1295-3"><a href="solutions.html#cb1295-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Number of seats for different planes&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>The number of seats seems to have increased in the 1980’s, and then reached a plateau:</li>
</ol>
<div class="sourceCode" id="cb1296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1296-1"><a href="solutions.html#cb1296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(planes, <span class="fu">aes</span>(year, seats)) <span class="sc">+</span></span>
<span id="cb1296-2"><a href="solutions.html#cb1296-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> engine)) <span class="sc">+</span></span>
<span id="cb1296-3"><a href="solutions.html#cb1296-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>()</span></code></pre></div>
<p>The plane with the largest number of seats is not an Airbus, but a Boeing 747-451. It can be found using <code>planes[which.max(planes$seats),]</code> or visually using <code>plotly</code>:</p>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="solutions.html#cb1297-1" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(planes, <span class="fu">aes</span>(year, seats,</span>
<span id="cb1297-2"><a href="solutions.html#cb1297-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Tail number:&quot;</span>, tailnum,</span>
<span id="cb1297-3"><a href="solutions.html#cb1297-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;&lt;br&gt;Manufacturer:&quot;</span>,</span>
<span id="cb1297-4"><a href="solutions.html#cb1297-4" aria-hidden="true" tabindex="-1"></a>                                          manufacturer))) <span class="sc">+</span></span>
<span id="cb1297-5"><a href="solutions.html#cb1297-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> engine)) <span class="sc">+</span></span>
<span id="cb1297-6"><a href="solutions.html#cb1297-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>()</span>
<span id="cb1297-7"><a href="solutions.html#cb1297-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1297-8"><a href="solutions.html#cb1297-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Finally, we can investigate what engines were used during different time periods in several ways, for instance by differentiating engines by colour in our previous plot:</li>
</ol>
<div class="sourceCode" id="cb1298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1298-1"><a href="solutions.html#cb1298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(planes, <span class="fu">aes</span>(year, seats)) <span class="sc">+</span></span>
<span id="cb1298-2"><a href="solutions.html#cb1298-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> engine)) <span class="sc">+</span></span>
<span id="cb1298-3"><a href="solutions.html#cb1298-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>()</span></code></pre></div>
<p><a href="eda.html#exr:ch4exc22">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions23" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc23">4.25</a><a href="solutions.html#ch4solutions23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we compute the principal components:</p>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1299-1"><a href="solutions.html#cb1299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1299-2"><a href="solutions.html#cb1299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1299-3"><a href="solutions.html#cb1299-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute principal components:</span></span>
<span id="cb1299-4"><a href="solutions.html#cb1299-4" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(diamonds[, <span class="fu">which</span>(<span class="fu">sapply</span>(diamonds, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)],</span>
<span id="cb1299-5"><a href="solutions.html#cb1299-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>To see the proportion of variance explained by each component, we use <code>summary</code>:</li>
</ol>
<div class="sourceCode" id="cb1300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1300-1"><a href="solutions.html#cb1300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code></pre></div>
<p>The first PC accounts for 65.5 % of the total variance. The first two account for 86.9 % and the first three account for 98.3 % of the total variance, meaning that 3 components are needed to account for at least 90 % of the total variance.</p>
<ol start="2" style="list-style-type: decimal">
<li>To see the loadings, we type:</li>
</ol>
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1301-1"><a href="solutions.html#cb1301-1" aria-hidden="true" tabindex="-1"></a>pca</span></code></pre></div>
<p>The first PC appears to measure size: it is dominated by <code>carat</code>, <code>x</code>, <code>y</code> and <code>z</code>, which all are size measurements. The second PC appears is dominated by <code>depth</code> and <code>table</code> and is therefore a summary of those measures.</p>
<ol start="3" style="list-style-type: decimal">
<li>To compute the correlation, we use <code>cor</code>:</li>
</ol>
<div class="sourceCode" id="cb1302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1302-1"><a href="solutions.html#cb1302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], diamonds<span class="sc">$</span>price)</span></code></pre></div>
<p>The (Pearson) correlation is 0.89, which is fairly high. Size is clearly correlated to price!</p>
<ol start="4" style="list-style-type: decimal">
<li>To see if the first two principal components be used to distinguish between diamonds with different cuts, we make a scatterplot:</li>
</ol>
<div class="sourceCode" id="cb1303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1303-1"><a href="solutions.html#cb1303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> diamonds, <span class="at">colour =</span> <span class="st">&quot;cut&quot;</span>)</span></code></pre></div>
<p>The points are mostly gathered in one large cloud. Apart from the fact that very large or very small values of the second PC indicates that a diamond has a Fair cut, the first two principal components seem to offer little information about a diamond’s cut.</p>
<p><a href="eda.html#exr:ch4exc23">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions24" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc24">4.26</a><a href="solutions.html#ch4solutions24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We create the scatterplot with the added arguments:</p>
<div class="sourceCode" id="cb1304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1304-1"><a href="solutions.html#cb1304-1" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1304-2"><a href="solutions.html#cb1304-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1304-3"><a href="solutions.html#cb1304-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1304-4"><a href="solutions.html#cb1304-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1304-5"><a href="solutions.html#cb1304-5" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span>
<span id="cb1304-6"><a href="solutions.html#cb1304-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1304-7"><a href="solutions.html#cb1304-7" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(seeds[,<span class="sc">-</span><span class="dv">8</span>], <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1304-8"><a href="solutions.html#cb1304-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1304-9"><a href="solutions.html#cb1304-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1304-10"><a href="solutions.html#cb1304-10" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> <span class="st">&quot;Variety&quot;</span>,</span>
<span id="cb1304-11"><a href="solutions.html#cb1304-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The arrows for <code>Area</code>, <code>Perimeter</code>, <code>Kernel_length</code>, <code>Kernel_width</code> and <code>Groove_length</code> are all about the same length and are close to parallel the x-axis, which shows that these have similar impact on the first principal component but not the second, making the first component a measure of size. <code>Asymmetry</code> and <code>Compactness</code> both affect the second component, making it a measure of shape. <code>Compactness</code> also affects the first component, but not as much as the size variables do.</p>
<p><a href="eda.html#exr:ch4exc24">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions25" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc25">4.27</a><a href="solutions.html#ch4solutions25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We change the <code>hc_method</code> and <code>hc_metric</code> arguments to use complete linkage and the Manhattan distance:</p>
<div class="sourceCode" id="cb1305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1305-1"><a href="solutions.html#cb1305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1305-2"><a href="solutions.html#cb1305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1305-3"><a href="solutions.html#cb1305-3" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1305-4"><a href="solutions.html#cb1305-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb1305-5"><a href="solutions.html#cb1305-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;complete&quot;</span>,</span>
<span id="cb1305-6"><a href="solutions.html#cb1305-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;manhattan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1305-7"><a href="solutions.html#cb1305-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_dend</span>()</span></code></pre></div>
<p><code>fviz_dend</code> produces <code>ggplot2</code> plots. We can save the plots from both approaches and then plot them side-by-side using <code>patchwork</code> as in Section <a href="eda.html#patchwork">4.3.4</a>:</p>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1306-1"><a href="solutions.html#cb1306-1" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1306-2"><a href="solutions.html#cb1306-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb1306-3"><a href="solutions.html#cb1306-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;average&quot;</span>,</span>
<span id="cb1306-4"><a href="solutions.html#cb1306-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1306-5"><a href="solutions.html#cb1306-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_dend</span>() <span class="ot">-&gt;</span> dendro1</span>
<span id="cb1306-6"><a href="solutions.html#cb1306-6" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1306-7"><a href="solutions.html#cb1306-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb1306-8"><a href="solutions.html#cb1306-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;complete&quot;</span>,</span>
<span id="cb1306-9"><a href="solutions.html#cb1306-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;manhattan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1306-10"><a href="solutions.html#cb1306-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_dend</span>() <span class="ot">-&gt;</span> dendro2</span>
<span id="cb1306-11"><a href="solutions.html#cb1306-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1306-12"><a href="solutions.html#cb1306-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1306-13"><a href="solutions.html#cb1306-13" aria-hidden="true" tabindex="-1"></a>dendro1 <span class="sc">/</span> dendro2</span></code></pre></div>
<p>Alaska and Vermont are clustered together in both cases. The red leftmost cluster is similar but not identical, including Alabama, Georgia and Louisiana.</p>
<p>To compare the two dendrograms in a different way, we can use <code>tanglegram</code>. Setting <code>k_labels = 5</code> and <code>k_branches = 5</code> gives us 5 coloured clusters:</p>
<div class="sourceCode" id="cb1307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1307-1"><a href="solutions.html#cb1307-1" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1307-2"><a href="solutions.html#cb1307-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb1307-3"><a href="solutions.html#cb1307-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;average&quot;</span>,</span>
<span id="cb1307-4"><a href="solutions.html#cb1307-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="ot">-&gt;</span> clust1</span>
<span id="cb1307-5"><a href="solutions.html#cb1307-5" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1307-6"><a href="solutions.html#cb1307-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb1307-7"><a href="solutions.html#cb1307-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;complete&quot;</span>,</span>
<span id="cb1307-8"><a href="solutions.html#cb1307-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;manhattan&quot;</span>) <span class="ot">-&gt;</span> clust2</span>
<span id="cb1307-9"><a href="solutions.html#cb1307-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1307-10"><a href="solutions.html#cb1307-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb1307-11"><a href="solutions.html#cb1307-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(<span class="fu">as.dendrogram</span>(clust1), </span>
<span id="cb1307-12"><a href="solutions.html#cb1307-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.dendrogram</span>(clust2),</span>
<span id="cb1307-13"><a href="solutions.html#cb1307-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">k_labels =</span> <span class="dv">5</span>,</span>
<span id="cb1307-14"><a href="solutions.html#cb1307-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">k_branches =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>Note that the colours of the lines connecting the two dendrograms are unrelated to the colours of the clusters.</p>
<p><a href="eda.html#exr:ch4exc25">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions25b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc25b">4.28</a><a href="solutions.html#ch4solutions25b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the default settings in <code>agnes</code>, we can do the clustering using:</p>
<div class="sourceCode" id="cb1308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1308-1"><a href="solutions.html#cb1308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1308-2"><a href="solutions.html#cb1308-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1308-3"><a href="solutions.html#cb1308-3" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1308-4"><a href="solutions.html#cb1308-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">agnes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1308-5"><a href="solutions.html#cb1308-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot</span>(<span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Maryland is clustered with New Mexico, Michigan and Arizona, in that order.</p>
<p><a href="eda.html#exr:ch4exc25b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions25c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc25c">4.29</a><a href="solutions.html#ch4solutions25c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We draw a heatmap, with the data standardised in the column direction because we wish to cluster the observations rather than the variables:</p>
<div class="sourceCode" id="cb1309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1309-1"><a href="solutions.html#cb1309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1309-2"><a href="solutions.html#cb1309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1309-3"><a href="solutions.html#cb1309-3" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="fu">heatmap</span>(<span class="at">scale =</span> <span class="st">&quot;col&quot;</span>)</span></code></pre></div>
<p>You may want to increase the height of your Plot window so that the names of all states are displayed properly.</p>
<p>The heatmap shows that Maryland, and the states similar to it, has higher crime rates than most other states. There are a few other states with high crime rates in other clusters, but those tend to only have a high rate for one crime (e.g. Georgia, which has a very high murder rate), whereas states in the cluster that Maryland is in have high rates for all or almost all types of violent crime.</p>
<p><a href="eda.html#exr:ch4exc25c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions26" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc26">4.30</a><a href="solutions.html#ch4solutions26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we inspect the data:</p>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1310-1"><a href="solutions.html#cb1310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1310-2"><a href="solutions.html#cb1310-2" aria-hidden="true" tabindex="-1"></a>?chorSub</span>
<span id="cb1310-3"><a href="solutions.html#cb1310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1310-4"><a href="solutions.html#cb1310-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot matrix:</span></span>
<span id="cb1310-5"><a href="solutions.html#cb1310-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1310-6"><a href="solutions.html#cb1310-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(chorSub)</span></code></pre></div>
<p>There are a few outliers, so it may be a good idea to use <code>pam</code> as it is less affected by outliers than <code>kmeans</code>. Next, we draw some plots to help use choose <span class="math inline">\(k\)</span>:</p>
<div class="sourceCode" id="cb1311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1311-1"><a href="solutions.html#cb1311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1311-2"><a href="solutions.html#cb1311-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1311-3"><a href="solutions.html#cb1311-3" aria-hidden="true" tabindex="-1"></a>chorSub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1311-4"><a href="solutions.html#cb1311-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(pam, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>)</span>
<span id="cb1311-5"><a href="solutions.html#cb1311-5" aria-hidden="true" tabindex="-1"></a>chorSub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1311-6"><a href="solutions.html#cb1311-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(pam, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>)</span>
<span id="cb1311-7"><a href="solutions.html#cb1311-7" aria-hidden="true" tabindex="-1"></a>chorSub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1311-8"><a href="solutions.html#cb1311-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(pam, <span class="at">method =</span> <span class="st">&quot;gap&quot;</span>)</span></code></pre></div>
<p>There is no pronounced elbow in the WSS plot, although slight changes appear to occur at <span class="math inline">\(k=3\)</span> and <span class="math inline">\(k=7\)</span>. Judging by the silhouette plot, <span class="math inline">\(k=3\)</span> may be a good choice, while the gap statistic indicates that <span class="math inline">\(k=7\)</span> would be preferable. Let’s try both values:</p>
<div class="sourceCode" id="cb1312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1312-1"><a href="solutions.html#cb1312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k = 3:</span></span>
<span id="cb1312-2"><a href="solutions.html#cb1312-2" aria-hidden="true" tabindex="-1"></a>chorSub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1312-3"><a href="solutions.html#cb1312-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pam</span>(<span class="at">k =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> kola_cluster</span>
<span id="cb1312-4"><a href="solutions.html#cb1312-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(kola_cluster, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>)</span>
<span id="cb1312-5"><a href="solutions.html#cb1312-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1312-6"><a href="solutions.html#cb1312-6" aria-hidden="true" tabindex="-1"></a><span class="co"># k = 7:</span></span>
<span id="cb1312-7"><a href="solutions.html#cb1312-7" aria-hidden="true" tabindex="-1"></a>chorSub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1312-8"><a href="solutions.html#cb1312-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pam</span>(<span class="at">k =</span> <span class="dv">7</span>) <span class="ot">-&gt;</span> kola_cluster</span>
<span id="cb1312-9"><a href="solutions.html#cb1312-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(kola_cluster, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>)</span></code></pre></div>
<p>Neither choice is clearly superior. Remember that clustering is an exploratory procedure, that we use to try to better understand our data.</p>
<p>The plot for <span class="math inline">\(k=7\)</span> may look a little strange, with two largely overlapping clusters. Bear in mind though, that the clustering algorithm uses all 10 variables and not just the first two principal components, which are what is shown in the plot. The differences between the two clusters isn’t captured by the first two principal components.</p>
<p><a href="eda.html#exr:ch4exc26">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions27" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc27">4.31</a><a href="solutions.html#ch4solutions27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we try to find a good number of clusters:</p>
<div class="sourceCode" id="cb1313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1313-1"><a href="solutions.html#cb1313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1313-2"><a href="solutions.html#cb1313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1313-3"><a href="solutions.html#cb1313-3" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1313-4"><a href="solutions.html#cb1313-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(fanny, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>)</span>
<span id="cb1313-5"><a href="solutions.html#cb1313-5" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1313-6"><a href="solutions.html#cb1313-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(fanny, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>)</span></code></pre></div>
<p>We’ll go with <span class="math inline">\(k=2\)</span> clusters:</p>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1314-1"><a href="solutions.html#cb1314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1314-2"><a href="solutions.html#cb1314-2" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1314-3"><a href="solutions.html#cb1314-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fanny</span>(<span class="at">k =</span> <span class="dv">2</span>) <span class="ot">-&gt;</span> USAclusters</span>
<span id="cb1314-4"><a href="solutions.html#cb1314-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1314-5"><a href="solutions.html#cb1314-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show memberships:</span></span>
<span id="cb1314-6"><a href="solutions.html#cb1314-6" aria-hidden="true" tabindex="-1"></a>USAclusters<span class="sc">$</span>membership</span></code></pre></div>
<p>Maryland is mostly associated with the first cluster. Its neighbouring state New Jersey is equally associated with both clusters.</p>
<p><a href="eda.html#exr:ch4exc27">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions28" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc28">4.32</a><a href="solutions.html#ch4solutions28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We do the clustering and plot the resulting clusters:</p>
<div class="sourceCode" id="cb1315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1315-1"><a href="solutions.html#cb1315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1315-2"><a href="solutions.html#cb1315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb1315-3"><a href="solutions.html#cb1315-3" aria-hidden="true" tabindex="-1"></a>kola_cluster <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(<span class="fu">scale</span>(chorSub))</span>
<span id="cb1315-4"><a href="solutions.html#cb1315-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(kola_cluster)</span>
<span id="cb1315-5"><a href="solutions.html#cb1315-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1315-6"><a href="solutions.html#cb1315-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results with ellipsoids:</span></span>
<span id="cb1315-7"><a href="solutions.html#cb1315-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1315-8"><a href="solutions.html#cb1315-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(kola_cluster, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">ellipse.type =</span> <span class="st">&quot;norm&quot;</span>)</span></code></pre></div>
<p>Three clusters, that overlap substantially when the first two principal components are plotted, are found.</p>
<p><a href="eda.html#exr:ch4exc28">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions29" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc29">4.33</a><a href="solutions.html#ch4solutions29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we have a look at the data:</p>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1316-1"><a href="solutions.html#cb1316-1" aria-hidden="true" tabindex="-1"></a>?ability.cov</span>
<span id="cb1316-2"><a href="solutions.html#cb1316-2" aria-hidden="true" tabindex="-1"></a>ability.cov</span></code></pre></div>
<p>We can imagine several different latent variables that could explain how well the participants performed in these tests: general ability, visual ability, verbal ability, and so on. Let’s use a scree plot to determine how many factors to use:</p>
<div class="sourceCode" id="cb1317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1317-1"><a href="solutions.html#cb1317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1317-2"><a href="solutions.html#cb1317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scree</span>(ability.cov<span class="sc">$</span>cov, <span class="at">pc =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>2 or 3 factors seem like a good choice here. Let’s try both:</p>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="solutions.html#cb1318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2-factor model:</span></span>
<span id="cb1318-2"><a href="solutions.html#cb1318-2" aria-hidden="true" tabindex="-1"></a>ab_fa2 <span class="ot">&lt;-</span> <span class="fu">fa</span>(ability.cov<span class="sc">$</span>cov, <span class="at">nfactors =</span> <span class="dv">2</span>,</span>
<span id="cb1318-3"><a href="solutions.html#cb1318-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">rotate =</span> <span class="st">&quot;oblimin&quot;</span>, <span class="at">fm =</span> <span class="st">&quot;ml&quot;</span>)</span>
<span id="cb1318-4"><a href="solutions.html#cb1318-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(ab_fa2, <span class="at">simple =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1318-5"><a href="solutions.html#cb1318-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1318-6"><a href="solutions.html#cb1318-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3-factor model:</span></span>
<span id="cb1318-7"><a href="solutions.html#cb1318-7" aria-hidden="true" tabindex="-1"></a>ab_fa3 <span class="ot">&lt;-</span> <span class="fu">fa</span>(ability.cov<span class="sc">$</span>cov, <span class="at">nfactors =</span> <span class="dv">3</span>,</span>
<span id="cb1318-8"><a href="solutions.html#cb1318-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">rotate =</span> <span class="st">&quot;oblimin&quot;</span>, <span class="at">fm =</span> <span class="st">&quot;ml&quot;</span>)</span>
<span id="cb1318-9"><a href="solutions.html#cb1318-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(ab_fa3, <span class="at">simple =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>In the 2-factor model, one factor is primarily associated with the visual variables (which we interpret as the factor describing visual ability), whereas the other primarily is associated with reading and vocabulary (verbal ability). Both are associated with the measure of general intelligence.</p>
<p>In the 3-factor model, there is still a factor associated with reading and vocabulary. There are two factors associated with the visual tests: one with block design and mazes and one with picture completion and general intelligence.</p>
<p><a href="eda.html#exr:ch4exc29">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch4solutions30" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="eda.html#exr:ch4exc30">4.34</a><a href="solutions.html#ch4solutions30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we have a look at the data:</p>
<div class="sourceCode" id="cb1319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1319-1"><a href="solutions.html#cb1319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA)</span>
<span id="cb1319-2"><a href="solutions.html#cb1319-2" aria-hidden="true" tabindex="-1"></a>?cheating</span>
<span id="cb1319-3"><a href="solutions.html#cb1319-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(cheating)</span></code></pre></div>
<p>Next, we perform a latent class analysis with <code>GPA</code> as a covariate:</p>
<div class="sourceCode" id="cb1320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1320-1"><a href="solutions.html#cb1320-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(LIEEXAM, LIEPAPER,</span>
<span id="cb1320-2"><a href="solutions.html#cb1320-2" aria-hidden="true" tabindex="-1"></a>                 FRAUD, COPYEXAM) <span class="sc">~</span> GPA,</span>
<span id="cb1320-3"><a href="solutions.html#cb1320-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> cheating, <span class="at">nclass =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>The two classes roughly correspond to cheaters and non-cheaters. From the table showing the relationship with <code>GPA</code>, we see students with high GPA’s are less likely to be cheaters.</p>
<p><a href="eda.html#exr:ch4exc30">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="ch5solutions" class="section level2 unnumbered hasAnchor">
<h2>Chapter 5<a href="solutions.html#ch5solutions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch5solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc1">5.1</a><a href="solutions.html#ch5solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><code>as.logical</code> returns <code>FALSE</code> for <code>0</code> and <code>TRUE</code> for all other numbers:</li>
</ol>
<div class="sourceCode" id="cb1321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1321-1"><a href="solutions.html#cb1321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">0</span>)</span>
<span id="cb1321-2"><a href="solutions.html#cb1321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">1</span>)</span>
<span id="cb1321-3"><a href="solutions.html#cb1321-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">14</span>)</span>
<span id="cb1321-4"><a href="solutions.html#cb1321-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="sc">-</span><span class="fl">8.889</span>)</span>
<span id="cb1321-5"><a href="solutions.html#cb1321-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(pi<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="dv">18</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>When the <code>as.</code> functions are applied to vectors, they convert all values in the vector:</li>
</ol>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="solutions.html#cb1322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, pi, <span class="fu">sqrt</span>(<span class="dv">2</span>)))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>The <code>is.</code> functions return a <code>logical</code>: <code>TRUE</code> if the variable is of the type and <code>FALSE</code> otherwise:</li>
</ol>
<div class="sourceCode" id="cb1323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1323-1"><a href="solutions.html#cb1323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(<span class="dv">27</span>)</span>
<span id="cb1323-2"><a href="solutions.html#cb1323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(<span class="st">&quot;27&quot;</span>)</span>
<span id="cb1323-3"><a href="solutions.html#cb1323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(<span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The <code>is.</code> functions show that <code>NA</code> in fact is a (special type of) <code>logical</code>. This is also verified by the documentation for <code>NA</code>:</li>
</ol>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1324-1"><a href="solutions.html#cb1324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.logical</span>(<span class="cn">NA</span>)</span>
<span id="cb1324-2"><a href="solutions.html#cb1324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb1324-3"><a href="solutions.html#cb1324-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(<span class="cn">NA</span>)</span>
<span id="cb1324-4"><a href="solutions.html#cb1324-4" aria-hidden="true" tabindex="-1"></a>?<span class="cn">NA</span></span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions1b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc1b">5.2</a><a href="solutions.html#ch5solutions1b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path for <code>vas.csv</code> and load the data as in Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>:</p>
<div class="sourceCode" id="cb1325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1325-1"><a href="solutions.html#cb1325-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>To split the <code>VAS</code> vector by patient ID, we use <code>split</code>:</p>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1326-1"><a href="solutions.html#cb1326-1" aria-hidden="true" tabindex="-1"></a>vas_split <span class="ot">&lt;-</span> <span class="fu">split</span>(vas<span class="sc">$</span>VAS, vas<span class="sc">$</span>ID)</span></code></pre></div>
<p>To access the values for patient 212, either of the following works:</p>
<div class="sourceCode" id="cb1327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1327-1"><a href="solutions.html#cb1327-1" aria-hidden="true" tabindex="-1"></a>vas_split<span class="sc">$</span><span class="st">`</span><span class="at">212</span><span class="st">`</span></span>
<span id="cb1327-2"><a href="solutions.html#cb1327-2" aria-hidden="true" tabindex="-1"></a>vas_split[[<span class="dv">12</span>]]</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc1b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc2">5.3</a><a href="solutions.html#ch5solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To convert the proportions to percentages with one decimal place, we must first multiply them by 100 and then round them:</li>
</ol>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1328-1"><a href="solutions.html#cb1328-1" aria-hidden="true" tabindex="-1"></a>props <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1010</span>, <span class="fl">0.2546</span>, <span class="fl">0.6009</span>, <span class="fl">0.0400</span>, <span class="fl">0.0035</span>)</span>
<span id="cb1328-2"><a href="solutions.html#cb1328-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> props, <span class="dv">1</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The cumulative maxima and minima are computed using <code>cummax</code> and <code>cummin</code>:</li>
</ol>
<div class="sourceCode" id="cb1329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1329-1"><a href="solutions.html#cb1329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cummax</span>(airquality<span class="sc">$</span>Temp)</span>
<span id="cb1329-2"><a href="solutions.html#cb1329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cummin</span>(airquality<span class="sc">$</span>Temp)</span></code></pre></div>
<p>The minimum during the period occurs on the 5th day, whereas the maximum occurs during day 120.</p>
<ol start="3" style="list-style-type: decimal">
<li>To find runs of days with temperatures above 80, we use <code>rle</code>:</li>
</ol>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1330-1"><a href="solutions.html#cb1330-1" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">rle</span>(airquality<span class="sc">$</span>Temp <span class="sc">&gt;</span> <span class="dv">80</span>)</span></code></pre></div>
<p>To find runs with temperatures above 80, we extract the length of the runs for which <code>runs$values</code> is <code>TRUE</code>:</p>
<div class="sourceCode" id="cb1331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1331-1"><a href="solutions.html#cb1331-1" aria-hidden="true" tabindex="-1"></a>runs<span class="sc">$</span>lengths[runs<span class="sc">$</span>values <span class="sc">==</span> <span class="cn">TRUE</span>]</span></code></pre></div>
<p>We see that the longest run was 23 days.</p>
<p><a href="messychapter.html#exr:ch5exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc3">5.4</a><a href="solutions.html#ch5solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>On virtually all systems, the largest number that R can represent as a floating point is <code>1.797693e+308</code>. You can find this by gradually trying larger and larger numbers:</li>
</ol>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1332-1"><a href="solutions.html#cb1332-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1e+100</span></span>
<span id="cb1332-2"><a href="solutions.html#cb1332-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb1332-3"><a href="solutions.html#cb1332-3" aria-hidden="true" tabindex="-1"></a><span class="fl">1e+308</span></span>
<span id="cb1332-4"><a href="solutions.html#cb1332-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1e+309</span>  <span class="co"># The largest number must be between 1e+308 and 1e+309!</span></span>
<span id="cb1332-5"><a href="solutions.html#cb1332-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb1332-6"><a href="solutions.html#cb1332-6" aria-hidden="true" tabindex="-1"></a><span class="fl">1.797693e+308</span></span>
<span id="cb1332-7"><a href="solutions.html#cb1332-7" aria-hidden="true" tabindex="-1"></a><span class="fl">1.797694e+308</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>If we place the <code>^2</code> inside <code>sqrt</code> the result becomes 0:</li>
</ol>
<div class="sourceCode" id="cb1333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1333-1"><a href="solutions.html#cb1333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span>  <span class="co"># Not 0</span></span>
<span id="cb1333-2"><a href="solutions.html#cb1333-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> <span class="dv">2</span>  <span class="co"># 0</span></span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc4">5.5</a><a href="solutions.html#ch5solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We re-use the solution from Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a>:</p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="solutions.html#cb1334-1" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>TempCat <span class="ot">&lt;-</span> <span class="fu">cut</span>(airquality<span class="sc">$</span>Temp,</span>
<span id="cb1334-2"><a href="solutions.html#cb1334-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">110</span>))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we change the levels’ names:</li>
</ol>
<div class="sourceCode" id="cb1335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1335-1"><a href="solutions.html#cb1335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(airquality<span class="sc">$</span>TempCat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Moderate&quot;</span>, <span class="st">&quot;Hot&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Finally, we combine the last two levels:</li>
</ol>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1336-1"><a href="solutions.html#cb1336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(airquality<span class="sc">$</span>TempCat)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Hot&quot;</span></span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc5">5.6</a><a href="solutions.html#ch5solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>1 We start by converting the <code>vore</code> variable to a <code>factor</code>:</p>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1337-1"><a href="solutions.html#cb1337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1337-2"><a href="solutions.html#cb1337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(msleep) <span class="co"># vore is a character vector!</span></span>
<span id="cb1337-3"><a href="solutions.html#cb1337-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1337-4"><a href="solutions.html#cb1337-4" aria-hidden="true" tabindex="-1"></a>msleep<span class="sc">$</span>vore <span class="ot">&lt;-</span> <span class="fu">factor</span>(msleep<span class="sc">$</span>vore)</span>
<span id="cb1337-5"><a href="solutions.html#cb1337-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(msleep<span class="sc">$</span>vore)</span></code></pre></div>
<p>The levels are ordered alphabetically, which is the default in R.</p>
<ol start="2" style="list-style-type: decimal">
<li>To compute grouped means, we use <code>aggregate</code>:</li>
</ol>
<div class="sourceCode" id="cb1338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1338-1"><a href="solutions.html#cb1338-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sleep_total <span class="sc">~</span> vore, <span class="at">data =</span> msleep, <span class="at">FUN =</span> mean)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we sort the factor levels according to their <code>sleep_total</code> means:</li>
</ol>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1339-1"><a href="solutions.html#cb1339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check order:</span></span>
<span id="cb1339-2"><a href="solutions.html#cb1339-2" aria-hidden="true" tabindex="-1"></a>means</span>
<span id="cb1339-3"><a href="solutions.html#cb1339-3" aria-hidden="true" tabindex="-1"></a><span class="co"># New order: herbi, carni, omni, insecti.</span></span>
<span id="cb1339-4"><a href="solutions.html#cb1339-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1339-5"><a href="solutions.html#cb1339-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We could set the new order manually:</span></span>
<span id="cb1339-6"><a href="solutions.html#cb1339-6" aria-hidden="true" tabindex="-1"></a>msleep<span class="sc">$</span>vore <span class="ot">&lt;-</span> <span class="fu">factor</span>(msleep<span class="sc">$</span>vore,</span>
<span id="cb1339-7"><a href="solutions.html#cb1339-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;herbi&quot;</span>, <span class="st">&quot;carni&quot;</span>, <span class="st">&quot;omni&quot;</span>, <span class="st">&quot;insecti&quot;</span>))</span>
<span id="cb1339-8"><a href="solutions.html#cb1339-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1339-9"><a href="solutions.html#cb1339-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, rank and match can be used to get the new order of</span></span>
<span id="cb1339-10"><a href="solutions.html#cb1339-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the levels:</span></span>
<span id="cb1339-11"><a href="solutions.html#cb1339-11" aria-hidden="true" tabindex="-1"></a>?rank</span>
<span id="cb1339-12"><a href="solutions.html#cb1339-12" aria-hidden="true" tabindex="-1"></a>?match</span>
<span id="cb1339-13"><a href="solutions.html#cb1339-13" aria-hidden="true" tabindex="-1"></a>ranks <span class="ot">&lt;-</span> <span class="fu">rank</span>(means<span class="sc">$</span>sleep_total)</span>
<span id="cb1339-14"><a href="solutions.html#cb1339-14" aria-hidden="true" tabindex="-1"></a>new_order <span class="ot">&lt;-</span> <span class="fu">match</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ranks)</span>
<span id="cb1339-15"><a href="solutions.html#cb1339-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1339-16"><a href="solutions.html#cb1339-16" aria-hidden="true" tabindex="-1"></a>msleep<span class="sc">$</span>vore <span class="ot">&lt;-</span> <span class="fu">factor</span>(msleep<span class="sc">$</span>vore,</span>
<span id="cb1339-17"><a href="solutions.html#cb1339-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">levels</span>(msleep<span class="sc">$</span>vore)[new_order])</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc6">5.7</a><a href="solutions.html#ch5solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we set <code>file_path</code> to the path to <code>handkerchiefs.csv</code> and import it to the data frame <code>pricelist</code>:</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="solutions.html#cb1340-1" aria-hidden="true" tabindex="-1"></a>pricelist <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>nchar</code> counts the number of characters in strings:</li>
</ol>
<div class="sourceCode" id="cb1341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1341-1"><a href="solutions.html#cb1341-1" aria-hidden="true" tabindex="-1"></a>?nchar</span>
<span id="cb1341-2"><a href="solutions.html#cb1341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(pricelist<span class="sc">$</span>Italian.handkerchiefs)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can use <code>grep</code> and a regular expression to see that there are 2 rows of the <code>Italian.handkerchief</code> column that contain numbers:</li>
</ol>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1342-1"><a href="solutions.html#cb1342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;[[:digit:]]&quot;</span>, pricelist<span class="sc">$</span>Italian.handkerchiefs)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>To extract the prices in shillings (S) and pence (D) from the <code>Price</code> column and store these in two new <code>numeric</code> variables in our data frame, we use <code>strsplit</code>, <code>unlist</code> and <code>matrix</code> as follows:</li>
</ol>
<div class="sourceCode" id="cb1343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1343-1"><a href="solutions.html#cb1343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split strings at the space between the numbers and the letters:</span></span>
<span id="cb1343-2"><a href="solutions.html#cb1343-2" aria-hidden="true" tabindex="-1"></a>Price_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(pricelist<span class="sc">$</span>Price, <span class="st">&quot; &quot;</span>)</span>
<span id="cb1343-3"><a href="solutions.html#cb1343-3" aria-hidden="true" tabindex="-1"></a>Price_split <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Price_split)</span>
<span id="cb1343-4"><a href="solutions.html#cb1343-4" aria-hidden="true" tabindex="-1"></a>Price_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Price_split, <span class="at">nrow =</span> <span class="fu">length</span>(Price_split)<span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb1343-5"><a href="solutions.html#cb1343-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1343-6"><a href="solutions.html#cb1343-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1343-7"><a href="solutions.html#cb1343-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to the data frame:</span></span>
<span id="cb1343-8"><a href="solutions.html#cb1343-8" aria-hidden="true" tabindex="-1"></a>pricelist<span class="sc">$</span>PriceS <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Price_matrix[,<span class="dv">1</span>])</span>
<span id="cb1343-9"><a href="solutions.html#cb1343-9" aria-hidden="true" tabindex="-1"></a>pricelist<span class="sc">$</span>PriceD <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Price_matrix[,<span class="dv">3</span>])</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions65" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc65">5.8</a><a href="solutions.html#ch5solutions65" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>oslo-biomarkers.xlsx</code> and load the data:</p>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1344-1"><a href="solutions.html#cb1344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1344-2"><a href="solutions.html#cb1344-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1344-3"><a href="solutions.html#cb1344-3" aria-hidden="true" tabindex="-1"></a>oslo <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.xlsx</span>(file_path))</span></code></pre></div>
<p>To find out how many patients were included in the study, we use <code>strsplit</code> to split the ID-timepoint string, and then <code>unique</code>:</p>
<div class="sourceCode" id="cb1345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1345-1"><a href="solutions.html#cb1345-1" aria-hidden="true" tabindex="-1"></a>oslo_id <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(oslo<span class="sc">$</span><span class="st">&quot;PatientID.timepoint&quot;</span>, <span class="st">&quot;-&quot;</span>))</span>
<span id="cb1345-2"><a href="solutions.html#cb1345-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1345-3"><a href="solutions.html#cb1345-3" aria-hidden="true" tabindex="-1"></a>oslo_id_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(oslo_id, <span class="at">nrow =</span> <span class="fu">length</span>(oslo_id)<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb1345-4"><a href="solutions.html#cb1345-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1345-5"><a href="solutions.html#cb1345-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1345-6"><a href="solutions.html#cb1345-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(oslo_id_matrix[,<span class="dv">1</span>])</span>
<span id="cb1345-7"><a href="solutions.html#cb1345-7" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(oslo_id_matrix[,<span class="dv">1</span>]))</span></code></pre></div>
<p>We see that 118 patients were included in the study.</p>
<p><a href="messychapter.html#exr:ch5exc65">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc7">5.9</a><a href="solutions.html#ch5solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><code>"$g"</code> matches strings ending with <code>g</code>:</li>
</ol>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1346-1"><a href="solutions.html#cb1346-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;g$&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>"^[^[[:digit:]]"</code> matches strings beginning with anything but a digit:</li>
</ol>
<div class="sourceCode" id="cb1347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1347-1"><a href="solutions.html#cb1347-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;^[^[[:digit:]]&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>"a(s|l)"</code> matches strings containing either <code>as</code> or <code>al</code>:</li>
</ol>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="solutions.html#cb1348-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;a(s|l)&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><code>"[[:lower:]]+[.][[:lower:]]+"</code> matches strings containing any number of lowercase letters, followed by a period <code>.</code>, followed by any number of lowercase letters:</li>
</ol>
<div class="sourceCode" id="cb1349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1349-1"><a href="solutions.html#cb1349-1" aria-hidden="true" tabindex="-1"></a>contacts<span class="sc">$</span>Address[<span class="fu">grep</span>(<span class="st">&quot;[[:lower:]]+[.][[:lower:]]+&quot;</span>, contacts<span class="sc">$</span>Address)]</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions7b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc7b">5.10</a><a href="solutions.html#ch5solutions7b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We want to extract all words, i.e. segments of characters separated by white spaces. First, let’s create the string containing example sentences:</p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1350-1"><a href="solutions.html#cb1350-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;This is an example of a sentence, with 10 words. Here are 4 more!&quot;</span></span></code></pre></div>
<p>Next, we split the string at the spaces:</p>
<div class="sourceCode" id="cb1351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1351-1"><a href="solutions.html#cb1351-1" aria-hidden="true" tabindex="-1"></a>x_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(x, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<p>Note that <code>x_split</code> is a <code>list</code>. To turn this into a vector, we use <code>unlist</code></p>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1352-1"><a href="solutions.html#cb1352-1" aria-hidden="true" tabindex="-1"></a>x_split <span class="ot">&lt;-</span> <span class="fu">unlist</span>(x_split)</span></code></pre></div>
<p>Finally, we can use <code>gsub</code> to remove the punctuation marks, so that only the words remain:</p>
<div class="sourceCode" id="cb1353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1353-1"><a href="solutions.html#cb1353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, x_split)</span></code></pre></div>
<p>If you like, you can put all steps on a single row:</p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1354-1"><a href="solutions.html#cb1354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot; &quot;</span>)))</span></code></pre></div>
<p>…or reverse the order of the operations:</p>
<div class="sourceCode" id="cb1355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1355-1"><a href="solutions.html#cb1355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, x), <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc7b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions75" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc75">5.11</a><a href="solutions.html#ch5solutions75" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The functions are used to extract the weekday, month and quarter for each date:</li>
</ol>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1356-1"><a href="solutions.html#cb1356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weekdays</span>(dates)</span>
<span id="cb1356-2"><a href="solutions.html#cb1356-2" aria-hidden="true" tabindex="-1"></a><span class="fu">months</span>(dates)</span>
<span id="cb1356-3"><a href="solutions.html#cb1356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">quarters</span>(dates)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>julian</code> can be used to compute the number of days from a specific date (e.g. 1970-01-01) to each date in the vector:</li>
</ol>
<div class="sourceCode" id="cb1357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1357-1"><a href="solutions.html#cb1357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">julian</span>(dates, <span class="at">origin =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1970-01-01&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>))</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc75">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc8">5.12</a><a href="solutions.html#ch5solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>On most systems, converting the three variables to <code>Date</code> objects using <code>as.Date</code> yields correct dates <em>without times</em>:</li>
</ol>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1358-1"><a href="solutions.html#cb1358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">c</span>(time1, time2, time3))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We convert <code>time1</code> to a <code>Date</code> object and add <code>1</code> to it:</li>
</ol>
<div class="sourceCode" id="cb1359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1359-1"><a href="solutions.html#cb1359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(time1) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<p>The result is <code>2020-04-02</code>, i.e. adding <code>1</code> to the <code>Date</code> object has added 1 day to it.</p>
<ol start="3" style="list-style-type: decimal">
<li>We convert <code>time3</code> and <code>time1</code> to <code>Date</code> objects and subtract them:</li>
</ol>
<div class="sourceCode" id="cb1360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1360-1"><a href="solutions.html#cb1360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(time3) <span class="sc">-</span> <span class="fu">as.Date</span>(time1)</span></code></pre></div>
<p>The result is a <code>difftime</code> object, printed as <code>Time difference of 2 days</code>. Note that the times are ignored, just as before.</p>
<ol start="4" style="list-style-type: decimal">
<li>We convert <code>time2</code> and <code>time1</code> to <code>Date</code> objects and subtract them:</li>
</ol>
<div class="sourceCode" id="cb1361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1361-1"><a href="solutions.html#cb1361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(time2) <span class="sc">-</span> <span class="fu">as.Date</span>(time1)</span></code></pre></div>
<p>The result is printed as <code>Time difference of 0 days</code>, because the difference in time is ignored.</p>
<ol start="5" style="list-style-type: decimal">
<li>We convert the three variables to <code>POSIXct</code> date and time objects using <code>as.POSIXct</code> without specifying the date format:</li>
</ol>
<div class="sourceCode" id="cb1362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1362-1"><a href="solutions.html#cb1362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="fu">c</span>(time1, time2, time3))</span></code></pre></div>
<p>On most systems, this yields correctly displayed dates <em>and</em> times.</p>
<ol start="6" style="list-style-type: decimal">
<li>We convert <code>time3</code> and <code>time1</code> to <code>POSIXct</code> objects and subtract them:</li>
</ol>
<div class="sourceCode" id="cb1363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1363-1"><a href="solutions.html#cb1363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(time3) <span class="sc">-</span> <span class="fu">as.POSIXct</span>(time1)</span></code></pre></div>
<p>This time out, time is included when the difference is computed, and the output is <code>Time difference of 2.234722 days</code>.</p>
<ol start="7" style="list-style-type: decimal">
<li>We convert <code>time2</code> and <code>time1</code> to <code>POSIXct</code> objects and subtract them:</li>
</ol>
<div class="sourceCode" id="cb1364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1364-1"><a href="solutions.html#cb1364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(time2) <span class="sc">-</span> <span class="fu">as.POSIXct</span>(time1)</span></code></pre></div>
<p>In this case, the difference is presented in hours: <code>Time difference of 1.166667 hours</code>. In the next step, we take control over the units shown in the output.</p>
<ol start="8" style="list-style-type: decimal">
<li><code>difftime</code> can be used to control what units are used for expressing differences between two timepoints:</li>
</ol>
<div class="sourceCode" id="cb1365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1365-1"><a href="solutions.html#cb1365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">difftime</span>(<span class="fu">as.POSIXct</span>(time3), <span class="fu">as.POSIXct</span>(time1), <span class="at">units =</span> <span class="st">&quot;hours&quot;</span>)</span></code></pre></div>
<p>The out is <code>Time difference of 53.63333 hours</code>.</p>
<p><a href="messychapter.html#exr:ch5exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions8b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc8b">5.13</a><a href="solutions.html#ch5solutions8b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Using the first option, the <code>Date</code> becomes the <em>first</em> day of the quarter. Using the second option, it becomes the <em>last</em> day of the quarter instead. Both can be useful for presentation purposes - which you prefer is a matter of taste.</p></li>
<li><p>To convert the quarter-observations to the first day of their respective quarters, we use <code>as.yearqtr</code> as follows:</p></li>
</ol>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1366-1"><a href="solutions.html#cb1366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1366-2"><a href="solutions.html#cb1366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">as.yearqtr</span>(qvec2, <span class="at">format =</span> <span class="st">&quot;Q%q/%y&quot;</span>))</span>
<span id="cb1366-3"><a href="solutions.html#cb1366-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">as.yearqtr</span>(qvec3, <span class="at">format =</span> <span class="st">&quot;Q%q-%Y&quot;</span>))</span></code></pre></div>
<p><code>%q</code>, <code>%y</code>,and <code>%Y</code> are date tokens. The other letters and symbols in the <code>format</code> argument simply describe other characters included in the format.</p>
<p><a href="messychapter.html#exr:ch5exc8b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc9">5.14</a><a href="solutions.html#ch5solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The x-axis of the data can be changed in multiple ways. A simple approach is the following:</p>
<div class="sourceCode" id="cb1367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1367-1"><a href="solutions.html#cb1367-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a new data frame with the correct dates and the demand data:</span></span>
<span id="cb1367-2"><a href="solutions.html#cb1367-2" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2014-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2014-12-31&quot;</span>),</span>
<span id="cb1367-3"><a href="solutions.html#cb1367-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb1367-4"><a href="solutions.html#cb1367-4" aria-hidden="true" tabindex="-1"></a>elecdaily2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">dates =</span> dates, <span class="at">demand =</span> elecdaily[,<span class="dv">1</span>])</span>
<span id="cb1367-5"><a href="solutions.html#cb1367-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1367-6"><a href="solutions.html#cb1367-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elecdaily2, <span class="fu">aes</span>(dates, demand)) <span class="sc">+</span></span>
<span id="cb1367-7"><a href="solutions.html#cb1367-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span></code></pre></div>
<p>A more elegant approach relies on the <code>xts</code> package for time series:</p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1368-1"><a href="solutions.html#cb1368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb1368-2"><a href="solutions.html#cb1368-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert time series to an xts object:</span></span>
<span id="cb1368-3"><a href="solutions.html#cb1368-3" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2014-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2014-12-31&quot;</span>),</span>
<span id="cb1368-4"><a href="solutions.html#cb1368-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb1368-5"><a href="solutions.html#cb1368-5" aria-hidden="true" tabindex="-1"></a>elecdaily3 <span class="ot">&lt;-</span> <span class="fu">xts</span>(elecdaily, <span class="at">order.by =</span> dates)</span>
<span id="cb1368-6"><a href="solutions.html#cb1368-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1368-7"><a href="solutions.html#cb1368-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily3[,<span class="st">&quot;Demand&quot;</span>])</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc10">5.15</a><a href="solutions.html#ch5solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1369-1"><a href="solutions.html#cb1369-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First, create a data frame with better formatted dates</span></span>
<span id="cb1369-2"><a href="solutions.html#cb1369-2" aria-hidden="true" tabindex="-1"></a>a102 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(a10)</span>
<span id="cb1369-3"><a href="solutions.html#cb1369-3" aria-hidden="true" tabindex="-1"></a>a102<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;1991-07-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2008-06-01&quot;</span>),</span>
<span id="cb1369-4"><a href="solutions.html#cb1369-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb1369-5"><a href="solutions.html#cb1369-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1369-6"><a href="solutions.html#cb1369-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the plot object</span></span>
<span id="cb1369-7"><a href="solutions.html#cb1369-7" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(a102, <span class="fu">aes</span>(Date, x)) <span class="sc">+</span></span>
<span id="cb1369-8"><a href="solutions.html#cb1369-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1369-9"><a href="solutions.html#cb1369-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Sales&quot;</span>)</span>
<span id="cb1369-10"><a href="solutions.html#cb1369-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1369-11"><a href="solutions.html#cb1369-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the interactive plot</span></span>
<span id="cb1369-12"><a href="solutions.html#cb1369-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc11">5.16</a><a href="solutions.html#ch5solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path for <code>vas.csv</code> and read the data as in Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a> and convert it to a <code>data.table</code> (the last step being optional if we’re only using <code>dplyr</code> for this exercise):</p>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1370-1"><a href="solutions.html#cb1370-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb1370-2"><a href="solutions.html#cb1370-2" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(vas)</span></code></pre></div>
<p>A better option is to achieve the same result in a single line by using the <code>fread</code> function from <code>data.table</code>:</p>
<div class="sourceCode" id="cb1371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1371-1"><a href="solutions.html#cb1371-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we remove the columns <code>X</code> and <code>X.1</code>:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1372-1"><a href="solutions.html#cb1372-1" aria-hidden="true" tabindex="-1"></a>vas[, <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;X.1&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1373-1"><a href="solutions.html#cb1373-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>X, <span class="sc">-</span>X<span class="fl">.1</span>) <span class="ot">-&gt;</span> vas</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Second, we add a dummy variable called <code>highVAS</code> that indicates whether a patient’s <code>VAS</code> is 7 or greater on any given day:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1374-1"><a href="solutions.html#cb1374-1" aria-hidden="true" tabindex="-1"></a>vas[, highVAS <span class="sc">:</span><span class="er">=</span> VAS <span class="sc">&gt;=</span> <span class="dv">7</span>]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1375-1"><a href="solutions.html#cb1375-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">highVAS =</span> VAS <span class="sc">&gt;=</span> <span class="dv">7</span>) <span class="ot">-&gt;</span> vas</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc11">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions14" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc14">5.17</a><a href="solutions.html#ch5solutions14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We re-use the solution from Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a>:</p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1376-1"><a href="solutions.html#cb1376-1" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>TempCat <span class="ot">&lt;-</span> <span class="fu">cut</span>(airquality<span class="sc">$</span>Temp,</span>
<span id="cb1376-2"><a href="solutions.html#cb1376-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">110</span>))</span>
<span id="cb1376-3"><a href="solutions.html#cb1376-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1376-4"><a href="solutions.html#cb1376-4" aria-hidden="true" tabindex="-1"></a>aq <span class="ot">&lt;-</span> <span class="fu">data.table</span>(airquality)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we change the levels’ names:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1377-1"><a href="solutions.html#cb1377-1" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Moderate&quot;</span>,</span>
<span id="cb1377-2"><a href="solutions.html#cb1377-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Hot&quot;</span>)</span>
<span id="cb1377-3"><a href="solutions.html#cb1377-3" aria-hidden="true" tabindex="-1"></a>aq[.(<span class="at">TempCat =</span> <span class="fu">levels</span>(TempCat),</span>
<span id="cb1377-4"><a href="solutions.html#cb1377-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> new_names),</span>
<span id="cb1377-5"><a href="solutions.html#cb1377-5" aria-hidden="true" tabindex="-1"></a>       on <span class="ot">=</span> <span class="st">&quot;TempCat&quot;</span>,</span>
<span id="cb1377-6"><a href="solutions.html#cb1377-6" aria-hidden="true" tabindex="-1"></a>       TempCat <span class="sc">:</span><span class="er">=</span> i.to]</span>
<span id="cb1377-7"><a href="solutions.html#cb1377-7" aria-hidden="true" tabindex="-1"></a>aq[,TempCat <span class="sc">:</span><span class="er">=</span> <span class="fu">droplevels</span>(TempCat)]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1378-1"><a href="solutions.html#cb1378-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TempCat =</span> <span class="fu">recode</span>(TempCat,</span>
<span id="cb1378-2"><a href="solutions.html#cb1378-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;(50,70]&quot;</span> <span class="ot">=</span> <span class="st">&quot;Mild&quot;</span>,</span>
<span id="cb1378-3"><a href="solutions.html#cb1378-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;(70,90]&quot;</span> <span class="ot">=</span> <span class="st">&quot;Moderate&quot;</span>,</span>
<span id="cb1378-4"><a href="solutions.html#cb1378-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;(90,110]&quot;</span> <span class="ot">=</span> <span class="st">&quot;Hot&quot;</span>)) <span class="ot">-&gt;</span> aq</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Finally, we combine the last two levels:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1379-1"><a href="solutions.html#cb1379-1" aria-hidden="true" tabindex="-1"></a>aq[.(<span class="at">TempCat =</span> <span class="fu">c</span>(<span class="st">&quot;Moderate&quot;</span>, <span class="st">&quot;Hot&quot;</span>),</span>
<span id="cb1379-2"><a href="solutions.html#cb1379-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> <span class="st">&quot;Hot&quot;</span>),</span>
<span id="cb1379-3"><a href="solutions.html#cb1379-3" aria-hidden="true" tabindex="-1"></a>    on <span class="ot">=</span> <span class="st">&quot;TempCat&quot;</span>, TempCat <span class="sc">:</span><span class="er">=</span> i.to]</span>
<span id="cb1379-4"><a href="solutions.html#cb1379-4" aria-hidden="true" tabindex="-1"></a>aq[, TempCat <span class="sc">:</span><span class="er">=</span> <span class="fu">droplevels</span>(TempCat)]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1380-1"><a href="solutions.html#cb1380-1" aria-hidden="true" tabindex="-1"></a>aq <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TempCat =</span> <span class="fu">recode</span>(TempCat,</span>
<span id="cb1380-2"><a href="solutions.html#cb1380-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Moderate&quot;</span> <span class="ot">=</span> <span class="st">&quot;Hot&quot;</span>))</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc14">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions12" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc12">5.18</a><a href="solutions.html#ch5solutions12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path for <code>vas.csv</code> and read the data as in Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a> using <code>fread</code> to import it as a <code>data.table</code>:</p>
<div class="sourceCode" id="cb1381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1381-1"><a href="solutions.html#cb1381-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we compute the mean VAS for each patient:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1382-1"><a href="solutions.html#cb1382-1" aria-hidden="true" tabindex="-1"></a>vas[, <span class="fu">mean</span>(VAS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), ID]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1383-1"><a href="solutions.html#cb1383-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb1383-2"><a href="solutions.html#cb1383-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">meanVAS =</span> </span>
<span id="cb1383-3"><a href="solutions.html#cb1383-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean</span>(VAS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Next, we compute the lowest and highest VAS recorded for each patient:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="solutions.html#cb1384-1" aria-hidden="true" tabindex="-1"></a>vas[, .(<span class="at">min =</span> <span class="fu">min</span>(VAS,</span>
<span id="cb1384-2"><a href="solutions.html#cb1384-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1384-3"><a href="solutions.html#cb1384-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> <span class="fu">max</span>(VAS,</span>
<span id="cb1384-4"><a href="solutions.html#cb1384-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb1384-5"><a href="solutions.html#cb1384-5" aria-hidden="true" tabindex="-1"></a>        ID]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1385-1"><a href="solutions.html#cb1385-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb1385-2"><a href="solutions.html#cb1385-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">min =</span> <span class="fu">min</span>(VAS,</span>
<span id="cb1385-3"><a href="solutions.html#cb1385-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1385-4"><a href="solutions.html#cb1385-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">max =</span> <span class="fu">max</span>(VAS,</span>
<span id="cb1385-5"><a href="solutions.html#cb1385-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we compute the number of high-VAS days for each patient. We can compute the sum directly:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1386-1"><a href="solutions.html#cb1386-1" aria-hidden="true" tabindex="-1"></a>vas[, <span class="fu">sum</span>(VAS <span class="sc">&gt;=</span> <span class="dv">7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1386-2"><a href="solutions.html#cb1386-2" aria-hidden="true" tabindex="-1"></a>    ID]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1387-1"><a href="solutions.html#cb1387-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb1387-2"><a href="solutions.html#cb1387-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">highVASdays =</span> </span>
<span id="cb1387-3"><a href="solutions.html#cb1387-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(VAS <span class="sc">&gt;=</span> <span class="dv">7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<p>Alternatively, we can do this by first creating a dummy variable for high-VAS days:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1388-1"><a href="solutions.html#cb1388-1" aria-hidden="true" tabindex="-1"></a>vas[, highVAS <span class="sc">:</span><span class="er">=</span> VAS <span class="sc">&gt;=</span><span class="dv">7</span>]</span>
<span id="cb1388-2"><a href="solutions.html#cb1388-2" aria-hidden="true" tabindex="-1"></a>vas[, <span class="fu">sum</span>(highVAS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1388-3"><a href="solutions.html#cb1388-3" aria-hidden="true" tabindex="-1"></a>    ID]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1389-1"><a href="solutions.html#cb1389-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">highVAS =</span> VAS <span class="sc">&gt;=</span> <span class="dv">7</span>) <span class="ot">-&gt;</span> vas</span>
<span id="cb1389-2"><a href="solutions.html#cb1389-2" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb1389-3"><a href="solutions.html#cb1389-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">highVASdays =</span> <span class="fu">sum</span>(highVAS,</span>
<span id="cb1389-4"><a href="solutions.html#cb1389-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc12">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions13" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc13">5.19</a><a href="solutions.html#ch5solutions13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First we load the data and convert it to a <code>data.table</code> (the last step being optional if we’re only using <code>dplyr</code> for this exercise):</p>
<div class="sourceCode" id="cb1390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1390-1"><a href="solutions.html#cb1390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasauRus)</span>
<span id="cb1390-2"><a href="solutions.html#cb1390-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(datasaurus_dozen)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we compute summary statistics grouped by <code>dataset</code>:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1391-1"><a href="solutions.html#cb1391-1" aria-hidden="true" tabindex="-1"></a>dd[, .(<span class="at">mean_x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1391-2"><a href="solutions.html#cb1391-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb1391-3"><a href="solutions.html#cb1391-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_x =</span> <span class="fu">sd</span>(x),</span>
<span id="cb1391-4"><a href="solutions.html#cb1391-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_y =</span> <span class="fu">sd</span>(y),</span>
<span id="cb1391-5"><a href="solutions.html#cb1391-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">cor =</span> <span class="fu">cor</span>(x,y)),</span>
<span id="cb1391-6"><a href="solutions.html#cb1391-6" aria-hidden="true" tabindex="-1"></a>        dataset]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1392-1"><a href="solutions.html#cb1392-1" aria-hidden="true" tabindex="-1"></a>dd <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dataset) <span class="sc">%&gt;%</span></span>
<span id="cb1392-2"><a href="solutions.html#cb1392-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1392-3"><a href="solutions.html#cb1392-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_y =</span> <span class="fu">mean</span>(y),</span>
<span id="cb1392-4"><a href="solutions.html#cb1392-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_x =</span> <span class="fu">sd</span>(x),</span>
<span id="cb1392-5"><a href="solutions.html#cb1392-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_y =</span> <span class="fu">sd</span>(y),</span>
<span id="cb1392-6"><a href="solutions.html#cb1392-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cor =</span> <span class="fu">cor</span>(x,y))</span></code></pre></div>
</div>
</table>
<p>The summary statistics for all datasets are virtually identical.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we make scatterplots. Here is a solution using <code>ggplot2</code>:</li>
</ol>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1393-1"><a href="solutions.html#cb1393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1393-2"><a href="solutions.html#cb1393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datasaurus_dozen, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> dataset)) <span class="sc">+</span></span>
<span id="cb1393-3"><a href="solutions.html#cb1393-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1393-4"><a href="solutions.html#cb1393-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> dataset, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Clearly, the datasets are <em>very</em> different! This is a great example of how simply computing summary statistics is not enough. They tell a part of the story, yes, but only a part.</p>
<p><a href="messychapter.html#exr:ch5exc13">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions13b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc13b">5.20</a><a href="solutions.html#ch5solutions13b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path for <code>vas.csv</code> and read the data as in Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a> using <code>fread</code> to import it as a <code>data.table</code>:</p>
<div class="sourceCode" id="cb1394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1394-1"><a href="solutions.html#cb1394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1394-2"><a href="solutions.html#cb1394-2" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>To fill in the missing values, we can now do as follows:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1395-1"><a href="solutions.html#cb1395-1" aria-hidden="true" tabindex="-1"></a>vas[, Visit <span class="sc">:</span><span class="er">=</span> <span class="fu">nafill</span>(</span>
<span id="cb1395-2"><a href="solutions.html#cb1395-2" aria-hidden="true" tabindex="-1"></a>      Visit, <span class="st">&quot;locf&quot;</span>)]</span></code></pre></div>
</div>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1396-1"><a href="solutions.html#cb1396-1" aria-hidden="true" tabindex="-1"></a>vas <span class="sc">%&gt;%</span> <span class="fu">fill</span>(Visit)</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc13b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions15" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc15">5.21</a><a href="solutions.html#ch5solutions15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>ucdp-onesided-191.csv</code> and load the data as a <code>data.table</code> using <code>fread</code>:</p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1397-1"><a href="solutions.html#cb1397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1397-2"><a href="solutions.html#cb1397-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1397-3"><a href="solutions.html#cb1397-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1397-4"><a href="solutions.html#cb1397-4" aria-hidden="true" tabindex="-1"></a>ucdp <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we filter the rows so that only conflicts that took place in Colombia are retained.</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1398-1"><a href="solutions.html#cb1398-1" aria-hidden="true" tabindex="-1"></a>colombia <span class="ot">&lt;-</span> ucdp[location <span class="sc">==</span></span>
<span id="cb1398-2"><a href="solutions.html#cb1398-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Colombia&quot;</span>,]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1399-1"><a href="solutions.html#cb1399-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(location <span class="sc">==</span></span>
<span id="cb1399-2"><a href="solutions.html#cb1399-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Colombia&quot;</span>) <span class="ot">-&gt;</span> colombia</span></code></pre></div>
</div>
</table>
<p>To list the number of different actors responsible for attacks, we can use <code>unique</code>:</p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1400-1"><a href="solutions.html#cb1400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(colombia<span class="sc">$</span>actor_name)</span></code></pre></div>
<p>We see that there were attacks by 7 different actors during the period.</p>
<ol start="2" style="list-style-type: decimal">
<li>To find the number of fatalities caused by government attacks on civilians, we first filter the data to only retain rows where the actor name contains the word <em>government</em>:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1401-1"><a href="solutions.html#cb1401-1" aria-hidden="true" tabindex="-1"></a>gov <span class="ot">&lt;-</span> ucdp[actor_name <span class="sc">%like%</span></span>
<span id="cb1401-2"><a href="solutions.html#cb1401-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;[gG]overnment&quot;</span>,]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1402-1"><a href="solutions.html#cb1402-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;[gG]overnment&quot;</span>,</span>
<span id="cb1402-2"><a href="solutions.html#cb1402-2" aria-hidden="true" tabindex="-1"></a>                actor_name)</span>
<span id="cb1402-3"><a href="solutions.html#cb1402-3" aria-hidden="true" tabindex="-1"></a>                ) <span class="ot">-&gt;</span> gov</span></code></pre></div>
</div>
</table>
<p>It may be of interest to list the governments involved in attacks on civilians:</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1403-1"><a href="solutions.html#cb1403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(gov<span class="sc">$</span>actor_name)</span></code></pre></div>
<p>To estimate the number of fatalities cause by these attacks, we sum the fatalities from each attack:</p>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1404-1"><a href="solutions.html#cb1404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(gov<span class="sc">$</span>best_fatality_estimate)</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc15">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions16" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc16">5.22</a><a href="solutions.html#ch5solutions16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>oslo-biomarkers.xlsx</code> and load the data:</p>
<div class="sourceCode" id="cb1405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1405-1"><a href="solutions.html#cb1405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1405-2"><a href="solutions.html#cb1405-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1405-3"><a href="solutions.html#cb1405-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1405-4"><a href="solutions.html#cb1405-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1405-5"><a href="solutions.html#cb1405-5" aria-hidden="true" tabindex="-1"></a>oslo <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.xlsx</span>(file_path))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we select only the measurements from blood samples taken at 12 months. These are the only observations where the <code>PatientID.timepoint</code> column contains the word <code>months</code>:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1406-1"><a href="solutions.html#cb1406-1" aria-hidden="true" tabindex="-1"></a>oslo[PatientID.timepoint <span class="sc">%like%</span></span>
<span id="cb1406-2"><a href="solutions.html#cb1406-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;months&quot;</span>,]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1407-1"><a href="solutions.html#cb1407-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;months&quot;</span>,</span>
<span id="cb1407-2"><a href="solutions.html#cb1407-2" aria-hidden="true" tabindex="-1"></a>           PatientID.timepoint))</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Second, we select only the measurements from the patient with ID number 6. Note that we cannot simply search for strings containing a <code>6</code>, as we then also would find measurements from other patients taken at 6 weeks, as well as patients with a 6 in their ID number, e.g. patient 126. Instead, we search for strings beginning with <code>6-</code>:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1408-1"><a href="solutions.html#cb1408-1" aria-hidden="true" tabindex="-1"></a>oslo[PatientID.timepoint <span class="sc">%like%</span></span>
<span id="cb1408-2"><a href="solutions.html#cb1408-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;^6[-]&quot;</span>,]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1409-1"><a href="solutions.html#cb1409-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^6[-]&quot;</span>,</span>
<span id="cb1409-2"><a href="solutions.html#cb1409-2" aria-hidden="true" tabindex="-1"></a>           PatientID.timepoint))</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc16">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions17" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc17">5.23</a><a href="solutions.html#ch5solutions17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>ucdp-onesided-191.csv</code> and load the data as a <code>data.table</code> using <code>fread</code>:</p>
<div class="sourceCode" id="cb1410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1410-1"><a href="solutions.html#cb1410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1410-2"><a href="solutions.html#cb1410-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1410-3"><a href="solutions.html#cb1410-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1410-4"><a href="solutions.html#cb1410-4" aria-hidden="true" tabindex="-1"></a>ucdp <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path)</span></code></pre></div>
<p>Next, we select the <code>actor_name</code>, <code>year</code>, <code>best_fatality_estimate</code> and <code>location</code> columns:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1411-1"><a href="solutions.html#cb1411-1" aria-hidden="true" tabindex="-1"></a>ucdp[, .(actor_name, year,</span>
<span id="cb1411-2"><a href="solutions.html#cb1411-2" aria-hidden="true" tabindex="-1"></a>         best_fatality_estimate,</span>
<span id="cb1411-3"><a href="solutions.html#cb1411-3" aria-hidden="true" tabindex="-1"></a>         location)]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1412-1"><a href="solutions.html#cb1412-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="sc">%&gt;%</span> <span class="fu">select</span>(actor_name, year,</span>
<span id="cb1412-2"><a href="solutions.html#cb1412-2" aria-hidden="true" tabindex="-1"></a>          best_fatality_estimate,</span>
<span id="cb1412-3"><a href="solutions.html#cb1412-3" aria-hidden="true" tabindex="-1"></a>          location)</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc17">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions18" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc18">5.24</a><a href="solutions.html#ch5solutions18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>oslo-biomarkers.xlsx</code> and load the data:</p>
<div class="sourceCode" id="cb1413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1413-1"><a href="solutions.html#cb1413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1413-2"><a href="solutions.html#cb1413-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1413-3"><a href="solutions.html#cb1413-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1413-4"><a href="solutions.html#cb1413-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1413-5"><a href="solutions.html#cb1413-5" aria-hidden="true" tabindex="-1"></a>oslo <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.xlsx</span>(file_path))</span></code></pre></div>
<p>We then order the data by the <code>PatientID.timepoint</code> column:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1414-1"><a href="solutions.html#cb1414-1" aria-hidden="true" tabindex="-1"></a>oslo[<span class="fu">order</span>(PatientID.timepoint),]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1415-1"><a href="solutions.html#cb1415-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(PatientID.timepoint)</span></code></pre></div>
</div>
</table>
<p>Note that because <code>PatientID.timepoint</code> is a <code>character</code> column, the rows are now ordered in <em>alphabetical</em> order, meaning that patient 1 is followed by 100, 101, 102, and so on. To order the patients in <em>numerical</em> order, we must first split the ID and timepoints into two different columns. We’ll see how to do that in the next section, and try it out on the <code>oslo</code> data in Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a>.</p>
<p><a href="messychapter.html#exr:ch5exc18">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions19" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a><a href="solutions.html#ch5solutions19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>oslo-biomarkers.xlsx</code> and load the data:</p>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1416-1"><a href="solutions.html#cb1416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1416-2"><a href="solutions.html#cb1416-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1416-3"><a href="solutions.html#cb1416-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1416-4"><a href="solutions.html#cb1416-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1416-5"><a href="solutions.html#cb1416-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1416-6"><a href="solutions.html#cb1416-6" aria-hidden="true" tabindex="-1"></a>oslo <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.xlsx</span>(file_path))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we split the <code>PatientID.timepoint</code> column:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1417-1"><a href="solutions.html#cb1417-1" aria-hidden="true" tabindex="-1"></a>oslo[, <span class="fu">c</span>(<span class="st">&quot;PatientID&quot;</span>,</span>
<span id="cb1417-2"><a href="solutions.html#cb1417-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;timepoint&quot;</span>) <span class="sc">:</span><span class="er">=</span></span>
<span id="cb1417-3"><a href="solutions.html#cb1417-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tstrsplit</span>(PatientID.timepoint, <span class="st">&quot;-&quot;</span>,</span>
<span id="cb1417-4"><a href="solutions.html#cb1417-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1418-1"><a href="solutions.html#cb1418-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">separate</span>(PatientID.timepoint,</span>
<span id="cb1418-2"><a href="solutions.html#cb1418-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;PatientID&quot;</span>,</span>
<span id="cb1418-3"><a href="solutions.html#cb1418-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;timepoint&quot;</span>),</span>
<span id="cb1418-4"><a href="solutions.html#cb1418-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="ot">-&gt;</span> oslo</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Next, we reformat the patient ID to a <code>numeric</code> and sort the table:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1419-1"><a href="solutions.html#cb1419-1" aria-hidden="true" tabindex="-1"></a>oslo[, PatientID <span class="sc">:</span><span class="er">=</span></span>
<span id="cb1419-2"><a href="solutions.html#cb1419-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">as.numeric</span>(PatientID)]</span>
<span id="cb1419-3"><a href="solutions.html#cb1419-3" aria-hidden="true" tabindex="-1"></a>oslo[<span class="fu">order</span>(PatientID),]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1420-1"><a href="solutions.html#cb1420-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PatientID =</span></span>
<span id="cb1420-2"><a href="solutions.html#cb1420-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.numeric</span>(PatientID)) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-3"><a href="solutions.html#cb1420-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">arrange</span>(PatientID)</span></code></pre></div>
</div>
</table>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we reformat the data from long to wide, keeping the IL-8 and VEGF-A measurements. We store it as oslo2, knowing that we’ll need it again in Exercise <a href="messychapter.html#exr:ch5exc20">5.26</a>.</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1421-1"><a href="solutions.html#cb1421-1" aria-hidden="true" tabindex="-1"></a>oslo2 <span class="ot">&lt;-</span> <span class="fu">dcast</span>(oslo,</span>
<span id="cb1421-2"><a href="solutions.html#cb1421-2" aria-hidden="true" tabindex="-1"></a>          PatientID <span class="sc">~</span> timepoint,</span>
<span id="cb1421-3"><a href="solutions.html#cb1421-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">&quot;IL-8&quot;</span>, <span class="st">&quot;VEGF-A&quot;</span>))</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>tidyr</code>:</p>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1422-1"><a href="solutions.html#cb1422-1" aria-hidden="true" tabindex="-1"></a>oslo <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span></span>
<span id="cb1422-2"><a href="solutions.html#cb1422-2" aria-hidden="true" tabindex="-1"></a>                        PatientID,</span>
<span id="cb1422-3"><a href="solutions.html#cb1422-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">names_from =</span> timepoint,</span>
<span id="cb1422-4"><a href="solutions.html#cb1422-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">values_from =</span> </span>
<span id="cb1422-5"><a href="solutions.html#cb1422-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">&quot;IL-8&quot;</span>, <span class="st">&quot;VEGF-A&quot;</span>)</span>
<span id="cb1422-6"><a href="solutions.html#cb1422-6" aria-hidden="true" tabindex="-1"></a>           ) <span class="ot">-&gt;</span> oslo2</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc19">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions20" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc20">5.26</a><a href="solutions.html#ch5solutions20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the <code>oslo2</code> data frame that <a href="solutions.html#ch5solutions19">we created in Exercise <a href="messychapter.html#exr:ch5exc20">5.26</a></a>. In addition, we set <code>file_path</code> to the path to <code>oslo-covariates.xlsx</code> and load the data:</p>
<div class="sourceCode" id="cb1423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1423-1"><a href="solutions.html#cb1423-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1423-2"><a href="solutions.html#cb1423-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1423-3"><a href="solutions.html#cb1423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1423-4"><a href="solutions.html#cb1423-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1423-5"><a href="solutions.html#cb1423-5" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.xlsx</span>(file_path))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>First, we merge the wide data frame from Exercise <a href="messychapter.html#exr:ch5exc19">5.25</a> with the <code>oslo-covariates.xlsx</code> data, using patient ID as key. A left join, where we only keep data for patients with biomarker measurements, seems appropriate here. We see that both datasets have a column named <code>PatientID</code>, which we can use as our key.</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1424-1"><a href="solutions.html#cb1424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(oslo2, covar, </span>
<span id="cb1424-2"><a href="solutions.html#cb1424-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1424-3"><a href="solutions.html#cb1424-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;PatientID&quot;</span>)</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1425-1"><a href="solutions.html#cb1425-1" aria-hidden="true" tabindex="-1"></a>oslo2 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(covar,</span>
<span id="cb1425-2"><a href="solutions.html#cb1425-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">by =</span> <span class="st">&quot;PatientID&quot;</span>)</span></code></pre></div>
</div>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Next, we use the <code>oslo-covariates.xlsx</code> data to select data for smokers from the wide data frame using a semijoin. The <code>Smoker.(1=yes,.2=no)</code> column contains information about smoking habits. First we create a table for filtering:</li>
</ol>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1426-1"><a href="solutions.html#cb1426-1" aria-hidden="true" tabindex="-1"></a>filter_data <span class="ot">&lt;-</span></span>
<span id="cb1426-2"><a href="solutions.html#cb1426-2" aria-hidden="true" tabindex="-1"></a>  covar[<span class="st">`</span><span class="at">Smoker.(1=yes,.2=no)</span><span class="st">`</span></span>
<span id="cb1426-3"><a href="solutions.html#cb1426-3" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">==</span> <span class="dv">1</span>,]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1427-1"><a href="solutions.html#cb1427-1" aria-hidden="true" tabindex="-1"></a>covar <span class="sc">%&gt;%</span></span>
<span id="cb1427-2"><a href="solutions.html#cb1427-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Smoker.(1=yes,.2=no)</span><span class="st">`</span></span>
<span id="cb1427-3"><a href="solutions.html#cb1427-3" aria-hidden="true" tabindex="-1"></a>          <span class="sc">==</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> filter_data</span></code></pre></div>
</div>
</table>
<p>Next, we perform the semijoin:</p>
<table>
<div class="column-left">
<p>With <code>data.table</code>:</p>
<div class="sourceCode" id="cb1428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1428-1"><a href="solutions.html#cb1428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(oslo2, PatientID)</span>
<span id="cb1428-2"><a href="solutions.html#cb1428-2" aria-hidden="true" tabindex="-1"></a>oslo2[oslo2[filter_data,</span>
<span id="cb1428-3"><a href="solutions.html#cb1428-3" aria-hidden="true" tabindex="-1"></a>            which <span class="ot">=</span> <span class="cn">TRUE</span>]]</span></code></pre></div>
<table>
<div class="column-right">
<p>With <code>dplyr</code>:</p>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1429-1"><a href="solutions.html#cb1429-1" aria-hidden="true" tabindex="-1"></a>oslo2 <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(filter_data,</span>
<span id="cb1429-2"><a href="solutions.html#cb1429-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;PatientID&quot;</span>)</span></code></pre></div>
</div>
</table>
<p><a href="messychapter.html#exr:ch5exc20">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch5solutions21" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="messychapter.html#exr:ch5exc21">5.27</a><a href="solutions.html#ch5solutions21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We read the HTML file and extract the table:</p>
<div class="sourceCode" id="cb1430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1430-1"><a href="solutions.html#cb1430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1430-2"><a href="solutions.html#cb1430-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1430-3"><a href="solutions.html#cb1430-3" aria-hidden="true" tabindex="-1"></a>wiki <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_keytars&quot;</span>)</span>
<span id="cb1430-4"><a href="solutions.html#cb1430-4" aria-hidden="true" tabindex="-1"></a>keytars <span class="ot">&lt;-</span> <span class="fu">html_table</span>(<span class="fu">html_nodes</span>(wiki, <span class="st">&quot;table&quot;</span>)[[<span class="dv">1</span>]], <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We note that some non-numeric characters cause <code>Dates</code> to be a <code>character</code> vector:</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1431-1"><a href="solutions.html#cb1431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(keytars)</span>
<span id="cb1431-2"><a href="solutions.html#cb1431-2" aria-hidden="true" tabindex="-1"></a>keytars<span class="sc">$</span>Dates</span></code></pre></div>
<p>Noting that the first four characters in each element of the vector contain the year, we can use <code>substr</code> to only keep those characters. Finally, we use <code>as.numeric</code> to convert the text to numbers:</p>
<div class="sourceCode" id="cb1432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1432-1"><a href="solutions.html#cb1432-1" aria-hidden="true" tabindex="-1"></a>keytars<span class="sc">$</span>Dates <span class="ot">&lt;-</span> <span class="fu">substr</span>(keytars<span class="sc">$</span>Dates, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb1432-2"><a href="solutions.html#cb1432-2" aria-hidden="true" tabindex="-1"></a>keytars<span class="sc">$</span>Dates <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(keytars<span class="sc">$</span>Dates)</span>
<span id="cb1432-3"><a href="solutions.html#cb1432-3" aria-hidden="true" tabindex="-1"></a>keytars<span class="sc">$</span>Dates</span></code></pre></div>
<p><a href="messychapter.html#exr:ch5exc21">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="ch6solutions" class="section level2 unnumbered hasAnchor">
<h2>Chapter 6<a href="solutions.html#ch6solutions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch6solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc1">6.1</a><a href="solutions.html#ch6solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The formula for converting a temperature <span class="math inline">\(F\)</span> measured in Fahrenheit to a temperature <span class="math inline">\(C\)</span> measured in Celsius is $C=(F-32)*5/9. Our function becomes:</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1433-1"><a href="solutions.html#cb1433-1" aria-hidden="true" tabindex="-1"></a>FtoC <span class="ot">&lt;-</span> <span class="cf">function</span>(F)</span>
<span id="cb1433-2"><a href="solutions.html#cb1433-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1433-3"><a href="solutions.html#cb1433-3" aria-hidden="true" tabindex="-1"></a>    C <span class="ot">&lt;-</span> (F<span class="dv">-32</span>)<span class="sc">*</span><span class="dv">5</span><span class="sc">/</span><span class="dv">9</span></span>
<span id="cb1433-4"><a href="solutions.html#cb1433-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(C)</span>
<span id="cb1433-5"><a href="solutions.html#cb1433-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>To apply it to the <code>Temp</code> column of <code>airquality</code>:</p>
<div class="sourceCode" id="cb1434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1434-1"><a href="solutions.html#cb1434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FtoC</span>(airquality<span class="sc">$</span>Temp)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc2">6.2</a><a href="solutions.html#ch6solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We want out function to take a vector as input and return a vector containing its minimum and the maximum, without using <code>min</code> and <code>max</code>:</li>
</ol>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1435-1"><a href="solutions.html#cb1435-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1435-2"><a href="solutions.html#cb1435-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1435-3"><a href="solutions.html#cb1435-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sort x so that the minimum becomes the first element</span></span>
<span id="cb1435-4"><a href="solutions.html#cb1435-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and the maximum becomes the last element:</span></span>
<span id="cb1435-5"><a href="solutions.html#cb1435-5" aria-hidden="true" tabindex="-1"></a>      sorted_x <span class="ot">&lt;-</span> <span class="fu">sort</span>(x)</span>
<span id="cb1435-6"><a href="solutions.html#cb1435-6" aria-hidden="true" tabindex="-1"></a>      min_x <span class="ot">&lt;-</span> sorted_x[<span class="dv">1</span>]</span>
<span id="cb1435-7"><a href="solutions.html#cb1435-7" aria-hidden="true" tabindex="-1"></a>      max_x <span class="ot">&lt;-</span> sorted_x[<span class="fu">length</span>(sorted_x)]</span>
<span id="cb1435-8"><a href="solutions.html#cb1435-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(min_x, max_x))</span>
<span id="cb1435-9"><a href="solutions.html#cb1435-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1435-10"><a href="solutions.html#cb1435-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1435-11"><a href="solutions.html#cb1435-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1435-12"><a href="solutions.html#cb1435-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1435-13"><a href="solutions.html#cb1435-13" aria-hidden="true" tabindex="-1"></a><span class="fu">minmax</span>(x) <span class="co"># Should be 1 and 8</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We want a function that computes the mean of the squared values of a vector using <code>mean</code>, and that takes additional arguments that it passes on to <code>mean</code> (e.g. <code>na.rm</code>):</li>
</ol>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1436-1"><a href="solutions.html#cb1436-1" aria-hidden="true" tabindex="-1"></a>mean2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1436-2"><a href="solutions.html#cb1436-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1436-3"><a href="solutions.html#cb1436-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">mean</span>(x<span class="sc">^</span><span class="dv">2</span>, ...))</span>
<span id="cb1436-4"><a href="solutions.html#cb1436-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1436-5"><a href="solutions.html#cb1436-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-6"><a href="solutions.html#cb1436-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1436-7"><a href="solutions.html#cb1436-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1436-8"><a href="solutions.html#cb1436-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean2</span>(x) <span class="co"># Should be 14/3=4.666...</span></span>
<span id="cb1436-9"><a href="solutions.html#cb1436-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-10"><a href="solutions.html#cb1436-10" aria-hidden="true" tabindex="-1"></a><span class="co"># With NA:</span></span>
<span id="cb1436-11"><a href="solutions.html#cb1436-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb1436-12"><a href="solutions.html#cb1436-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean2</span>(x) <span class="co"># Should be NA</span></span>
<span id="cb1436-13"><a href="solutions.html#cb1436-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mean2</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># Should be 13/2=6.5</span></span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions2b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="#exr:ch6exc2b"><strong>??</strong></a><a href="solutions.html#ch6solutions2b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use <code>cat</code> to print a message about missing values, <code>sum(is.na(.))</code> to compute the number of missing values, <code>na.omit</code> to remove rows with missing data and then <code>summary</code> to print the summary:</p>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1437-1"><a href="solutions.html#cb1437-1" aria-hidden="true" tabindex="-1"></a>na_remove <span class="ot">&lt;-</span> . <span class="sc">%T&gt;%</span> {<span class="fu">cat</span>(<span class="st">&quot;Missing values:&quot;</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(.)), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)} <span class="sc">%&gt;%</span></span>
<span id="cb1437-2"><a href="solutions.html#cb1437-2" aria-hidden="true" tabindex="-1"></a>                    na.omit <span class="sc">%&gt;%</span> summary</span>
<span id="cb1437-3"><a href="solutions.html#cb1437-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1437-4"><a href="solutions.html#cb1437-4" aria-hidden="true" tabindex="-1"></a><span class="fu">na_remove</span>(airquality)</span></code></pre></div>
<p><a href="#exr:ch6exc2b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions2c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc2c">6.3</a><a href="solutions.html#ch6solutions2c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following operator allows us to plot <code>y</code> against <code>x</code>:</p>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1438-1"><a href="solutions.html#cb1438-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%against%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x) { <span class="fu">plot</span>(x, y) }</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1439-1"><a href="solutions.html#cb1439-1" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>Wind <span class="sc">%against%</span> airquality<span class="sc">$</span>Temp</span></code></pre></div>
<p>Or, if we want to use <code>ggplot2</code> instead of base graphics:</p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1440-1"><a href="solutions.html#cb1440-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1440-2"><a href="solutions.html#cb1440-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%against%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x) { </span>
<span id="cb1440-3"><a href="solutions.html#cb1440-3" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb1440-4"><a href="solutions.html#cb1440-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb1440-5"><a href="solutions.html#cb1440-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>()</span>
<span id="cb1440-6"><a href="solutions.html#cb1440-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1440-7"><a href="solutions.html#cb1440-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1440-8"><a href="solutions.html#cb1440-8" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>Wind <span class="sc">%against%</span> airquality<span class="sc">$</span>Temp</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc2c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc3">6.4</a><a href="solutions.html#ch6solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p><code>FALSE</code>: <code>x</code> is not greater than 2.</p></li>
<li><p><code>TRUE</code>: <code>|</code> means that at least one of the conditions need to be satisfied, and <code>x</code> is greater than <code>z</code>.</p></li>
<li><p><code>FALSE</code>: <code>&amp;</code> means that both conditions must be satisfied, and <code>x</code> is not greater than <code>y</code>.</p></li>
<li><p><code>TRUE</code>: the absolute value of <code>x*z</code> is 6, which is greater than <code>y</code>.</p></li>
</ol>
<p><a href="progchapter.html#exr:ch6exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc4">6.5</a><a href="solutions.html#ch6solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two errors: the variable name in <code>exists</code> is not between quotes and <code>x &gt; 0</code> evaluates to a vector an not a single value. The goal is to check that all values in <code>x</code> are positive, so <code>all</code> can be used to collapse the <code>logical</code> vector <code>x &gt; 0</code>:</p>
<div class="sourceCode" id="cb1441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1441-1"><a href="solutions.html#cb1441-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, pi, <span class="dv">8</span>)</span>
<span id="cb1441-2"><a href="solutions.html#cb1441-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1441-3"><a href="solutions.html#cb1441-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Only compute square roots if x exists</span></span>
<span id="cb1441-4"><a href="solutions.html#cb1441-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and contains positive values:</span></span>
<span id="cb1441-5"><a href="solutions.html#cb1441-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">&quot;x&quot;</span>)) { <span class="cf">if</span>(<span class="fu">all</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)) { <span class="fu">sqrt</span>(x) } }</span></code></pre></div>
<p>Alternatively, we can get a better looking solution by using <code>&amp;&amp;</code>:</p>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1442-1"><a href="solutions.html#cb1442-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">&quot;x&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">all</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)) { <span class="fu">sqrt</span>(x) }</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc5">6.6</a><a href="solutions.html#ch6solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>To compute the mean temperature for each month in the <code>airquality</code> dataset using a loop, we loop over the 6 months:</li>
</ol>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1443-1"><a href="solutions.html#cb1443-1" aria-hidden="true" tabindex="-1"></a>months <span class="ot">&lt;-</span> <span class="fu">unique</span>(airquality<span class="sc">$</span>Month)</span>
<span id="cb1443-2"><a href="solutions.html#cb1443-2" aria-hidden="true" tabindex="-1"></a>meanTemp <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="fu">length</span>(months))</span>
<span id="cb1443-3"><a href="solutions.html#cb1443-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1443-4"><a href="solutions.html#cb1443-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(months))</span>
<span id="cb1443-5"><a href="solutions.html#cb1443-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1443-6"><a href="solutions.html#cb1443-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract data for month[i]:</span></span>
<span id="cb1443-7"><a href="solutions.html#cb1443-7" aria-hidden="true" tabindex="-1"></a>      aq <span class="ot">&lt;-</span> airquality[airquality<span class="sc">$</span>Month <span class="sc">==</span> months[i],]</span>
<span id="cb1443-8"><a href="solutions.html#cb1443-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Compute mean temperature:</span></span>
<span id="cb1443-9"><a href="solutions.html#cb1443-9" aria-hidden="true" tabindex="-1"></a>      meanTemp[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(aq<span class="sc">$</span>Temp)</span>
<span id="cb1443-10"><a href="solutions.html#cb1443-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we use a <code>for</code> loop to compute the maximum and minimum value of each column of the <code>airquality</code> data frame, storing the results in a data frame:</li>
</ol>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1444-1"><a href="solutions.html#cb1444-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">min =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="fu">ncol</span>(airquality)),</span>
<span id="cb1444-2"><a href="solutions.html#cb1444-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="fu">ncol</span>(airquality)))</span>
<span id="cb1444-3"><a href="solutions.html#cb1444-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1444-4"><a href="solutions.html#cb1444-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(airquality))</span>
<span id="cb1444-5"><a href="solutions.html#cb1444-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1444-6"><a href="solutions.html#cb1444-6" aria-hidden="true" tabindex="-1"></a>      results<span class="sc">$</span>min[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(airquality[,i], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1444-7"><a href="solutions.html#cb1444-7" aria-hidden="true" tabindex="-1"></a>      results<span class="sc">$</span>max[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(airquality[,i], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1444-8"><a href="solutions.html#cb1444-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1444-9"><a href="solutions.html#cb1444-9" aria-hidden="true" tabindex="-1"></a>results</span>
<span id="cb1444-10"><a href="solutions.html#cb1444-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1444-11"><a href="solutions.html#cb1444-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For presentation purposes, we can add the variable names as</span></span>
<span id="cb1444-12"><a href="solutions.html#cb1444-12" aria-hidden="true" tabindex="-1"></a><span class="co"># row names:</span></span>
<span id="cb1444-13"><a href="solutions.html#cb1444-13" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(results) <span class="ot">&lt;-</span> <span class="fu">names</span>(airquality)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Finally, we write a function to solve task 2 for any data frame:</li>
</ol>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1445-1"><a href="solutions.html#cb1445-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ...)</span>
<span id="cb1445-2"><a href="solutions.html#cb1445-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1445-3"><a href="solutions.html#cb1445-3" aria-hidden="true" tabindex="-1"></a>       results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">min =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="fu">ncol</span>(df)),</span>
<span id="cb1445-4"><a href="solutions.html#cb1445-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">max =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="fu">ncol</span>(df)))</span>
<span id="cb1445-5"><a href="solutions.html#cb1445-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1445-6"><a href="solutions.html#cb1445-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df))</span>
<span id="cb1445-7"><a href="solutions.html#cb1445-7" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb1445-8"><a href="solutions.html#cb1445-8" aria-hidden="true" tabindex="-1"></a>            results<span class="sc">$</span>min[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(df[,i], ...)</span>
<span id="cb1445-9"><a href="solutions.html#cb1445-9" aria-hidden="true" tabindex="-1"></a>            results<span class="sc">$</span>max[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(df[,i], ...)</span>
<span id="cb1445-10"><a href="solutions.html#cb1445-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1445-11"><a href="solutions.html#cb1445-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1445-12"><a href="solutions.html#cb1445-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For presentation purposes, we add the variable names as</span></span>
<span id="cb1445-13"><a href="solutions.html#cb1445-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># row names:</span></span>
<span id="cb1445-14"><a href="solutions.html#cb1445-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row.names</span>(results) <span class="ot">&lt;-</span> <span class="fu">names</span>(airquality)</span>
<span id="cb1445-15"><a href="solutions.html#cb1445-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1445-16"><a href="solutions.html#cb1445-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(results)</span>
<span id="cb1445-17"><a href="solutions.html#cb1445-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1445-18"><a href="solutions.html#cb1445-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1445-19"><a href="solutions.html#cb1445-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1445-20"><a href="solutions.html#cb1445-20" aria-hidden="true" tabindex="-1"></a><span class="fu">minmax</span>(airquality)</span>
<span id="cb1445-21"><a href="solutions.html#cb1445-21" aria-hidden="true" tabindex="-1"></a><span class="fu">minmax</span>(airquality, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions5b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc5b">6.7</a><a href="solutions.html#ch6solutions5b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We can create <code>0.25 0.5 0.75 1</code> in two different ways using <code>seq</code>:</li>
</ol>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1446-1"><a href="solutions.html#cb1446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="fl">0.25</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">4</span>)</span>
<span id="cb1446-2"><a href="solutions.html#cb1446-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="fl">0.25</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We can create <code>1 1 1 2 2 5</code> using <code>rep</code>. <code>1</code> is repeated 3 times, <code>2</code> is repeated 2 times and 5 is repeated a single time:</li>
</ol>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1447-1"><a href="solutions.html#cb1447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc5b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc6">6.8</a><a href="solutions.html#ch6solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We could create the same sequences using <code>1:ncol(airquality)</code> and <code>1:length(airquality$Temp)</code>, but if we accidentally apply those solutions to objects with zero length, we would run into trouble! Let’s see what happens:</p>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1448-1"><a href="solutions.html#cb1448-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb1448-2"><a href="solutions.html#cb1448-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x)</span></code></pre></div>
<p>Even though there are no elements in the vector, two iterations are run when we use <code>1:length(x)</code> to set the values of the control variable:</p>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1449-1"><a href="solutions.html#cb1449-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) { <span class="fu">cat</span>(<span class="st">&quot;Element&quot;</span>, i, <span class="st">&quot;of the vector</span><span class="sc">\n</span><span class="st">&quot;</span>) }</span></code></pre></div>
<p>The reason is that <code>1:length(x)</code> yields the vector <code>0 1</code>, providing two values for the control variable.</p>
<p>If we use <code>seq_along</code> instead, no iterations will be run, because <code>seq_along(x)</code> returns zero values:</p>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1450-1"><a href="solutions.html#cb1450-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) { <span class="fu">cat</span>(<span class="st">&quot;Element&quot;</span>, i, <span class="st">&quot;of the vector</span><span class="sc">\n</span><span class="st">&quot;</span>) }</span></code></pre></div>
<p>This is the desired behaviour - if there are no elements in the vector then the loop shouldn’t run! <code>seq_along</code> is the safer option, but <code>1:length(x)</code> is arguably less opaque and therefore easier for humans to read, which also has its benefits.</p>
<p><a href="progchapter.html#exr:ch6exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc7">6.9</a><a href="solutions.html#ch6solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To normalise the variable, we need to map the smallest value to 0 and the largest to 1:</p>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1451-1"><a href="solutions.html#cb1451-1" aria-hidden="true" tabindex="-1"></a>normalise <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ...)</span>
<span id="cb1451-2"><a href="solutions.html#cb1451-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1451-3"><a href="solutions.html#cb1451-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df))</span>
<span id="cb1451-4"><a href="solutions.html#cb1451-4" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb1451-5"><a href="solutions.html#cb1451-5" aria-hidden="true" tabindex="-1"></a>          df[,i] <span class="ot">&lt;-</span> (df[,i] <span class="sc">-</span> <span class="fu">min</span>(df[,i], ...))<span class="sc">/</span>(<span class="fu">max</span>(df[,i], ...) <span class="sc">-</span></span>
<span id="cb1451-6"><a href="solutions.html#cb1451-6" aria-hidden="true" tabindex="-1"></a>                                                   <span class="fu">min</span>(df[,i], ...))</span>
<span id="cb1451-7"><a href="solutions.html#cb1451-7" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1451-8"><a href="solutions.html#cb1451-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb1451-9"><a href="solutions.html#cb1451-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1451-10"><a href="solutions.html#cb1451-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1451-11"><a href="solutions.html#cb1451-11" aria-hidden="true" tabindex="-1"></a>aqn <span class="ot">&lt;-</span> <span class="fu">normalise</span>(airquality, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1451-12"><a href="solutions.html#cb1451-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aqn)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc10">6.10</a><a href="solutions.html#ch6solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>folder_path</code> to the path of the folder (making sure that the path ends with <code>/</code> (or <code>\\</code> on Windows)). We can then loop over the <code>.csv</code> files in the folder and print the names of their variables as follows:</p>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1452-1"><a href="solutions.html#cb1452-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(folder_path, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.csv$&quot;</span>)</span>
<span id="cb1452-2"><a href="solutions.html#cb1452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1452-3"><a href="solutions.html#cb1452-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(file <span class="cf">in</span> files)</span>
<span id="cb1452-4"><a href="solutions.html#cb1452-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1452-5"><a href="solutions.html#cb1452-5" aria-hidden="true" tabindex="-1"></a>      csv_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(folder_path, file, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb1452-6"><a href="solutions.html#cb1452-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1452-7"><a href="solutions.html#cb1452-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">names</span>(csv_data))</span>
<span id="cb1452-8"><a href="solutions.html#cb1452-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb1452-9"><a href="solutions.html#cb1452-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc8">6.11</a><a href="solutions.html#ch6solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>The condition in the outer loop, <code>i &lt; length(x)</code>, is used to check that the element <code>x[i+1]</code> used in the inner loop actually exists. If <code>i</code> is equal to the length of the vector (i.e. is the last element of the vector) then there is no element <code>x[i+1]</code> and consequently the run cannot go on. If this condition wasn’t included, we would end up with an infinite loop.</p></li>
<li><p>The condition in the inner loop, <code>x[i+1] == x[i] &amp; i &lt; length(x)</code>, is used to check if the run continues. If <code>[i+1] == x[i]</code> is <code>TRUE</code> then the next element of <code>x</code> is the same as the current, meaning that the run continues. As in the previous condition, <code>i &lt; length(x)</code> is included to make sure that we don’t start looking for elements outside of <code>x</code>, which could create an infinite loop.</p></li>
<li><p>The line <code>run_values &lt;- c(run_values, x[i-1])</code> creates a vector combining the existing elements of <code>run_values</code> with <code>x[i-1]</code>. This allows us to store the results in a vector without specifying its size in advance. Not however that this approach is slower than specifying the vector size in advance, and that you therefore should avoid it when using <code>for</code> loops.</p></li>
</ol>
<p><a href="progchapter.html#exr:ch6exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc9">6.12</a><a href="solutions.html#ch6solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We modify the loop so that it skips to the next iteration if <code>x[i]</code> is <code>0</code>, and breaks if <code>x[i]</code> is <code>NA</code>:</p>
<div class="sourceCode" id="cb1453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1453-1"><a href="solutions.html#cb1453-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">18</span>, <span class="dv">2</span>)</span>
<span id="cb1453-2"><a href="solutions.html#cb1453-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1453-3"><a href="solutions.html#cb1453-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x))</span>
<span id="cb1453-4"><a href="solutions.html#cb1453-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1453-5"><a href="solutions.html#cb1453-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.na</span>(x[i])) { <span class="cf">break</span> }</span>
<span id="cb1453-6"><a href="solutions.html#cb1453-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(x[i] <span class="sc">==</span> <span class="dv">0</span>) { <span class="cf">next</span> }</span>
<span id="cb1453-7"><a href="solutions.html#cb1453-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;Step&quot;</span>, i, <span class="st">&quot;- reciprocal is&quot;</span>, <span class="dv">1</span><span class="sc">/</span>x[i], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1453-8"><a href="solutions.html#cb1453-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions9b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc9">6.12</a><a href="solutions.html#ch6solutions9b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can put a conditional statement inside each of the loops, to check that both variables are <code>numeric</code>:</p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1454-1"><a href="solutions.html#cb1454-1" aria-hidden="true" tabindex="-1"></a>cor_func <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb1454-2"><a href="solutions.html#cb1454-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1454-3"><a href="solutions.html#cb1454-3" aria-hidden="true" tabindex="-1"></a>    cor_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(df), <span class="at">ncol =</span> <span class="fu">ncol</span>(df))</span>
<span id="cb1454-4"><a href="solutions.html#cb1454-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(df))</span>
<span id="cb1454-5"><a href="solutions.html#cb1454-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1454-6"><a href="solutions.html#cb1454-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(df[[i]])) { <span class="cf">next</span> }</span>
<span id="cb1454-7"><a href="solutions.html#cb1454-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">seq_along</span>(df))</span>
<span id="cb1454-8"><a href="solutions.html#cb1454-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb1454-9"><a href="solutions.html#cb1454-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(df[[j]])) { <span class="cf">next</span> }</span>
<span id="cb1454-10"><a href="solutions.html#cb1454-10" aria-hidden="true" tabindex="-1"></a>            cor_mat[i, j] <span class="ot">&lt;-</span> <span class="fu">cor</span>(df[[i]], df[[j]],</span>
<span id="cb1454-11"><a href="solutions.html#cb1454-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">use =</span> <span class="st">&quot;pairwise.complete&quot;</span>)</span>
<span id="cb1454-12"><a href="solutions.html#cb1454-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1454-13"><a href="solutions.html#cb1454-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1454-14"><a href="solutions.html#cb1454-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cor_mat)</span>
<span id="cb1454-15"><a href="solutions.html#cb1454-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1454-16"><a href="solutions.html#cb1454-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1454-17"><a href="solutions.html#cb1454-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1454-18"><a href="solutions.html#cb1454-18" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ggplot2<span class="sc">::</span>msleep)</span>
<span id="cb1454-19"><a href="solutions.html#cb1454-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cor_func</span>(ggplot2<span class="sc">::</span>msleep)</span></code></pre></div>
<p>An (nicer?) alternative would be to check which columns are <code>numeric</code> and loop over those:</p>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1455-1"><a href="solutions.html#cb1455-1" aria-hidden="true" tabindex="-1"></a>cor_func <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb1455-2"><a href="solutions.html#cb1455-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1455-3"><a href="solutions.html#cb1455-3" aria-hidden="true" tabindex="-1"></a>    cor_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(df), <span class="at">ncol =</span> <span class="fu">ncol</span>(df))</span>
<span id="cb1455-4"><a href="solutions.html#cb1455-4" aria-hidden="true" tabindex="-1"></a>    indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(df, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)</span>
<span id="cb1455-5"><a href="solutions.html#cb1455-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> indices)</span>
<span id="cb1455-6"><a href="solutions.html#cb1455-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1455-7"><a href="solutions.html#cb1455-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> indices)</span>
<span id="cb1455-8"><a href="solutions.html#cb1455-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb1455-9"><a href="solutions.html#cb1455-9" aria-hidden="true" tabindex="-1"></a>            cor_mat[i, j] <span class="ot">&lt;-</span> <span class="fu">cor</span>(df[[i]], df[[j]],</span>
<span id="cb1455-10"><a href="solutions.html#cb1455-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">use =</span> <span class="st">&quot;pairwise.complete&quot;</span>)</span>
<span id="cb1455-11"><a href="solutions.html#cb1455-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1455-12"><a href="solutions.html#cb1455-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1455-13"><a href="solutions.html#cb1455-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cor_mat)</span>
<span id="cb1455-14"><a href="solutions.html#cb1455-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1455-15"><a href="solutions.html#cb1455-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1455-16"><a href="solutions.html#cb1455-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1455-17"><a href="solutions.html#cb1455-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cor_func</span>(ggplot2<span class="sc">::</span>msleep)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc9b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc11">6.14</a><a href="solutions.html#ch6solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To compute the minima, we can use:</p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1456-1"><a href="solutions.html#cb1456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(airquality, <span class="dv">2</span>, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To compute the maxima, we can use:</p>
<div class="sourceCode" id="cb1457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1457-1"><a href="solutions.html#cb1457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(airquality, <span class="dv">2</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We could also write a function that computes both the minimum and the maximum and returns both, and use that with <code>apply</code>:</p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1458-1"><a href="solutions.html#cb1458-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1458-2"><a href="solutions.html#cb1458-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1458-3"><a href="solutions.html#cb1458-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">max =</span> <span class="fu">max</span>(x, ...)))</span>
<span id="cb1458-4"><a href="solutions.html#cb1458-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1458-5"><a href="solutions.html#cb1458-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1458-6"><a href="solutions.html#cb1458-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(airquality, <span class="dv">2</span>, minmax, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc11">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions12" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc12">6.15</a><a href="solutions.html#ch6solutions12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can for instance make use of the <code>minmax</code> function that we created in Exercise <a href="progchapter.html#exr:ch6exc11">6.14</a>:</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="solutions.html#cb1459-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1459-2"><a href="solutions.html#cb1459-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1459-3"><a href="solutions.html#cb1459-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">max =</span> <span class="fu">max</span>(x, ...)))</span>
<span id="cb1459-4"><a href="solutions.html#cb1459-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1459-5"><a href="solutions.html#cb1459-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1459-6"><a href="solutions.html#cb1459-6" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">split</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month)</span>
<span id="cb1459-7"><a href="solutions.html#cb1459-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1459-8"><a href="solutions.html#cb1459-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(temps, minmax) <span class="co"># or lapply/vapply</span></span>
<span id="cb1459-9"><a href="solutions.html#cb1459-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1459-10"><a href="solutions.html#cb1459-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Or:</span></span>
<span id="cb1459-11"><a href="solutions.html#cb1459-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month, minmax)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc12">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions13" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc13">6.16</a><a href="solutions.html#ch6solutions13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To compute minima and maxima, we can use:</p>
<div class="sourceCode" id="cb1460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1460-1"><a href="solutions.html#cb1460-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1460-2"><a href="solutions.html#cb1460-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1460-3"><a href="solutions.html#cb1460-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">max =</span> <span class="fu">max</span>(x, ...)))</span>
<span id="cb1460-4"><a href="solutions.html#cb1460-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This time out, we want to apply this function to two variables: <code>Temp</code> and <code>Wind</code>. We can do this using <code>apply</code>:</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="solutions.html#cb1461-1" aria-hidden="true" tabindex="-1"></a>minmax2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1461-2"><a href="solutions.html#cb1461-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1461-3"><a href="solutions.html#cb1461-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">apply</span>(x, <span class="dv">2</span>, minmax))</span>
<span id="cb1461-4"><a href="solutions.html#cb1461-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1462-1"><a href="solutions.html#cb1462-1" aria-hidden="true" tabindex="-1"></a>tw <span class="ot">&lt;-</span> <span class="fu">split</span>(airquality[,<span class="fu">c</span>(<span class="st">&quot;Temp&quot;</span>, <span class="st">&quot;Wind&quot;</span>)], airquality<span class="sc">$</span>Month)</span>
<span id="cb1462-2"><a href="solutions.html#cb1462-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1462-3"><a href="solutions.html#cb1462-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(tw, minmax2)</span></code></pre></div>
<p>If we use <code>sapply</code> instead, we lose information about which statistic correspond to which variable, so <code>lapply</code> is a better choice here:</p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="solutions.html#cb1463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(tw, minmax2)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc13">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions13b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc13b">6.17</a><a href="solutions.html#ch6solutions13b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can for instance make use of the <code>minmax</code> function that we created in Exercise <a href="progchapter.html#exr:ch6exc11">6.14</a>:</p>
<div class="sourceCode" id="cb1464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1464-1"><a href="solutions.html#cb1464-1" aria-hidden="true" tabindex="-1"></a>minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb1464-2"><a href="solutions.html#cb1464-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1464-3"><a href="solutions.html#cb1464-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">max =</span> <span class="fu">max</span>(x, ...)))</span>
<span id="cb1464-4"><a href="solutions.html#cb1464-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1464-5"><a href="solutions.html#cb1464-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1464-6"><a href="solutions.html#cb1464-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1464-7"><a href="solutions.html#cb1464-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1464-8"><a href="solutions.html#cb1464-8" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">split</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month)</span>
<span id="cb1464-9"><a href="solutions.html#cb1464-9" aria-hidden="true" tabindex="-1"></a>temps <span class="sc">%&gt;%</span> <span class="fu">map</span>(minmax)</span></code></pre></div>
<p>We can also use a single pipe chain to split the data and apply the functional:</p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1465-1"><a href="solutions.html#cb1465-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span> <span class="fu">split</span>(.<span class="sc">$</span>Month) <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span><span class="fu">minmax</span>(.<span class="sc">$</span>Temp))</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc13b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions13c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc13c">6.18</a><a href="solutions.html#ch6solutions13c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Because we want to use both the variable names and their values, an <code>imap_*</code> function is appropriate here:</p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1466-1"><a href="solutions.html#cb1466-1" aria-hidden="true" tabindex="-1"></a>data_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb1466-2"><a href="solutions.html#cb1466-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1466-3"><a href="solutions.html#cb1466-3" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> <span class="fu">imap_dfr</span>(<span class="sc">~</span>(<span class="fu">data.frame</span>(<span class="at">variable =</span> .y,</span>
<span id="cb1466-4"><a href="solutions.html#cb1466-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">unique_values =</span> <span class="fu">length</span>(<span class="fu">unique</span>(.x)),</span>
<span id="cb1466-5"><a href="solutions.html#cb1466-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">class =</span> <span class="fu">class</span>(.x),</span>
<span id="cb1466-6"><a href="solutions.html#cb1466-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">missing_values =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x)) )))</span>
<span id="cb1466-7"><a href="solutions.html#cb1466-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1466-8"><a href="solutions.html#cb1466-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1466-9"><a href="solutions.html#cb1466-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that it works:</span></span>
<span id="cb1466-10"><a href="solutions.html#cb1466-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1466-11"><a href="solutions.html#cb1466-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data_summary</span>(msleep)</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc13c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions13d" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc13d">6.19</a><a href="solutions.html#ch6solutions13d" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We combine <code>map</code> and <code>imap</code> to get the desired result. <code>folder_path</code> is the path to the folder containing the <code>.csv</code> files. We must use <code>set_names</code> to set the file names as element names, otherwise only the index of each file (in the file name vector) will be printed:</p>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1467-1"><a href="solutions.html#cb1467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(folder_path, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.csv$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1467-2"><a href="solutions.html#cb1467-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(folder_path, ., <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1467-3"><a href="solutions.html#cb1467-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1467-4"><a href="solutions.html#cb1467-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(read.csv) <span class="sc">%&gt;%</span> </span>
<span id="cb1467-5"><a href="solutions.html#cb1467-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">imap</span>(<span class="sc">~</span><span class="fu">cat</span>(.y, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">names</span>(.x), <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>))</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc13d">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions13e" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc13e">6.20</a><a href="solutions.html#ch6solutions13e" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data and create vectors containing all combinations</p>
<div class="sourceCode" id="cb1468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1468-1"><a href="solutions.html#cb1468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb1468-2"><a href="solutions.html#cb1468-2" aria-hidden="true" tabindex="-1"></a>combos <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(continent, year)</span>
<span id="cb1468-3"><a href="solutions.html#cb1468-3" aria-hidden="true" tabindex="-1"></a>continents <span class="ot">&lt;-</span> combos<span class="sc">$</span>continent</span>
<span id="cb1468-4"><a href="solutions.html#cb1468-4" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> combos<span class="sc">$</span>year</span></code></pre></div>
<p>Next, we create the scatterplots:</p>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1469-1"><a href="solutions.html#cb1469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot for each pair:</span></span>
<span id="cb1469-2"><a href="solutions.html#cb1469-2" aria-hidden="true" tabindex="-1"></a>combos_plots <span class="ot">&lt;-</span> <span class="fu">map2</span>(continents, years, <span class="sc">~</span>{</span>
<span id="cb1469-3"><a href="solutions.html#cb1469-3" aria-hidden="true" tabindex="-1"></a>                     gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">==</span> .x,</span>
<span id="cb1469-4"><a href="solutions.html#cb1469-4" aria-hidden="true" tabindex="-1"></a>                                         year <span class="sc">==</span> .y) <span class="sc">%&gt;%</span> </span>
<span id="cb1469-5"><a href="solutions.html#cb1469-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop, lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1469-6"><a href="solutions.html#cb1469-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(<span class="fu">paste</span>(.x, .y, <span class="at">sep =</span><span class="st">&quot; in &quot;</span>))})</span></code></pre></div>
<p>If instead we just want to save each scatterplot in a separate file, we can do so by putting <code>ggsave</code> (or <code>png</code> + <code>dev.off</code>) inside a <code>walk2</code> call:</p>
<div class="sourceCode" id="cb1470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1470-1"><a href="solutions.html#cb1470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot for each pair:</span></span>
<span id="cb1470-2"><a href="solutions.html#cb1470-2" aria-hidden="true" tabindex="-1"></a>combos_plots <span class="ot">&lt;-</span> <span class="fu">walk2</span>(continents, years, <span class="sc">~</span>{</span>
<span id="cb1470-3"><a href="solutions.html#cb1470-3" aria-hidden="true" tabindex="-1"></a>                     gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">==</span> .x,</span>
<span id="cb1470-4"><a href="solutions.html#cb1470-4" aria-hidden="true" tabindex="-1"></a>                                         year <span class="sc">==</span> .y) <span class="sc">%&gt;%</span> </span>
<span id="cb1470-5"><a href="solutions.html#cb1470-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop, lifeExp)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1470-6"><a href="solutions.html#cb1470-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(<span class="fu">paste</span>(.x, .y, <span class="at">sep =</span><span class="st">&quot; in &quot;</span>))</span>
<span id="cb1470-7"><a href="solutions.html#cb1470-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ggsave</span>(<span class="fu">paste</span>(.x, .y, <span class="st">&quot;.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb1470-8"><a href="solutions.html#cb1470-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">width =</span> <span class="dv">3</span>, <span class="at">height =</span> <span class="dv">3</span>)})</span></code></pre></div>
<p><a href="progchapter.html#exr:ch6exc13e">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions14" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc14">6.21</a><a href="solutions.html#ch6solutions14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we write a function for computing the mean of a vector with a loop:</p>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1471-1"><a href="solutions.html#cb1471-1" aria-hidden="true" tabindex="-1"></a>mean_loop <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1471-2"><a href="solutions.html#cb1471-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1471-3"><a href="solutions.html#cb1471-3" aria-hidden="true" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1471-4"><a href="solutions.html#cb1471-4" aria-hidden="true" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb1471-5"><a href="solutions.html#cb1471-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x))</span>
<span id="cb1471-6"><a href="solutions.html#cb1471-6" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb1471-7"><a href="solutions.html#cb1471-7" aria-hidden="true" tabindex="-1"></a>            m <span class="ot">&lt;-</span> m <span class="sc">+</span> x[i]<span class="sc">/</span>n</span>
<span id="cb1471-8"><a href="solutions.html#cb1471-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1471-9"><a href="solutions.html#cb1471-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(m)</span>
<span id="cb1471-10"><a href="solutions.html#cb1471-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next, we run the functions once, and then benchmark them:</p>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1472-1"><a href="solutions.html#cb1472-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span></span>
<span id="cb1472-2"><a href="solutions.html#cb1472-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean_loop</span>(x)</span>
<span id="cb1472-3"><a href="solutions.html#cb1472-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span>
<span id="cb1472-4"><a href="solutions.html#cb1472-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-5"><a href="solutions.html#cb1472-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb1472-6"><a href="solutions.html#cb1472-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">mean</span>(x), <span class="fu">mean_loop</span>(x))</span></code></pre></div>
<p><code>mean_loop</code> is several times slower than <code>mean</code>. The memory usage of both functions is negligible.</p>
<p><a href="progchapter.html#exr:ch6exc14">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch6solutions15" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="progchapter.html#exr:ch6exc15">6.22</a><a href="solutions.html#ch6solutions15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can compare the three solutions as follows:</p>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1473-1"><a href="solutions.html#cb1473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1473-2"><a href="solutions.html#cb1473-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1473-3"><a href="solutions.html#cb1473-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb1473-4"><a href="solutions.html#cb1473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb1473-5"><a href="solutions.html#cb1473-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-6"><a href="solutions.html#cb1473-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a data.table copy of the data:</span></span>
<span id="cb1473-7"><a href="solutions.html#cb1473-7" aria-hidden="true" tabindex="-1"></a>flights.dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(flights)</span>
<span id="cb1473-8"><a href="solutions.html#cb1473-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-9"><a href="solutions.html#cb1473-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap the solutions in functions (using global assignment to better</span></span>
<span id="cb1473-10"><a href="solutions.html#cb1473-10" aria-hidden="true" tabindex="-1"></a><span class="co"># monitor memory usage):</span></span>
<span id="cb1473-11"><a href="solutions.html#cb1473-11" aria-hidden="true" tabindex="-1"></a>base_filter <span class="ot">&lt;-</span> <span class="cf">function</span>() { flights0101 <span class="ot">&lt;&lt;-</span> flights[flights<span class="sc">$</span>month <span class="sc">==</span></span>
<span id="cb1473-12"><a href="solutions.html#cb1473-12" aria-hidden="true" tabindex="-1"></a>                                              <span class="dv">1</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>day <span class="sc">==</span> <span class="dv">1</span>,] }</span>
<span id="cb1473-13"><a href="solutions.html#cb1473-13" aria-hidden="true" tabindex="-1"></a>dt_filter <span class="ot">&lt;-</span> <span class="cf">function</span>() { flights0101 <span class="ot">&lt;&lt;-</span> flights.dt[month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb1473-14"><a href="solutions.html#cb1473-14" aria-hidden="true" tabindex="-1"></a>                                                          day <span class="sc">==</span> <span class="dv">1</span>,] }</span>
<span id="cb1473-15"><a href="solutions.html#cb1473-15" aria-hidden="true" tabindex="-1"></a>dplyr_filter <span class="ot">&lt;-</span> <span class="cf">function</span>() { flights0101 <span class="ot">&lt;&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb1473-16"><a href="solutions.html#cb1473-16" aria-hidden="true" tabindex="-1"></a>                                                month <span class="sc">==</span><span class="dv">1</span>, day <span class="sc">==</span> <span class="dv">1</span>) }</span>
<span id="cb1473-17"><a href="solutions.html#cb1473-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-18"><a href="solutions.html#cb1473-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the functions:</span></span>
<span id="cb1473-19"><a href="solutions.html#cb1473-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compiler)</span>
<span id="cb1473-20"><a href="solutions.html#cb1473-20" aria-hidden="true" tabindex="-1"></a>base_filter <span class="ot">&lt;-</span> <span class="fu">cmpfun</span>(base_filter)</span>
<span id="cb1473-21"><a href="solutions.html#cb1473-21" aria-hidden="true" tabindex="-1"></a>dt_filter <span class="ot">&lt;-</span> <span class="fu">cmpfun</span>(dt_filter)</span>
<span id="cb1473-22"><a href="solutions.html#cb1473-22" aria-hidden="true" tabindex="-1"></a>dplyr_filter <span class="ot">&lt;-</span> <span class="fu">cmpfun</span>(dplyr_filter)</span>
<span id="cb1473-23"><a href="solutions.html#cb1473-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-24"><a href="solutions.html#cb1473-24" aria-hidden="true" tabindex="-1"></a><span class="co"># benchmark the solutions:</span></span>
<span id="cb1473-25"><a href="solutions.html#cb1473-25" aria-hidden="true" tabindex="-1"></a>bm <span class="ot">&lt;-</span> <span class="fu">mark</span>(<span class="fu">base_filter</span>(), <span class="fu">dt_filter</span>(), <span class="fu">dplyr_filter</span>())</span>
<span id="cb1473-26"><a href="solutions.html#cb1473-26" aria-hidden="true" tabindex="-1"></a>bm</span>
<span id="cb1473-27"><a href="solutions.html#cb1473-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bm)</span></code></pre></div>
<p>We see that <code>dplyr</code> is substantially faster and more memory efficient than the base R solution, but that <code>data.table</code> beats them both by a margin.</p>
<p><a href="progchapter.html#exr:ch6exc15">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="ch7solutions" class="section level2 unnumbered hasAnchor">
<h2>Chapter 7<a href="solutions.html#ch7solutions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch7solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc1">7.1</a><a href="solutions.html#ch7solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The parameter <code>replace</code> controls whether or not replacement is used. To draw 5 random numbers with replacement, we use:</p>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1474-1"><a href="solutions.html#cb1474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><a href="modchapter.html#exr:ch7exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc2">7.2</a><a href="solutions.html#ch7solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As an alternative to <code>sample(1:10, n, replace = TRUE)</code> we could use <code>runif</code> to generate random numbers from <code>1:10</code>. This can be done in at least three different ways.</p>
<ol style="list-style-type: decimal">
<li>Generating (decimal) numbers between <span class="math inline">\(0\)</span> and <span class="math inline">\(10\)</span> and rounding up to the nearest integer:</li>
</ol>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="solutions.html#cb1475-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># Generate 10 numbers</span></span>
<span id="cb1475-2"><a href="solutions.html#cb1475-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(<span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Generating (decimal) numbers between <span class="math inline">\(1\)</span> and <span class="math inline">\(11\)</span> and rounding down to the nearest integer:</li>
</ol>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1476-1"><a href="solutions.html#cb1476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">11</span>))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generating (decimal) numbers between <span class="math inline">\(0.5\)</span> and <span class="math inline">\(10.5\)</span> and rounding to the nearest integer:</li>
</ol>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="solutions.html#cb1477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="fl">0.5</span>, <span class="fl">10.5</span>))</span></code></pre></div>
<p>Using <code>sample(1:10, n, replace = TRUE)</code> is more straightforward in this case, and is the recommended approach.</p>
<p><a href="modchapter.html#exr:ch7exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="#exr:ch7exc3"><strong>??</strong></a><a href="solutions.html#ch7solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we compare the histogram of the data to the normal density function:</p>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1478-1"><a href="solutions.html#cb1478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1478-2"><a href="solutions.html#cb1478-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="at">x =</span> sleep_total)) <span class="sc">+</span></span>
<span id="cb1478-3"><a href="solutions.html#cb1478-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb1478-4"><a href="solutions.html#cb1478-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1478-5"><a href="solutions.html#cb1478-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_function</span>(<span class="at">fun =</span> dnorm, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1478-6"><a href="solutions.html#cb1478-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(msleep<span class="sc">$</span>sleep_total), </span>
<span id="cb1478-7"><a href="solutions.html#cb1478-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sd =</span> <span class="fu">sd</span>(msleep<span class="sc">$</span>sleep_total)))</span></code></pre></div>
<p>The density estimate is fairly similar to the normal density, but there appear to be too many low values in the data.</p>
<p>Then a normal Q-Q plot:</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="solutions.html#cb1479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="at">sample =</span> sleep_total)) <span class="sc">+</span></span>
<span id="cb1479-2"><a href="solutions.html#cb1479-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span></code></pre></div>
<p>There are some small deviations from the line, but no large deviations. To decide whether these deviations are large enough to be a concern, it may be a good idea to compare this Q-Q-plot to Q-Q-plots from simulated normal data:</p>
<div class="sourceCode" id="cb1480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1480-1"><a href="solutions.html#cb1480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Q-Q-plot for the total sleep data, and store</span></span>
<span id="cb1480-2"><a href="solutions.html#cb1480-2" aria-hidden="true" tabindex="-1"></a><span class="co"># it in a list:</span></span>
<span id="cb1480-3"><a href="solutions.html#cb1480-3" aria-hidden="true" tabindex="-1"></a>qqplots <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="at">sample =</span> sleep_total)) <span class="sc">+</span></span>
<span id="cb1480-4"><a href="solutions.html#cb1480-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Actual data&quot;</span>))</span>
<span id="cb1480-5"><a href="solutions.html#cb1480-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-6"><a href="solutions.html#cb1480-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the sample size n: </span></span>
<span id="cb1480-7"><a href="solutions.html#cb1480-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(msleep<span class="sc">$</span>sleep_total))</span>
<span id="cb1480-8"><a href="solutions.html#cb1480-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-9"><a href="solutions.html#cb1480-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 8 new datasets of size n from a normal distribution.</span></span>
<span id="cb1480-10"><a href="solutions.html#cb1480-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Then draw Q-Q-plots for these and store them in the list:</span></span>
<span id="cb1480-11"><a href="solutions.html#cb1480-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb1480-12"><a href="solutions.html#cb1480-12" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1480-13"><a href="solutions.html#cb1480-13" aria-hidden="true" tabindex="-1"></a>    generated_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">normal_data =</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb1480-14"><a href="solutions.html#cb1480-14" aria-hidden="true" tabindex="-1"></a>    qqplots[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(generated_data, <span class="fu">aes</span>(<span class="at">sample =</span> normal_data)) <span class="sc">+</span></span>
<span id="cb1480-15"><a href="solutions.html#cb1480-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated data&quot;</span>)</span>
<span id="cb1480-16"><a href="solutions.html#cb1480-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1480-17"><a href="solutions.html#cb1480-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-18"><a href="solutions.html#cb1480-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the resulting Q-Q-plots side-by-side:</span></span>
<span id="cb1480-19"><a href="solutions.html#cb1480-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1480-20"><a href="solutions.html#cb1480-20" aria-hidden="true" tabindex="-1"></a>(qqplots[[<span class="dv">1</span>]] <span class="sc">+</span> qqplots[[<span class="dv">2</span>]] <span class="sc">+</span> qqplots[[<span class="dv">3</span>]]) <span class="sc">/</span></span>
<span id="cb1480-21"><a href="solutions.html#cb1480-21" aria-hidden="true" tabindex="-1"></a>  (qqplots[[<span class="dv">4</span>]] <span class="sc">+</span> qqplots[[<span class="dv">5</span>]] <span class="sc">+</span> qqplots[[<span class="dv">6</span>]]) <span class="sc">/</span></span>
<span id="cb1480-22"><a href="solutions.html#cb1480-22" aria-hidden="true" tabindex="-1"></a>  (qqplots[[<span class="dv">7</span>]] <span class="sc">+</span> qqplots[[<span class="dv">8</span>]] <span class="sc">+</span> qqplots[[<span class="dv">9</span>]])</span></code></pre></div>
<p>The Q-Q-plot for the real data is pretty similar to those from the simulated samples. We can’t rule out the normal distribution.</p>
<p>Nevertheless, perhaps the lognormal distribution would be a better fit? We can compare its density to the histogram, and draw a Q-Q plot:</p>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="solutions.html#cb1481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram:</span></span>
<span id="cb1481-2"><a href="solutions.html#cb1481-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="at">x =</span> sleep_total)) <span class="sc">+</span></span>
<span id="cb1481-3"><a href="solutions.html#cb1481-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb1481-4"><a href="solutions.html#cb1481-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1481-5"><a href="solutions.html#cb1481-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_function</span>(<span class="at">fun =</span> dlnorm, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1481-6"><a href="solutions.html#cb1481-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">args =</span> <span class="fu">list</span>(<span class="at">meanlog =</span> <span class="fu">mean</span>(<span class="fu">log</span>(msleep<span class="sc">$</span>sleep_total)), </span>
<span id="cb1481-7"><a href="solutions.html#cb1481-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sdlog =</span> <span class="fu">sd</span>(<span class="fu">log</span>(msleep<span class="sc">$</span>sleep_total))))</span>
<span id="cb1481-8"><a href="solutions.html#cb1481-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-9"><a href="solutions.html#cb1481-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plot:</span></span>
<span id="cb1481-10"><a href="solutions.html#cb1481-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="at">sample =</span> sleep_total)) <span class="sc">+</span></span>
<span id="cb1481-11"><a href="solutions.html#cb1481-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_qq</span>(<span class="at">distribution =</span> qlnorm) <span class="sc">+</span></span>
<span id="cb1481-12"><a href="solutions.html#cb1481-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_qq_line</span>(<span class="at">distribution =</span> qlnorm)</span></code></pre></div>
<p>The right tail of the distribution differs greatly from the data. If we have to choose between these two distributions, then the normal distribution seems to be the better choice.</p>
<p><a href="#exr:ch7exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc4">7.3</a><a href="solutions.html#ch7solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>The documentation for <code>shapiro.test</code> shows that it takes a vector containing the data as input. So to apply it to the sleeping times data, we use:</li>
</ol>
<div class="sourceCode" id="cb1482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1482-1"><a href="solutions.html#cb1482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1482-2"><a href="solutions.html#cb1482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(msleep<span class="sc">$</span>sleep_total)</span></code></pre></div>
<p>The p-value is <span class="math inline">\(0.21\)</span>, meaning that we can’t reject the null hypothesis of normality - the test does not indicate that the data is non-normal.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we generate data from a <span class="math inline">\(\chi^2(100)\)</span> distribution, and compare its distribution to a normal density function:</li>
</ol>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1483-1"><a href="solutions.html#cb1483-1" aria-hidden="true" tabindex="-1"></a>generated_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rchisq</span>(<span class="dv">2000</span>, <span class="dv">100</span>))</span>
<span id="cb1483-2"><a href="solutions.html#cb1483-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1483-3"><a href="solutions.html#cb1483-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(generated_data, <span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb1483-4"><a href="solutions.html#cb1483-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb1483-5"><a href="solutions.html#cb1483-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1483-6"><a href="solutions.html#cb1483-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_function</span>(<span class="at">fun =</span> dnorm, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1483-7"><a href="solutions.html#cb1483-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(generated_data<span class="sc">$</span>x), </span>
<span id="cb1483-8"><a href="solutions.html#cb1483-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sd =</span> <span class="fu">sd</span>(generated_data<span class="sc">$</span>x)))</span></code></pre></div>
<p>The fit is likely to be very good - the data is visually very close to the normal distribution. Indeed, it is rare in practice to find real data that is closer to the normal distribution than this.</p>
<p>However, the Shapiro-Wilk test probably tells a different story:</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1484-1"><a href="solutions.html#cb1484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(generated_data<span class="sc">$</span>x)</span></code></pre></div>
<p>The lesson here is that if the sample size is large enough, the Shapiro-Wilk test (and any other test for normality, for that matter) is likely to reject normality even if the deviation from normality is tiny. When the sample size is too large, the power of the test is close to 1 even for very small deviations. On the other hand, if the sample size is small, the power of the Shapiro-Wilk test is low, meaning that it can’t be used to detect non-normality.</p>
<p>In summary, you probably shouldn’t use formal tests for normality at all. And I say that as someone who has written two papers introducing new tests for normality!</p>
<p><a href="modchapter.html#exr:ch7exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc5">7.4</a><a href="solutions.html#ch7solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As in Section <a href="datachapter.html#paths">3.3</a>, we set <code>file_path</code> to the path to <code>vas.csv</code> and load the data using the code from Exercise <a href="datachapter.html#exr:ch3exc4">3.8</a>:</p>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1485-1"><a href="solutions.html#cb1485-1" aria-hidden="true" tabindex="-1"></a>vas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>The null hypothesis is that the mean <span class="math inline">\(\mu\)</span> is less than or equal to 6, meaning that the alternative is that <span class="math inline">\(\mu\)</span> is greater than 6. To perform the test, we run:</p>
<div class="sourceCode" id="cb1486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1486-1"><a href="solutions.html#cb1486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(vas<span class="sc">$</span>VAS, <span class="at">mu =</span> <span class="dv">6</span>, <span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span></code></pre></div>
<p>The average VAS isn’t much higher than 6 - it’s 6.4 - but because the sample size is fairly large (<span class="math inline">\(n=2,351\)</span>) we are still able to detect that it indeed is greater.</p>
<p><a href="modchapter.html#exr:ch7exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc7">7.5</a><a href="solutions.html#ch7solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we assume that <code>delta</code> is 0.5 and that the standard deviation is 2, and want to find the <span class="math inline">\(n\)</span> required to achieve 95 % power at a 5 % significance level:</p>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1487-1"><a href="solutions.html#cb1487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">power =</span> <span class="fl">0.95</span>, <span class="at">delta =</span> <span class="fl">0.5</span>, <span class="at">sd =</span> <span class="dv">2</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb1487-2"><a href="solutions.html#cb1487-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span> <span class="st">&quot;one.sample&quot;</span>, <span class="at">alternative =</span> <span class="st">&quot;one.sided&quot;</span>)</span></code></pre></div>
<p>We see than <span class="math inline">\(n\)</span> needs to be at least 175 to achieve the desired power.</p>
<p>The actual sample size for this dataset was <span class="math inline">\(n=2,351\)</span>. Let’s see what power that gives us:</p>
<div class="sourceCode" id="cb1488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1488-1"><a href="solutions.html#cb1488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">n =</span> <span class="dv">2351</span>, <span class="at">delta =</span> <span class="fl">0.5</span>, <span class="at">sd =</span> <span class="dv">2</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb1488-2"><a href="solutions.html#cb1488-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span> <span class="st">&quot;one.sample&quot;</span>, <span class="at">alternative =</span> <span class="st">&quot;one.sided&quot;</span>)</span></code></pre></div>
<p>The power is 1 (or rather, very close to 1). We’re more or less guaranteed to find statistical evidence that the mean is greater than 6 if the true mean is 6.5!</p>
<p><a href="modchapter.html#exr:ch7exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc8">7.6</a><a href="solutions.html#ch7solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, let’s compute the proportion of herbivores and carnivores that sleep for more than 7 hours a day:</p>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1489-1"><a href="solutions.html#cb1489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1489-2"><a href="solutions.html#cb1489-2" aria-hidden="true" tabindex="-1"></a>herbivores <span class="ot">&lt;-</span> msleep[msleep<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;herbi&quot;</span>,]</span>
<span id="cb1489-3"><a href="solutions.html#cb1489-3" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(herbivores<span class="sc">$</span>sleep_total))</span>
<span id="cb1489-4"><a href="solutions.html#cb1489-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(herbivores<span class="sc">$</span>sleep_total <span class="sc">&gt;</span> <span class="dv">7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1489-5"><a href="solutions.html#cb1489-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1489-6"><a href="solutions.html#cb1489-6" aria-hidden="true" tabindex="-1"></a>carnivores <span class="ot">&lt;-</span> msleep[msleep<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;carni&quot;</span>,]</span>
<span id="cb1489-7"><a href="solutions.html#cb1489-7" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(carnivores<span class="sc">$</span>sleep_total))</span>
<span id="cb1489-8"><a href="solutions.html#cb1489-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(carnivores<span class="sc">$</span>sleep_total <span class="sc">&gt;</span> <span class="dv">7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The proportions are 0.625 and 0.68, respectively. To obtain a confidence interval for the difference of the two proportions, we use <code>binomDiffCI</code> as follows:</p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1490-1"><a href="solutions.html#cb1490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MKinfer)</span>
<span id="cb1490-2"><a href="solutions.html#cb1490-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binomDiffCI</span>(x1, x2, n1, n2, <span class="at">method =</span> <span class="st">&quot;wilson&quot;</span>)</span></code></pre></div>
<p><a href="modchapter.html#exr:ch7exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc9">7.12</a><a href="solutions.html#ch7solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To run the same simulation for different <span class="math inline">\(n\)</span>, we will write a function for the simulation, with the sample size <code>n</code> as an argument:</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="solutions.html#cb1491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for our custom estimator:</span></span>
<span id="cb1491-2"><a href="solutions.html#cb1491-2" aria-hidden="true" tabindex="-1"></a>max_min_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1491-3"><a href="solutions.html#cb1491-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1491-4"><a href="solutions.html#cb1491-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>((<span class="fu">max</span>(x)<span class="sc">+</span><span class="fu">min</span>(x))<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1491-5"><a href="solutions.html#cb1491-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1491-6"><a href="solutions.html#cb1491-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-7"><a href="solutions.html#cb1491-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for simulation:</span></span>
<span id="cb1491-8"><a href="solutions.html#cb1491-8" aria-hidden="true" tabindex="-1"></a>simulate_estimators <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">B =</span> <span class="fl">1e4</span>)</span>
<span id="cb1491-9"><a href="solutions.html#cb1491-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1491-10"><a href="solutions.html#cb1491-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1491-11"><a href="solutions.html#cb1491-11" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x_mean =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, B),</span>
<span id="cb1491-12"><a href="solutions.html#cb1491-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x_median =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, B),</span>
<span id="cb1491-13"><a href="solutions.html#cb1491-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x_mma =</span> <span class="fu">vector</span>(<span class="st">&quot;numeric&quot;</span>, B))</span>
<span id="cb1491-14"><a href="solutions.html#cb1491-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1491-15"><a href="solutions.html#cb1491-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start progress bar:</span></span>
<span id="cb1491-16"><a href="solutions.html#cb1491-16" aria-hidden="true" tabindex="-1"></a>    pbar <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> B, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb1491-17"><a href="solutions.html#cb1491-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1491-18"><a href="solutions.html#cb1491-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(res<span class="sc">$</span>x_mean))</span>
<span id="cb1491-19"><a href="solutions.html#cb1491-19" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1491-20"><a href="solutions.html#cb1491-20" aria-hidden="true" tabindex="-1"></a>          x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, mu, sigma)</span>
<span id="cb1491-21"><a href="solutions.html#cb1491-21" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_mean[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb1491-22"><a href="solutions.html#cb1491-22" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_median[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(x)</span>
<span id="cb1491-23"><a href="solutions.html#cb1491-23" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_mma[i] <span class="ot">&lt;-</span> <span class="fu">max_min_avg</span>(x)</span>
<span id="cb1491-24"><a href="solutions.html#cb1491-24" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb1491-25"><a href="solutions.html#cb1491-25" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Update progress bar</span></span>
<span id="cb1491-26"><a href="solutions.html#cb1491-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">setTxtProgressBar</span>(pbar, i)</span>
<span id="cb1491-27"><a href="solutions.html#cb1491-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1491-28"><a href="solutions.html#cb1491-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(pbar)</span>
<span id="cb1491-29"><a href="solutions.html#cb1491-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1491-30"><a href="solutions.html#cb1491-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return a list containing the sample size,</span></span>
<span id="cb1491-31"><a href="solutions.html#cb1491-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and the simulation results:</span></span>
<span id="cb1491-32"><a href="solutions.html#cb1491-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">n =</span> n,</span>
<span id="cb1491-33"><a href="solutions.html#cb1491-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">bias =</span> <span class="fu">colMeans</span>(res<span class="sc">-</span>mu),</span>
<span id="cb1491-34"><a href="solutions.html#cb1491-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">vars =</span> <span class="fu">apply</span>(res, <span class="dv">2</span>, var)))</span>
<span id="cb1491-35"><a href="solutions.html#cb1491-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We could write a <code>for</code> loop to perform the simulation for different values of <span class="math inline">\(n\)</span>. Alternatively, we can use a function, as in Section <a href="progchapter.html#vectorloops">6.5</a>. Here are two examples of how this can be done:</p>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1492-1"><a href="solutions.html#cb1492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of samples sizes:</span></span>
<span id="cb1492-2"><a href="solutions.html#cb1492-2" aria-hidden="true" tabindex="-1"></a>n_vector <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb1492-3"><a href="solutions.html#cb1492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-4"><a href="solutions.html#cb1492-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run a simulation for each value in n_vector:</span></span>
<span id="cb1492-5"><a href="solutions.html#cb1492-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-6"><a href="solutions.html#cb1492-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Using base R:</span></span>
<span id="cb1492-7"><a href="solutions.html#cb1492-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">data.frame</span>(<span class="at">n =</span> n_vector), <span class="dv">1</span>, simulate_estimators)</span>
<span id="cb1492-8"><a href="solutions.html#cb1492-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-9"><a href="solutions.html#cb1492-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Using purrr:</span></span>
<span id="cb1492-10"><a href="solutions.html#cb1492-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1492-11"><a href="solutions.html#cb1492-11" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">map</span>(n_vector, simulate_estimators)</span></code></pre></div>
<p>Next, we want to plot the results. We need to extract the results from the list <code>res</code> and store them in a data frame, so that we can plot them using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="solutions.html#cb1493-1" aria-hidden="true" tabindex="-1"></a>simres <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(res), <span class="dv">10</span>, <span class="dv">7</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1493-2"><a href="solutions.html#cb1493-2" aria-hidden="true" tabindex="-1"></a>simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(simres)</span>
<span id="cb1493-3"><a href="solutions.html#cb1493-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(simres) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">unlist</span>(res))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb1493-4"><a href="solutions.html#cb1493-4" aria-hidden="true" tabindex="-1"></a>simres</span></code></pre></div>
<p>Transforming the data frame from wide to long format (Section <a href="messychapter.html#reshaping">5.11</a>) makes plotting easier.</p>
<p>We can do this using <code>data.table</code>:</p>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1494-1"><a href="solutions.html#cb1494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1494-2"><a href="solutions.html#cb1494-2" aria-hidden="true" tabindex="-1"></a>simres2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">melt</span>(simres, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span>),</span>
<span id="cb1494-3"><a href="solutions.html#cb1494-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">measure.vars =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>))</span>
<span id="cb1494-4"><a href="solutions.html#cb1494-4" aria-hidden="true" tabindex="-1"></a>simres2[, <span class="fu">c</span>(<span class="st">&quot;measure&quot;</span>, <span class="st">&quot;estimator&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable,</span>
<span id="cb1494-5"><a href="solutions.html#cb1494-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;.&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<p>…or with <code>tidyr</code>:</p>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1495-1"><a href="solutions.html#cb1495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1495-2"><a href="solutions.html#cb1495-2" aria-hidden="true" tabindex="-1"></a>simres <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">names</span>(simres)[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>],</span>
<span id="cb1495-3"><a href="solutions.html#cb1495-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb1495-4"><a href="solutions.html#cb1495-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1495-5"><a href="solutions.html#cb1495-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">separate</span>(variable,</span>
<span id="cb1495-6"><a href="solutions.html#cb1495-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;measure&quot;</span>, <span class="st">&quot;estimator&quot;</span>),</span>
<span id="cb1495-7"><a href="solutions.html#cb1495-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep =</span> <span class="st">&quot;[.]&quot;</span>) <span class="ot">-&gt;</span> simres2</span></code></pre></div>
<p>We are now ready to plot the results:</p>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1496-1"><a href="solutions.html#cb1496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1496-2"><a href="solutions.html#cb1496-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bias, with a reference line at 0:</span></span>
<span id="cb1496-3"><a href="solutions.html#cb1496-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(simres2, measure <span class="sc">==</span> <span class="st">&quot;bias&quot;</span>), <span class="fu">aes</span>(n, value,</span>
<span id="cb1496-4"><a href="solutions.html#cb1496-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">col =</span> estimator)) <span class="sc">+</span></span>
<span id="cb1496-5"><a href="solutions.html#cb1496-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1496-6"><a href="solutions.html#cb1496-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb1496-7"><a href="solutions.html#cb1496-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Bias&quot;</span>)</span>
<span id="cb1496-8"><a href="solutions.html#cb1496-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1496-9"><a href="solutions.html#cb1496-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the variance:</span></span>
<span id="cb1496-10"><a href="solutions.html#cb1496-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(simres2, measure <span class="sc">==</span> <span class="st">&quot;vars&quot;</span>), <span class="fu">aes</span>(n, value,</span>
<span id="cb1496-11"><a href="solutions.html#cb1496-11" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">col =</span> estimator)) <span class="sc">+</span></span>
<span id="cb1496-12"><a href="solutions.html#cb1496-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1496-13"><a href="solutions.html#cb1496-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Variance&quot;</span>)</span></code></pre></div>
<p>All three estimators have a bias close to 0 for all values of <span class="math inline">\(n\)</span> (indeed, we can verify analytically that they are unbiased). The mean has the lowest variance for all <span class="math inline">\(n\)</span>, with the median as a close competitor. Our custom estimator has a higher variance, that also has a slower decrease as <span class="math inline">\(n\)</span> increases. In summary, based on bias and variance, the mean is the best estimator for the mean of a normal distribution.</p>
<p><a href="modchapter.html#exr:ch7exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc10">7.13</a><a href="solutions.html#ch7solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To perform the same simulation with <span class="math inline">\(t(3)\)</span>-distributed data, we can reuse the same code as in Exercise <a href="modchapter.html#exr:ch7exc9">7.12</a>, only replacing three lines:</p>
<ul>
<li>The arguments of <code>simulate_estimators</code> (<code>mu</code> and <code>sigma</code> are replaced by the degrees of freedom <code>df</code> of the <span class="math inline">\(t\)</span>-distribution,</li>
<li>The line were the data is generated (<code>rt</code> replaces <code>rnorm</code>),</li>
<li>The line were the bias is computed (the mean of the <span class="math inline">\(t\)</span>-distribution is always 0).</li>
</ul>
<div class="sourceCode" id="cb1497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1497-1"><a href="solutions.html#cb1497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for our custom estimator:</span></span>
<span id="cb1497-2"><a href="solutions.html#cb1497-2" aria-hidden="true" tabindex="-1"></a>max_min_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1497-3"><a href="solutions.html#cb1497-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1497-4"><a href="solutions.html#cb1497-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>((<span class="fu">max</span>(x)<span class="sc">+</span><span class="fu">min</span>(x))<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1497-5"><a href="solutions.html#cb1497-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1497-6"><a href="solutions.html#cb1497-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1497-7"><a href="solutions.html#cb1497-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for simulation:</span></span>
<span id="cb1497-8"><a href="solutions.html#cb1497-8" aria-hidden="true" tabindex="-1"></a>simulate_estimators <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">df =</span> <span class="dv">3</span>, <span class="at">B =</span> <span class="fl">1e4</span>)</span>
<span id="cb1497-9"><a href="solutions.html#cb1497-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1497-10"><a href="solutions.html#cb1497-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1497-11"><a href="solutions.html#cb1497-11" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x_mean =</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, B),</span>
<span id="cb1497-12"><a href="solutions.html#cb1497-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x_median =</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, B),</span>
<span id="cb1497-13"><a href="solutions.html#cb1497-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x_mma =</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, B))</span>
<span id="cb1497-14"><a href="solutions.html#cb1497-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1497-15"><a href="solutions.html#cb1497-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start progress bar:</span></span>
<span id="cb1497-16"><a href="solutions.html#cb1497-16" aria-hidden="true" tabindex="-1"></a>    pbar <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> B, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb1497-17"><a href="solutions.html#cb1497-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1497-18"><a href="solutions.html#cb1497-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(res<span class="sc">$</span>x_mean))</span>
<span id="cb1497-19"><a href="solutions.html#cb1497-19" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1497-20"><a href="solutions.html#cb1497-20" aria-hidden="true" tabindex="-1"></a>          x <span class="ot">&lt;-</span> <span class="fu">rt</span>(n, df)</span>
<span id="cb1497-21"><a href="solutions.html#cb1497-21" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_mean[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb1497-22"><a href="solutions.html#cb1497-22" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_median[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(x)</span>
<span id="cb1497-23"><a href="solutions.html#cb1497-23" aria-hidden="true" tabindex="-1"></a>          res<span class="sc">$</span>x_mma[i] <span class="ot">&lt;-</span> <span class="fu">max_min_avg</span>(x)</span>
<span id="cb1497-24"><a href="solutions.html#cb1497-24" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb1497-25"><a href="solutions.html#cb1497-25" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Update progress bar</span></span>
<span id="cb1497-26"><a href="solutions.html#cb1497-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">setTxtProgressBar</span>(pbar, i)</span>
<span id="cb1497-27"><a href="solutions.html#cb1497-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1497-28"><a href="solutions.html#cb1497-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(pbar)</span>
<span id="cb1497-29"><a href="solutions.html#cb1497-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1497-30"><a href="solutions.html#cb1497-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return a list containing the sample size,</span></span>
<span id="cb1497-31"><a href="solutions.html#cb1497-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and the simulation results:</span></span>
<span id="cb1497-32"><a href="solutions.html#cb1497-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">n =</span> n,</span>
<span id="cb1497-33"><a href="solutions.html#cb1497-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">bias =</span> <span class="fu">colMeans</span>(res<span class="dv">-0</span>),</span>
<span id="cb1497-34"><a href="solutions.html#cb1497-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">vars =</span> <span class="fu">apply</span>(res, <span class="dv">2</span>, var)))</span>
<span id="cb1497-35"><a href="solutions.html#cb1497-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>To perform the simulation, we can then e.g. run the following, which has been copied from the solution to the previous exercise.</p>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1498-1"><a href="solutions.html#cb1498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of samples sizes:</span></span>
<span id="cb1498-2"><a href="solutions.html#cb1498-2" aria-hidden="true" tabindex="-1"></a>n_vector <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb1498-3"><a href="solutions.html#cb1498-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1498-4"><a href="solutions.html#cb1498-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run a simulation for each value in n_vector:</span></span>
<span id="cb1498-5"><a href="solutions.html#cb1498-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">data.frame</span>(<span class="at">n =</span> n_vector), <span class="dv">1</span>, simulate_estimators)</span>
<span id="cb1498-6"><a href="solutions.html#cb1498-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1498-7"><a href="solutions.html#cb1498-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reformat the results:</span></span>
<span id="cb1498-8"><a href="solutions.html#cb1498-8" aria-hidden="true" tabindex="-1"></a>simres <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(res), <span class="dv">10</span>, <span class="dv">7</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1498-9"><a href="solutions.html#cb1498-9" aria-hidden="true" tabindex="-1"></a>simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(simres)</span>
<span id="cb1498-10"><a href="solutions.html#cb1498-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(simres) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">unlist</span>(res))[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb1498-11"><a href="solutions.html#cb1498-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1498-12"><a href="solutions.html#cb1498-12" aria-hidden="true" tabindex="-1"></a>simres2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">melt</span>(simres, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span>),</span>
<span id="cb1498-13"><a href="solutions.html#cb1498-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">measure.vars =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>))</span>
<span id="cb1498-14"><a href="solutions.html#cb1498-14" aria-hidden="true" tabindex="-1"></a>simres2[, <span class="fu">c</span>(<span class="st">&quot;measure&quot;</span>, <span class="st">&quot;estimator&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable,</span>
<span id="cb1498-15"><a href="solutions.html#cb1498-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;.&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb1498-16"><a href="solutions.html#cb1498-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the result</span></span>
<span id="cb1498-17"><a href="solutions.html#cb1498-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1498-18"><a href="solutions.html#cb1498-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bias, with a reference line at 0:</span></span>
<span id="cb1498-19"><a href="solutions.html#cb1498-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(simres2, measure <span class="sc">==</span> <span class="st">&quot;bias&quot;</span>), <span class="fu">aes</span>(n, value,</span>
<span id="cb1498-20"><a href="solutions.html#cb1498-20" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">col =</span> estimator)) <span class="sc">+</span></span>
<span id="cb1498-21"><a href="solutions.html#cb1498-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1498-22"><a href="solutions.html#cb1498-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb1498-23"><a href="solutions.html#cb1498-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Bias, t(3)-distribution&quot;</span>)</span>
<span id="cb1498-24"><a href="solutions.html#cb1498-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1498-25"><a href="solutions.html#cb1498-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the variance:</span></span>
<span id="cb1498-26"><a href="solutions.html#cb1498-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(simres2, measure <span class="sc">==</span> <span class="st">&quot;vars&quot;</span>), <span class="fu">aes</span>(n, value,</span>
<span id="cb1498-27"><a href="solutions.html#cb1498-27" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">col =</span> estimator)) <span class="sc">+</span></span>
<span id="cb1498-28"><a href="solutions.html#cb1498-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1498-29"><a href="solutions.html#cb1498-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Variance, t(3)-distribution&quot;</span>)</span></code></pre></div>
<p>The results are qualitatively similar to those for normal data.</p>
<p><a href="modchapter.html#exr:ch7exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc11">7.14</a><a href="solutions.html#ch7solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will use the functions that we created to simulate the type I error rates and powers of the three tests in Sections @ref(simtypeI} and <a href="modchapter.html#simpower">7.5.3</a>. Also, we must make sure to load the <code>MKinfer</code> package that contains <code>perm.t.test</code>.</p>
<p>To compare the type I error rates, we only need to supply the function <code>rt</code> for generating data and the parameter <code>df = 3</code> to clarify that a <span class="math inline">\(t(3)\)</span>-distribution should be used:</p>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1499-1"><a href="solutions.html#cb1499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_type_I</span>(<span class="dv">20</span>, <span class="dv">20</span>, rt, <span class="at">B =</span> <span class="dv">9999</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb1499-2"><a href="solutions.html#cb1499-2" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_type_I</span>(<span class="dv">20</span>, <span class="dv">30</span>, rt, <span class="at">B =</span> <span class="dv">9999</span>, <span class="at">df =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Here are the results from my runs:</p>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1500-1"><a href="solutions.html#cb1500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced sample sizes:</span></span>
<span id="cb1500-2"><a href="solutions.html#cb1500-2" aria-hidden="true" tabindex="-1"></a>     p_t_test p_perm_t_test    p_wilcoxon </span>
<span id="cb1500-3"><a href="solutions.html#cb1500-3" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.04340434</span>    <span class="fl">0.04810481</span>    <span class="fl">0.04860486</span> </span>
<span id="cb1500-4"><a href="solutions.html#cb1500-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1500-5"><a href="solutions.html#cb1500-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Imbalanced sample sizes:</span></span>
<span id="cb1500-6"><a href="solutions.html#cb1500-6" aria-hidden="true" tabindex="-1"></a>     p_t_test p_perm_t_test    p_wilcoxon </span>
<span id="cb1500-7"><a href="solutions.html#cb1500-7" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.04300430</span>    <span class="fl">0.04860486</span>    <span class="fl">0.04670467</span> </span></code></pre></div>
<p>The old-school t-test appears to be a little conservative, with an actual type I error rate close to <span class="math inline">\(0.043\)</span>. We can use <code>binomDiffCI</code> from <code>MKinfer</code> to get a confidence interval for the difference in type I error rate between the old-school t-test and the permutation t-test:</p>
<div class="sourceCode" id="cb1501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1501-1"><a href="solutions.html#cb1501-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">9999</span></span>
<span id="cb1501-2"><a href="solutions.html#cb1501-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binomDiffCI</span>(B<span class="sc">*</span><span class="fl">0.04810481</span>, B<span class="sc">*</span><span class="fl">0.04340434</span>, B, B, <span class="at">method =</span> <span class="st">&quot;wilson&quot;</span>)</span></code></pre></div>
<p>The confidence interval is <span class="math inline">\((-0.001, 0.010)\)</span>. Even though the old-school t-test appeared to have a lower type I error rate, we cannot say for sure, as a difference of 0 is included in the confidence interval. Increasing the number of simulated samples to, say, <span class="math inline">\(99,999\)</span>, might be required to detect any differences between the different tests.</p>
<p>Next, we compare the power of the tests. For the function used to simulate data for the second sample, we add a <code>+ 1</code> to shift the distribution to the right (so that the mean difference is 1):</p>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1502-1"><a href="solutions.html#cb1502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced sample sizes:</span></span>
<span id="cb1502-2"><a href="solutions.html#cb1502-2" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_power</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="cf">function</span>(n) { <span class="fu">rt</span>(n, <span class="at">df =</span> <span class="dv">3</span>,) },</span>
<span id="cb1502-3"><a href="solutions.html#cb1502-3" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">function</span>(n) { <span class="fu">rt</span>(n, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span> },</span>
<span id="cb1502-4"><a href="solutions.html#cb1502-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">B =</span> <span class="dv">9999</span>)</span>
<span id="cb1502-5"><a href="solutions.html#cb1502-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1502-6"><a href="solutions.html#cb1502-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Imbalanced sample sizes:</span></span>
<span id="cb1502-7"><a href="solutions.html#cb1502-7" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_power</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="cf">function</span>(n) { <span class="fu">rt</span>(n, <span class="at">df =</span> <span class="dv">3</span>,) },</span>
<span id="cb1502-8"><a href="solutions.html#cb1502-8" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">function</span>(n) { <span class="fu">rt</span>(n, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span> },</span>
<span id="cb1502-9"><a href="solutions.html#cb1502-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">B =</span> <span class="dv">9999</span>)</span></code></pre></div>
<p>Here are the results from my runs:</p>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1503-1"><a href="solutions.html#cb1503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced sample sizes:</span></span>
<span id="cb1503-2"><a href="solutions.html#cb1503-2" aria-hidden="true" tabindex="-1"></a>     p_t_test p_perm_t_test    p_wilcoxon </span>
<span id="cb1503-3"><a href="solutions.html#cb1503-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5127513</span>     <span class="fl">0.5272527</span>     <span class="fl">0.6524652</span> </span>
<span id="cb1503-4"><a href="solutions.html#cb1503-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1503-5"><a href="solutions.html#cb1503-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Imbalanced sample sizes:</span></span>
<span id="cb1503-6"><a href="solutions.html#cb1503-6" aria-hidden="true" tabindex="-1"></a>     p_t_test p_perm_t_test    p_wilcoxon </span>
<span id="cb1503-7"><a href="solutions.html#cb1503-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5898590</span>     <span class="fl">0.6010601</span>     <span class="fl">0.7423742</span> </span></code></pre></div>
<p>The Wilcoxon-Mann-Whitney test has the highest power in this example.</p>
<p><a href="modchapter.html#exr:ch7exc11">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions12" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="#exr:ch7exc12"><strong>??</strong></a><a href="solutions.html#ch7solutions12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Both the functions that we created in Section <a href="modchapter.html#simcorpower">7.6.1</a>, <code>simulate_power</code> and <code>power.cor.test</code> include <code>...</code> in their list of arguments, which allows us to pass additional arguments to interior functions. In particular, the line in <code>simulate_power</code> where the p-value for the correlation test is computed, contains this placeholder:</p>
<div class="sourceCode" id="cb1504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1504-1"><a href="solutions.html#cb1504-1" aria-hidden="true" tabindex="-1"></a>p_values[i] <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x[,<span class="dv">1</span>], x[,<span class="dv">2</span>], ...)<span class="sc">$</span>p.value</span></code></pre></div>
<p>This means that we can pass the argument <code>method = "spearman"</code> to use the functions to compute the sample size for the Spearman correlation test. Let’s try it:</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1505-1"><a href="solutions.html#cb1505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.cor.test</span>(<span class="at">n_start =</span> <span class="dv">10</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">power =</span> <span class="fl">0.9</span>,</span>
<span id="cb1505-2"><a href="solutions.html#cb1505-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb1505-3"><a href="solutions.html#cb1505-3" aria-hidden="true" tabindex="-1"></a><span class="fu">power.cor.test</span>(<span class="at">n_start =</span> <span class="dv">10</span>, <span class="at">rho =</span> <span class="fl">0.2</span>, <span class="at">power =</span> <span class="fl">0.8</span>,</span>
<span id="cb1505-4"><a href="solutions.html#cb1505-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<p>In my runs, the Pearson correlation test required the sample sizes <span class="math inline">\(n=45\)</span> and <span class="math inline">\(n=200\)</span>, whereas the Spearman correlation test required larger sample sizes: <span class="math inline">\(n=50\)</span> and <span class="math inline">\(n=215\)</span>.</p>
<p><a href="#exr:ch7exc12">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsCP" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7excCP">7.15</a><a href="solutions.html#ch7solutionsCP" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we create a function that simulates the expected width of the Clopper-Pearson interval for a given <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span>:</p>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1506-1"><a href="solutions.html#cb1506-1" aria-hidden="true" tabindex="-1"></a>cp_width <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, <span class="at">level =</span> <span class="fl">0.05</span>, <span class="at">B =</span> <span class="dv">999</span>)</span>
<span id="cb1506-2"><a href="solutions.html#cb1506-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1506-3"><a href="solutions.html#cb1506-3" aria-hidden="true" tabindex="-1"></a>      widths <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, B)</span>
<span id="cb1506-4"><a href="solutions.html#cb1506-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1506-5"><a href="solutions.html#cb1506-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Start progress bar:</span></span>
<span id="cb1506-6"><a href="solutions.html#cb1506-6" aria-hidden="true" tabindex="-1"></a>      pbar <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> B, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb1506-7"><a href="solutions.html#cb1506-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1506-8"><a href="solutions.html#cb1506-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B)</span>
<span id="cb1506-9"><a href="solutions.html#cb1506-9" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb1506-10"><a href="solutions.html#cb1506-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate binomial data:</span></span>
<span id="cb1506-11"><a href="solutions.html#cb1506-11" aria-hidden="true" tabindex="-1"></a>            x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, p)</span>
<span id="cb1506-12"><a href="solutions.html#cb1506-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1506-13"><a href="solutions.html#cb1506-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute interval width:</span></span>
<span id="cb1506-14"><a href="solutions.html#cb1506-14" aria-hidden="true" tabindex="-1"></a>            interval <span class="ot">&lt;-</span> <span class="fu">binomCI</span>(x, n, <span class="at">conf.level =</span> <span class="fl">0.95</span>,</span>
<span id="cb1506-15"><a href="solutions.html#cb1506-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">&quot;clopper-pearson&quot;</span>)<span class="sc">$</span>conf.int</span>
<span id="cb1506-16"><a href="solutions.html#cb1506-16" aria-hidden="true" tabindex="-1"></a>            widths[i] <span class="ot">&lt;-</span> interval[<span class="dv">2</span>] <span class="sc">-</span> interval[<span class="dv">1</span>]</span>
<span id="cb1506-17"><a href="solutions.html#cb1506-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1506-18"><a href="solutions.html#cb1506-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Update progress bar:</span></span>
<span id="cb1506-19"><a href="solutions.html#cb1506-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setTxtProgressBar</span>(pbar, i)</span>
<span id="cb1506-20"><a href="solutions.html#cb1506-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1506-21"><a href="solutions.html#cb1506-21" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1506-22"><a href="solutions.html#cb1506-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">close</span>(pbar)</span>
<span id="cb1506-23"><a href="solutions.html#cb1506-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1506-24"><a href="solutions.html#cb1506-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">mean</span>(widths))</span>
<span id="cb1506-25"><a href="solutions.html#cb1506-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next, we create a function with a <code>while</code> loop that finds the sample sizes required to achieve a desired expected width:</p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1507-1"><a href="solutions.html#cb1507-1" aria-hidden="true" tabindex="-1"></a>cp_ssize <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_start =</span> <span class="dv">10</span>, p, <span class="at">n_incr =</span> <span class="dv">5</span>, <span class="at">level =</span> <span class="fl">0.05</span>,</span>
<span id="cb1507-2"><a href="solutions.html#cb1507-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">B =</span> <span class="dv">999</span>)</span>
<span id="cb1507-3"><a href="solutions.html#cb1507-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1507-4"><a href="solutions.html#cb1507-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set initial values</span></span>
<span id="cb1507-5"><a href="solutions.html#cb1507-5" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n_start</span>
<span id="cb1507-6"><a href="solutions.html#cb1507-6" aria-hidden="true" tabindex="-1"></a>    width_now <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1507-7"><a href="solutions.html#cb1507-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1507-8"><a href="solutions.html#cb1507-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check power for different sample sizes:</span></span>
<span id="cb1507-9"><a href="solutions.html#cb1507-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span>(width_now <span class="sc">&gt;</span> width)</span>
<span id="cb1507-10"><a href="solutions.html#cb1507-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1507-11"><a href="solutions.html#cb1507-11" aria-hidden="true" tabindex="-1"></a>        width_now <span class="ot">&lt;-</span> <span class="fu">cp_width</span>(n, p, level, B)</span>
<span id="cb1507-12"><a href="solutions.html#cb1507-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;n =&quot;</span>, n, <span class="st">&quot; - Width:&quot;</span>, width_now, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1507-13"><a href="solutions.html#cb1507-13" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> n <span class="sc">+</span> n_incr</span>
<span id="cb1507-14"><a href="solutions.html#cb1507-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1507-15"><a href="solutions.html#cb1507-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1507-16"><a href="solutions.html#cb1507-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the result:</span></span>
<span id="cb1507-17"><a href="solutions.html#cb1507-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">When n =&quot;</span>, n, <span class="st">&quot;the expected with is&quot;</span>, <span class="fu">round</span>(width, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1507-18"><a href="solutions.html#cb1507-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(n)</span>
<span id="cb1507-19"><a href="solutions.html#cb1507-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, we run our simulation for <span class="math inline">\(p=0.1\)</span> (with expected width <span class="math inline">\(0.01\)</span>) and <span class="math inline">\(p=0.3\)</span> (expected width <span class="math inline">\(0.05\)</span>) and compare the results to the asymptotic answer:</p>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1508-1"><a href="solutions.html#cb1508-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p = 0.1</span></span>
<span id="cb1508-2"><a href="solutions.html#cb1508-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Asymptotic answer:</span></span>
<span id="cb1508-3"><a href="solutions.html#cb1508-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ssize.propCI</span>(<span class="at">prop =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">method =</span> <span class="st">&quot;clopper-pearson&quot;</span>)</span>
<span id="cb1508-4"><a href="solutions.html#cb1508-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1508-5"><a href="solutions.html#cb1508-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The asymptotic answer is 14,029 - so we need to set a fairly high</span></span>
<span id="cb1508-6"><a href="solutions.html#cb1508-6" aria-hidden="true" tabindex="-1"></a><span class="co"># starting value for n in our simulation!</span></span>
<span id="cb1508-7"><a href="solutions.html#cb1508-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cp_ssize</span>(<span class="at">n_start =</span> <span class="dv">14020</span>, <span class="at">p =</span> <span class="fl">0.1</span>, <span class="at">n_incr =</span> <span class="dv">1</span>, <span class="at">level =</span> <span class="fl">0.05</span>,</span>
<span id="cb1508-8"><a href="solutions.html#cb1508-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">9999</span>)</span>
<span id="cb1508-9"><a href="solutions.html#cb1508-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1508-10"><a href="solutions.html#cb1508-10" aria-hidden="true" tabindex="-1"></a><span class="do">#######</span></span>
<span id="cb1508-11"><a href="solutions.html#cb1508-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1508-12"><a href="solutions.html#cb1508-12" aria-hidden="true" tabindex="-1"></a><span class="co"># p = 0.3, width = 0.05</span></span>
<span id="cb1508-13"><a href="solutions.html#cb1508-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Asymptotic answer:</span></span>
<span id="cb1508-14"><a href="solutions.html#cb1508-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ssize.propCI</span>(<span class="at">prop =</span> <span class="fl">0.3</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">method =</span> <span class="st">&quot;clopper-pearson&quot;</span>)</span>
<span id="cb1508-15"><a href="solutions.html#cb1508-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1508-16"><a href="solutions.html#cb1508-16" aria-hidden="true" tabindex="-1"></a><span class="co"># The asymptotic answer is 343.</span></span>
<span id="cb1508-17"><a href="solutions.html#cb1508-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cp_ssize</span>(<span class="at">n_start =</span> <span class="dv">335</span>, <span class="at">p =</span> <span class="fl">0.3</span>, <span class="at">n_incr =</span> <span class="dv">1</span>, <span class="at">level =</span> <span class="fl">0.05</span>,</span>
<span id="cb1508-18"><a href="solutions.html#cb1508-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">B =</span> <span class="dv">9999</span>)</span></code></pre></div>
<p>As you can see, the asymptotic results are very close to those obtained from the simulation, and so using <code>ssize.propCI</code> is preferable in this case, as it is much faster.</p>
<p><a href="modchapter.html#exr:ch7excCP">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions13" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc13">7.16</a><a href="solutions.html#ch7solutions13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If we want to assume that the two populations have equal variances, we first have to create a centred dataset, where both groups have mean 0. We can then draw observations from this sample, and shift them by the two group means:</p>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1509-1"><a href="solutions.html#cb1509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1509-2"><a href="solutions.html#cb1509-2" aria-hidden="true" tabindex="-1"></a>boot_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">subset</span>(msleep,</span>
<span id="cb1509-3"><a href="solutions.html#cb1509-3" aria-hidden="true" tabindex="-1"></a>                  vore <span class="sc">==</span> <span class="st">&quot;carni&quot;</span> <span class="sc">|</span> vore <span class="sc">==</span> <span class="st">&quot;herbi&quot;</span>)[,<span class="fu">c</span>(<span class="st">&quot;sleep_total&quot;</span>,</span>
<span id="cb1509-4"><a href="solutions.html#cb1509-4" aria-hidden="true" tabindex="-1"></a>                                                          <span class="st">&quot;vore&quot;</span>)])</span>
<span id="cb1509-5"><a href="solutions.html#cb1509-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute group means and sizes:</span></span>
<span id="cb1509-6"><a href="solutions.html#cb1509-6" aria-hidden="true" tabindex="-1"></a>group_means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sleep_total <span class="sc">~</span> vore,</span>
<span id="cb1509-7"><a href="solutions.html#cb1509-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> boot_data, <span class="at">FUN =</span> mean)</span>
<span id="cb1509-8"><a href="solutions.html#cb1509-8" aria-hidden="true" tabindex="-1"></a>group_sizes <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sleep_total <span class="sc">~</span> vore,</span>
<span id="cb1509-9"><a href="solutions.html#cb1509-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> boot_data, <span class="at">FUN =</span> length)</span>
<span id="cb1509-10"><a href="solutions.html#cb1509-10" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> group_sizes[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb1509-11"><a href="solutions.html#cb1509-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-12"><a href="solutions.html#cb1509-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a centred dataset, where both groups have mean 0:</span></span>
<span id="cb1509-13"><a href="solutions.html#cb1509-13" aria-hidden="true" tabindex="-1"></a>boot_data<span class="sc">$</span>sleep_total[boot_data<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;carni&quot;</span>] <span class="ot">&lt;-</span> </span>
<span id="cb1509-14"><a href="solutions.html#cb1509-14" aria-hidden="true" tabindex="-1"></a>     boot_data<span class="sc">$</span>sleep_total[boot_data<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;carni&quot;</span>] <span class="sc">-</span></span>
<span id="cb1509-15"><a href="solutions.html#cb1509-15" aria-hidden="true" tabindex="-1"></a>                                      group_means[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb1509-16"><a href="solutions.html#cb1509-16" aria-hidden="true" tabindex="-1"></a>boot_data<span class="sc">$</span>sleep_total[boot_data<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;herbi&quot;</span>] <span class="ot">&lt;-</span> </span>
<span id="cb1509-17"><a href="solutions.html#cb1509-17" aria-hidden="true" tabindex="-1"></a>     boot_data<span class="sc">$</span>sleep_total[boot_data<span class="sc">$</span>vore <span class="sc">==</span> <span class="st">&quot;herbi&quot;</span>] <span class="sc">-</span></span>
<span id="cb1509-18"><a href="solutions.html#cb1509-18" aria-hidden="true" tabindex="-1"></a>                                      group_means[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb1509-19"><a href="solutions.html#cb1509-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-20"><a href="solutions.html#cb1509-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that we&#39;ve centred the two groups:</span></span>
<span id="cb1509-21"><a href="solutions.html#cb1509-21" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(sleep_total <span class="sc">~</span> vore, <span class="at">data =</span> boot_data, <span class="at">FUN =</span> mean)</span>
<span id="cb1509-22"><a href="solutions.html#cb1509-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-23"><a href="solutions.html#cb1509-23" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we resample from the centred data sets. Then we label</span></span>
<span id="cb1509-24"><a href="solutions.html#cb1509-24" aria-hidden="true" tabindex="-1"></a><span class="co"># some observations as carnivores, and add the group mean for</span></span>
<span id="cb1509-25"><a href="solutions.html#cb1509-25" aria-hidden="true" tabindex="-1"></a><span class="co"># carnivores to them, and label some as herbivores and add</span></span>
<span id="cb1509-26"><a href="solutions.html#cb1509-26" aria-hidden="true" tabindex="-1"></a><span class="co"># that group mean instead. That way both groups are used to</span></span>
<span id="cb1509-27"><a href="solutions.html#cb1509-27" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the variability of the observations.</span></span>
<span id="cb1509-28"><a href="solutions.html#cb1509-28" aria-hidden="true" tabindex="-1"></a>mean_diff_msleep <span class="ot">&lt;-</span> <span class="cf">function</span>(data, i)</span>
<span id="cb1509-29"><a href="solutions.html#cb1509-29" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb1509-30"><a href="solutions.html#cb1509-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a sample with the same mean as the carnivore group:</span></span>
<span id="cb1509-31"><a href="solutions.html#cb1509-31" aria-hidden="true" tabindex="-1"></a>    sample1 <span class="ot">&lt;-</span> data[i[<span class="dv">1</span><span class="sc">:</span>n1], <span class="dv">1</span>] <span class="sc">+</span> group_means[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb1509-32"><a href="solutions.html#cb1509-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a sample with the same mean as the herbivore group:</span></span>
<span id="cb1509-33"><a href="solutions.html#cb1509-33" aria-hidden="true" tabindex="-1"></a>    sample2 <span class="ot">&lt;-</span> data[i[(n1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(i)], <span class="dv">1</span>] <span class="sc">+</span> group_means[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb1509-34"><a href="solutions.html#cb1509-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the difference in means:</span></span>
<span id="cb1509-35"><a href="solutions.html#cb1509-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(sample1<span class="sc">$</span>sleep_total) <span class="sc">-</span> <span class="fu">mean</span>(sample2<span class="sc">$</span>sleep_total))</span>
<span id="cb1509-36"><a href="solutions.html#cb1509-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1509-37"><a href="solutions.html#cb1509-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-38"><a href="solutions.html#cb1509-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1509-39"><a href="solutions.html#cb1509-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-40"><a href="solutions.html#cb1509-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the resampling:</span></span>
<span id="cb1509-41"><a href="solutions.html#cb1509-41" aria-hidden="true" tabindex="-1"></a>boot_res <span class="ot">&lt;-</span> <span class="fu">boot</span>(boot_data,</span>
<span id="cb1509-42"><a href="solutions.html#cb1509-42" aria-hidden="true" tabindex="-1"></a>                 mean_diff_msleep,</span>
<span id="cb1509-43"><a href="solutions.html#cb1509-43" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">9999</span>)</span>
<span id="cb1509-44"><a href="solutions.html#cb1509-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1509-45"><a href="solutions.html#cb1509-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confidence intervals:</span></span>
<span id="cb1509-46"><a href="solutions.html#cb1509-46" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;perc&quot;</span>, <span class="st">&quot;bca&quot;</span>))</span></code></pre></div>
<p>The resulting percentile interval is close to that which we obtained without assuming equal variances. The BCa interval is however very different.</p>
<p><a href="modchapter.html#exr:ch7exc13">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions14" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="modchapter.html#exr:ch7exc14">7.17</a><a href="solutions.html#ch7solutions14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the percentile confidence interval from the previous exercise to compute p-values as follows (the null hypothesis is that the parameter is 0):</p>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="solutions.html#cb1510-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1510-2"><a href="solutions.html#cb1510-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.pval</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">theta_null =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>A more verbose solution would be to write a <code>while</code> loop:</p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1511-1"><a href="solutions.html#cb1511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The null hypothesis is there the difference is 0:</span></span>
<span id="cb1511-2"><a href="solutions.html#cb1511-2" aria-hidden="true" tabindex="-1"></a>diff_null <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1511-3"><a href="solutions.html#cb1511-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1511-4"><a href="solutions.html#cb1511-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set initial conditions:</span></span>
<span id="cb1511-5"><a href="solutions.html#cb1511-5" aria-hidden="true" tabindex="-1"></a>in_interval <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb1511-6"><a href="solutions.html#cb1511-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1511-7"><a href="solutions.html#cb1511-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1511-8"><a href="solutions.html#cb1511-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the lowest alpha for which diff_null is in the</span></span>
<span id="cb1511-9"><a href="solutions.html#cb1511-9" aria-hidden="true" tabindex="-1"></a><span class="co"># interval:</span></span>
<span id="cb1511-10"><a href="solutions.html#cb1511-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(in_interval)</span>
<span id="cb1511-11"><a href="solutions.html#cb1511-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1511-12"><a href="solutions.html#cb1511-12" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">&lt;-</span> alpha <span class="sc">+</span> <span class="fl">0.001</span></span>
<span id="cb1511-13"><a href="solutions.html#cb1511-13" aria-hidden="true" tabindex="-1"></a>    interval <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_res, </span>
<span id="cb1511-14"><a href="solutions.html#cb1511-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">conf =</span> <span class="dv">1</span> <span class="sc">-</span> alpha,</span>
<span id="cb1511-15"><a href="solutions.html#cb1511-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)<span class="sc">$</span>percent[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb1511-16"><a href="solutions.html#cb1511-16" aria-hidden="true" tabindex="-1"></a>    in_interval <span class="ot">&lt;-</span> diff_null <span class="sc">&gt;</span> interval[<span class="dv">1</span>] <span class="sc">&amp;</span> diff_null <span class="sc">&lt;</span> interval[<span class="dv">2</span>]</span>
<span id="cb1511-17"><a href="solutions.html#cb1511-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1511-18"><a href="solutions.html#cb1511-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1511-19"><a href="solutions.html#cb1511-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the p-value:</span></span>
<span id="cb1511-20"><a href="solutions.html#cb1511-20" aria-hidden="true" tabindex="-1"></a>alpha</span></code></pre></div>
<p>The p-value is approximately 0.52, and we can not reject the null hypothesis.</p>
<p><a href="modchapter.html#exr:ch7exc14">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="ch7bsolutions" class="section level2 unnumbered hasAnchor">
<h2>Chapter 8<a href="solutions.html#ch7bsolutions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch7solutions15" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc15">8.1</a><a href="solutions.html#ch7solutions15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path of <code>sales-weather.csv</code>. To load the data, fit the model and plot the results, we do the following:</p>
<div class="sourceCode" id="cb1512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1512-1"><a href="solutions.html#cb1512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data:</span></span>
<span id="cb1512-2"><a href="solutions.html#cb1512-2" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb1512-3"><a href="solutions.html#cb1512-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(weather)</span>
<span id="cb1512-4"><a href="solutions.html#cb1512-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1512-5"><a href="solutions.html#cb1512-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model:</span></span>
<span id="cb1512-6"><a href="solutions.html#cb1512-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS, <span class="at">data =</span> weather)</span>
<span id="cb1512-7"><a href="solutions.html#cb1512-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb1512-8"><a href="solutions.html#cb1512-8" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb1512-9"><a href="solutions.html#cb1512-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the result:</span></span>
<span id="cb1512-10"><a href="solutions.html#cb1512-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1512-11"><a href="solutions.html#cb1512-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weather, <span class="fu">aes</span>(SUN_HOURS, TEMPERATURE)) <span class="sc">+</span></span>
<span id="cb1512-12"><a href="solutions.html#cb1512-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1512-13"><a href="solutions.html#cb1512-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(m)[<span class="dv">1</span>], <span class="at">slope =</span> <span class="fu">coef</span>(m)[<span class="dv">2</span>]),</span>
<span id="cb1512-14"><a href="solutions.html#cb1512-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The coefficient for <code>SUN_HOURS</code> is not significantly non-zero at the 5 % level. The <span class="math inline">\(R^2\)</span> value is 0.035, which is very low. There is little evidence of a connection between the number of sun hours and the temperature during this period.</p>
<p><a href="regression.html#exr:ch7exc15">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions15b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc15b">8.2</a><a href="solutions.html#ch7solutions15b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit a model using the formula:</p>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1513-1"><a href="solutions.html#cb1513-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> mtcars)</span>
<span id="cb1513-2"><a href="solutions.html#cb1513-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>What we’ve just done is to create a model where all variables from the data frame (except <code>mpg</code>) are used as explanatory variables. This is the same model as we’d have obtained using the following (much longer) code:</p>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1514-1"><a href="solutions.html#cb1514-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> disp <span class="sc">+</span> hp <span class="sc">+</span> drat <span class="sc">+</span> wt <span class="sc">+</span></span>
<span id="cb1514-2"><a href="solutions.html#cb1514-2" aria-hidden="true" tabindex="-1"></a>          qsec <span class="sc">+</span> vs <span class="sc">+</span> am <span class="sc">+</span> gear <span class="sc">+</span> carb, <span class="at">data =</span> mtcars)</span></code></pre></div>
<p>The <code>~ .</code> shorthand is very useful when you want to fit a model with a lot of explanatory variables.</p>
<p><a href="regression.html#exr:ch7exc15b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions16" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc16">8.3</a><a href="solutions.html#ch7solutions16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we create the dummy variable:</p>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1515-1"><a href="solutions.html#cb1515-1" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>prec_dummy <span class="ot">&lt;-</span> <span class="fu">factor</span>(weather<span class="sc">$</span>PRECIPITATION <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Then, we fit the new model and have a look at the results. We won’t centre the <code>SUN_HOURS</code> variable, as the model is easy to interpret without centring. The intercept corresponds to the expected temperature on a day with 0 <code>SUN_HOURS</code> and no precipitation.</p>
<div class="sourceCode" id="cb1516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1516-1"><a href="solutions.html#cb1516-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1516-2"><a href="solutions.html#cb1516-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>Both <code>SUN_HOURS</code> and the dummy variable are significantly non-zero. In the next section, we’ll have a look at how we can visualise the results of this model.</p>
<p><a href="regression.html#exr:ch7exc16">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions17a" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc17a">8.4</a><a href="solutions.html#ch7solutions17a" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We run the code to create the two data frames. We then fit a model to the first dataset <code>exdata1</code>, and make some plots:</p>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="solutions.html#cb1517-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> exdata1)</span>
<span id="cb1517-2"><a href="solutions.html#cb1517-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1517-3"><a href="solutions.html#cb1517-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show fitted values in scatterplot:</span></span>
<span id="cb1517-4"><a href="solutions.html#cb1517-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1517-5"><a href="solutions.html#cb1517-5" aria-hidden="true" tabindex="-1"></a>m1_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> exdata1<span class="sc">$</span>x, <span class="at">y_pred =</span> <span class="fu">predict</span>(m1))</span>
<span id="cb1517-6"><a href="solutions.html#cb1517-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata1, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb1517-7"><a href="solutions.html#cb1517-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1517-8"><a href="solutions.html#cb1517-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> m1_pred, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_pred),</span>
<span id="cb1517-9"><a href="solutions.html#cb1517-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) </span>
<span id="cb1517-10"><a href="solutions.html#cb1517-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1517-11"><a href="solutions.html#cb1517-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plots:</span></span>
<span id="cb1517-12"><a href="solutions.html#cb1517-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1517-13"><a href="solutions.html#cb1517-13" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m1, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">label.size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>There are clear signs of <em>nonlinearity</em> here, that can be seen both in the scatterplot and the residuals versus fitted plot.</p>
<p>Next, we do the same for the second dataset:</p>
<div class="sourceCode" id="cb1518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1518-1"><a href="solutions.html#cb1518-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> exdata2)</span>
<span id="cb1518-2"><a href="solutions.html#cb1518-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1518-3"><a href="solutions.html#cb1518-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show fitted values in scatterplot:</span></span>
<span id="cb1518-4"><a href="solutions.html#cb1518-4" aria-hidden="true" tabindex="-1"></a>m2_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> exdata2<span class="sc">$</span>x, <span class="at">y_pred =</span> <span class="fu">predict</span>(m2))</span>
<span id="cb1518-5"><a href="solutions.html#cb1518-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata2, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb1518-6"><a href="solutions.html#cb1518-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1518-7"><a href="solutions.html#cb1518-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> m2_pred, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_pred),</span>
<span id="cb1518-8"><a href="solutions.html#cb1518-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) </span>
<span id="cb1518-9"><a href="solutions.html#cb1518-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1518-10"><a href="solutions.html#cb1518-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plots:</span></span>
<span id="cb1518-11"><a href="solutions.html#cb1518-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1518-12"><a href="solutions.html#cb1518-12" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m2, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">label.size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>There is a strong indication of <em>heteroscedasticity</em>. As is seen e.g. in the scatterplot and in the scale-location plot, the residuals appear to vary more the larger <code>x</code> becomes.</p>
<p><a href="regression.html#exr:ch7exc17a">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions17" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc17">8.5</a><a href="solutions.html#ch7solutions17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>First, we plot the observed values against the fitted values for the two models.</li>
</ol>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1519-1"><a href="solutions.html#cb1519-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The two models:</span></span>
<span id="cb1519-2"><a href="solutions.html#cb1519-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS, <span class="at">data =</span> weather)</span>
<span id="cb1519-3"><a href="solutions.html#cb1519-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1519-4"><a href="solutions.html#cb1519-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1519-5"><a href="solutions.html#cb1519-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(weather)</span>
<span id="cb1519-6"><a href="solutions.html#cb1519-6" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Observed =</span> <span class="fu">rep</span>(weather<span class="sc">$</span>TEMPERATURE, <span class="dv">2</span>),</span>
<span id="cb1519-7"><a href="solutions.html#cb1519-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Fitted =</span> <span class="fu">c</span>(<span class="fu">predict</span>(m1), <span class="fu">predict</span>(m2)),</span>
<span id="cb1519-8"><a href="solutions.html#cb1519-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Model 1&quot;</span>, <span class="st">&quot;Model 2&quot;</span>), <span class="fu">c</span>(n, n)))</span>
<span id="cb1519-9"><a href="solutions.html#cb1519-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1519-10"><a href="solutions.html#cb1519-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(models, <span class="fu">aes</span>(Fitted, Observed)) <span class="sc">+</span></span>
<span id="cb1519-11"><a href="solutions.html#cb1519-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1519-12"><a href="solutions.html#cb1519-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> Model, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1519-13"><a href="solutions.html#cb1519-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1519-14"><a href="solutions.html#cb1519-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Fitted values&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Observed values&quot;</span>)</span></code></pre></div>
<p>The first model only predicts values within a fairly narrow interval. The second model does a somewhat better job of predicting high temperatures.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we create residual plots for the second model.</li>
</ol>
<div class="sourceCode" id="cb1520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1520-1"><a href="solutions.html#cb1520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1520-2"><a href="solutions.html#cb1520-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m2, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">label.size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>There are no clear trends or signs of heteroscedasticity. There are some deviations from normality in the tail of the residual distribution. There are a few observations - 57, 76 and 83, that have fairly high Cook’s distance. Observation 76 also has a very high leverage. Let’s have a closer look at them:</p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1521-1"><a href="solutions.html#cb1521-1" aria-hidden="true" tabindex="-1"></a>weather[<span class="fu">c</span>(<span class="dv">57</span>, <span class="dv">76</span>, <span class="dv">83</span>),]</span></code></pre></div>
<p>As we can see using <code>sort(weather$SUN_HOURS)</code> and <code>min(weather$TEMPERATURE)</code>, observation 57 corresponds to the coldest day during the period, and observations 76 and 83 to the two days with the highest numbers of sun hours. Neither of them deviate too much from other observations though, so it shouldn’t be a problem that their Cook’s distances are little high.</p>
<p><a href="regression.html#exr:ch7exc17">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions18" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc18">8.6</a><a href="solutions.html#ch7solutions18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We run <code>boxcox</code> to find a suitable Box-Cox transformation for our model:</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1522-1"><a href="solutions.html#cb1522-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1522-2"><a href="solutions.html#cb1522-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1522-3"><a href="solutions.html#cb1522-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1522-4"><a href="solutions.html#cb1522-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(m)</span></code></pre></div>
<p>You’ll notice an error message, saying:</p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1523-1"><a href="solutions.html#cb1523-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">boxcox.default</span>(m) <span class="sc">:</span> response variable must be positive</span></code></pre></div>
<p>The <code>boxcox</code> method can only be used for non-negative response variables. We can solve this e.g. by transforming the temperature (which currently is in degrees Celsius) to degrees Fahrenheit, or by adding a constant to the temperature (which only will affect the intercept of the model, and not the slope coefficients). Let’s try the former:</p>
<div class="sourceCode" id="cb1524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1524-1"><a href="solutions.html#cb1524-1" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>TEMPERATUREplus10 <span class="ot">&lt;-</span> weather<span class="sc">$</span>TEMPERATURE <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb1524-2"><a href="solutions.html#cb1524-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATUREplus10 <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1524-3"><a href="solutions.html#cb1524-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1524-4"><a href="solutions.html#cb1524-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(m)</span></code></pre></div>
<p>The value <span class="math inline">\(\lambda = 1\)</span> is inside the interval indicated by the dotted lines. This corresponds to no transformation at all, meaning that there is no indication that we should transform our response variable.</p>
<p><a href="regression.html#exr:ch7exc18">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions19" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc19">8.7</a><a href="solutions.html#ch7solutions19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We refit the model using:</p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="solutions.html#cb1525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmPerm)</span>
<span id="cb1525-2"><a href="solutions.html#cb1525-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmp</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1525-3"><a href="solutions.html#cb1525-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>The main effects are still significant at the 5 % level.</p>
<p><a href="regression.html#exr:ch7exc19">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions20" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc20">8.8</a><a href="solutions.html#ch7solutions20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The easiest way to do this is to use <code>boot_summary</code>:</p>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="solutions.html#cb1526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1526-2"><a href="solutions.html#cb1526-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">rlm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1526-3"><a href="solutions.html#cb1526-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1526-4"><a href="solutions.html#cb1526-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1526-5"><a href="solutions.html#cb1526-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;residual&quot;</span>)</span></code></pre></div>
<p>We can also use <code>Boot</code>:</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="solutions.html#cb1527-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1527-2"><a href="solutions.html#cb1527-2" aria-hidden="true" tabindex="-1"></a>boot_res <span class="ot">&lt;-</span> <span class="fu">Boot</span>(m, <span class="at">method =</span> <span class="st">&quot;residual&quot;</span>)</span>
<span id="cb1527-3"><a href="solutions.html#cb1527-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1527-4"><a href="solutions.html#cb1527-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute 95 % confidence intervals using confint</span></span>
<span id="cb1527-5"><a href="solutions.html#cb1527-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)</span></code></pre></div>
<p>If instead we want to use <code>boot</code>, we begin by fitting the model:</p>
<div class="sourceCode" id="cb1528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1528-1"><a href="solutions.html#cb1528-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1528-2"><a href="solutions.html#cb1528-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">rlm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span></code></pre></div>
<p>Next, we compute the confidence intervals using <code>boot</code> and <code>boot.ci</code> (note that we use <code>rlm</code> inside the <code>coefficients</code> function!):</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="solutions.html#cb1529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1529-2"><a href="solutions.html#cb1529-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-3"><a href="solutions.html#cb1529-3" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, i, predictions, residuals) {</span>
<span id="cb1529-4"><a href="solutions.html#cb1529-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the bootstrap value of response variable by</span></span>
<span id="cb1529-5"><a href="solutions.html#cb1529-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># adding a randomly drawn residual to the value of the</span></span>
<span id="cb1529-6"><a href="solutions.html#cb1529-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fitted function for each observation:</span></span>
<span id="cb1529-7"><a href="solutions.html#cb1529-7" aria-hidden="true" tabindex="-1"></a>      data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]] <span class="ot">&lt;-</span> predictions <span class="sc">+</span> residuals[i]</span>
<span id="cb1529-8"><a href="solutions.html#cb1529-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1529-9"><a href="solutions.html#cb1529-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fit a new model with the bootstrap value of the response</span></span>
<span id="cb1529-10"><a href="solutions.html#cb1529-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># variable and the original explanatory variables:</span></span>
<span id="cb1529-11"><a href="solutions.html#cb1529-11" aria-hidden="true" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">rlm</span>(formula, <span class="at">data =</span> data)</span>
<span id="cb1529-12"><a href="solutions.html#cb1529-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">coef</span>(m))</span>
<span id="cb1529-13"><a href="solutions.html#cb1529-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1529-14"><a href="solutions.html#cb1529-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-15"><a href="solutions.html#cb1529-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear model:</span></span>
<span id="cb1529-16"><a href="solutions.html#cb1529-16" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">rlm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1529-17"><a href="solutions.html#cb1529-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-18"><a href="solutions.html#cb1529-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scaled and centred residuals:</span></span>
<span id="cb1529-19"><a href="solutions.html#cb1529-19" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(m)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">lm.influence</span>(m)<span class="sc">$</span>hat)</span>
<span id="cb1529-20"><a href="solutions.html#cb1529-20" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> res <span class="sc">-</span> <span class="fu">mean</span>(res)</span>
<span id="cb1529-21"><a href="solutions.html#cb1529-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-22"><a href="solutions.html#cb1529-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the bootstrap, extracting the model formula and the</span></span>
<span id="cb1529-23"><a href="solutions.html#cb1529-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted function from the model m:</span></span>
<span id="cb1529-24"><a href="solutions.html#cb1529-24" aria-hidden="true" tabindex="-1"></a>boot_res <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data =</span> mtcars, <span class="at">statistic =</span> coefficients,</span>
<span id="cb1529-25"><a href="solutions.html#cb1529-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">R =</span> <span class="dv">999</span>, <span class="at">formula =</span> <span class="fu">formula</span>(m),</span>
<span id="cb1529-26"><a href="solutions.html#cb1529-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">predictions =</span> <span class="fu">predict</span>(m),</span>
<span id="cb1529-27"><a href="solutions.html#cb1529-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">residuals =</span> res)</span>
<span id="cb1529-28"><a href="solutions.html#cb1529-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-29"><a href="solutions.html#cb1529-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confidence intervals:</span></span>
<span id="cb1529-30"><a href="solutions.html#cb1529-30" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">1</span>) <span class="co"># Intercept</span></span>
<span id="cb1529-31"><a href="solutions.html#cb1529-31" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">2</span>) <span class="co"># Sun hours</span></span>
<span id="cb1529-32"><a href="solutions.html#cb1529-32" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">3</span>) <span class="co"># Precipitation dummy</span></span>
<span id="cb1529-33"><a href="solutions.html#cb1529-33" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">4</span>) <span class="co"># Interaction term</span></span></code></pre></div>
<p>Using the connection between hypothesis tests and confidence intervals, to see whether an effect is significant at the 5 % level, you can check whether 0 is contained in the confidence interval. If not, then the effect is significant.</p>
<p><a href="regression.html#exr:ch7exc20">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions20b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc20b">8.9</a><a href="solutions.html#ch7solutions20b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit the model and then use <code>boot_summary</code> with <code>method = "case"</code>:</p>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="solutions.html#cb1530-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp <span class="sc">+</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb1530-2"><a href="solutions.html#cb1530-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1530-3"><a href="solutions.html#cb1530-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1530-4"><a href="solutions.html#cb1530-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;case&quot;</span>, <span class="at">R =</span> <span class="dv">9999</span>)</span>
<span id="cb1530-5"><a href="solutions.html#cb1530-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;residual&quot;</span>, <span class="at">R =</span> <span class="dv">9999</span>)</span></code></pre></div>
<p>In this case, the resulting confidence intervals are similar to what we obtained with residual resampling.</p>
<p><a href="regression.html#exr:ch7exc20b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions21" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc21">8.10</a><a href="solutions.html#ch7solutions21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we prepare the model and the data:</p>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1531-1"><a href="solutions.html#cb1531-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(TEMPERATURE <span class="sc">~</span> SUN_HOURS<span class="sc">*</span>prec_dummy, <span class="at">data =</span> weather)</span>
<span id="cb1531-2"><a href="solutions.html#cb1531-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SUN_HOURS =</span> <span class="dv">0</span>, <span class="at">prec_dummy =</span> <span class="st">&quot;TRUE&quot;</span>)</span></code></pre></div>
<p>We can then compute the prediction interval using <code>boot.ci</code>:</p>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1532-1"><a href="solutions.html#cb1532-1" aria-hidden="true" tabindex="-1"></a>boot_pred <span class="ot">&lt;-</span> <span class="cf">function</span>(data, new_data, model, i,</span>
<span id="cb1532-2"><a href="solutions.html#cb1532-2" aria-hidden="true" tabindex="-1"></a>                      formula, predictions, residuals){</span>
<span id="cb1532-3"><a href="solutions.html#cb1532-3" aria-hidden="true" tabindex="-1"></a>      data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]] <span class="ot">&lt;-</span> predictions <span class="sc">+</span> residuals[i]</span>
<span id="cb1532-4"><a href="solutions.html#cb1532-4" aria-hidden="true" tabindex="-1"></a>      m_boot <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> data)</span>
<span id="cb1532-5"><a href="solutions.html#cb1532-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">predict</span>(m_boot, <span class="at">newdata =</span> new_data) <span class="sc">+</span> </span>
<span id="cb1532-6"><a href="solutions.html#cb1532-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">sample</span>(<span class="fu">residuals</span>(m_boot), <span class="fu">nrow</span>(new_data))</span>
<span id="cb1532-7"><a href="solutions.html#cb1532-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1532-8"><a href="solutions.html#cb1532-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1532-9"><a href="solutions.html#cb1532-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1532-10"><a href="solutions.html#cb1532-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1532-11"><a href="solutions.html#cb1532-11" aria-hidden="true" tabindex="-1"></a>boot_res <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data =</span> m<span class="sc">$</span>model,</span>
<span id="cb1532-12"><a href="solutions.html#cb1532-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">statistic =</span> boot_pred,</span>
<span id="cb1532-13"><a href="solutions.html#cb1532-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">R =</span> <span class="dv">999</span>,</span>
<span id="cb1532-14"><a href="solutions.html#cb1532-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> m,</span>
<span id="cb1532-15"><a href="solutions.html#cb1532-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">new_data =</span> new_data,</span>
<span id="cb1532-16"><a href="solutions.html#cb1532-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">formula =</span> <span class="fu">formula</span>(m),</span>
<span id="cb1532-17"><a href="solutions.html#cb1532-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predictions =</span> <span class="fu">predict</span>(m),</span>
<span id="cb1532-18"><a href="solutions.html#cb1532-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">residuals =</span> <span class="fu">residuals</span>(m))</span>
<span id="cb1532-19"><a href="solutions.html#cb1532-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1532-20"><a href="solutions.html#cb1532-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % bootstrap prediction interval:</span></span>
<span id="cb1532-21"><a href="solutions.html#cb1532-21" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)</span></code></pre></div>
<p><a href="regression.html#exr:ch7exc21">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions21a" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc21a">8.11</a><a href="solutions.html#ch7solutions21a" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>autoplot</code> uses standard <code>ggplot2</code> syntax, so by adding <code>colour = mtcars$cyl</code> to <code>autoplot</code>, we can plot different groups in different colours:</p>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="solutions.html#cb1533-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb1533-2"><a href="solutions.html#cb1533-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am)</span>
<span id="cb1533-3"><a href="solutions.html#cb1533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1533-4"><a href="solutions.html#cb1533-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model and print ANOVA table:</span></span>
<span id="cb1533-5"><a href="solutions.html#cb1533-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aov</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> am, <span class="at">data =</span> mtcars)</span>
<span id="cb1533-6"><a href="solutions.html#cb1533-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1533-7"><a href="solutions.html#cb1533-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1533-8"><a href="solutions.html#cb1533-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">label.size =</span> <span class="dv">3</span>,</span>
<span id="cb1533-9"><a href="solutions.html#cb1533-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> mtcars<span class="sc">$</span>cyl)</span></code></pre></div>
<p><a href="regression.html#exr:ch7exc21a">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions21b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc21b">8.12</a><a href="solutions.html#ch7solutions21b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We rerun the analysis:</p>
<div class="sourceCode" id="cb1534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1534-1"><a href="solutions.html#cb1534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert variables to factors:</span></span>
<span id="cb1534-2"><a href="solutions.html#cb1534-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb1534-3"><a href="solutions.html#cb1534-3" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">factor</span>(mtcars<span class="sc">$</span>am)</span>
<span id="cb1534-4"><a href="solutions.html#cb1534-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-5"><a href="solutions.html#cb1534-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model and print ANOVA table:</span></span>
<span id="cb1534-6"><a href="solutions.html#cb1534-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmPerm)</span>
<span id="cb1534-7"><a href="solutions.html#cb1534-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aovp</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> am, <span class="at">data =</span> mtcars)</span>
<span id="cb1534-8"><a href="solutions.html#cb1534-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>Unfortunately, if you run this multiple times, the p-values will vary a lot. To fix that, you need to increase the maximum number of iterations allowed, by increasing <code>maxIter</code>, and changing the condition for the accuracy of the p-value by lowering <code>Ca</code>:</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="solutions.html#cb1535-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aovp</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> am, <span class="at">data =</span> mtcars,</span>
<span id="cb1535-2"><a href="solutions.html#cb1535-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">perm =</span> <span class="st">&quot;Prob&quot;</span>,</span>
<span id="cb1535-3"><a href="solutions.html#cb1535-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">Ca =</span> <span class="fl">1e-3</span>,</span>
<span id="cb1535-4"><a href="solutions.html#cb1535-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">maxIter =</span> <span class="fl">1e6</span>)</span>
<span id="cb1535-5"><a href="solutions.html#cb1535-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>According to <code>?aovp</code>, the <code>seqs</code> arguments controls which type of table is produced. It’s perhaps not perfectly clear from the documentation, but the default <code>seqs = FALSE</code> corresponds to a type III table, whereas <code>seqs = TRUE</code> corresponds to a type I table:</p>
<div class="sourceCode" id="cb1536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1536-1"><a href="solutions.html#cb1536-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Type I table:</span></span>
<span id="cb1536-2"><a href="solutions.html#cb1536-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aovp</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> am, <span class="at">data =</span> mtcars,</span>
<span id="cb1536-3"><a href="solutions.html#cb1536-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">seqs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1536-4"><a href="solutions.html#cb1536-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">perm =</span> <span class="st">&quot;Prob&quot;</span>,</span>
<span id="cb1536-5"><a href="solutions.html#cb1536-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">Ca =</span> <span class="fl">1e-3</span>,</span>
<span id="cb1536-6"><a href="solutions.html#cb1536-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">maxIter =</span> <span class="fl">1e6</span>)</span>
<span id="cb1536-7"><a href="solutions.html#cb1536-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p><a href="regression.html#exr:ch7exc21b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutions21c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7exc21c">8.13</a><a href="solutions.html#ch7solutions21c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can run the test using the usual formula notation:</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="solutions.html#cb1537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(mpg <span class="sc">~</span> cyl, <span class="at">data =</span> mtcars)</span></code></pre></div>
<p>The p-value is very low, and we conclude that the fuel consumption differs between the three groups.</p>
<p><a href="regression.html#exr:ch7exc21c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM1">8.16</a><a href="solutions.html#ch7solutionsGLM1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path of <code>shark.csv</code> and then load and inspect the data:</p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1538-1"><a href="solutions.html#cb1538-1" aria-hidden="true" tabindex="-1"></a>sharks <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb1538-2"><a href="solutions.html#cb1538-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(sharks)</span></code></pre></div>
<p>We need to convert the <code>Age</code> variable to a <code>numeric</code>, which will cause us to lose information (“NAs introduced by coercion”) about the age of the persons involved in some attacks, i.e. those with values like <code>20's</code> and <code>25 or 28</code>, which cannot be automatically coerced into numbers:</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1539-1"><a href="solutions.html#cb1539-1" aria-hidden="true" tabindex="-1"></a>sharks<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sharks<span class="sc">$</span>Age)</span></code></pre></div>
<p>Similarly, we’ll convert <code>Sex.</code> and <code>Fatal..Y.N.</code> to <code>factor</code> variables:</p>
<div class="sourceCode" id="cb1540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1540-1"><a href="solutions.html#cb1540-1" aria-hidden="true" tabindex="-1"></a>sharks<span class="sc">$</span>Sex. <span class="ot">&lt;-</span> <span class="fu">factor</span>(sharks<span class="sc">$</span>Sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>))</span>
<span id="cb1540-2"><a href="solutions.html#cb1540-2" aria-hidden="true" tabindex="-1"></a>sharks<span class="sc">$</span>Fatal..Y.N. <span class="ot">&lt;-</span> <span class="fu">factor</span>(sharks<span class="sc">$</span>Fatal..Y.N., <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>))</span></code></pre></div>
<p>We can now fit the model:</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="solutions.html#cb1541-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(Fatal..Y.N. <span class="sc">~</span> Age <span class="sc">+</span> Sex., <span class="at">data =</span> sharks, <span class="at">family =</span> binomial)</span>
<span id="cb1541-2"><a href="solutions.html#cb1541-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>Judging from the p-values, there is no evidence that sex and age affect the probability of an attack being fatal.</p>
<p><a href="regression.html#exr:ch7excGLM1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM1b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM1b">8.17</a><a href="solutions.html#ch7solutionsGLM1b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the same logistic regression model for the <code>wine</code> data as before:</p>
<div class="sourceCode" id="cb1542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1542-1"><a href="solutions.html#cb1542-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol, <span class="at">data =</span> wine, <span class="at">family =</span> binomial)</span></code></pre></div>
<p>The <code>broom</code> functions work also for generalised linear models. As for linear models, <code>tidy</code> gives the table of coefficients and p-values, <code>glance</code> gives some summary statistics, and <code>augment</code> adds fitted values and residuals to the original dataset:</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1543-1"><a href="solutions.html#cb1543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1543-2"><a href="solutions.html#cb1543-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m)</span>
<span id="cb1543-3"><a href="solutions.html#cb1543-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(m)</span>
<span id="cb1543-4"><a href="solutions.html#cb1543-4" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m)</span></code></pre></div>
<p><a href="regression.html#exr:ch7excGLM1b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM2">8.18</a><a href="solutions.html#ch7solutionsGLM2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the model <code>m</code> from the other exercise, we can now do the following.</p>
<ol style="list-style-type: decimal">
<li>Compute asymptotic confidence intervals:</li>
</ol>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1544-1"><a href="solutions.html#cb1544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1544-2"><a href="solutions.html#cb1544-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we compute bootstrap confidence intervals and p-values. In this case, the response variable is missing for a lot of observations. In order to use the same number of observations in our bootstrapping as when fitting the original model, we need to add a line to remove those observation (as in Section <a href="messychapter.html#conditions2">5.8.2</a>).</li>
</ol>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="solutions.html#cb1545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1545-2"><a href="solutions.html#cb1545-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Try fitting the model without removing missing values:</span></span>
<span id="cb1545-3"><a href="solutions.html#cb1545-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;case&quot;</span>)</span>
<span id="cb1545-4"><a href="solutions.html#cb1545-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1545-5"><a href="solutions.html#cb1545-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove missing values, refit the model, and then run</span></span>
<span id="cb1545-6"><a href="solutions.html#cb1545-6" aria-hidden="true" tabindex="-1"></a><span class="co"># boot_summary again:</span></span>
<span id="cb1545-7"><a href="solutions.html#cb1545-7" aria-hidden="true" tabindex="-1"></a>sharks2 <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(sharks, <span class="st">&quot;Fatal..Y.N.&quot;</span>)</span>
<span id="cb1545-8"><a href="solutions.html#cb1545-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(Fatal..Y.N. <span class="sc">~</span> Age <span class="sc">+</span> Sex., <span class="at">data =</span> sharks2,</span>
<span id="cb1545-9"><a href="solutions.html#cb1545-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> binomial)</span>
<span id="cb1545-10"><a href="solutions.html#cb1545-10" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;case&quot;</span>)</span></code></pre></div>
<p>If you prefer writing your own bootstrap code, you could proceed as follows:</p>
<div class="sourceCode" id="cb1546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1546-1"><a href="solutions.html#cb1546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb1546-2"><a href="solutions.html#cb1546-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-3"><a href="solutions.html#cb1546-3" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, predictions, ...) {</span>
<span id="cb1546-4"><a href="solutions.html#cb1546-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows where the response variable is missing:</span></span>
<span id="cb1546-5"><a href="solutions.html#cb1546-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(data, <span class="fu">all.vars</span>(formula)[<span class="dv">1</span>])</span>
<span id="cb1546-6"><a href="solutions.html#cb1546-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1546-7"><a href="solutions.html#cb1546-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check whether the response variable is a factor or</span></span>
<span id="cb1546-8"><a href="solutions.html#cb1546-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># numeric, and then resample:</span></span>
<span id="cb1546-9"><a href="solutions.html#cb1546-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.factor</span>(data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]])) {</span>
<span id="cb1546-10"><a href="solutions.html#cb1546-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If the response variable is a factor:</span></span>
<span id="cb1546-11"><a href="solutions.html#cb1546-11" aria-hidden="true" tabindex="-1"></a>      data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb1546-12"><a href="solutions.html#cb1546-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="fu">levels</span>(data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]])[<span class="dv">1</span> <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data),</span>
<span id="cb1546-13"><a href="solutions.html#cb1546-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="dv">1</span>, predictions)]) } <span class="cf">else</span> {</span>
<span id="cb1546-14"><a href="solutions.html#cb1546-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If the response variable is numeric:</span></span>
<span id="cb1546-15"><a href="solutions.html#cb1546-15" aria-hidden="true" tabindex="-1"></a>      data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb1546-16"><a href="solutions.html#cb1546-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">unique</span>(data[,<span class="fu">all.vars</span>(formula)[<span class="dv">1</span>]])[<span class="dv">1</span> <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data),</span>
<span id="cb1546-17"><a href="solutions.html#cb1546-17" aria-hidden="true" tabindex="-1"></a>                                              <span class="dv">1</span>, predictions)] }</span>
<span id="cb1546-18"><a href="solutions.html#cb1546-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1546-19"><a href="solutions.html#cb1546-19" aria-hidden="true" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> binomial)</span>
<span id="cb1546-20"><a href="solutions.html#cb1546-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">coef</span>(m))</span>
<span id="cb1546-21"><a href="solutions.html#cb1546-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1546-22"><a href="solutions.html#cb1546-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-23"><a href="solutions.html#cb1546-23" aria-hidden="true" tabindex="-1"></a>boot_res <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data =</span> sharks, <span class="at">statistic =</span> coefficients,</span>
<span id="cb1546-24"><a href="solutions.html#cb1546-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">R=</span><span class="dv">999</span>, <span class="at">formula =</span> <span class="fu">formula</span>(m),</span>
<span id="cb1546-25"><a href="solutions.html#cb1546-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">predictions =</span> <span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb1546-26"><a href="solutions.html#cb1546-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-27"><a href="solutions.html#cb1546-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confidence intervals:</span></span>
<span id="cb1546-28"><a href="solutions.html#cb1546-28" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">1</span>) <span class="co"># Intercept</span></span>
<span id="cb1546-29"><a href="solutions.html#cb1546-29" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">2</span>) <span class="co"># Age</span></span>
<span id="cb1546-30"><a href="solutions.html#cb1546-30" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(boot_res, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">3</span>) <span class="co"># Sex.M</span></span>
<span id="cb1546-31"><a href="solutions.html#cb1546-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-32"><a href="solutions.html#cb1546-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute p-values:</span></span>
<span id="cb1546-33"><a href="solutions.html#cb1546-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-34"><a href="solutions.html#cb1546-34" aria-hidden="true" tabindex="-1"></a><span class="co"># The null hypothesis is that the effect (beta coefficient)</span></span>
<span id="cb1546-35"><a href="solutions.html#cb1546-35" aria-hidden="true" tabindex="-1"></a><span class="co"># is 0:</span></span>
<span id="cb1546-36"><a href="solutions.html#cb1546-36" aria-hidden="true" tabindex="-1"></a>beta_null <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1546-37"><a href="solutions.html#cb1546-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-38"><a href="solutions.html#cb1546-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Set initial conditions:</span></span>
<span id="cb1546-39"><a href="solutions.html#cb1546-39" aria-hidden="true" tabindex="-1"></a>in_interval <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb1546-40"><a href="solutions.html#cb1546-40" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1546-41"><a href="solutions.html#cb1546-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-42"><a href="solutions.html#cb1546-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the lowest alpha for which beta_null is in the</span></span>
<span id="cb1546-43"><a href="solutions.html#cb1546-43" aria-hidden="true" tabindex="-1"></a><span class="co"># interval:</span></span>
<span id="cb1546-44"><a href="solutions.html#cb1546-44" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(in_interval)</span>
<span id="cb1546-45"><a href="solutions.html#cb1546-45" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1546-46"><a href="solutions.html#cb1546-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Based on the asymptotic test, we expect the p-value</span></span>
<span id="cb1546-47"><a href="solutions.html#cb1546-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to not be close to 0. We therefore increase alpha by</span></span>
<span id="cb1546-48"><a href="solutions.html#cb1546-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0.01 instead of 0.001 in each iteration.</span></span>
<span id="cb1546-49"><a href="solutions.html#cb1546-49" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">&lt;-</span> alpha <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb1546-50"><a href="solutions.html#cb1546-50" aria-hidden="true" tabindex="-1"></a>    interval <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_res, </span>
<span id="cb1546-51"><a href="solutions.html#cb1546-51" aria-hidden="true" tabindex="-1"></a>                        <span class="at">conf =</span> <span class="dv">1</span> <span class="sc">-</span> alpha,</span>
<span id="cb1546-52"><a href="solutions.html#cb1546-52" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">index =</span> <span class="dv">2</span>)<span class="sc">$</span>perc[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb1546-53"><a href="solutions.html#cb1546-53" aria-hidden="true" tabindex="-1"></a>    in_interval <span class="ot">&lt;-</span> beta_null <span class="sc">&gt;</span> interval[<span class="dv">1</span>] <span class="sc">&amp;</span> beta_null <span class="sc">&lt;</span> interval[<span class="dv">2</span>]</span>
<span id="cb1546-54"><a href="solutions.html#cb1546-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1546-55"><a href="solutions.html#cb1546-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-56"><a href="solutions.html#cb1546-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the p-value:</span></span>
<span id="cb1546-57"><a href="solutions.html#cb1546-57" aria-hidden="true" tabindex="-1"></a>alpha</span></code></pre></div>
<p><a href="regression.html#exr:ch7excGLM2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM3">8.19</a><a href="solutions.html#ch7solutionsGLM3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We draw a binned residual plot for our model:</p>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="solutions.html#cb1547-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(Fatal..Y.N. <span class="sc">~</span> Age <span class="sc">+</span> Sex., <span class="at">data =</span> sharks, <span class="at">family =</span> binomial)</span>
<span id="cb1547-2"><a href="solutions.html#cb1547-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-3"><a href="solutions.html#cb1547-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb1547-4"><a href="solutions.html#cb1547-4" aria-hidden="true" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb1547-5"><a href="solutions.html#cb1547-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">residuals</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span></code></pre></div>
<p>There are a few points outside the interval, but not too many. There is not trend, i.e. there is for instance no sign that the model has a worse performance when it predicts a larger probability of a fatal attack.</p>
<p>Next, we plot the Cook’s distances of the observations:</p>
<div class="sourceCode" id="cb1548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1548-1"><a href="solutions.html#cb1548-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">cooks.distance</span>(m)),</span>
<span id="cb1548-2"><a href="solutions.html#cb1548-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">CooksDistance =</span> <span class="fu">cooks.distance</span>(m))</span>
<span id="cb1548-3"><a href="solutions.html#cb1548-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1548-4"><a href="solutions.html#cb1548-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot index against the Cook&#39;s distance to find</span></span>
<span id="cb1548-5"><a href="solutions.html#cb1548-5" aria-hidden="true" tabindex="-1"></a><span class="co"># influential points:</span></span>
<span id="cb1548-6"><a href="solutions.html#cb1548-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(Index, CooksDistance)) <span class="sc">+</span></span>
<span id="cb1548-7"><a href="solutions.html#cb1548-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1548-8"><a href="solutions.html#cb1548-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(CooksDistance <span class="sc">&gt;</span> <span class="fl">0.05</span>,</span>
<span id="cb1548-9"><a href="solutions.html#cb1548-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">rownames</span>(res), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb1548-10"><a href="solutions.html#cb1548-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fl">1.1</span>)</span></code></pre></div>
<p>There are a few points with a high Cook’s distance. Let’s investigate point 116, which has the highest distance:</p>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="solutions.html#cb1549-1" aria-hidden="true" tabindex="-1"></a>sharks[<span class="dv">116</span>,]</span></code></pre></div>
<p>This observation corresponds to the oldest person in the dataset, and a fatal attack. Being an extreme observation, we’d expect it to have a high Cook’s distance.</p>
<p><a href="regression.html#exr:ch7excGLM3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM4">8.20</a><a href="solutions.html#ch7solutionsGLM4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we have a look at the <code>quakes</code> data:</p>
<div class="sourceCode" id="cb1550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1550-1"><a href="solutions.html#cb1550-1" aria-hidden="true" tabindex="-1"></a>?quakes</span>
<span id="cb1550-2"><a href="solutions.html#cb1550-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(quakes)</span></code></pre></div>
<p>We then fit a Poisson regression model with <code>stations</code> as response variable and <code>mag</code> as explanatory variable:</p>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="solutions.html#cb1551-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(stations <span class="sc">~</span> mag, <span class="at">data =</span> quakes, <span class="at">family =</span> poisson)</span>
<span id="cb1551-2"><a href="solutions.html#cb1551-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>We plot the fitted values against the observed values, create a binned residual plot, and perform a test of overdispersion:</p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="solutions.html#cb1552-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot observed against fitted:</span></span>
<span id="cb1552-2"><a href="solutions.html#cb1552-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Observed =</span> quakes<span class="sc">$</span>stations,</span>
<span id="cb1552-3"><a href="solutions.html#cb1552-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Fitted =</span> <span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb1552-4"><a href="solutions.html#cb1552-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1552-5"><a href="solutions.html#cb1552-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(Fitted, Observed)) <span class="sc">+</span></span>
<span id="cb1552-6"><a href="solutions.html#cb1552-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1552-7"><a href="solutions.html#cb1552-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1552-8"><a href="solutions.html#cb1552-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Fitted values&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Observed values&quot;</span>)</span>
<span id="cb1552-9"><a href="solutions.html#cb1552-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1552-10"><a href="solutions.html#cb1552-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Binned residual plot:</span></span>
<span id="cb1552-11"><a href="solutions.html#cb1552-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb1552-12"><a href="solutions.html#cb1552-12" aria-hidden="true" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb1552-13"><a href="solutions.html#cb1552-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">residuals</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb1552-14"><a href="solutions.html#cb1552-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1552-15"><a href="solutions.html#cb1552-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Test overdispersion</span></span>
<span id="cb1552-16"><a href="solutions.html#cb1552-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb1552-17"><a href="solutions.html#cb1552-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersiontest</span>(m, <span class="at">trafo =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Visually, the fit is pretty good. As indicated by the test, there are however signs of overdispersion. Let’s try a negative binomial regression instead.</p>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="solutions.html#cb1553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit NB regression:</span></span>
<span id="cb1553-2"><a href="solutions.html#cb1553-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1553-3"><a href="solutions.html#cb1553-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(stations <span class="sc">~</span> mag, <span class="at">data =</span> quakes)</span>
<span id="cb1553-4"><a href="solutions.html#cb1553-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb1553-5"><a href="solutions.html#cb1553-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1553-6"><a href="solutions.html#cb1553-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare fit of observed against fitted:</span></span>
<span id="cb1553-7"><a href="solutions.html#cb1553-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(quakes)</span>
<span id="cb1553-8"><a href="solutions.html#cb1553-8" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Observed =</span> <span class="fu">rep</span>(quakes<span class="sc">$</span>stations, <span class="dv">2</span>),</span>
<span id="cb1553-9"><a href="solutions.html#cb1553-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Fitted =</span> <span class="fu">c</span>(<span class="fu">predict</span>(m, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb1553-10"><a href="solutions.html#cb1553-10" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">predict</span>(m2, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)),</span>
<span id="cb1553-11"><a href="solutions.html#cb1553-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Poisson&quot;</span>, <span class="st">&quot;NegBin&quot;</span>),</span>
<span id="cb1553-12"><a href="solutions.html#cb1553-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">c</span>(n, n)))</span>
<span id="cb1553-13"><a href="solutions.html#cb1553-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1553-14"><a href="solutions.html#cb1553-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(models, <span class="fu">aes</span>(Fitted, Observed)) <span class="sc">+</span></span>
<span id="cb1553-15"><a href="solutions.html#cb1553-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1553-16"><a href="solutions.html#cb1553-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> Model, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1553-17"><a href="solutions.html#cb1553-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1553-18"><a href="solutions.html#cb1553-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Fitted values&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Observed values&quot;</span>)</span></code></pre></div>
<p>The difference between the models is tiny. We’d probably need to include more variables to get a real improvement of the model.</p>
<p><a href="regression.html#exr:ch7excGLM4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsGLM5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excGLM5">8.21</a><a href="solutions.html#ch7solutionsGLM5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can get confidence intervals for the <span class="math inline">\(\beta_j\)</span> using <code>boot_summary</code>, as in previous sections. To get bootstrap confidence intervals for the rate ratios <span class="math inline">\(e^{\beta_j}\)</span>, we exponentiate the confidence intervals for the <span class="math inline">\(\beta_j\)</span>:</p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1554-1"><a href="solutions.html#cb1554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1554-2"><a href="solutions.html#cb1554-2" aria-hidden="true" tabindex="-1"></a>boot_table <span class="ot">&lt;-</span> <span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">method =</span> <span class="st">&quot;case&quot;</span>)</span>
<span id="cb1554-3"><a href="solutions.html#cb1554-3" aria-hidden="true" tabindex="-1"></a>boot_table</span>
<span id="cb1554-4"><a href="solutions.html#cb1554-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1554-5"><a href="solutions.html#cb1554-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence intervals for rate ratios:</span></span>
<span id="cb1554-6"><a href="solutions.html#cb1554-6" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(boot_table[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span></code></pre></div>
<p><a href="regression.html#exr:ch7excGLM5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM1">8.22</a><a href="solutions.html#ch7solutionsLMM1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data and have a quick look at it:</p>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="solutions.html#cb1555-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1555-2"><a href="solutions.html#cb1555-2" aria-hidden="true" tabindex="-1"></a>?Oxboys</span>
<span id="cb1555-3"><a href="solutions.html#cb1555-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(Oxboys)</span></code></pre></div>
<p>Next, we make a plot for each boy (each subject):</p>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1556-1"><a href="solutions.html#cb1556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height, <span class="at">colour =</span> Subject)) <span class="sc">+</span></span>
<span id="cb1556-2"><a href="solutions.html#cb1556-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1556-3"><a href="solutions.html#cb1556-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1556-4"><a href="solutions.html#cb1556-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1556-5"><a href="solutions.html#cb1556-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Both intercepts and slopes seem to vary between individuals. Are they correlated?</p>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="solutions.html#cb1557-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect the coefficients from each linear model:</span></span>
<span id="cb1557-2"><a href="solutions.html#cb1557-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1557-3"><a href="solutions.html#cb1557-3" aria-hidden="true" tabindex="-1"></a>Oxboys <span class="sc">%&gt;%</span> <span class="fu">split</span>(.<span class="sc">$</span>Subject) <span class="sc">%&gt;%</span> </span>
<span id="cb1557-4"><a href="solutions.html#cb1557-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(height <span class="sc">~</span> age, <span class="at">data =</span> .)) <span class="sc">%&gt;%</span> </span>
<span id="cb1557-5"><a href="solutions.html#cb1557-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">map</span>(coef) <span class="ot">-&gt;</span> coefficients</span>
<span id="cb1557-6"><a href="solutions.html#cb1557-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1557-7"><a href="solutions.html#cb1557-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame:</span></span>
<span id="cb1557-8"><a href="solutions.html#cb1557-8" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(coefficients),</span>
<span id="cb1557-9"><a href="solutions.html#cb1557-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrow =</span> <span class="fu">length</span>(coefficients),</span>
<span id="cb1557-10"><a href="solutions.html#cb1557-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1557-11"><a href="solutions.html#cb1557-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="fu">names</span>(coefficients))</span>
<span id="cb1557-12"><a href="solutions.html#cb1557-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(coefficients) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb1557-13"><a href="solutions.html#cb1557-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1557-14"><a href="solutions.html#cb1557-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the coefficients:</span></span>
<span id="cb1557-15"><a href="solutions.html#cb1557-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coefficients, <span class="fu">aes</span>(Intercept, Age,</span>
<span id="cb1557-16"><a href="solutions.html#cb1557-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">colour =</span> <span class="fu">row.names</span>(coefficients))) <span class="sc">+</span></span>
<span id="cb1557-17"><a href="solutions.html#cb1557-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1557-18"><a href="solutions.html#cb1557-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1557-19"><a href="solutions.html#cb1557-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Subject&quot;</span>)</span>
<span id="cb1557-20"><a href="solutions.html#cb1557-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1557-21"><a href="solutions.html#cb1557-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the correlation:</span></span>
<span id="cb1557-22"><a href="solutions.html#cb1557-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(coefficients<span class="sc">$</span>Intercept, coefficients<span class="sc">$</span>Age)</span></code></pre></div>
<p>There is a strong indication that the intercepts and slopes have a positive correlation. We’ll therefore fit a linear mixed model with correlated random intercepts and slopes:</p>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1558-1"><a href="solutions.html#cb1558-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(height <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age<span class="sc">|</span>Subject), <span class="at">data =</span> Oxboys)</span>
<span id="cb1558-2"><a href="solutions.html#cb1558-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m, <span class="at">correlation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><a href="regression.html#exr:ch7excLMM1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM1b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM1">8.22</a><a href="solutions.html#ch7solutionsLMM1b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ll use the model that we fitted to the <code>Oxboys</code> data in the previous exercise:</p>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="solutions.html#cb1559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1559-2"><a href="solutions.html#cb1559-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1559-3"><a href="solutions.html#cb1559-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(height <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age<span class="sc">|</span>Subject), <span class="at">data =</span> Oxboys)</span></code></pre></div>
<p>First, we install <code>broom.mixed</code>:</p>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1560-1"><a href="solutions.html#cb1560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;broom.mixed&quot;</span>)</span></code></pre></div>
<p>Next, we obtain the summary table as a data frame using <code>tidy</code>:</p>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1561-1"><a href="solutions.html#cb1561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb1561-2"><a href="solutions.html#cb1561-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m)</span></code></pre></div>
<p>As you can see, fixed and random effects are shown in the same table. However, different information is displayed for the two types of variables (just as when we use <code>summary</code>).</p>
<p>Note that if we fit the model after loading the <code>lmerTest</code>, the <code>tidy</code> table also includes p-values:</p>
<div class="sourceCode" id="cb1562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1562-1"><a href="solutions.html#cb1562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1562-2"><a href="solutions.html#cb1562-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(height <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age<span class="sc">|</span>Subject), <span class="at">data =</span> Oxboys)</span>
<span id="cb1562-3"><a href="solutions.html#cb1562-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m)</span></code></pre></div>
<p><a href="regression.html#exr:ch7excLMM1b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM2">8.24</a><a href="solutions.html#ch7solutionsLMM2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the same model as in the previous exercise:</p>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="solutions.html#cb1563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1563-2"><a href="solutions.html#cb1563-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(height <span class="sc">~</span> age <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age<span class="sc">|</span>Subject), <span class="at">data =</span> Oxboys)</span></code></pre></div>
<p>We make some diagnostic plots:</p>
<div class="sourceCode" id="cb1564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1564-1"><a href="solutions.html#cb1564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1564-2"><a href="solutions.html#cb1564-2" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">fortify.merMod</span>(m)</span>
<span id="cb1564-3"><a href="solutions.html#cb1564-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1564-4"><a href="solutions.html#cb1564-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals:</span></span>
<span id="cb1564-5"><a href="solutions.html#cb1564-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fm, <span class="fu">aes</span>(.fitted, .resid)) <span class="sc">+</span></span>
<span id="cb1564-6"><a href="solutions.html#cb1564-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1564-7"><a href="solutions.html#cb1564-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1564-8"><a href="solutions.html#cb1564-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Fitted values&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb1564-9"><a href="solutions.html#cb1564-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1564-10"><a href="solutions.html#cb1564-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the residuals of different subjects:</span></span>
<span id="cb1564-11"><a href="solutions.html#cb1564-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fm, <span class="fu">aes</span>(Subject, .resid)) <span class="sc">+</span></span>
<span id="cb1564-12"><a href="solutions.html#cb1564-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb1564-13"><a href="solutions.html#cb1564-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1564-14"><a href="solutions.html#cb1564-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb1564-15"><a href="solutions.html#cb1564-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1564-16"><a href="solutions.html#cb1564-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed values versus fitted values:</span></span>
<span id="cb1564-17"><a href="solutions.html#cb1564-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fm, <span class="fu">aes</span>(.fitted, height)) <span class="sc">+</span></span>
<span id="cb1564-18"><a href="solutions.html#cb1564-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1564-19"><a href="solutions.html#cb1564-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1564-20"><a href="solutions.html#cb1564-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1564-21"><a href="solutions.html#cb1564-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Fitted values&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Observed values&quot;</span>)</span>
<span id="cb1564-22"><a href="solutions.html#cb1564-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1564-23"><a href="solutions.html#cb1564-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Q-Q plot of residuals:</span></span>
<span id="cb1564-24"><a href="solutions.html#cb1564-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fm, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span></span>
<span id="cb1564-25"><a href="solutions.html#cb1564-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb1564-26"><a href="solutions.html#cb1564-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1564-27"><a href="solutions.html#cb1564-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Q-Q plot of random effects:</span></span>
<span id="cb1564-28"><a href="solutions.html#cb1564-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">ranef</span>(m)<span class="sc">$</span>Subject, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1564-29"><a href="solutions.html#cb1564-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span>
<span id="cb1564-30"><a href="solutions.html#cb1564-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">ranef</span>(m)<span class="sc">$</span>Subject, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">age</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1564-31"><a href="solutions.html#cb1564-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>()</span></code></pre></div>
<p>Overall, the fit seems very good. There may be some heteroscedasticity, but nothing too bad. Some subjects have a larger spread in their residuals, which is to be expected in this case - growth in children is non-constant, and a large negative residual is therefore likely to be followed by a large positive residual, and vice versa. The regression errors and random effects all appear to be normally distributed.</p>
<p><a href="regression.html#exr:ch7excLMM2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM2b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM2b">8.25</a><a href="solutions.html#ch7solutionsLMM2b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To look for an interaction between <code>TVset</code> and <code>Assessor</code>, we draw an interaction plot:</p>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="solutions.html#cb1565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1565-2"><a href="solutions.html#cb1565-2" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(TVbo<span class="sc">$</span>Assessor, TVbo<span class="sc">$</span>TVset,</span>
<span id="cb1565-3"><a href="solutions.html#cb1565-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">response =</span> TVbo<span class="sc">$</span>Coloursaturation)</span></code></pre></div>
<p>The lines overlap and follow different patterns, so there appears to be an interaction. There are two ways in which we could include this. Which we choose depends on what we think our <em>clusters of correlated measurements</em> are. If only the assessors are clusters, we’d include this as a random slope:</p>
<div class="sourceCode" id="cb1566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1566-1"><a href="solutions.html#cb1566-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Coloursaturation <span class="sc">~</span> TVset<span class="sc">*</span>Picture <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TVset<span class="sc">|</span>Assessor),</span>
<span id="cb1566-2"><a href="solutions.html#cb1566-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> TVbo)</span>
<span id="cb1566-3"><a href="solutions.html#cb1566-3" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb1566-4"><a href="solutions.html#cb1566-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m)</span></code></pre></div>
<p>In this case, we think that there is a fixed interaction between each pair of assessor and TV set.</p>
<p>However, if we think that the interaction is random and varies between repetitions, the situation is different. In this case the combination of assessor and TV set are clusters of correlated measurements (which could make sense here, because we have repeated measurements for each assessor-TV set pair). We can then include the interaction as a nested random effect:</p>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1567-1"><a href="solutions.html#cb1567-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Coloursaturation <span class="sc">~</span> TVset<span class="sc">*</span>Picture <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Assessor<span class="sc">/</span>TVset),</span>
<span id="cb1567-2"><a href="solutions.html#cb1567-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> TVbo)</span>
<span id="cb1567-3"><a href="solutions.html#cb1567-3" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb1567-4"><a href="solutions.html#cb1567-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m)</span></code></pre></div>
<p>Neither of these approaches is inherently superior to the other. Which we choose is a matter of what we think best describes the correlation structure of the data.</p>
<p>In either case, the results are similar, and all fixed effects are significant at the 5 % level.</p>
<p><a href="regression.html#exr:ch7excLMM2b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM3">8.26</a><a href="solutions.html#ch7solutionsLMM3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>BROOD</code>, <code>INDEX</code> (subject ID number) and <code>LOCATION</code> all seem like they could cause measurements to be correlated, and so are good choices for random effects. To keep the model simple, we’ll only include random intercepts. We fit a mixed Poisson regression using <code>glmer</code>:</p>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1568-1"><a href="solutions.html#cb1568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1568-2"><a href="solutions.html#cb1568-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glmer</span>(TICKS <span class="sc">~</span> YEAR <span class="sc">+</span> HEIGHT <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>BROOD) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>INDEX) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>LOCATION),</span>
<span id="cb1568-3"><a href="solutions.html#cb1568-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> grouseticks, <span class="at">family =</span> poisson)</span>
<span id="cb1568-4"><a href="solutions.html#cb1568-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m, <span class="at">correlation =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>To compute the bootstrap confidence interval for the effect of <code>HEIGHT</code>, we use <code>boot_summary</code>:</p>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="solutions.html#cb1569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1569-2"><a href="solutions.html#cb1569-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_summary</span>(m, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>, <span class="at">R =</span> <span class="dv">100</span>)</span></code></pre></div>
<p><a href="regression.html#exr:ch7excLMM3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM3b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="#exr:ch7excLMM3b"><strong>??</strong></a><a href="solutions.html#ch7solutionsLMM3b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>ovarian</code> data comes from a randomised trial comparing two treatments for ovarian cancer:</p>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1570-1"><a href="solutions.html#cb1570-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1570-2"><a href="solutions.html#cb1570-2" aria-hidden="true" tabindex="-1"></a>?ovarian</span>
<span id="cb1570-3"><a href="solutions.html#cb1570-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ovarian)</span></code></pre></div>
<p>Let’s plot Kaplan-Meier curves to compare the two treatments:</p>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1571-1"><a href="solutions.html#cb1571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1571-2"><a href="solutions.html#cb1571-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(futime, fustat) <span class="sc">~</span> rx, <span class="at">data =</span> ovarian)</span>
<span id="cb1571-3"><a href="solutions.html#cb1571-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m)</span></code></pre></div>
<p>The parametric confidence interval overlap a lot. Let’s compute a bootstrap confidence interval for the difference in the 75 % quantile of the survival times. We set the quantile level using the <code>q</code> argument in <code>bootkm</code>:</p>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1572-1"><a href="solutions.html#cb1572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1572-2"><a href="solutions.html#cb1572-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-3"><a href="solutions.html#cb1572-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a survival object:</span></span>
<span id="cb1572-4"><a href="solutions.html#cb1572-4" aria-hidden="true" tabindex="-1"></a>survobj <span class="ot">&lt;-</span> <span class="fu">Surv</span>(ovarian<span class="sc">$</span>futime, ovarian<span class="sc">$</span>fustat)</span>
<span id="cb1572-5"><a href="solutions.html#cb1572-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-6"><a href="solutions.html#cb1572-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get bootstrap replicates of the 75 % quantile for the</span></span>
<span id="cb1572-7"><a href="solutions.html#cb1572-7" aria-hidden="true" tabindex="-1"></a><span class="co"># survival time for the two groups:</span></span>
<span id="cb1572-8"><a href="solutions.html#cb1572-8" aria-hidden="true" tabindex="-1"></a>q75_surv_time_1 <span class="ot">&lt;-</span> <span class="fu">bootkm</span>(survobj[ovarian<span class="sc">$</span>rx <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb1572-9"><a href="solutions.html#cb1572-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">q =</span> <span class="fl">0.75</span>, <span class="at">B =</span> <span class="dv">999</span>)</span>
<span id="cb1572-10"><a href="solutions.html#cb1572-10" aria-hidden="true" tabindex="-1"></a>q75_surv_time_2 <span class="ot">&lt;-</span> <span class="fu">bootkm</span>(survobj[ovarian<span class="sc">$</span>rx <span class="sc">==</span> <span class="dv">2</span>],</span>
<span id="cb1572-11"><a href="solutions.html#cb1572-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">q =</span> <span class="fl">0.75</span>, <span class="at">B =</span> <span class="dv">999</span>)</span>
<span id="cb1572-12"><a href="solutions.html#cb1572-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-13"><a href="solutions.html#cb1572-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % bootstrap confidence interval for the difference in</span></span>
<span id="cb1572-14"><a href="solutions.html#cb1572-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 75 % quantile of the survival time distribution:</span></span>
<span id="cb1572-15"><a href="solutions.html#cb1572-15" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(q75_surv_time_2 <span class="sc">-</span> q75_surv_time_1,</span>
<span id="cb1572-16"><a href="solutions.html#cb1572-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The resulting confidence interval is very wide!</p>
<p><a href="#exr:ch7excLMM3b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM3c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM3c">8.27</a><a href="solutions.html#ch7solutionsLMM3c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>First, we fit a Cox regression model. From <code>?ovarian</code> we see that the survival/censoring times are given by <code>futime</code> and the censoring status by <code>fustat</code>.</li>
</ol>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="solutions.html#cb1573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1573-2"><a href="solutions.html#cb1573-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(futime, fustat) <span class="sc">~</span> age <span class="sc">+</span> rx,</span>
<span id="cb1573-3"><a href="solutions.html#cb1573-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> ovarian, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1573-4"><a href="solutions.html#cb1573-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>According to the p-value in the table, which is 0.2, there is no significant difference between the two treatment groups. Put differently, there is no evidence that the hazard ratio for treatment isn’t equal to 1.</p>
<p>To assess the assumption of proportional hazards, we plot the Schoenfeld residuals:</p>
<div class="sourceCode" id="cb1574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1574-1"><a href="solutions.html#cb1574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1574-2"><a href="solutions.html#cb1574-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(m), <span class="at">var =</span> <span class="dv">1</span>)</span>
<span id="cb1574-3"><a href="solutions.html#cb1574-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(m), <span class="at">var =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>There is no clear trend over time, and the assumption appears to hold.</p>
<ol start="2" style="list-style-type: decimal">
<li>To compute a bootstrap confidence interval for the hazard ratio for age, we follow the same steps as in the <code>lung</code> example, using <code>censboot_summary</code>:.</li>
</ol>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1575-1"><a href="solutions.html#cb1575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot.pval)</span>
<span id="cb1575-2"><a href="solutions.html#cb1575-2" aria-hidden="true" tabindex="-1"></a><span class="fu">censboot_summary</span>(m)</span></code></pre></div>
<p>All values in the confidence interval are positive, meaning that we are fairly sure that the hazard increases with age.</p>
<p><a href="regression.html#exr:ch7excLMM3c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM4">8.28</a><a href="solutions.html#ch7solutionsLMM4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we fit the model:</p>
<div class="sourceCode" id="cb1576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1576-1"><a href="solutions.html#cb1576-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(futime, status) <span class="sc">~</span> age <span class="sc">+</span> type <span class="sc">+</span> trt,</span>
<span id="cb1576-2"><a href="solutions.html#cb1576-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">cluster =</span> id, <span class="at">data =</span> retinopathy)</span>
<span id="cb1576-3"><a href="solutions.html#cb1576-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>To check the assumption of proportional hazards, we make a residual plot:</p>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1577-1"><a href="solutions.html#cb1577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1577-2"><a href="solutions.html#cb1577-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(m), <span class="at">var =</span> <span class="dv">1</span>)</span>
<span id="cb1577-3"><a href="solutions.html#cb1577-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(m), <span class="at">var =</span> <span class="dv">2</span>)</span>
<span id="cb1577-4"><a href="solutions.html#cb1577-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxzph</span>(<span class="fu">cox.zph</span>(m), <span class="at">var =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>As there are no trends over time, there is no evidence against the assumption of proportional hazards.</p>
<p><a href="regression.html#exr:ch7excLMM4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLMM5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLMM5">8.29</a><a href="solutions.html#ch7solutionsLMM5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit the model using <code>survreg</code>:</p>
<div class="sourceCode" id="cb1578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1578-1"><a href="solutions.html#cb1578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1578-2"><a href="solutions.html#cb1578-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(futime, fustat) <span class="sc">~</span> ., <span class="at">data =</span> ovarian,</span>
<span id="cb1578-3"><a href="solutions.html#cb1578-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">dist =</span> <span class="st">&quot;loglogistic&quot;</span>)</span></code></pre></div>
<p>To get the estimated effect on survival times, we exponentiate the coefficients:</p>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="solutions.html#cb1579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m))</span></code></pre></div>
<p>According to the model, the survival time increases 1.8 times for patients in treatment group 2, compared to patients in treatment group 1. Running <code>summary(m)</code> shows that the p-value for <code>rx</code> is 0.05, meaning that the result isn’t significant at the 5 % level (albeit with the smallest possible margin!).</p>
<p><a href="regression.html#exr:ch7excLMM5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLoD1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLoD1">8.30</a><a href="solutions.html#ch7solutionsLoD1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>il2rb.csv</code> and then load the data (note that it uses a decimal comma!):</p>
<div class="sourceCode" id="cb1580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1580-1"><a href="solutions.html#cb1580-1" aria-hidden="true" tabindex="-1"></a>biomarkers <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p>Next, we check which measurements that are nondetects, and impute the detection limit 0.25:</p>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="solutions.html#cb1581-1" aria-hidden="true" tabindex="-1"></a>censored <span class="ot">&lt;-</span> <span class="fu">is.na</span>(biomarkers<span class="sc">$</span>IL2RB)</span>
<span id="cb1581-2"><a href="solutions.html#cb1581-2" aria-hidden="true" tabindex="-1"></a>biomarkers<span class="sc">$</span>IL2RB[censored] <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb1581-3"><a href="solutions.html#cb1581-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1581-4"><a href="solutions.html#cb1581-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the proportion of nondetects:</span></span>
<span id="cb1581-5"><a href="solutions.html#cb1581-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(censored)</span></code></pre></div>
<p>27.5 % of the observations are left-censored.</p>
<p>To compute bootstrap confidence intervals for the mean of the biomarker level distribution under the assumption of lognormality, we can now use <code>elnormAltCensored</code>:</p>
<div class="sourceCode" id="cb1582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1582-1"><a href="solutions.html#cb1582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">elnormAltCensored</span>(biomarkers<span class="sc">$</span>IL2RB, censored, <span class="at">method =</span> <span class="st">&quot;mle&quot;</span>,</span>
<span id="cb1582-2"><a href="solutions.html#cb1582-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">ci =</span> <span class="cn">TRUE</span>,  <span class="at">ci.method =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb1582-3"><a href="solutions.html#cb1582-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">n.bootstraps =</span> <span class="dv">999</span>)<span class="sc">$</span>interval<span class="sc">$</span>limits</span></code></pre></div>
<p><a href="regression.html#exr:ch7excLoD1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch7solutionsLoD2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="regression.html#exr:ch7excLoD2">8.31</a><a href="solutions.html#ch7solutionsLoD2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>il2rb.csv</code> and then load and prepare the data:</p>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="solutions.html#cb1583-1" aria-hidden="true" tabindex="-1"></a>biomarkers <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb1583-2"><a href="solutions.html#cb1583-2" aria-hidden="true" tabindex="-1"></a>censored <span class="ot">&lt;-</span> <span class="fu">is.na</span>(biomarkers<span class="sc">$</span>IL2RB)</span>
<span id="cb1583-3"><a href="solutions.html#cb1583-3" aria-hidden="true" tabindex="-1"></a>biomarkers<span class="sc">$</span>IL2RB[censored] <span class="ot">&lt;-</span> <span class="fl">0.25</span></span></code></pre></div>
<p>Based on the recommendations in Zhang et al. (2009), we can now run a Wilcoxon-Mann-Whitney test. Because we’ve imputed the LoD for the nondetects, all observations are included in the test:</p>
<div class="sourceCode" id="cb1584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1584-1"><a href="solutions.html#cb1584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(IL2RB <span class="sc">~</span> Group, <span class="at">data =</span> biomarkers)</span></code></pre></div>
<p>The p-value is 0.42, and we do not reject the null hypothesis that there is no difference in location.</p>
<p><a href="regression.html#exr:ch7excLoD2">(Click here to return to the exercise.)</a></p>
</div>
</div>
<div id="ch8solutions" class="section level2 unnumbered hasAnchor">
<h2>Chapter 9<a href="solutions.html#ch8solutions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ch8solutions1" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc1">9.1</a><a href="solutions.html#ch8solutions1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We load the data and compute the expected values using the formula <span class="math inline">\(y = 2x_1-x_2+x_3\cdot x_2\)</span>:</li>
</ol>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="solutions.html#cb1585-1" aria-hidden="true" tabindex="-1"></a>exdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">0.87</span>, <span class="sc">-</span><span class="fl">1.03</span>, <span class="fl">0.02</span>, <span class="sc">-</span><span class="fl">0.25</span>, <span class="sc">-</span><span class="fl">1.09</span>, <span class="fl">0.74</span>,</span>
<span id="cb1585-2"><a href="solutions.html#cb1585-2" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.09</span>, <span class="sc">-</span><span class="fl">1.64</span>, <span class="sc">-</span><span class="fl">0.32</span>, <span class="sc">-</span><span class="fl">0.33</span>, <span class="fl">1.40</span>, <span class="fl">0.29</span>, <span class="sc">-</span><span class="fl">0.71</span>, <span class="fl">1.36</span>, <span class="fl">0.64</span>,</span>
<span id="cb1585-3"><a href="solutions.html#cb1585-3" aria-hidden="true" tabindex="-1"></a>          <span class="sc">-</span><span class="fl">0.78</span>, <span class="sc">-</span><span class="fl">0.58</span>, <span class="fl">0.67</span>, <span class="sc">-</span><span class="fl">0.90</span>, <span class="sc">-</span><span class="fl">1.52</span>, <span class="sc">-</span><span class="fl">0.11</span>, <span class="sc">-</span><span class="fl">0.65</span>, <span class="fl">0.04</span>,</span>
<span id="cb1585-4"><a href="solutions.html#cb1585-4" aria-hidden="true" tabindex="-1"></a>          <span class="sc">-</span><span class="fl">0.72</span>, <span class="fl">1.71</span>, <span class="sc">-</span><span class="fl">1.58</span>, <span class="sc">-</span><span class="fl">1.76</span>, <span class="fl">2.10</span>, <span class="fl">0.81</span>, <span class="sc">-</span><span class="fl">0.30</span>),</span>
<span id="cb1585-5"><a href="solutions.html#cb1585-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">1.38</span>, <span class="fl">0.14</span>, <span class="fl">1.46</span>, <span class="fl">0.27</span>, <span class="sc">-</span><span class="fl">1.02</span>, <span class="sc">-</span><span class="fl">1.94</span>, <span class="fl">0.12</span>, <span class="sc">-</span><span class="fl">0.64</span>,</span>
<span id="cb1585-6"><a href="solutions.html#cb1585-6" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.64</span>, <span class="sc">-</span><span class="fl">0.39</span>, <span class="fl">0.28</span>, <span class="fl">0.50</span>, <span class="sc">-</span><span class="fl">1.29</span>, <span class="fl">0.52</span>, <span class="fl">0.28</span>, <span class="fl">0.23</span>, <span class="fl">0.05</span>,</span>
<span id="cb1585-7"><a href="solutions.html#cb1585-7" aria-hidden="true" tabindex="-1"></a>          <span class="fl">3.10</span>, <span class="fl">0.84</span>, <span class="sc">-</span><span class="fl">0.66</span>, <span class="sc">-</span><span class="fl">1.35</span>, <span class="sc">-</span><span class="fl">0.06</span>, <span class="sc">-</span><span class="fl">0.66</span>, <span class="fl">0.40</span>, <span class="sc">-</span><span class="fl">0.23</span>,</span>
<span id="cb1585-8"><a href="solutions.html#cb1585-8" aria-hidden="true" tabindex="-1"></a>          <span class="sc">-</span><span class="fl">0.97</span>, <span class="sc">-</span><span class="fl">0.78</span>, <span class="fl">0.38</span>, <span class="fl">0.49</span>, <span class="fl">0.21</span>),</span>
<span id="cb1585-9"><a href="solutions.html#cb1585-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">x3 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb1585-10"><a href="solutions.html#cb1585-10" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1585-11"><a href="solutions.html#cb1585-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">3.47</span>, <span class="sc">-</span><span class="fl">0.80</span>, <span class="fl">4.57</span>, <span class="fl">0.16</span>, <span class="sc">-</span><span class="fl">1.77</span>, <span class="sc">-</span><span class="fl">6.84</span>, <span class="fl">1.28</span>, <span class="sc">-</span><span class="fl">0.52</span>,</span>
<span id="cb1585-12"><a href="solutions.html#cb1585-12" aria-hidden="true" tabindex="-1"></a>          <span class="fl">1.00</span>, <span class="sc">-</span><span class="fl">2.50</span>, <span class="sc">-</span><span class="fl">1.99</span>, <span class="fl">1.13</span>, <span class="sc">-</span><span class="fl">4.26</span>, <span class="fl">1.16</span>, <span class="sc">-</span><span class="fl">0.69</span>, <span class="fl">0.89</span>, <span class="sc">-</span><span class="fl">1.01</span>,</span>
<span id="cb1585-13"><a href="solutions.html#cb1585-13" aria-hidden="true" tabindex="-1"></a>          <span class="fl">7.56</span>, <span class="fl">2.33</span>, <span class="fl">0.36</span>, <span class="sc">-</span><span class="fl">1.11</span>, <span class="sc">-</span><span class="fl">0.53</span>, <span class="sc">-</span><span class="fl">1.44</span>, <span class="sc">-</span><span class="fl">0.43</span>, <span class="fl">0.69</span>, <span class="sc">-</span><span class="fl">2.30</span>,</span>
<span id="cb1585-14"><a href="solutions.html#cb1585-14" aria-hidden="true" tabindex="-1"></a>          <span class="sc">-</span><span class="fl">3.55</span>, <span class="fl">0.99</span>, <span class="sc">-</span><span class="fl">0.50</span>, <span class="sc">-</span><span class="fl">1.67</span>))</span>
<span id="cb1585-15"><a href="solutions.html#cb1585-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1585-16"><a href="solutions.html#cb1585-16" aria-hidden="true" tabindex="-1"></a>exdata<span class="sc">$</span>Ey <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>exdata<span class="sc">$</span>x2 <span class="sc">-</span> exdata<span class="sc">$</span>x3 <span class="sc">+</span> exdata<span class="sc">$</span>x3<span class="sc">*</span>exdata<span class="sc">$</span>x2</span></code></pre></div>
<p>Next, we plot the expected values against the actual values:</p>
<div class="sourceCode" id="cb1586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1586-1"><a href="solutions.html#cb1586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1586-2"><a href="solutions.html#cb1586-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(Ey, y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p>The points seem to follow a straight line, and a linear model seems appropriate.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we fit a linear model to the first 20 observations:</li>
</ol>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="solutions.html#cb1587-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data =</span> exdata[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,])</span>
<span id="cb1587-2"><a href="solutions.html#cb1587-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>The <span class="math inline">\(R^2\)</span>-value is pretty high: 0.91. <code>x1</code> and <code>x2</code> both have low p-values, as does the F-test for the regression. We can check the model fit by comparing the fitted values to the actual values. We add a red line that the points should follow if we have a good fit:</p>
<div class="sourceCode" id="cb1588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1588-1"><a href="solutions.html#cb1588-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,], <span class="fu">aes</span>(y, <span class="fu">predict</span>(m))) <span class="sc">+</span> </span>
<span id="cb1588-2"><a href="solutions.html#cb1588-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1588-3"><a href="solutions.html#cb1588-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The model seems to be pretty good! Now let’s see how well it does when faced with new data.</p>
<ol start="3" style="list-style-type: decimal">
<li>We make predictions for all 10 observations:</li>
</ol>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="solutions.html#cb1589-1" aria-hidden="true" tabindex="-1"></a>exdata<span class="sc">$</span>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, exdata)</span></code></pre></div>
<p>We can plot the results for the last 10 observations, which weren’t used when we fitted the model:</p>
<div class="sourceCode" id="cb1590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1590-1"><a href="solutions.html#cb1590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,], <span class="fu">aes</span>(y, predictions)) <span class="sc">+</span> </span>
<span id="cb1590-2"><a href="solutions.html#cb1590-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1590-3"><a href="solutions.html#cb1590-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The results are much worse than before! The correlation between the predicted values and the actual values is very low:</p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1591-1"><a href="solutions.html#cb1591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>y, exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>predictions)</span></code></pre></div>
<p>Despite the good in-sample performance (as indicated e.g. by the high <span class="math inline">\(R^2\)</span>), the model doesn’t seem to be very useful for prediction.</p>
<ol start="4" style="list-style-type: decimal">
<li>Perhaps you noted that the effect of <code>x3</code> wasn’t significant in the model. Perhaps the performance will improve if we remove it? Let’s try!</li>
</ol>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1592-1"><a href="solutions.html#cb1592-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> exdata[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,])</span>
<span id="cb1592-2"><a href="solutions.html#cb1592-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>The p-values and <span class="math inline">\(R^2\)</span> still look very promising. Let’s make predictions for the new observations and check the results:</p>
<div class="sourceCode" id="cb1593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1593-1"><a href="solutions.html#cb1593-1" aria-hidden="true" tabindex="-1"></a>exdata<span class="sc">$</span>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, exdata)</span>
<span id="cb1593-2"><a href="solutions.html#cb1593-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1593-3"><a href="solutions.html#cb1593-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,], <span class="fu">aes</span>(y, predictions)) <span class="sc">+</span> </span>
<span id="cb1593-4"><a href="solutions.html#cb1593-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1593-5"><a href="solutions.html#cb1593-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1593-6"><a href="solutions.html#cb1593-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1593-7"><a href="solutions.html#cb1593-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>y, exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>predictions)</span></code></pre></div>
<p>The predictions are no better than before - indeed, the correlation between the actual and predicted values is even lower this time out!</p>
<ol start="5" style="list-style-type: decimal">
<li>Finally, we fit a correctly specified model and evaluate the results:</li>
</ol>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1594-1"><a href="solutions.html#cb1594-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3<span class="sc">*</span>x2, <span class="at">data =</span> exdata[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,])</span>
<span id="cb1594-2"><a href="solutions.html#cb1594-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb1594-3"><a href="solutions.html#cb1594-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1594-4"><a href="solutions.html#cb1594-4" aria-hidden="true" tabindex="-1"></a>exdata<span class="sc">$</span>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, exdata)</span>
<span id="cb1594-5"><a href="solutions.html#cb1594-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1594-6"><a href="solutions.html#cb1594-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,], <span class="fu">aes</span>(y, predictions)) <span class="sc">+</span> </span>
<span id="cb1594-7"><a href="solutions.html#cb1594-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1594-8"><a href="solutions.html#cb1594-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1594-9"><a href="solutions.html#cb1594-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1594-10"><a href="solutions.html#cb1594-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>y, exdata[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,]<span class="sc">$</span>predictions)</span></code></pre></div>
<p>The predictive performance of the model remains low, which shows that model misspecification wasn’t the (only) reason for the poor performance of the previous models.</p>
<p><a href="mlchapter.html#exr:ch8exc1">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions2" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc2">9.2</a><a href="solutions.html#ch8solutions2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>estates.xlsx</code> and then load the data:</p>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1595-1"><a href="solutions.html#cb1595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1595-2"><a href="solutions.html#cb1595-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1595-3"><a href="solutions.html#cb1595-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1595-4"><a href="solutions.html#cb1595-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(estates)</span></code></pre></div>
<p>There are a lot of missing values which can cause problems when fitting the model, so let’s remove those:</p>
<div class="sourceCode" id="cb1596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1596-1"><a href="solutions.html#cb1596-1" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<p>Next, we fit a linear model and evaluate it with LOOCV using <code>caret</code> and <code>train</code>:</p>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1597-1"><a href="solutions.html#cb1597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1597-2"><a href="solutions.html#cb1597-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1597-3"><a href="solutions.html#cb1597-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1597-4"><a href="solutions.html#cb1597-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1597-5"><a href="solutions.html#cb1597-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb1597-6"><a href="solutions.html#cb1597-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc)</span></code></pre></div>
<p>The <span class="math inline">\(RMSE\)</span> is 547 and the <span class="math inline">\(MAE\)</span> is 395 kSEK. The average selling price in the data (<code>mean(estates$selling_price)</code>) is 2843 kSEK, meaning that the <span class="math inline">\(MAE\)</span> is approximately 13 % of the mean selling price. This is not unreasonably high for this application. Prediction errors are definitely expected here, given the fact that we have relatively few variables - the selling price can be expected to depend on several things not captured by the variables in our data (proximity to schools, access to public transport, and so on). Moreover, houses in Sweden are not sold at fixed prices, but subject to bidding, which can cause prices to fluctuate a lot. All in all, and <span class="math inline">\(MAE\)</span> of 395 is pretty good, and, at the very least, the model seems useful for getting a ballpark figure for the price of a house.</p>
<p><a href="mlchapter.html#exr:ch8exc2">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions3" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc3">9.3</a><a href="solutions.html#ch8solutions3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>estates.xlsx</code> and then load and clean the data:</p>
<div class="sourceCode" id="cb1598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1598-1"><a href="solutions.html#cb1598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1598-2"><a href="solutions.html#cb1598-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1598-3"><a href="solutions.html#cb1598-3" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we evaluate the model with 10-fold cross-validation a few times:</li>
</ol>
<div class="sourceCode" id="cb1599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1599-1"><a href="solutions.html#cb1599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1599-2"><a href="solutions.html#cb1599-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this several times:</span></span>
<span id="cb1599-3"><a href="solutions.html#cb1599-3" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span> , <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb1599-4"><a href="solutions.html#cb1599-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1599-5"><a href="solutions.html#cb1599-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1599-6"><a href="solutions.html#cb1599-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb1599-7"><a href="solutions.html#cb1599-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc)</span>
<span id="cb1599-8"><a href="solutions.html#cb1599-8" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results</span></code></pre></div>
<p>In my runs, the <span class="math inline">\(MAE\)</span> ranged from to 391 to 405. Not a massive difference on the scale of the data, but there is clearly some variability in the results.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we run repeated 10-fold cross-validations a few times:</li>
</ol>
<div class="sourceCode" id="cb1600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1600-1"><a href="solutions.html#cb1600-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this several times:</span></span>
<span id="cb1600-2"><a href="solutions.html#cb1600-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb1600-3"><a href="solutions.html#cb1600-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">100</span>)</span>
<span id="cb1600-4"><a href="solutions.html#cb1600-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1600-5"><a href="solutions.html#cb1600-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1600-6"><a href="solutions.html#cb1600-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb1600-7"><a href="solutions.html#cb1600-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc)</span>
<span id="cb1600-8"><a href="solutions.html#cb1600-8" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results</span></code></pre></div>
<p>In my runs the <span class="math inline">\(MAE\)</span> varied between 396.0 and 397.4. There is still some variability, but it is much smaller than for a simple 10-fold cross-validation.</p>
<p><a href="mlchapter.html#exr:ch8exc3">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions4" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc4">9.4</a><a href="solutions.html#ch8solutions4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path to <code>estates.xlsx</code> and then load and clean the data:</p>
<div class="sourceCode" id="cb1601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1601-1"><a href="solutions.html#cb1601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1601-2"><a href="solutions.html#cb1601-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1601-3"><a href="solutions.html#cb1601-3" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<p>Next, we evaluate the model with the bootstrap a few times:</p>
<div class="sourceCode" id="cb1602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1602-1"><a href="solutions.html#cb1602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1602-2"><a href="solutions.html#cb1602-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this several times:</span></span>
<span id="cb1602-3"><a href="solutions.html#cb1602-3" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;boot&quot;</span>,</span>
<span id="cb1602-4"><a href="solutions.html#cb1602-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">999</span>)</span>
<span id="cb1602-5"><a href="solutions.html#cb1602-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1602-6"><a href="solutions.html#cb1602-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1602-7"><a href="solutions.html#cb1602-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb1602-8"><a href="solutions.html#cb1602-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc)</span>
<span id="cb1602-9"><a href="solutions.html#cb1602-9" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results</span></code></pre></div>
<p>In my run, the <span class="math inline">\(MAE\)</span> varied between 410.0 and 411.8, meaning that the variability is similar to the with repeated 10-fold cross-validation. When I increased the number of bootstrap samples to 9,999, the <span class="math inline">\(MAE\)</span> stabilised around 411.7.</p>
<p><a href="mlchapter.html#exr:ch8exc4">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions5" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc5">9.5</a><a href="solutions.html#ch8solutions5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the two models using <code>train</code>:</p>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1603-1"><a href="solutions.html#cb1603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1603-2"><a href="solutions.html#cb1603-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb1603-3"><a href="solutions.html#cb1603-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb1603-4"><a href="solutions.html#cb1603-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1603-5"><a href="solutions.html#cb1603-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1603-6"><a href="solutions.html#cb1603-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1603-7"><a href="solutions.html#cb1603-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 - two variables:</span></span>
<span id="cb1603-8"><a href="solutions.html#cb1603-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol,</span>
<span id="cb1603-9"><a href="solutions.html#cb1603-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1603-10"><a href="solutions.html#cb1603-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1603-11"><a href="solutions.html#cb1603-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb1603-12"><a href="solutions.html#cb1603-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb1603-13"><a href="solutions.html#cb1603-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1603-14"><a href="solutions.html#cb1603-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 - four variables:</span></span>
<span id="cb1603-15"><a href="solutions.html#cb1603-15" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1603-16"><a href="solutions.html#cb1603-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1603-17"><a href="solutions.html#cb1603-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1603-18"><a href="solutions.html#cb1603-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb1603-19"><a href="solutions.html#cb1603-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<p>To compare the models, we use <code>evalm</code> to plot ROC and calibration curves:</p>
<div class="sourceCode" id="cb1604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1604-1"><a href="solutions.html#cb1604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1604-2"><a href="solutions.html#cb1604-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(<span class="fu">list</span>(m, m2),</span>
<span id="cb1604-3"><a href="solutions.html#cb1604-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">gnames =</span> <span class="fu">c</span>(<span class="st">&quot;Model 1&quot;</span>, <span class="st">&quot;Model 2&quot;</span>))</span>
<span id="cb1604-4"><a href="solutions.html#cb1604-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1604-5"><a href="solutions.html#cb1604-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1604-6"><a href="solutions.html#cb1604-6" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1604-7"><a href="solutions.html#cb1604-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1604-8"><a href="solutions.html#cb1604-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1604-9"><a href="solutions.html#cb1604-9" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p>Model 2 performs much better, both in terms of <span class="math inline">\(AUC\)</span> and calibration. Adding two more variables has both increased the predictive performance of the model (a much higher <span class="math inline">\(AUC\)</span>) and lead to a better-calibrated model.</p>
<p><a href="mlchapter.html#exr:ch8exc5">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions6" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc6">9.9</a><a href="solutions.html#ch8solutions6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load and clean the data:</p>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1605-1"><a href="solutions.html#cb1605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1605-2"><a href="solutions.html#cb1605-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1605-3"><a href="solutions.html#cb1605-3" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<p>Next, we fit a ridge regression model and evaluate it with LOOCV using <code>caret</code> and <code>train</code>:</p>
<div class="sourceCode" id="cb1606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1606-1"><a href="solutions.html#cb1606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1606-2"><a href="solutions.html#cb1606-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1606-3"><a href="solutions.html#cb1606-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1606-4"><a href="solutions.html#cb1606-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1606-5"><a href="solutions.html#cb1606-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1606-6"><a href="solutions.html#cb1606-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb1606-7"><a href="solutions.html#cb1606-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)),</span>
<span id="cb1606-8"><a href="solutions.html#cb1606-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1606-9"><a href="solutions.html#cb1606-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1606-10"><a href="solutions.html#cb1606-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Results for the best model:</span></span>
<span id="cb1606-11"><a href="solutions.html#cb1606-11" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results[<span class="fu">which</span>(m<span class="sc">$</span>results<span class="sc">$</span>lambda <span class="sc">==</span> m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt),]</span></code></pre></div>
<p>Noticing that the <span class="math inline">\(\lambda\)</span> that gave the best <span class="math inline">\(RMSE\)</span> was 10, which was the maximal <span class="math inline">\(\lambda\)</span> that we investigated, we rerun the code, allowing for higher values of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1607-1"><a href="solutions.html#cb1607-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1607-2"><a href="solutions.html#cb1607-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1607-3"><a href="solutions.html#cb1607-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1607-4"><a href="solutions.html#cb1607-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb1607-5"><a href="solutions.html#cb1607-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">120</span>, <span class="dv">1</span>)),</span>
<span id="cb1607-6"><a href="solutions.html#cb1607-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1607-7"><a href="solutions.html#cb1607-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1607-8"><a href="solutions.html#cb1607-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Results for the best model:</span></span>
<span id="cb1607-9"><a href="solutions.html#cb1607-9" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results[<span class="fu">which</span>(m<span class="sc">$</span>results<span class="sc">$</span>lambda <span class="sc">==</span> m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt),]</span></code></pre></div>
<p>The <span class="math inline">\(RMSE\)</span> is 549 and the <span class="math inline">\(MAE\)</span> is 399. In this case, ridge regression did not improve the performance of the model compared to an ordinary linear regression.</p>
<p><a href="mlchapter.html#exr:ch8exc6">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions6b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc6b">9.10</a><a href="solutions.html#ch8solutions6b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>.</p>
<ol style="list-style-type: decimal">
<li>We can now fit the models using <code>train</code>, making sure to add <code>family = "binomial"</code>:</li>
</ol>
<div class="sourceCode" id="cb1608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1608-1"><a href="solutions.html#cb1608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1608-2"><a href="solutions.html#cb1608-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1608-3"><a href="solutions.html#cb1608-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb1608-4"><a href="solutions.html#cb1608-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1608-5"><a href="solutions.html#cb1608-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1608-6"><a href="solutions.html#cb1608-6" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1608-7"><a href="solutions.html#cb1608-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1608-8"><a href="solutions.html#cb1608-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1608-9"><a href="solutions.html#cb1608-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb1608-10"><a href="solutions.html#cb1608-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb1608-11"><a href="solutions.html#cb1608-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)),</span>
<span id="cb1608-12"><a href="solutions.html#cb1608-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1608-13"><a href="solutions.html#cb1608-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-14"><a href="solutions.html#cb1608-14" aria-hidden="true" tabindex="-1"></a>m1</span></code></pre></div>
<p>The best value for <span class="math inline">\(\lambda\)</span> is 0, meaning that no regularisation is used.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we add <code>summaryFunction = twoClassSummary</code> and <code>metric = "ROC"</code>, which means that <span class="math inline">\(AUC\)</span> and not accuracy will be used to find the optimal <span class="math inline">\(\lambda\)</span>:</li>
</ol>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1609-1"><a href="solutions.html#cb1609-1" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1609-2"><a href="solutions.html#cb1609-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb1609-3"><a href="solutions.html#cb1609-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1609-4"><a href="solutions.html#cb1609-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1609-5"><a href="solutions.html#cb1609-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1609-6"><a href="solutions.html#cb1609-6" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1609-7"><a href="solutions.html#cb1609-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1609-8"><a href="solutions.html#cb1609-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1609-9"><a href="solutions.html#cb1609-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb1609-10"><a href="solutions.html#cb1609-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb1609-11"><a href="solutions.html#cb1609-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)),</span>
<span id="cb1609-12"><a href="solutions.html#cb1609-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1609-13"><a href="solutions.html#cb1609-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1609-14"><a href="solutions.html#cb1609-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1609-15"><a href="solutions.html#cb1609-15" aria-hidden="true" tabindex="-1"></a>m2</span></code></pre></div>
<p>The best value for <span class="math inline">\(\lambda\)</span> is still 0. For this dataset, both accuracy and <span class="math inline">\(AUC\)</span> happened to give the same <span class="math inline">\(\lambda\)</span>, but that isn’t always the case.</p>
<p><a href="mlchapter.html#exr:ch8exc6b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions7" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc7">9.11</a><a href="solutions.html#ch8solutions7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load and clean the data:</p>
<div class="sourceCode" id="cb1610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1610-1"><a href="solutions.html#cb1610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1610-2"><a href="solutions.html#cb1610-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1610-3"><a href="solutions.html#cb1610-3" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<p>Next, we fit a lasso model and evaluate it with LOOCV using <code>caret</code> and <code>train</code>:</p>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1611-1"><a href="solutions.html#cb1611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1611-2"><a href="solutions.html#cb1611-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1611-3"><a href="solutions.html#cb1611-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1611-4"><a href="solutions.html#cb1611-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1611-5"><a href="solutions.html#cb1611-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1611-6"><a href="solutions.html#cb1611-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb1611-7"><a href="solutions.html#cb1611-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)),</span>
<span id="cb1611-8"><a href="solutions.html#cb1611-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1611-9"><a href="solutions.html#cb1611-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1611-10"><a href="solutions.html#cb1611-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Results for the best model:</span></span>
<span id="cb1611-11"><a href="solutions.html#cb1611-11" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results[<span class="fu">which</span>(m<span class="sc">$</span>results<span class="sc">$</span>lambda <span class="sc">==</span> m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt),]</span></code></pre></div>
<p>The <span class="math inline">\(RMSE\)</span> is 545 and the <span class="math inline">\(MAE\)</span> is 394. Both are a little lower than for the ordinary linear regression, but the difference is small in this case. To see which variables have been removed, we can use:</p>
<div class="sourceCode" id="cb1612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1612-1"><a href="solutions.html#cb1612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m<span class="sc">$</span>finalModel, m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt)</span></code></pre></div>
<p>Note that this data isn’t perfectly suited to the lasso, because most variables are useful in explaining the selling price. Where the lasso really shines in problems where a lot of the variables, perhaps even most, aren’t useful in explaining the response variable. We’ll see an example of that in the next exercise.</p>
<p><a href="mlchapter.html#exr:ch8exc7">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions7b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc7b">9.12</a><a href="solutions.html#ch8solutions7b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We try fitting a linear model to the data:</li>
</ol>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1613-1"><a href="solutions.html#cb1613-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> simulated_data)</span>
<span id="cb1613-2"><a href="solutions.html#cb1613-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<p>There are no error messages, but <code>summary</code> reveals that there were problems: <code>Coefficients: (101 not defined because of singularities)</code> and for half the variables we don’t get estimates of the coefficients. It is not possible to fit ordinary linear models when there are more variables than observations (there is no unique solution to the least squares equations from which we obtain the coefficient estimates), which leads to this strange-looking output.</p>
<ol start="2" style="list-style-type: decimal">
<li>Lasso models can be used even when the number of variables is greater than the number of observations - regularisation ensures that there will be a unique solution. We fit a lasso model using <code>caret</code> and <code>train</code>:</li>
</ol>
<div class="sourceCode" id="cb1614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1614-1"><a href="solutions.html#cb1614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1614-2"><a href="solutions.html#cb1614-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1614-3"><a href="solutions.html#cb1614-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(y <span class="sc">~</span> .,</span>
<span id="cb1614-4"><a href="solutions.html#cb1614-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> simulated_data,</span>
<span id="cb1614-5"><a href="solutions.html#cb1614-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1614-6"><a href="solutions.html#cb1614-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb1614-7"><a href="solutions.html#cb1614-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)),</span>
<span id="cb1614-8"><a href="solutions.html#cb1614-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span></code></pre></div>
<p>Next, we have a look at what variables have non-zero coefficients:</p>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1615-1"><a href="solutions.html#cb1615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(<span class="fu">coef</span>(m<span class="sc">$</span>finalModel, m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt))[</span>
<span id="cb1615-2"><a href="solutions.html#cb1615-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">coef</span>(m<span class="sc">$</span>finalModel, m<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt)[,<span class="dv">1</span>]<span class="sc">!=</span> <span class="dv">0</span>]</span></code></pre></div>
<p>Your mileage may vary (try running the simulation more than once!), but it is likely that the lasso will have picked at least the first four of the explanatory variables, probably along with some additional variables. Try changing the ratio between <code>n</code> and <code>p</code> in your experiment, or the size of the coefficients used when generating <code>y</code>, and see what happens.</p>
<p><a href="mlchapter.html#exr:ch8exc7b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions8" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc8">9.13</a><a href="solutions.html#ch8solutions8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load and clean the data:</p>
<div class="sourceCode" id="cb1616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1616-1"><a href="solutions.html#cb1616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1616-2"><a href="solutions.html#cb1616-2" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(file_path)</span>
<span id="cb1616-3"><a href="solutions.html#cb1616-3" aria-hidden="true" tabindex="-1"></a>estates <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(estates)</span></code></pre></div>
<p>Next, we fit an elastic net model and evaluate it with LOOCV using <code>caret</code> and <code>train</code>:</p>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1617-1"><a href="solutions.html#cb1617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1617-2"><a href="solutions.html#cb1617-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1617-3"><a href="solutions.html#cb1617-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(selling_price <span class="sc">~</span> .,</span>
<span id="cb1617-4"><a href="solutions.html#cb1617-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> estates,</span>
<span id="cb1617-5"><a href="solutions.html#cb1617-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>, </span>
<span id="cb1617-6"><a href="solutions.html#cb1617-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>),</span>
<span id="cb1617-7"><a href="solutions.html#cb1617-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">1</span>)),</span>
<span id="cb1617-8"><a href="solutions.html#cb1617-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc) </span>
<span id="cb1617-9"><a href="solutions.html#cb1617-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1617-10"><a href="solutions.html#cb1617-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print best choices of alpha and lambda:</span></span>
<span id="cb1617-11"><a href="solutions.html#cb1617-11" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>bestTune</span>
<span id="cb1617-12"><a href="solutions.html#cb1617-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1617-13"><a href="solutions.html#cb1617-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the RMSE and MAE for the best model:</span></span>
<span id="cb1617-14"><a href="solutions.html#cb1617-14" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>results[<span class="fu">which</span>(<span class="fu">rownames</span>(m<span class="sc">$</span>results) <span class="sc">==</span> <span class="fu">rownames</span>(m<span class="sc">$</span>bestTune)),]</span></code></pre></div>
<p>We get a slight improvement over the lasso, with an <span class="math inline">\(RMSE\)</span> of 543.5 and an <span class="math inline">\(MAE\)</span> of 393.</p>
<p><a href="mlchapter.html#exr:ch8exc8">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions10" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc10">9.14</a><a href="solutions.html#ch8solutions10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the model using <code>train</code>. We set <code>summaryFunction = twoClassSummary</code> and <code>metric = "ROC"</code> to use <span class="math inline">\(AUC\)</span> to find the optimal <span class="math inline">\(k\)</span>.</p>
<div class="sourceCode" id="cb1618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1618-1"><a href="solutions.html#cb1618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1618-2"><a href="solutions.html#cb1618-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb1618-3"><a href="solutions.html#cb1618-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb1618-4"><a href="solutions.html#cb1618-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1618-5"><a href="solutions.html#cb1618-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1618-6"><a href="solutions.html#cb1618-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1618-7"><a href="solutions.html#cb1618-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1618-8"><a href="solutions.html#cb1618-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1618-9"><a href="solutions.html#cb1618-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1618-10"><a href="solutions.html#cb1618-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1618-11"><a href="solutions.html#cb1618-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1618-12"><a href="solutions.html#cb1618-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1618-13"><a href="solutions.html#cb1618-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="dv">0</span>))</span>
<span id="cb1618-14"><a href="solutions.html#cb1618-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1618-15"><a href="solutions.html#cb1618-15" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Next, we plot the resulting decision tree:</li>
</ol>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1619-1"><a href="solutions.html#cb1619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb1619-2"><a href="solutions.html#cb1619-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(m<span class="sc">$</span>finalModel)</span></code></pre></div>
<p>The tree is pretty large. The parameter <code>cp</code>, called a complexity parameter, can be used to <em>prune</em> the tree, i.e. to make it smaller. Let’s try setting a larger value for <code>cp</code>:</p>
<div class="sourceCode" id="cb1620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1620-1"><a href="solutions.html#cb1620-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1620-2"><a href="solutions.html#cb1620-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1620-3"><a href="solutions.html#cb1620-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1620-4"><a href="solutions.html#cb1620-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1620-5"><a href="solutions.html#cb1620-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1620-6"><a href="solutions.html#cb1620-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fl">0.1</span>))</span>
<span id="cb1620-7"><a href="solutions.html#cb1620-7" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(m<span class="sc">$</span>finalModel)</span></code></pre></div>
<p>That was way too much pruning - now the tree is too small! Try a value somewhere in-between:</p>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1621-1"><a href="solutions.html#cb1621-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1621-2"><a href="solutions.html#cb1621-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1621-3"><a href="solutions.html#cb1621-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1621-4"><a href="solutions.html#cb1621-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1621-5"><a href="solutions.html#cb1621-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1621-6"><a href="solutions.html#cb1621-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fl">0.01</span>))</span>
<span id="cb1621-7"><a href="solutions.html#cb1621-7" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(m<span class="sc">$</span>finalModel)</span></code></pre></div>
<p>That seems like a good compromise. The tree is small enough for us to understand and discuss, but hopefully large enough that it still has a high <span class="math inline">\(AUC\)</span>.</p>
<ol start="2" style="list-style-type: decimal">
<li>For presentation and interpretability purposes we can experiment with manually setting different values of <code>cp</code>. We can also let <code>train</code> find an optimal value of <code>cp</code> for us, maximising for instance the <span class="math inline">\(AUC\)</span>. We’ll use <code>tuneGrid = expand.grid(cp = seq(0, 0.01, 0.001))</code> to find a good choice of <code>cp</code> somewhere between 0 and 0.01:</li>
</ol>
<div class="sourceCode" id="cb1622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1622-1"><a href="solutions.html#cb1622-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1622-2"><a href="solutions.html#cb1622-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1622-3"><a href="solutions.html#cb1622-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1622-4"><a href="solutions.html#cb1622-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1622-5"><a href="solutions.html#cb1622-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1622-6"><a href="solutions.html#cb1622-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>)))</span>
<span id="cb1622-7"><a href="solutions.html#cb1622-7" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb1622-8"><a href="solutions.html#cb1622-8" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(m<span class="sc">$</span>finalModel)</span></code></pre></div>
<p>In some cases, increasing <code>cp</code> can increase the <span class="math inline">\(AUC\)</span>, but not here - a <code>cp</code> of 0 turns out to be optimal in this instance.</p>
<p>Finally, to visually evaluate the model, we use <code>evalm</code> to plot ROC and calibration curves:</p>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1623-1"><a href="solutions.html#cb1623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1623-2"><a href="solutions.html#cb1623-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(m, <span class="at">gnames =</span> <span class="st">&quot;Decision tree&quot;</span>)</span>
<span id="cb1623-3"><a href="solutions.html#cb1623-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1623-4"><a href="solutions.html#cb1623-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1623-5"><a href="solutions.html#cb1623-5" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1623-6"><a href="solutions.html#cb1623-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1623-7"><a href="solutions.html#cb1623-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % Confidence interval for AUC:</span></span>
<span id="cb1623-8"><a href="solutions.html#cb1623-8" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>optres[[<span class="dv">1</span>]][<span class="dv">13</span>,]</span>
<span id="cb1623-9"><a href="solutions.html#cb1623-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1623-10"><a href="solutions.html#cb1623-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1623-11"><a href="solutions.html#cb1623-11" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p><a href="mlchapter.html#exr:ch8exc10">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions10b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc10b">9.15</a><a href="solutions.html#ch8solutions10b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path of <code>bacteria.csv</code>, then load and format the data as in Section <a href="mlchapter.html#extrapolation">9.3.3</a>:</p>
<div class="sourceCode" id="cb1624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1624-1"><a href="solutions.html#cb1624-1" aria-hidden="true" tabindex="-1"></a>bacteria <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1624-2"><a href="solutions.html#cb1624-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(bacteria<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Next, we fit a regression tree model using rows 45 to 90:</p>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1625-1"><a href="solutions.html#cb1625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1625-2"><a href="solutions.html#cb1625-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1625-3"><a href="solutions.html#cb1625-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1625-4"><a href="solutions.html#cb1625-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1625-5"><a href="solutions.html#cb1625-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,],</span>
<span id="cb1625-6"><a href="solutions.html#cb1625-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1625-7"><a href="solutions.html#cb1625-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1625-8"><a href="solutions.html#cb1625-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Finally, we make predictions for the entire dataset and compare the results to the actual outcomes:</p>
<div class="sourceCode" id="cb1626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1626-1"><a href="solutions.html#cb1626-1" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1626-2"><a href="solutions.html#cb1626-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1626-3"><a href="solutions.html#cb1626-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1626-4"><a href="solutions.html#cb1626-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1626-5"><a href="solutions.html#cb1626-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1626-6"><a href="solutions.html#cb1626-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>Regression trees are unable to extrapolate beyond the training data. By design, they will make constant predictions whenever the values of the explanatory variables go beyond those in the training data. Bear this in mind if you use tree-based models for predictions!</p>
<p><a href="mlchapter.html#exr:ch8exc10b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions10c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc10c">9.16</a><a href="solutions.html#ch8solutions10c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1627-1"><a href="solutions.html#cb1627-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1627-2"><a href="solutions.html#cb1627-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1627-3"><a href="solutions.html#cb1627-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1627-4"><a href="solutions.html#cb1627-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1627-5"><a href="solutions.html#cb1627-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1627-6"><a href="solutions.html#cb1627-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1627-7"><a href="solutions.html#cb1627-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we fit a classification tree model with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1628-1"><a href="solutions.html#cb1628-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1628-2"><a href="solutions.html#cb1628-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1628-3"><a href="solutions.html#cb1628-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1628-4"><a href="solutions.html#cb1628-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1628-5"><a href="solutions.html#cb1628-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1628-6"><a href="solutions.html#cb1628-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1628-7"><a href="solutions.html#cb1628-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1628-8"><a href="solutions.html#cb1628-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Finally, we plot the decision boundaries:</p>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1629-1"><a href="solutions.html#cb1629-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1629-2"><a href="solutions.html#cb1629-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1629-3"><a href="solutions.html#cb1629-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1629-4"><a href="solutions.html#cb1629-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1629-5"><a href="solutions.html#cb1629-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1629-6"><a href="solutions.html#cb1629-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m, contour_data)))</span>
<span id="cb1629-7"><a href="solutions.html#cb1629-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1629-8"><a href="solutions.html#cb1629-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1629-9"><a href="solutions.html#cb1629-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1629-10"><a href="solutions.html#cb1629-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1629-11"><a href="solutions.html#cb1629-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1629-12"><a href="solutions.html#cb1629-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>The decision boundaries seem pretty good - most points in the lower left part belong to variety 3, most in the middle to variety 1, and most to the right to variety 2.</p>
<p><a href="mlchapter.html#exr:ch8exc10c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions11" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc11">9.17</a><a href="solutions.html#ch8solutions11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the models using <code>train</code> (fitting <code>m2</code> takes a while):</p>
<div class="sourceCode" id="cb1630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1630-1"><a href="solutions.html#cb1630-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1630-2"><a href="solutions.html#cb1630-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1630-3"><a href="solutions.html#cb1630-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, </span>
<span id="cb1630-4"><a href="solutions.html#cb1630-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1630-5"><a href="solutions.html#cb1630-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1630-6"><a href="solutions.html#cb1630-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1630-7"><a href="solutions.html#cb1630-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1630-8"><a href="solutions.html#cb1630-8" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> .,</span>
<span id="cb1630-9"><a href="solutions.html#cb1630-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1630-10"><a href="solutions.html#cb1630-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1630-11"><a href="solutions.html#cb1630-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1630-12"><a href="solutions.html#cb1630-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1630-13"><a href="solutions.html#cb1630-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>)))</span>
<span id="cb1630-14"><a href="solutions.html#cb1630-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1630-15"><a href="solutions.html#cb1630-15" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> .,</span>
<span id="cb1630-16"><a href="solutions.html#cb1630-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1630-17"><a href="solutions.html#cb1630-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1630-18"><a href="solutions.html#cb1630-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb1630-19"><a href="solutions.html#cb1630-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1630-20"><a href="solutions.html#cb1630-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>))</span></code></pre></div>
<p>Next, we compare the results of the best models:</p>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="solutions.html#cb1631-1" aria-hidden="true" tabindex="-1"></a>m1</span>
<span id="cb1631-2"><a href="solutions.html#cb1631-2" aria-hidden="true" tabindex="-1"></a>m2</span></code></pre></div>
<p>And finally, a visual comparison:</p>
<div class="sourceCode" id="cb1632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1632-1"><a href="solutions.html#cb1632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1632-2"><a href="solutions.html#cb1632-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(<span class="fu">list</span>(m1, m2),</span>
<span id="cb1632-3"><a href="solutions.html#cb1632-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">gnames =</span> <span class="fu">c</span>(<span class="st">&quot;Decision tree&quot;</span>, <span class="st">&quot;Random forest&quot;</span>))</span>
<span id="cb1632-4"><a href="solutions.html#cb1632-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1632-5"><a href="solutions.html#cb1632-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1632-6"><a href="solutions.html#cb1632-6" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1632-7"><a href="solutions.html#cb1632-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1632-8"><a href="solutions.html#cb1632-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1632-9"><a href="solutions.html#cb1632-9" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p>The calibration curves may look worrisome, but the main reason that they deviate from the straight line is that almost all observations have predicted probabilities close to either 0 or 1. To see this, we can have a quick look at the histogram of the predicted probabilities that the wines are white:</p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="solutions.html#cb1633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">predict</span>(m2, <span class="at">type =</span><span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>])</span></code></pre></div>
<p>We used 10-fold cross-validation here, as using repeated cross-validation would take too long (at least in this case, where we only study this data as an example). As we’ve seen before, that means that the performance metrics can vary a lot between runs, so we shouldn’t read too much into the difference we found here.</p>
<p><a href="mlchapter.html#exr:ch8exc11">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions11b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc11b">9.18</a><a href="solutions.html#ch8solutions11b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path of <code>bacteria.csv</code>, then load and format the data as in Section <a href="mlchapter.html#extrapolation">9.3.3</a>:</p>
<div class="sourceCode" id="cb1634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1634-1"><a href="solutions.html#cb1634-1" aria-hidden="true" tabindex="-1"></a>bacteria <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1634-2"><a href="solutions.html#cb1634-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(bacteria<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Next, we fit a random forest using rows 45 to 90:</p>
<div class="sourceCode" id="cb1635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1635-1"><a href="solutions.html#cb1635-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1635-2"><a href="solutions.html#cb1635-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1635-3"><a href="solutions.html#cb1635-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1635-4"><a href="solutions.html#cb1635-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1635-5"><a href="solutions.html#cb1635-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,],</span>
<span id="cb1635-6"><a href="solutions.html#cb1635-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1635-7"><a href="solutions.html#cb1635-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb1635-8"><a href="solutions.html#cb1635-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>Finally, we make predictions for the entire dataset and compare the results to the actual outcomes:</p>
<div class="sourceCode" id="cb1636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1636-1"><a href="solutions.html#cb1636-1" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1636-2"><a href="solutions.html#cb1636-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1636-3"><a href="solutions.html#cb1636-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1636-4"><a href="solutions.html#cb1636-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1636-5"><a href="solutions.html#cb1636-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1636-6"><a href="solutions.html#cb1636-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The model does very well for the training data, but fails to extrapolate beyond it. Because random forests are based on decision trees, they give constant predictions whenever the values of the explanatory variables go beyond those in the training data.</p>
<p><a href="mlchapter.html#exr:ch8exc11b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions11c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc11c">9.19</a><a href="solutions.html#ch8solutions11c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1637-1"><a href="solutions.html#cb1637-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1637-2"><a href="solutions.html#cb1637-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1637-3"><a href="solutions.html#cb1637-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1637-4"><a href="solutions.html#cb1637-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1637-5"><a href="solutions.html#cb1637-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1637-6"><a href="solutions.html#cb1637-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1637-7"><a href="solutions.html#cb1637-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we fit a random forest model with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1638-1"><a href="solutions.html#cb1638-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1638-2"><a href="solutions.html#cb1638-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1638-3"><a href="solutions.html#cb1638-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1638-4"><a href="solutions.html#cb1638-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1638-5"><a href="solutions.html#cb1638-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1638-6"><a href="solutions.html#cb1638-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1638-7"><a href="solutions.html#cb1638-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb1638-8"><a href="solutions.html#cb1638-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code></pre></div>
<p>Finally, we plot the decision boundaries:</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1639-1"><a href="solutions.html#cb1639-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1639-2"><a href="solutions.html#cb1639-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1639-3"><a href="solutions.html#cb1639-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1639-4"><a href="solutions.html#cb1639-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1639-5"><a href="solutions.html#cb1639-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1639-6"><a href="solutions.html#cb1639-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m, contour_data)))</span>
<span id="cb1639-7"><a href="solutions.html#cb1639-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1639-8"><a href="solutions.html#cb1639-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1639-9"><a href="solutions.html#cb1639-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1639-10"><a href="solutions.html#cb1639-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1639-11"><a href="solutions.html#cb1639-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1639-12"><a href="solutions.html#cb1639-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>The decision boundaries are much more complex and flexible than those for the decision tree of Exercise <a href="mlchapter.html#exr:ch8exc10c">9.16</a>. Perhaps they are too flexible, and the model has overfitted to the training data?</p>
<p><a href="mlchapter.html#exr:ch8exc11c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12">9.20</a><a href="solutions.html#ch8solutions12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the model using <code>train</code>. Try a large number of parameter values to see if you can get a high <span class="math inline">\(AUC\)</span>. You can try using a simple 10-fold cross-validation to find reasonable candidate values for the parameters, and then rerun the tuning with a replicated 10-fold cross-validation with parameter values close to those that were optimal in your first search.</p>
<div class="sourceCode" id="cb1640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1640-1"><a href="solutions.html#cb1640-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1640-2"><a href="solutions.html#cb1640-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1640-3"><a href="solutions.html#cb1640-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb1640-4"><a href="solutions.html#cb1640-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1640-5"><a href="solutions.html#cb1640-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1640-6"><a href="solutions.html#cb1640-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1640-7"><a href="solutions.html#cb1640-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1640-8"><a href="solutions.html#cb1640-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1640-9"><a href="solutions.html#cb1640-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1640-10"><a href="solutions.html#cb1640-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1640-11"><a href="solutions.html#cb1640-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;gbm&quot;</span>,</span>
<span id="cb1640-12"><a href="solutions.html#cb1640-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1640-13"><a href="solutions.html#cb1640-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1640-14"><a href="solutions.html#cb1640-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">interaction.depth =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1640-15"><a href="solutions.html#cb1640-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.trees =</span> <span class="fu">seq</span>(<span class="dv">20</span>, <span class="dv">200</span>, <span class="dv">20</span>),</span>
<span id="cb1640-16"><a href="solutions.html#cb1640-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shrinkage =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>),</span>
<span id="cb1640-17"><a href="solutions.html#cb1640-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.minobsinnode =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)),</span>
<span id="cb1640-18"><a href="solutions.html#cb1640-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1640-19"><a href="solutions.html#cb1640-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1640-20"><a href="solutions.html#cb1640-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m)</span></code></pre></div>
<p><a href="mlchapter.html#exr:ch8exc12">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12a" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12a">9.21</a><a href="solutions.html#ch8solutions12a" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We set <code>file_path</code> to the path of <code>bacteria.csv</code>, then load and format the data as in Section <a href="mlchapter.html#extrapolation">9.3.3</a>:</p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1641-1"><a href="solutions.html#cb1641-1" aria-hidden="true" tabindex="-1"></a>bacteria <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1641-2"><a href="solutions.html#cb1641-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(bacteria<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Next, we fit a boosted trees model using rows 45 to 90:</p>
<div class="sourceCode" id="cb1642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1642-1"><a href="solutions.html#cb1642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1642-2"><a href="solutions.html#cb1642-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1642-3"><a href="solutions.html#cb1642-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1642-4"><a href="solutions.html#cb1642-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1642-5"><a href="solutions.html#cb1642-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,],</span>
<span id="cb1642-6"><a href="solutions.html#cb1642-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1642-7"><a href="solutions.html#cb1642-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;gbm&quot;</span>)</span></code></pre></div>
<p>Finally, we make predictions for the entire dataset and compare the results to the actual outcomes:</p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1643-1"><a href="solutions.html#cb1643-1" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1643-2"><a href="solutions.html#cb1643-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1643-3"><a href="solutions.html#cb1643-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1643-4"><a href="solutions.html#cb1643-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1643-5"><a href="solutions.html#cb1643-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1643-6"><a href="solutions.html#cb1643-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The model does OK for the training data, but fails to extrapolate beyond it. Because boosted trees models are based on decision trees, they give constant predictions whenever the values of the explanatory variables go beyond those in the training data.</p>
<p><a href="mlchapter.html#exr:ch8exc12a">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12c" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12c">9.22</a><a href="solutions.html#ch8solutions12c" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1644-1"><a href="solutions.html#cb1644-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1644-2"><a href="solutions.html#cb1644-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1644-3"><a href="solutions.html#cb1644-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1644-4"><a href="solutions.html#cb1644-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1644-5"><a href="solutions.html#cb1644-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1644-6"><a href="solutions.html#cb1644-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1644-7"><a href="solutions.html#cb1644-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we fit a boosted trees model with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1645-1"><a href="solutions.html#cb1645-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1645-2"><a href="solutions.html#cb1645-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1645-3"><a href="solutions.html#cb1645-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1645-4"><a href="solutions.html#cb1645-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1645-5"><a href="solutions.html#cb1645-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1645-6"><a href="solutions.html#cb1645-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1645-7"><a href="solutions.html#cb1645-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;gbm&quot;</span>,</span>
<span id="cb1645-8"><a href="solutions.html#cb1645-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Finally, we plot the decision boundaries:</p>
<div class="sourceCode" id="cb1646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1646-1"><a href="solutions.html#cb1646-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1646-2"><a href="solutions.html#cb1646-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1646-3"><a href="solutions.html#cb1646-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1646-4"><a href="solutions.html#cb1646-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1646-5"><a href="solutions.html#cb1646-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1646-6"><a href="solutions.html#cb1646-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m, contour_data)))</span>
<span id="cb1646-7"><a href="solutions.html#cb1646-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1646-8"><a href="solutions.html#cb1646-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1646-9"><a href="solutions.html#cb1646-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1646-10"><a href="solutions.html#cb1646-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1646-11"><a href="solutions.html#cb1646-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1646-12"><a href="solutions.html#cb1646-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>The decision boundaries are much complex and flexible than those for the decision tree of Exercise <a href="mlchapter.html#exr:ch8exc10c">9.16</a>, but does not appear to have overfitted like the random forest in Exercise <a href="mlchapter.html#exr:ch8exc11c">9.19</a>.</p>
<p><a href="mlchapter.html#exr:ch8exc12c">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12ab" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12ab">9.23</a><a href="solutions.html#ch8solutions12ab" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We set <code>file_path</code> to the path of <code>bacteria.csv</code>, then load and format the data as in Section <a href="mlchapter.html#extrapolation">9.3.3</a>:</li>
</ol>
<div class="sourceCode" id="cb1647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1647-1"><a href="solutions.html#cb1647-1" aria-hidden="true" tabindex="-1"></a>bacteria <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1647-2"><a href="solutions.html#cb1647-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.POSIXct</span>(bacteria<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>))</span></code></pre></div>
<p>First, we fit a decision tree using rows 45 to 90:</p>
<div class="sourceCode" id="cb1648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1648-1"><a href="solutions.html#cb1648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1648-2"><a href="solutions.html#cb1648-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1648-3"><a href="solutions.html#cb1648-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1648-4"><a href="solutions.html#cb1648-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1648-5"><a href="solutions.html#cb1648-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,],</span>
<span id="cb1648-6"><a href="solutions.html#cb1648-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1648-7"><a href="solutions.html#cb1648-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1648-8"><a href="solutions.html#cb1648-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Next, we fit a model tree using rows 45 to 90. The only explanatory variable available to us is <code>Time</code>, and we want to use that both for the models in the nodes and for the splits:</p>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1649-1"><a href="solutions.html#cb1649-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(partykit)</span>
<span id="cb1649-2"><a href="solutions.html#cb1649-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lmtree</span>(OD <span class="sc">~</span> Time <span class="sc">|</span> Time, <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,])</span>
<span id="cb1649-3"><a href="solutions.html#cb1649-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1649-4"><a href="solutions.html#cb1649-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggparty)</span>
<span id="cb1649-5"><a href="solutions.html#cb1649-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m2)</span></code></pre></div>
<p>Next, we make predictions for the entire dataset and compare the results to the actual outcomes. We plot the predictions from the decision tree in red and those from the model tree in blue:</p>
<div class="sourceCode" id="cb1650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1650-1"><a href="solutions.html#cb1650-1" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted_dt <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1650-2"><a href="solutions.html#cb1650-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted_mt <span class="ot">&lt;-</span> <span class="fu">predict</span>(m2, bacteria)</span>
<span id="cb1650-3"><a href="solutions.html#cb1650-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1650-4"><a href="solutions.html#cb1650-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1650-5"><a href="solutions.html#cb1650-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1650-6"><a href="solutions.html#cb1650-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1650-7"><a href="solutions.html#cb1650-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted_dt), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1650-8"><a href="solutions.html#cb1650-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted_mt), <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>Neither model does particularly well (but fail in different ways).</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we repeat the same steps, but use observations 20 to 120 for fitting the models:</li>
</ol>
<div class="sourceCode" id="cb1651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1651-1"><a href="solutions.html#cb1651-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1651-2"><a href="solutions.html#cb1651-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">20</span><span class="sc">:</span><span class="dv">120</span>,],</span>
<span id="cb1651-3"><a href="solutions.html#cb1651-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1651-4"><a href="solutions.html#cb1651-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb1651-5"><a href="solutions.html#cb1651-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="dv">0</span>))</span>
<span id="cb1651-6"><a href="solutions.html#cb1651-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1651-7"><a href="solutions.html#cb1651-7" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lmtree</span>(OD <span class="sc">~</span> Time <span class="sc">|</span> Time, <span class="at">data =</span> bacteria[<span class="dv">20</span><span class="sc">:</span><span class="dv">120</span>,])</span>
<span id="cb1651-8"><a href="solutions.html#cb1651-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1651-9"><a href="solutions.html#cb1651-9" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m2)</span>
<span id="cb1651-10"><a href="solutions.html#cb1651-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1651-11"><a href="solutions.html#cb1651-11" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted_dt <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1651-12"><a href="solutions.html#cb1651-12" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted_mt <span class="ot">&lt;-</span> <span class="fu">predict</span>(m2, bacteria)</span>
<span id="cb1651-13"><a href="solutions.html#cb1651-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1651-14"><a href="solutions.html#cb1651-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1651-15"><a href="solutions.html#cb1651-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1651-16"><a href="solutions.html#cb1651-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1651-17"><a href="solutions.html#cb1651-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted_dt), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1651-18"><a href="solutions.html#cb1651-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted_mt), <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>As we can see from the plot of the model tree, it (correctly!) identifies different time phases in which the bacteria grow at different speeds. It therefore also managed to make better extrapolation than the decision tree, which predicts no growth as <code>Time</code> is increased beyond what was seen in the training data.</p>
<p><a href="mlchapter.html#exr:ch8exc12ab">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12b" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12b">9.24</a><a href="solutions.html#ch8solutions12b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the model using <code>train</code> as follows:</p>
<div class="sourceCode" id="cb1652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1652-1"><a href="solutions.html#cb1652-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1652-2"><a href="solutions.html#cb1652-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb1652-3"><a href="solutions.html#cb1652-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb1652-4"><a href="solutions.html#cb1652-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1652-5"><a href="solutions.html#cb1652-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1652-6"><a href="solutions.html#cb1652-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1652-7"><a href="solutions.html#cb1652-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1652-8"><a href="solutions.html#cb1652-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> .,</span>
<span id="cb1652-9"><a href="solutions.html#cb1652-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1652-10"><a href="solutions.html#cb1652-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1652-11"><a href="solutions.html#cb1652-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;qda&quot;</span>,</span>
<span id="cb1652-12"><a href="solutions.html#cb1652-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span>
<span id="cb1652-13"><a href="solutions.html#cb1652-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1652-14"><a href="solutions.html#cb1652-14" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>To round things off, we evaluate the model using <code>evalm</code>:</p>
<div class="sourceCode" id="cb1653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1653-1"><a href="solutions.html#cb1653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1653-2"><a href="solutions.html#cb1653-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(m, <span class="at">gnames =</span> <span class="st">&quot;QDA&quot;</span>)</span>
<span id="cb1653-3"><a href="solutions.html#cb1653-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1653-4"><a href="solutions.html#cb1653-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1653-5"><a href="solutions.html#cb1653-5" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1653-6"><a href="solutions.html#cb1653-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1653-7"><a href="solutions.html#cb1653-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % Confidence interval for AUC:</span></span>
<span id="cb1653-8"><a href="solutions.html#cb1653-8" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>optres[[<span class="dv">1</span>]][<span class="dv">13</span>,]</span>
<span id="cb1653-9"><a href="solutions.html#cb1653-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1653-10"><a href="solutions.html#cb1653-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1653-11"><a href="solutions.html#cb1653-11" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p><a href="mlchapter.html#exr:ch8exc12b">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12ad" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12ad">9.25</a><a href="solutions.html#ch8solutions12ad" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1654-1"><a href="solutions.html#cb1654-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1654-2"><a href="solutions.html#cb1654-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1654-3"><a href="solutions.html#cb1654-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1654-4"><a href="solutions.html#cb1654-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1654-5"><a href="solutions.html#cb1654-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1654-6"><a href="solutions.html#cb1654-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1654-7"><a href="solutions.html#cb1654-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we fit LDA and QDA models with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1655-1"><a href="solutions.html#cb1655-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1655-2"><a href="solutions.html#cb1655-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1655-3"><a href="solutions.html#cb1655-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1655-4"><a href="solutions.html#cb1655-4" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1655-5"><a href="solutions.html#cb1655-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1655-6"><a href="solutions.html#cb1655-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1655-7"><a href="solutions.html#cb1655-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;lda&quot;</span>)</span>
<span id="cb1655-8"><a href="solutions.html#cb1655-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1655-9"><a href="solutions.html#cb1655-9" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1655-10"><a href="solutions.html#cb1655-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1655-11"><a href="solutions.html#cb1655-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1655-12"><a href="solutions.html#cb1655-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;qda&quot;</span>)</span></code></pre></div>
<p>Next, we plot the decision boundaries in the same scatterplot (LDA is black and QDA is orange):</p>
<div class="sourceCode" id="cb1656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1656-1"><a href="solutions.html#cb1656-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1656-2"><a href="solutions.html#cb1656-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1656-3"><a href="solutions.html#cb1656-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1656-4"><a href="solutions.html#cb1656-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1656-5"><a href="solutions.html#cb1656-5" aria-hidden="true" tabindex="-1"></a>predictions1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1656-6"><a href="solutions.html#cb1656-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m1, contour_data)))</span>
<span id="cb1656-7"><a href="solutions.html#cb1656-7" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1656-8"><a href="solutions.html#cb1656-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m2, contour_data)))</span>
<span id="cb1656-9"><a href="solutions.html#cb1656-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1656-10"><a href="solutions.html#cb1656-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1656-11"><a href="solutions.html#cb1656-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1656-12"><a href="solutions.html#cb1656-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1656-13"><a href="solutions.html#cb1656-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1656-14"><a href="solutions.html#cb1656-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions1, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1656-15"><a href="solutions.html#cb1656-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1656-16"><a href="solutions.html#cb1656-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions2, <span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p>The decision boundaries are fairly similar and seem pretty reasonable. QDA offers more flexible non-linear boundaries, but the difference isn’t huge.</p>
<p><a href="mlchapter.html#exr:ch8exc12ad">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12ae" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12ae">9.26</a><a href="solutions.html#ch8solutions12ae" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1657-1"><a href="solutions.html#cb1657-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1657-2"><a href="solutions.html#cb1657-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1657-3"><a href="solutions.html#cb1657-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1657-4"><a href="solutions.html#cb1657-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1657-5"><a href="solutions.html#cb1657-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1657-6"><a href="solutions.html#cb1657-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1657-7"><a href="solutions.html#cb1657-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we fit the MDA model with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1658-1"><a href="solutions.html#cb1658-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1658-2"><a href="solutions.html#cb1658-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1658-3"><a href="solutions.html#cb1658-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1658-4"><a href="solutions.html#cb1658-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1658-5"><a href="solutions.html#cb1658-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1658-6"><a href="solutions.html#cb1658-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1658-7"><a href="solutions.html#cb1658-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;mda&quot;</span>)</span></code></pre></div>
<p>Finally, we plot the decision boundaries:</p>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1659-1"><a href="solutions.html#cb1659-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1659-2"><a href="solutions.html#cb1659-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1659-3"><a href="solutions.html#cb1659-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1659-4"><a href="solutions.html#cb1659-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1659-5"><a href="solutions.html#cb1659-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1659-6"><a href="solutions.html#cb1659-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m, contour_data)))</span>
<span id="cb1659-7"><a href="solutions.html#cb1659-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1659-8"><a href="solutions.html#cb1659-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1659-9"><a href="solutions.html#cb1659-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1659-10"><a href="solutions.html#cb1659-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1659-11"><a href="solutions.html#cb1659-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1659-12"><a href="solutions.html#cb1659-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>The decision boundaries are similar to those of QDA.</p>
<p><a href="mlchapter.html#exr:ch8exc12ae">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12cc" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12cc">9.27</a><a href="solutions.html#ch8solutions12cc" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We’ll go with a polynomial kernel and compare polynomials of degree 2 and 3. We can fit the model using <code>train</code> as follows:</p>
<div class="sourceCode" id="cb1660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1660-1"><a href="solutions.html#cb1660-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1660-2"><a href="solutions.html#cb1660-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1660-3"><a href="solutions.html#cb1660-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>, </span>
<span id="cb1660-4"><a href="solutions.html#cb1660-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1660-5"><a href="solutions.html#cb1660-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1660-6"><a href="solutions.html#cb1660-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1660-7"><a href="solutions.html#cb1660-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1660-8"><a href="solutions.html#cb1660-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span>  .,</span>
<span id="cb1660-9"><a href="solutions.html#cb1660-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1660-10"><a href="solutions.html#cb1660-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1660-11"><a href="solutions.html#cb1660-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;svmPoly&quot;</span>,</span>
<span id="cb1660-12"><a href="solutions.html#cb1660-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">C =</span> <span class="dv">1</span>,</span>
<span id="cb1660-13"><a href="solutions.html#cb1660-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">degree =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb1660-14"><a href="solutions.html#cb1660-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">scale =</span> <span class="dv">1</span>),</span>
<span id="cb1660-15"><a href="solutions.html#cb1660-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p>And, as usual, we can then plot ROC and calibration curves:</p>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1661-1"><a href="solutions.html#cb1661-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1661-2"><a href="solutions.html#cb1661-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(m, <span class="at">gnames =</span> <span class="st">&quot;SVM poly&quot;</span>)</span>
<span id="cb1661-3"><a href="solutions.html#cb1661-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1661-4"><a href="solutions.html#cb1661-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1661-5"><a href="solutions.html#cb1661-5" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1661-6"><a href="solutions.html#cb1661-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1661-7"><a href="solutions.html#cb1661-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % Confidence interval for AUC:</span></span>
<span id="cb1661-8"><a href="solutions.html#cb1661-8" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>optres[[<span class="dv">1</span>]][<span class="dv">13</span>,]</span>
<span id="cb1661-9"><a href="solutions.html#cb1661-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1661-10"><a href="solutions.html#cb1661-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1661-11"><a href="solutions.html#cb1661-11" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p><a href="mlchapter.html#exr:ch8exc12cc">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12d" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12d">9.28</a><a href="solutions.html#ch8solutions12d" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>We set <code>file_path</code> to the path of <code>bacteria.csv</code>, then load and format the data as in Section <a href="mlchapter.html#extrapolation">9.3.3</a>:</li>
</ol>
<div class="sourceCode" id="cb1662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1662-1"><a href="solutions.html#cb1662-1" aria-hidden="true" tabindex="-1"></a>bacteria <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1662-2"><a href="solutions.html#cb1662-2" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(bacteria<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Next, we fit an SVM with a polynomial kernel using rows 45 to 90:</p>
<div class="sourceCode" id="cb1663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1663-1"><a href="solutions.html#cb1663-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1663-2"><a href="solutions.html#cb1663-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1663-3"><a href="solutions.html#cb1663-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1663-4"><a href="solutions.html#cb1663-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1663-5"><a href="solutions.html#cb1663-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">45</span><span class="sc">:</span><span class="dv">90</span>,],</span>
<span id="cb1663-6"><a href="solutions.html#cb1663-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1663-7"><a href="solutions.html#cb1663-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;svmPoly&quot;</span>)</span></code></pre></div>
<p>Finally, we make predictions for the entire dataset and compare the results to the actual outcomes:</p>
<div class="sourceCode" id="cb1664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1664-1"><a href="solutions.html#cb1664-1" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1664-2"><a href="solutions.html#cb1664-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1664-3"><a href="solutions.html#cb1664-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1664-4"><a href="solutions.html#cb1664-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1664-5"><a href="solutions.html#cb1664-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1664-6"><a href="solutions.html#cb1664-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>Similar to the linear model in Section <a href="mlchapter.html#extrapolation">9.3.3</a>, the SVM model does not extrapolate too well outside the training data. Unlike tree-based models, however, it does not yield constant predictions for values of the explanatory variable that are outside the range in the training data. Instead, the fitted function is assumed to follow the same shape as in the training data.</p>
<ol start="2" style="list-style-type: decimal">
<li>Next, we repeat the same steps using the data from rows 20 to 120:</li>
</ol>
<div class="sourceCode" id="cb1665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1665-1"><a href="solutions.html#cb1665-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1665-2"><a href="solutions.html#cb1665-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1665-3"><a href="solutions.html#cb1665-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1665-4"><a href="solutions.html#cb1665-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(OD <span class="sc">~</span> Time,</span>
<span id="cb1665-5"><a href="solutions.html#cb1665-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bacteria[<span class="dv">20</span><span class="sc">:</span><span class="dv">120</span>,],</span>
<span id="cb1665-6"><a href="solutions.html#cb1665-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1665-7"><a href="solutions.html#cb1665-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;svmPoly&quot;</span>)</span>
<span id="cb1665-8"><a href="solutions.html#cb1665-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1665-9"><a href="solutions.html#cb1665-9" aria-hidden="true" tabindex="-1"></a>bacteria<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, bacteria)</span>
<span id="cb1665-10"><a href="solutions.html#cb1665-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1665-11"><a href="solutions.html#cb1665-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bacteria, <span class="fu">aes</span>(Time, OD)) <span class="sc">+</span></span>
<span id="cb1665-12"><a href="solutions.html#cb1665-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1665-13"><a href="solutions.html#cb1665-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(Time, Predicted), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>The results are disappointing. Using a different kernel could improve the results though, so go ahead and give that a try!</p>
<p><a href="mlchapter.html#exr:ch8exc12d">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions12af" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc12af">9.29</a><a href="solutions.html#ch8solutions12af" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1666-1"><a href="solutions.html#cb1666-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1666-2"><a href="solutions.html#cb1666-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1666-3"><a href="solutions.html#cb1666-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1666-4"><a href="solutions.html#cb1666-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1666-5"><a href="solutions.html#cb1666-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1666-6"><a href="solutions.html#cb1666-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1666-7"><a href="solutions.html#cb1666-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we two different SVM models with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1667-1"><a href="solutions.html#cb1667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1667-2"><a href="solutions.html#cb1667-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1667-3"><a href="solutions.html#cb1667-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb1667-4"><a href="solutions.html#cb1667-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1667-5"><a href="solutions.html#cb1667-5" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1667-6"><a href="solutions.html#cb1667-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1667-7"><a href="solutions.html#cb1667-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1667-8"><a href="solutions.html#cb1667-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;svmPoly&quot;</span>)</span>
<span id="cb1667-9"><a href="solutions.html#cb1667-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1667-10"><a href="solutions.html#cb1667-10" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1667-11"><a href="solutions.html#cb1667-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1667-12"><a href="solutions.html#cb1667-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1667-13"><a href="solutions.html#cb1667-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;svmRadialCost&quot;</span>)</span></code></pre></div>
<p>Next, we plot the decision boundaries in the same scatterplot (the polynomial kernel is black and the radial basis kernel is orange):</p>
<div class="sourceCode" id="cb1668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1668-1"><a href="solutions.html#cb1668-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1668-2"><a href="solutions.html#cb1668-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1668-3"><a href="solutions.html#cb1668-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1668-4"><a href="solutions.html#cb1668-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1668-5"><a href="solutions.html#cb1668-5" aria-hidden="true" tabindex="-1"></a>predictions1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1668-6"><a href="solutions.html#cb1668-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m1, contour_data)))</span>
<span id="cb1668-7"><a href="solutions.html#cb1668-7" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1668-8"><a href="solutions.html#cb1668-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m2, contour_data)))</span>
<span id="cb1668-9"><a href="solutions.html#cb1668-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1668-10"><a href="solutions.html#cb1668-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1668-11"><a href="solutions.html#cb1668-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1668-12"><a href="solutions.html#cb1668-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1668-13"><a href="solutions.html#cb1668-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1668-14"><a href="solutions.html#cb1668-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions1, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1668-15"><a href="solutions.html#cb1668-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1668-16"><a href="solutions.html#cb1668-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions2, <span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p>It is likely the case that the polynomial kernel gives a similar results to e.g. MDA, whereas the radial basis kernel gives more flexible decision boundaries.</p>
<p><a href="mlchapter.html#exr:ch8exc12af">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions9" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc9">9.30</a><a href="solutions.html#ch8solutions9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We load and format the data as in the beginning of Section <a href="mlchapter.html#classifieraccuracy">9.1.7</a>. We can then fit the model using <code>train</code>. We set <code>summaryFunction = twoClassSummary</code> and <code>metric = "ROC"</code> to use <span class="math inline">\(AUC\)</span> to find the optimal <span class="math inline">\(k\)</span>. We make sure to add a <code>preProcess</code> argument to <code>train</code>, to standardise the data:</p>
<div class="sourceCode" id="cb1669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1669-1"><a href="solutions.html#cb1669-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1669-2"><a href="solutions.html#cb1669-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb1669-3"><a href="solutions.html#cb1669-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb1669-4"><a href="solutions.html#cb1669-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb1669-5"><a href="solutions.html#cb1669-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1669-6"><a href="solutions.html#cb1669-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">classProbs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1669-7"><a href="solutions.html#cb1669-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1669-8"><a href="solutions.html#cb1669-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> pH <span class="sc">+</span> alcohol <span class="sc">+</span> fixed.acidity <span class="sc">+</span> residual.sugar,</span>
<span id="cb1669-9"><a href="solutions.html#cb1669-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wine,</span>
<span id="cb1669-10"><a href="solutions.html#cb1669-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1669-11"><a href="solutions.html#cb1669-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb1669-12"><a href="solutions.html#cb1669-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb1669-13"><a href="solutions.html#cb1669-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneLength =</span> <span class="dv">15</span>,</span>
<span id="cb1669-14"><a href="solutions.html#cb1669-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))</span>
<span id="cb1669-15"><a href="solutions.html#cb1669-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1669-16"><a href="solutions.html#cb1669-16" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>To visually evaluate the model, we use <code>evalm</code> to plot ROC and calibration curves:</p>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1670-1"><a href="solutions.html#cb1670-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLeval)</span>
<span id="cb1670-2"><a href="solutions.html#cb1670-2" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">evalm</span>(m, <span class="at">gnames =</span> <span class="st">&quot;kNN&quot;</span>)</span>
<span id="cb1670-3"><a href="solutions.html#cb1670-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1670-4"><a href="solutions.html#cb1670-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC:</span></span>
<span id="cb1670-5"><a href="solutions.html#cb1670-5" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>roc</span>
<span id="cb1670-6"><a href="solutions.html#cb1670-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1670-7"><a href="solutions.html#cb1670-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 95 % Confidence interval for AUC:</span></span>
<span id="cb1670-8"><a href="solutions.html#cb1670-8" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>optres[[<span class="dv">1</span>]][<span class="dv">13</span>,]</span>
<span id="cb1670-9"><a href="solutions.html#cb1670-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1670-10"><a href="solutions.html#cb1670-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibration curves:</span></span>
<span id="cb1670-11"><a href="solutions.html#cb1670-11" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span>cc</span></code></pre></div>
<p>The performance is as good as, or a little better than, the best logistic regression model from Exercise <a href="mlchapter.html#exr:ch8exc5">9.5</a>. We shouldn’t make too much of any differences though, as the models were evaluated in different ways - we used repeated 10-fold cross-validation for the logistics models and a simple 10-fold cross-validation here (because repeated cross-validation would be too slow in this case).</p>
<p><a href="mlchapter.html#exr:ch8exc9">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions9f" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc9f">9.31</a><a href="solutions.html#ch8solutions9f" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we load the data as in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb1671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1671-1"><a href="solutions.html#cb1671-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb1671-2"><a href="solutions.html#cb1671-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb1671-3"><a href="solutions.html#cb1671-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb1671-4"><a href="solutions.html#cb1671-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb1671-5"><a href="solutions.html#cb1671-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb1671-6"><a href="solutions.html#cb1671-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb1671-7"><a href="solutions.html#cb1671-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>Next, we two different kNN models with <code>Kernel_length</code> and <code>Compactness</code> as explanatory variables:</p>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1672-1"><a href="solutions.html#cb1672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1672-2"><a href="solutions.html#cb1672-2" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>)</span>
<span id="cb1672-3"><a href="solutions.html#cb1672-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1672-4"><a href="solutions.html#cb1672-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">train</span>(Variety <span class="sc">~</span> Kernel_length <span class="sc">+</span> Compactness,</span>
<span id="cb1672-5"><a href="solutions.html#cb1672-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> seeds,</span>
<span id="cb1672-6"><a href="solutions.html#cb1672-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">trControl =</span> tc,</span>
<span id="cb1672-7"><a href="solutions.html#cb1672-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb1672-8"><a href="solutions.html#cb1672-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">tuneLength =</span> <span class="dv">15</span>,</span>
<span id="cb1672-9"><a href="solutions.html#cb1672-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))</span></code></pre></div>
<p>Next, we plot the decision boundaries:</p>
<div class="sourceCode" id="cb1673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1673-1"><a href="solutions.html#cb1673-1" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1673-2"><a href="solutions.html#cb1673-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kernel_length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Kernel_length), <span class="fu">max</span>(seeds<span class="sc">$</span>Kernel_length), <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb1673-3"><a href="solutions.html#cb1673-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compactness =</span> <span class="fu">seq</span>(<span class="fu">min</span>(seeds<span class="sc">$</span>Compactness), <span class="fu">max</span>(seeds<span class="sc">$</span>Compactness), <span class="at">length =</span> <span class="dv">500</span>))</span>
<span id="cb1673-4"><a href="solutions.html#cb1673-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-5"><a href="solutions.html#cb1673-5" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(contour_data,</span>
<span id="cb1673-6"><a href="solutions.html#cb1673-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Variety =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(m, contour_data)))</span>
<span id="cb1673-7"><a href="solutions.html#cb1673-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-8"><a href="solutions.html#cb1673-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1673-9"><a href="solutions.html#cb1673-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(Kernel_length, Compactness, <span class="at">colour =</span> Variety)) <span class="sc">+</span></span>
<span id="cb1673-10"><a href="solutions.html#cb1673-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1673-11"><a href="solutions.html#cb1673-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> Kernel_length, <span class="at">y =</span> Compactness, <span class="at">z =</span> Variety),</span>
<span id="cb1673-12"><a href="solutions.html#cb1673-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> predictions, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>The decision boundaries are quite “wiggly”, which will always be the case when there are enough points in the sample.</p>
<p><a href="mlchapter.html#exr:ch8exc9f">(Click here to return to the exercise.)</a></p>
</div>
<div id="ch8solutions13" class="section level4 unnumbered hasAnchor">
<h4>Exercise <a href="mlchapter.html#exr:ch8exc13">9.32</a><a href="solutions.html#ch8solutions13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We start by plotting the time series:</p>
<div class="sourceCode" id="cb1674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1674-1"><a href="solutions.html#cb1674-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1674-2"><a href="solutions.html#cb1674-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fma)</span>
<span id="cb1674-3"><a href="solutions.html#cb1674-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1674-4"><a href="solutions.html#cb1674-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(writing) <span class="sc">+</span></span>
<span id="cb1674-5"><a href="solutions.html#cb1674-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales (francs)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1674-6"><a href="solutions.html#cb1674-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Sales of printing and writing paper&quot;</span>)</span></code></pre></div>
<p>Next, we fit an ARIMA model after removing the seasonal component:</p>
<div class="sourceCode" id="cb1675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1675-1"><a href="solutions.html#cb1675-1" aria-hidden="true" tabindex="-1"></a>tsmod <span class="ot">&lt;-</span> <span class="fu">stlm</span>(writing, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>,</span>
<span id="cb1675-2"><a href="solutions.html#cb1675-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">modelfunction =</span> auto.arima)</span></code></pre></div>
<p>The residuals look pretty good for this model:</p>
<div class="sourceCode" id="cb1676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1676-1"><a href="solutions.html#cb1676-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(tsmod)</span></code></pre></div>
<p>Finally, we make a forecast for the next 36 months, adding the seasonal component back and using bootstrap prediction intervals:</p>
<div class="sourceCode" id="cb1677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1677-1"><a href="solutions.html#cb1677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(tsmod, <span class="at">h =</span> <span class="dv">36</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><a href="mlchapter.html#exr:ch8exc13">(Click here to return to the exercise.)</a></p>
<!--#### Exercise \@ref(exr:ch8exc14) {-#ch8solutions14}



[(Click here to return to the exercise.)]Exercise 13.1 

 #### Exercise \@ref(exr:ch8exc15) {-#ch8solutions15}



[(Click here to return to the exercise.)]Exercise 13.2  

## Chapter 9 {-#ch9solutions}

## Chapter 10 {-#ch10solutions} -->

<!-- # References {-} -->
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mathschap.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
