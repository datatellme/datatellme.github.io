<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Exploratory data analysis and unsupervised learning | Modern Statistics with R</title>
  <meta name="description" content="4 Exploratory data analysis and unsupervised learning | Modern Statistics with R" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Exploratory data analysis and unsupervised learning | Modern Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Exploratory data analysis and unsupervised learning | Modern Statistics with R" />
  
  
  

<meta name="author" content="Mans Thulin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="datachapter.html"/>
<link rel="next" href="messychapter.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="preamble.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="Introduction.html"><a href="Introduction.html"><i class="fa fa-check"></i><b>1</b> 들어가며</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Introduction.html"><a href="Introduction.html#whatR"><i class="fa fa-check"></i><b>1.1</b> R이란?</a></li>
<li class="chapter" data-level="1.2" data-path="Introduction.html"><a href="Introduction.html#Rinstallation"><i class="fa fa-check"></i><b>1.2</b> R 설치하기</a></li>
<li class="chapter" data-level="1.3" data-path="Introduction.html"><a href="Introduction.html#RStudioinstallation"><i class="fa fa-check"></i><b>1.3</b> RStudio 설치하기</a></li>
<li class="chapter" data-level="1.4" data-path="Introduction.html"><a href="Introduction.html#LaTeXinstallation"><i class="fa fa-check"></i><b>1.4</b> 레이텍 설치하기</a></li>
<li class="chapter" data-level="1.5" data-path="Introduction.html"><a href="Introduction.html#packageinstallation"><i class="fa fa-check"></i><b>1.5</b> Packages 설치하기</a></li>
<li class="chapter" data-level="1.6" data-path="Introduction.html"><a href="Introduction.html#aboutbook"><i class="fa fa-check"></i><b>1.6</b> 이 책에 대하여</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="thebasics.html"><a href="thebasics.html"><i class="fa fa-check"></i><b>2</b> The basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="thebasics.html"><a href="thebasics.html#a-first-look-at-rstudio"><i class="fa fa-check"></i><b>2.1</b> A first look at RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="thebasics.html"><a href="thebasics.html#runningcode"><i class="fa fa-check"></i><b>2.2</b> Running R code</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="thebasics.html"><a href="thebasics.html#r-scripts"><i class="fa fa-check"></i><b>2.2.1</b> R scripts</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="thebasics.html"><a href="thebasics.html#varsandfuncs"><i class="fa fa-check"></i><b>2.3</b> Variables and functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="thebasics.html"><a href="thebasics.html#storing-data"><i class="fa fa-check"></i><b>2.3.1</b> Storing data</a></li>
<li class="chapter" data-level="2.3.2" data-path="thebasics.html"><a href="thebasics.html#whats-in-a-name"><i class="fa fa-check"></i><b>2.3.2</b> What’s in a name?</a></li>
<li class="chapter" data-level="2.3.3" data-path="thebasics.html"><a href="thebasics.html#vectors-and-data-frames"><i class="fa fa-check"></i><b>2.3.3</b> Vectors and data frames</a></li>
<li class="chapter" data-level="2.3.4" data-path="thebasics.html"><a href="thebasics.html#functions"><i class="fa fa-check"></i><b>2.3.4</b> Functions</a></li>
<li class="chapter" data-level="2.3.5" data-path="thebasics.html"><a href="thebasics.html#maths"><i class="fa fa-check"></i><b>2.3.5</b> Mathematical operations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="thebasics.html"><a href="thebasics.html#descstats"><i class="fa fa-check"></i><b>2.4</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="thebasics.html"><a href="thebasics.html#numerical-data"><i class="fa fa-check"></i><b>2.4.1</b> Numerical data</a></li>
<li class="chapter" data-level="2.4.2" data-path="thebasics.html"><a href="thebasics.html#catdata1"><i class="fa fa-check"></i><b>2.4.2</b> Categorical data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="thebasics.html"><a href="thebasics.html#plotting-numerical-data"><i class="fa fa-check"></i><b>2.5</b> Plotting numerical data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="thebasics.html"><a href="thebasics.html#our-first-plot"><i class="fa fa-check"></i><b>2.5.1</b> Our first plot</a></li>
<li class="chapter" data-level="2.5.2" data-path="thebasics.html"><a href="thebasics.html#colours-shapes-and-axis-labels"><i class="fa fa-check"></i><b>2.5.2</b> Colours, shapes and axis labels</a></li>
<li class="chapter" data-level="2.5.3" data-path="thebasics.html"><a href="thebasics.html#axis-limits-and-scales"><i class="fa fa-check"></i><b>2.5.3</b> Axis limits and scales</a></li>
<li class="chapter" data-level="2.5.4" data-path="thebasics.html"><a href="thebasics.html#comparinggroups"><i class="fa fa-check"></i><b>2.5.4</b> Comparing groups</a></li>
<li class="chapter" data-level="2.5.5" data-path="thebasics.html"><a href="thebasics.html#boxplots"><i class="fa fa-check"></i><b>2.5.5</b> Boxplots</a></li>
<li class="chapter" data-level="2.5.6" data-path="thebasics.html"><a href="thebasics.html#histograms"><i class="fa fa-check"></i><b>2.5.6</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="thebasics.html"><a href="thebasics.html#catdata2"><i class="fa fa-check"></i><b>2.6</b> Plotting categorical data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="thebasics.html"><a href="thebasics.html#bar-charts"><i class="fa fa-check"></i><b>2.6.1</b> Bar charts</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="thebasics.html"><a href="thebasics.html#saving-your-plot"><i class="fa fa-check"></i><b>2.7</b> Saving your plot</a></li>
<li class="chapter" data-level="2.8" data-path="thebasics.html"><a href="thebasics.html#troubleshooting"><i class="fa fa-check"></i><b>2.8</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datachapter.html"><a href="datachapter.html"><i class="fa fa-check"></i><b>3</b> Transforming, summarising, and analysing data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datachapter.html"><a href="datachapter.html#data-frames-and-data-types"><i class="fa fa-check"></i><b>3.1</b> Data frames and data types</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="datachapter.html"><a href="datachapter.html#types-and-structures"><i class="fa fa-check"></i><b>3.1.1</b> Types and structures</a></li>
<li class="chapter" data-level="3.1.2" data-path="datachapter.html"><a href="datachapter.html#typesoftables"><i class="fa fa-check"></i><b>3.1.2</b> Types of tables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="datachapter.html"><a href="datachapter.html#findingpoints"><i class="fa fa-check"></i><b>3.2</b> Vectors in data frames</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="datachapter.html"><a href="datachapter.html#accessingelements"><i class="fa fa-check"></i><b>3.2.1</b> Accessing vectors and elements</a></li>
<li class="chapter" data-level="3.2.2" data-path="datachapter.html"><a href="datachapter.html#use-your-dollars"><i class="fa fa-check"></i><b>3.2.2</b> Use your dollars</a></li>
<li class="chapter" data-level="3.2.3" data-path="datachapter.html"><a href="datachapter.html#conditionsintro"><i class="fa fa-check"></i><b>3.2.3</b> Using conditions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datachapter.html"><a href="datachapter.html#paths"><i class="fa fa-check"></i><b>3.3</b> Importing data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="datachapter.html"><a href="datachapter.html#importing-csv-files"><i class="fa fa-check"></i><b>3.3.1</b> Importing csv files</a></li>
<li class="chapter" data-level="3.3.2" data-path="datachapter.html"><a href="datachapter.html#file-paths"><i class="fa fa-check"></i><b>3.3.2</b> File paths</a></li>
<li class="chapter" data-level="3.3.3" data-path="datachapter.html"><a href="datachapter.html#importing-excel-files"><i class="fa fa-check"></i><b>3.3.3</b> Importing Excel files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="datachapter.html"><a href="datachapter.html#saving-and-exporting-your-data"><i class="fa fa-check"></i><b>3.4</b> Saving and exporting your data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="datachapter.html"><a href="datachapter.html#exporting-data"><i class="fa fa-check"></i><b>3.4.1</b> Exporting data</a></li>
<li class="chapter" data-level="3.4.2" data-path="datachapter.html"><a href="datachapter.html#saving-and-loading-r-data"><i class="fa fa-check"></i><b>3.4.2</b> Saving and loading R data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="datachapter.html"><a href="datachapter.html#rstudio-projects"><i class="fa fa-check"></i><b>3.5</b> RStudio projects</a></li>
<li class="chapter" data-level="3.6" data-path="datachapter.html"><a href="datachapter.html#firstttest"><i class="fa fa-check"></i><b>3.6</b> Running a t-test</a></li>
<li class="chapter" data-level="3.7" data-path="datachapter.html"><a href="datachapter.html#firstlm"><i class="fa fa-check"></i><b>3.7</b> Fitting a linear regression model</a></li>
<li class="chapter" data-level="3.8" data-path="datachapter.html"><a href="datachapter.html#grouped"><i class="fa fa-check"></i><b>3.8</b> Grouped summaries</a></li>
<li class="chapter" data-level="3.9" data-path="datachapter.html"><a href="datachapter.html#pipes"><i class="fa fa-check"></i><b>3.9</b> Using <code>%&gt;%</code> pipes</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="datachapter.html"><a href="datachapter.html#ceci-nest-pas-une-pipe"><i class="fa fa-check"></i><b>3.9.1</b> <em>Ceci n’est pas une pipe</em></a></li>
<li class="chapter" data-level="3.9.2" data-path="datachapter.html"><a href="datachapter.html#aliases-and-placeholders"><i class="fa fa-check"></i><b>3.9.2</b> Aliases and placeholders</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="datachapter.html"><a href="datachapter.html#flavours-of-r-base-and-tidyverse"><i class="fa fa-check"></i><b>3.10</b> Flavours of R: base and tidyverse</a></li>
<li class="chapter" data-level="3.11" data-path="datachapter.html"><a href="datachapter.html#ethicalguidelines"><i class="fa fa-check"></i><b>3.11</b> Ethics and good statistical practice</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis and unsupervised learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="eda.html"><a href="eda.html#rmarkdown"><i class="fa fa-check"></i><b>4.1</b> Reports with R Markdown</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="eda.html"><a href="eda.html#a-first-example"><i class="fa fa-check"></i><b>4.1.1</b> A first example</a></li>
<li class="chapter" data-level="4.1.2" data-path="eda.html"><a href="eda.html#formatting-text"><i class="fa fa-check"></i><b>4.1.2</b> Formatting text</a></li>
<li class="chapter" data-level="4.1.3" data-path="eda.html"><a href="eda.html#lists-tables-and-images"><i class="fa fa-check"></i><b>4.1.3</b> Lists, tables, and images</a></li>
<li class="chapter" data-level="4.1.4" data-path="eda.html"><a href="eda.html#code-chunks"><i class="fa fa-check"></i><b>4.1.4</b> Code chunks</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="eda.html"><a href="eda.html#themes"><i class="fa fa-check"></i><b>4.2</b> Customising <code>ggplot2</code> plots</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="eda.html"><a href="eda.html#using-themes"><i class="fa fa-check"></i><b>4.2.1</b> Using themes</a></li>
<li class="chapter" data-level="4.2.2" data-path="eda.html"><a href="eda.html#colourpalettes"><i class="fa fa-check"></i><b>4.2.2</b> Colour palettes</a></li>
<li class="chapter" data-level="4.2.3" data-path="eda.html"><a href="eda.html#theme-settings"><i class="fa fa-check"></i><b>4.2.3</b> Theme settings</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="eda.html"><a href="eda.html#exploring-distributions"><i class="fa fa-check"></i><b>4.3</b> Exploring distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="eda.html"><a href="eda.html#density-plots-and-frequency-polygons"><i class="fa fa-check"></i><b>4.3.1</b> Density plots and frequency polygons</a></li>
<li class="chapter" data-level="4.3.2" data-path="eda.html"><a href="eda.html#asking-questions"><i class="fa fa-check"></i><b>4.3.2</b> Asking questions</a></li>
<li class="chapter" data-level="4.3.3" data-path="eda.html"><a href="eda.html#violin-plots"><i class="fa fa-check"></i><b>4.3.3</b> Violin plots</a></li>
<li class="chapter" data-level="4.3.4" data-path="eda.html"><a href="eda.html#patchwork"><i class="fa fa-check"></i><b>4.3.4</b> Combine multiple plots into a single graphic</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="eda.html"><a href="eda.html#outliers-and-missing-data"><i class="fa fa-check"></i><b>4.4</b> Outliers and missing data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="eda.html"><a href="eda.html#detecting-outliers"><i class="fa fa-check"></i><b>4.4.1</b> Detecting outliers</a></li>
<li class="chapter" data-level="4.4.2" data-path="eda.html"><a href="eda.html#labelling-outliers"><i class="fa fa-check"></i><b>4.4.2</b> Labelling outliers</a></li>
<li class="chapter" data-level="4.4.3" data-path="eda.html"><a href="eda.html#missing-data"><i class="fa fa-check"></i><b>4.4.3</b> Missing data</a></li>
<li class="chapter" data-level="4.4.4" data-path="eda.html"><a href="eda.html#exploring-data"><i class="fa fa-check"></i><b>4.4.4</b> Exploring data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="eda.html"><a href="eda.html#trends-in-scatterplots"><i class="fa fa-check"></i><b>4.5</b> Trends in scatterplots</a></li>
<li class="chapter" data-level="4.6" data-path="eda.html"><a href="eda.html#tsplots"><i class="fa fa-check"></i><b>4.6</b> Exploring time series</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="eda.html"><a href="eda.html#annotations-and-reference-lines"><i class="fa fa-check"></i><b>4.6.1</b> Annotations and reference lines</a></li>
<li class="chapter" data-level="4.6.2" data-path="eda.html"><a href="eda.html#longitudinal-data"><i class="fa fa-check"></i><b>4.6.2</b> Longitudinal data</a></li>
<li class="chapter" data-level="4.6.3" data-path="eda.html"><a href="eda.html#path-plots"><i class="fa fa-check"></i><b>4.6.3</b> Path plots</a></li>
<li class="chapter" data-level="4.6.4" data-path="eda.html"><a href="eda.html#spaghetti-plots"><i class="fa fa-check"></i><b>4.6.4</b> Spaghetti plots</a></li>
<li class="chapter" data-level="4.6.5" data-path="eda.html"><a href="eda.html#stlsec"><i class="fa fa-check"></i><b>4.6.5</b> Seasonal plots and decompositions</a></li>
<li class="chapter" data-level="4.6.6" data-path="eda.html"><a href="eda.html#detecting-changepoints"><i class="fa fa-check"></i><b>4.6.6</b> Detecting changepoints</a></li>
<li class="chapter" data-level="4.6.7" data-path="eda.html"><a href="eda.html#interactivets"><i class="fa fa-check"></i><b>4.6.7</b> Interactive time series plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="eda.html"><a href="eda.html#polar"><i class="fa fa-check"></i><b>4.7</b> Using polar coordinates</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="eda.html"><a href="eda.html#visualising-periodic-data"><i class="fa fa-check"></i><b>4.7.1</b> Visualising periodic data</a></li>
<li class="chapter" data-level="4.7.2" data-path="eda.html"><a href="eda.html#pie-charts"><i class="fa fa-check"></i><b>4.7.2</b> Pie charts</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="eda.html"><a href="eda.html#visualising-multiple-variables"><i class="fa fa-check"></i><b>4.8</b> Visualising multiple variables</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="eda.html"><a href="eda.html#scatterplotmatrix"><i class="fa fa-check"></i><b>4.8.1</b> Scatterplot matrices</a></li>
<li class="chapter" data-level="4.8.2" data-path="eda.html"><a href="eda.html#d-scatterplots"><i class="fa fa-check"></i><b>4.8.2</b> 3D scatterplots</a></li>
<li class="chapter" data-level="4.8.3" data-path="eda.html"><a href="eda.html#correlograms"><i class="fa fa-check"></i><b>4.8.3</b> Correlograms</a></li>
<li class="chapter" data-level="4.8.4" data-path="eda.html"><a href="eda.html#adding-more-variables-to-scatterplots"><i class="fa fa-check"></i><b>4.8.4</b> Adding more variables to scatterplots</a></li>
<li class="chapter" data-level="4.8.5" data-path="eda.html"><a href="eda.html#overplotting"><i class="fa fa-check"></i><b>4.8.5</b> Overplotting</a></li>
<li class="chapter" data-level="4.8.6" data-path="eda.html"><a href="eda.html#categorical-data"><i class="fa fa-check"></i><b>4.8.6</b> Categorical data</a></li>
<li class="chapter" data-level="4.8.7" data-path="eda.html"><a href="eda.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.8.7</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="eda.html"><a href="eda.html#pca"><i class="fa fa-check"></i><b>4.9</b> Principal component analysis</a></li>
<li class="chapter" data-level="4.10" data-path="eda.html"><a href="eda.html#clustering"><i class="fa fa-check"></i><b>4.10</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="eda.html"><a href="eda.html#hierarchical-clustering"><i class="fa fa-check"></i><b>4.10.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="4.10.2" data-path="eda.html"><a href="eda.html#heatmaps-and-clustering-variables"><i class="fa fa-check"></i><b>4.10.2</b> Heatmaps and clustering variables</a></li>
<li class="chapter" data-level="4.10.3" data-path="eda.html"><a href="eda.html#centroid"><i class="fa fa-check"></i><b>4.10.3</b> Centroid-based clustering</a></li>
<li class="chapter" data-level="4.10.4" data-path="eda.html"><a href="eda.html#fuzzy-clustering"><i class="fa fa-check"></i><b>4.10.4</b> Fuzzy clustering</a></li>
<li class="chapter" data-level="4.10.5" data-path="eda.html"><a href="eda.html#modelbasedclustering"><i class="fa fa-check"></i><b>4.10.5</b> Model-based clustering</a></li>
<li class="chapter" data-level="4.10.6" data-path="eda.html"><a href="eda.html#comparing-clusters"><i class="fa fa-check"></i><b>4.10.6</b> Comparing clusters</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="eda.html"><a href="eda.html#exploratory-factor-analysis"><i class="fa fa-check"></i><b>4.11</b> Exploratory factor analysis</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="eda.html"><a href="eda.html#factor-analysis"><i class="fa fa-check"></i><b>4.11.1</b> Factor analysis</a></li>
<li class="chapter" data-level="4.11.2" data-path="eda.html"><a href="eda.html#lca"><i class="fa fa-check"></i><b>4.11.2</b> Latent class analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="messychapter.html"><a href="messychapter.html"><i class="fa fa-check"></i><b>5</b> Dealing with messy data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="messychapter.html"><a href="messychapter.html#coercion"><i class="fa fa-check"></i><b>5.1</b> Changing data types</a></li>
<li class="chapter" data-level="5.2" data-path="messychapter.html"><a href="messychapter.html#lists2"><i class="fa fa-check"></i><b>5.2</b> Working with lists</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="messychapter.html"><a href="messychapter.html#splitvector"><i class="fa fa-check"></i><b>5.2.1</b> Splitting vectors into lists</a></li>
<li class="chapter" data-level="5.2.2" data-path="messychapter.html"><a href="messychapter.html#collapsing-lists-into-vectors"><i class="fa fa-check"></i><b>5.2.2</b> Collapsing lists into vectors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="messychapter.html"><a href="messychapter.html#working-with-numbers"><i class="fa fa-check"></i><b>5.3</b> Working with numbers</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="messychapter.html"><a href="messychapter.html#rounding-numbers"><i class="fa fa-check"></i><b>5.3.1</b> Rounding numbers</a></li>
<li class="chapter" data-level="5.3.2" data-path="messychapter.html"><a href="messychapter.html#sums-and-means-in-data-frames"><i class="fa fa-check"></i><b>5.3.2</b> Sums and means in data frames</a></li>
<li class="chapter" data-level="5.3.3" data-path="messychapter.html"><a href="messychapter.html#rle"><i class="fa fa-check"></i><b>5.3.3</b> Summaries of series of numbers</a></li>
<li class="chapter" data-level="5.3.4" data-path="messychapter.html"><a href="messychapter.html#scientific-notation-1e-03"><i class="fa fa-check"></i><b>5.3.4</b> Scientific notation <code>1e-03</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="messychapter.html"><a href="messychapter.html#floatingpoints"><i class="fa fa-check"></i><b>5.3.5</b> Floating point arithmetics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="messychapter.html"><a href="messychapter.html#factors"><i class="fa fa-check"></i><b>5.4</b> Working with factors</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="messychapter.html"><a href="messychapter.html#creating-factors"><i class="fa fa-check"></i><b>5.4.1</b> Creating factors</a></li>
<li class="chapter" data-level="5.4.2" data-path="messychapter.html"><a href="messychapter.html#factorlevels"><i class="fa fa-check"></i><b>5.4.2</b> Changing factor levels</a></li>
<li class="chapter" data-level="5.4.3" data-path="messychapter.html"><a href="messychapter.html#changing-the-order-of-levels"><i class="fa fa-check"></i><b>5.4.3</b> Changing the order of levels</a></li>
<li class="chapter" data-level="5.4.4" data-path="messychapter.html"><a href="messychapter.html#combining-levels"><i class="fa fa-check"></i><b>5.4.4</b> Combining levels</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="messychapter.html"><a href="messychapter.html#strings"><i class="fa fa-check"></i><b>5.5</b> Working with strings</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="messychapter.html"><a href="messychapter.html#concatenating-strings"><i class="fa fa-check"></i><b>5.5.1</b> Concatenating strings</a></li>
<li class="chapter" data-level="5.5.2" data-path="messychapter.html"><a href="messychapter.html#changing-case"><i class="fa fa-check"></i><b>5.5.2</b> Changing case</a></li>
<li class="chapter" data-level="5.5.3" data-path="messychapter.html"><a href="messychapter.html#regexp"><i class="fa fa-check"></i><b>5.5.3</b> Finding patterns using regular expressions</a></li>
<li class="chapter" data-level="5.5.4" data-path="messychapter.html"><a href="messychapter.html#sub"><i class="fa fa-check"></i><b>5.5.4</b> Substitution</a></li>
<li class="chapter" data-level="5.5.5" data-path="messychapter.html"><a href="messychapter.html#splitting-strings"><i class="fa fa-check"></i><b>5.5.5</b> Splitting strings</a></li>
<li class="chapter" data-level="5.5.6" data-path="messychapter.html"><a href="messychapter.html#variable-names"><i class="fa fa-check"></i><b>5.5.6</b> Variable names</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="messychapter.html"><a href="messychapter.html#datetime"><i class="fa fa-check"></i><b>5.6</b> Working with dates and times</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="messychapter.html"><a href="messychapter.html#date-formats"><i class="fa fa-check"></i><b>5.6.1</b> Date formats</a></li>
<li class="chapter" data-level="5.6.2" data-path="messychapter.html"><a href="messychapter.html#plotting-with-dates"><i class="fa fa-check"></i><b>5.6.2</b> Plotting with dates</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="messychapter.html"><a href="messychapter.html#data-manipulation-with-data.table-dplyr-and-tidyr"><i class="fa fa-check"></i><b>5.7</b> Data manipulation with <code>data.table</code>, <code>dplyr</code>, and <code>tidyr</code></a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="messychapter.html"><a href="messychapter.html#dtbasics"><i class="fa fa-check"></i><b>5.7.1</b> <code>data.table</code> and tidyverse syntax basics</a></li>
<li class="chapter" data-level="5.7.2" data-path="messychapter.html"><a href="messychapter.html#modifyvar"><i class="fa fa-check"></i><b>5.7.2</b> Modifying a variable</a></li>
<li class="chapter" data-level="5.7.3" data-path="messychapter.html"><a href="messychapter.html#computing-a-new-variable-based-on-existing-variables"><i class="fa fa-check"></i><b>5.7.3</b> Computing a new variable based on existing variables</a></li>
<li class="chapter" data-level="5.7.4" data-path="messychapter.html"><a href="messychapter.html#renaming-a-variable"><i class="fa fa-check"></i><b>5.7.4</b> Renaming a variable</a></li>
<li class="chapter" data-level="5.7.5" data-path="messychapter.html"><a href="messychapter.html#removing-a-variable"><i class="fa fa-check"></i><b>5.7.5</b> Removing a variable</a></li>
<li class="chapter" data-level="5.7.6" data-path="messychapter.html"><a href="messychapter.html#recodedplyr"><i class="fa fa-check"></i><b>5.7.6</b> Recoding <code>factor</code> levels</a></li>
<li class="chapter" data-level="5.7.7" data-path="messychapter.html"><a href="messychapter.html#grouped2"><i class="fa fa-check"></i><b>5.7.7</b> Grouped summaries</a></li>
<li class="chapter" data-level="5.7.8" data-path="messychapter.html"><a href="messychapter.html#fillNA"><i class="fa fa-check"></i><b>5.7.8</b> Filling in missing values</a></li>
<li class="chapter" data-level="5.7.9" data-path="messychapter.html"><a href="messychapter.html#chaining-commands-together"><i class="fa fa-check"></i><b>5.7.9</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="messychapter.html"><a href="messychapter.html#filtering"><i class="fa fa-check"></i><b>5.8</b> Filtering: select rows</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="messychapter.html"><a href="messychapter.html#filtering-using-row-numbers"><i class="fa fa-check"></i><b>5.8.1</b> Filtering using row numbers</a></li>
<li class="chapter" data-level="5.8.2" data-path="messychapter.html"><a href="messychapter.html#conditions2"><i class="fa fa-check"></i><b>5.8.2</b> Filtering using conditions</a></li>
<li class="chapter" data-level="5.8.3" data-path="messychapter.html"><a href="messychapter.html#selecting-rows-at-random"><i class="fa fa-check"></i><b>5.8.3</b> Selecting rows at random</a></li>
<li class="chapter" data-level="5.8.4" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-rows"><i class="fa fa-check"></i><b>5.8.4</b> Using regular expressions to select rows</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="messychapter.html"><a href="messychapter.html#subsetting-select-columns"><i class="fa fa-check"></i><b>5.9</b> Subsetting: select columns</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="messychapter.html"><a href="messychapter.html#selecting-a-single-column"><i class="fa fa-check"></i><b>5.9.1</b> Selecting a single column</a></li>
<li class="chapter" data-level="5.9.2" data-path="messychapter.html"><a href="messychapter.html#selecting-multiple-columns"><i class="fa fa-check"></i><b>5.9.2</b> Selecting multiple columns</a></li>
<li class="chapter" data-level="5.9.3" data-path="messychapter.html"><a href="messychapter.html#using-regular-expressions-to-select-columns"><i class="fa fa-check"></i><b>5.9.3</b> Using regular expressions to select columns</a></li>
<li class="chapter" data-level="5.9.4" data-path="messychapter.html"><a href="messychapter.html#subsetusingcn"><i class="fa fa-check"></i><b>5.9.4</b> Subsetting using column numbers</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="messychapter.html"><a href="messychapter.html#sorting"><i class="fa fa-check"></i><b>5.10</b> Sorting</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="messychapter.html"><a href="messychapter.html#changing-the-column-order"><i class="fa fa-check"></i><b>5.10.1</b> Changing the column order</a></li>
<li class="chapter" data-level="5.10.2" data-path="messychapter.html"><a href="messychapter.html#changing-the-row-order"><i class="fa fa-check"></i><b>5.10.2</b> Changing the row order</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="messychapter.html"><a href="messychapter.html#reshaping"><i class="fa fa-check"></i><b>5.11</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="messychapter.html"><a href="messychapter.html#from-long-to-wide"><i class="fa fa-check"></i><b>5.11.1</b> From long to wide</a></li>
<li class="chapter" data-level="5.11.2" data-path="messychapter.html"><a href="messychapter.html#from-wide-to-long"><i class="fa fa-check"></i><b>5.11.2</b> From wide to long</a></li>
<li class="chapter" data-level="5.11.3" data-path="messychapter.html"><a href="messychapter.html#splittingcolumns"><i class="fa fa-check"></i><b>5.11.3</b> Splitting columns</a></li>
<li class="chapter" data-level="5.11.4" data-path="messychapter.html"><a href="messychapter.html#merging-columns"><i class="fa fa-check"></i><b>5.11.4</b> Merging columns</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="messychapter.html"><a href="messychapter.html#mergedata"><i class="fa fa-check"></i><b>5.12</b> Merging data from multiple tables</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="messychapter.html"><a href="messychapter.html#binds"><i class="fa fa-check"></i><b>5.12.1</b> Binds</a></li>
<li class="chapter" data-level="5.12.2" data-path="messychapter.html"><a href="messychapter.html#merging-tables-using-keys"><i class="fa fa-check"></i><b>5.12.2</b> Merging tables using keys</a></li>
<li class="chapter" data-level="5.12.3" data-path="messychapter.html"><a href="messychapter.html#inner-and-outer-joins"><i class="fa fa-check"></i><b>5.12.3</b> Inner and outer joins</a></li>
<li class="chapter" data-level="5.12.4" data-path="messychapter.html"><a href="messychapter.html#semijoins"><i class="fa fa-check"></i><b>5.12.4</b> Semijoins and antijoins</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="messychapter.html"><a href="messychapter.html#scraping-data-from-websites"><i class="fa fa-check"></i><b>5.13</b> Scraping data from websites</a></li>
<li class="chapter" data-level="5.14" data-path="messychapter.html"><a href="messychapter.html#commontasks"><i class="fa fa-check"></i><b>5.14</b> Other commons tasks</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="messychapter.html"><a href="messychapter.html#deleting-variables"><i class="fa fa-check"></i><b>5.14.1</b> Deleting variables</a></li>
<li class="chapter" data-level="5.14.2" data-path="messychapter.html"><a href="messychapter.html#foreign"><i class="fa fa-check"></i><b>5.14.2</b> Importing data from other statistical packages</a></li>
<li class="chapter" data-level="5.14.3" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-databases"><i class="fa fa-check"></i><b>5.14.3</b> Importing data from databases</a></li>
<li class="chapter" data-level="5.14.4" data-path="messychapter.html"><a href="messychapter.html#importing-data-from-json-files"><i class="fa fa-check"></i><b>5.14.4</b> Importing data from JSON files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="progchapter.html"><a href="progchapter.html"><i class="fa fa-check"></i><b>6</b> R programming</a>
<ul>
<li class="chapter" data-level="6.1" data-path="progchapter.html"><a href="progchapter.html#functions-1"><i class="fa fa-check"></i><b>6.1</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="progchapter.html"><a href="progchapter.html#createfunctions"><i class="fa fa-check"></i><b>6.1.1</b> Creating functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="progchapter.html"><a href="progchapter.html#local-and-global-variables"><i class="fa fa-check"></i><b>6.1.2</b> Local and global variables</a></li>
<li class="chapter" data-level="6.1.3" data-path="progchapter.html"><a href="progchapter.html#willfunctionwork"><i class="fa fa-check"></i><b>6.1.3</b> Will your function work?</a></li>
<li class="chapter" data-level="6.1.4" data-path="progchapter.html"><a href="progchapter.html#more-on-arguments"><i class="fa fa-check"></i><b>6.1.4</b> More on arguments</a></li>
<li class="chapter" data-level="6.1.5" data-path="progchapter.html"><a href="progchapter.html#namespaces"><i class="fa fa-check"></i><b>6.1.5</b> Namespaces</a></li>
<li class="chapter" data-level="6.1.6" data-path="progchapter.html"><a href="progchapter.html#sourcing-other-scripts"><i class="fa fa-check"></i><b>6.1.6</b> Sourcing other scripts</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="progchapter.html"><a href="progchapter.html#morepipes"><i class="fa fa-check"></i><b>6.2</b> More on pipes</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="progchapter.html"><a href="progchapter.html#ce-ne-sont-pas-non-plus-des-pipes"><i class="fa fa-check"></i><b>6.2.1</b> <em>Ce ne sont pas non plus des pipes</em></a></li>
<li class="chapter" data-level="6.2.2" data-path="progchapter.html"><a href="progchapter.html#writing-functions-with-pipes"><i class="fa fa-check"></i><b>6.2.2</b> Writing functions with pipes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="progchapter.html"><a href="progchapter.html#conditions"><i class="fa fa-check"></i><b>6.3</b> Checking conditions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="progchapter.html"><a href="progchapter.html#if-and-else"><i class="fa fa-check"></i><b>6.3.1</b> <code>if</code> and <code>else</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="progchapter.html"><a href="progchapter.html#section"><i class="fa fa-check"></i><b>6.3.2</b> <code>&amp;</code> &amp; <code>&amp;&amp;</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="progchapter.html"><a href="progchapter.html#ifelse"><i class="fa fa-check"></i><b>6.3.3</b> <code>ifelse</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="progchapter.html"><a href="progchapter.html#switch"><i class="fa fa-check"></i><b>6.3.4</b> <code>switch</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="progchapter.html"><a href="progchapter.html#failing-gracefully"><i class="fa fa-check"></i><b>6.3.5</b> Failing gracefully</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="progchapter.html"><a href="progchapter.html#loopsection"><i class="fa fa-check"></i><b>6.4</b> Iteration using loops</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="progchapter.html"><a href="progchapter.html#forloops"><i class="fa fa-check"></i><b>6.4.1</b> <code>for</code> loops</a></li>
<li class="chapter" data-level="6.4.2" data-path="progchapter.html"><a href="progchapter.html#nestedloops"><i class="fa fa-check"></i><b>6.4.2</b> Loops within loops</a></li>
<li class="chapter" data-level="6.4.3" data-path="progchapter.html"><a href="progchapter.html#beepr"><i class="fa fa-check"></i><b>6.4.3</b> Keeping track of what’s happening</a></li>
<li class="chapter" data-level="6.4.4" data-path="progchapter.html"><a href="progchapter.html#lists"><i class="fa fa-check"></i><b>6.4.4</b> Loops and lists</a></li>
<li class="chapter" data-level="6.4.5" data-path="progchapter.html"><a href="progchapter.html#whileloop"><i class="fa fa-check"></i><b>6.4.5</b> <code>while</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="progchapter.html"><a href="progchapter.html#vectorloops"><i class="fa fa-check"></i><b>6.5</b> Iteration using vectorisation and functionals</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="progchapter.html"><a href="progchapter.html#a-first-example-with-apply"><i class="fa fa-check"></i><b>6.5.1</b> A first example with <code>apply</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="progchapter.html"><a href="progchapter.html#variations-on-a-theme"><i class="fa fa-check"></i><b>6.5.2</b> Variations on a theme</a></li>
<li class="chapter" data-level="6.5.3" data-path="progchapter.html"><a href="progchapter.html#purrr"><i class="fa fa-check"></i><b>6.5.3</b> <code>purrr</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="progchapter.html"><a href="progchapter.html#specialised-functions"><i class="fa fa-check"></i><b>6.5.4</b> Specialised functions</a></li>
<li class="chapter" data-level="6.5.5" data-path="progchapter.html"><a href="progchapter.html#exploring-data-with-functionals"><i class="fa fa-check"></i><b>6.5.5</b> Exploring data with functionals</a></li>
<li class="chapter" data-level="6.5.6" data-path="progchapter.html"><a href="progchapter.html#keep-calm-and-carry-on"><i class="fa fa-check"></i><b>6.5.6</b> Keep calm and carry on</a></li>
<li class="chapter" data-level="6.5.7" data-path="progchapter.html"><a href="progchapter.html#multiiter"><i class="fa fa-check"></i><b>6.5.7</b> Iterating over multiple variables</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="progchapter.html"><a href="progchapter.html#measureperformance"><i class="fa fa-check"></i><b>6.6</b> Measuring code performance</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="progchapter.html"><a href="progchapter.html#timing-functions"><i class="fa fa-check"></i><b>6.6.1</b> Timing functions</a></li>
<li class="chapter" data-level="6.6.2" data-path="progchapter.html"><a href="progchapter.html#measuring-memory-usage---and-a-note-on-compilation"><i class="fa fa-check"></i><b>6.6.2</b> Measuring memory usage - and a note on compilation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modchapter.html"><a href="modchapter.html"><i class="fa fa-check"></i><b>7</b> Modern classical statistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="modchapter.html"><a href="modchapter.html#simulation"><i class="fa fa-check"></i><b>7.1</b> Simulation and distributions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="modchapter.html"><a href="modchapter.html#generating-random-numbers"><i class="fa fa-check"></i><b>7.1.1</b> Generating random numbers</a></li>
<li class="chapter" data-level="7.1.2" data-path="modchapter.html"><a href="modchapter.html#distfunctions"><i class="fa fa-check"></i><b>7.1.2</b> Some common distributions</a></li>
<li class="chapter" data-level="7.1.3" data-path="modchapter.html"><a href="modchapter.html#assessing-distributional-assumptions"><i class="fa fa-check"></i><b>7.1.3</b> Assessing distributional assumptions</a></li>
<li class="chapter" data-level="7.1.4" data-path="modchapter.html"><a href="modchapter.html#monte-carlo-integration"><i class="fa fa-check"></i><b>7.1.4</b> Monte Carlo integration</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="modchapter.html"><a href="modchapter.html#ttest"><i class="fa fa-check"></i><b>7.2</b> Student’s t-test revisited</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="modchapter.html"><a href="modchapter.html#oldschoolt"><i class="fa fa-check"></i><b>7.2.1</b> The old-school t-test</a></li>
<li class="chapter" data-level="7.2.2" data-path="modchapter.html"><a href="modchapter.html#permutation-tests"><i class="fa fa-check"></i><b>7.2.2</b> Permutation tests</a></li>
<li class="chapter" data-level="7.2.3" data-path="modchapter.html"><a href="modchapter.html#the-bootstrap"><i class="fa fa-check"></i><b>7.2.3</b> The bootstrap</a></li>
<li class="chapter" data-level="7.2.4" data-path="modchapter.html"><a href="modchapter.html#saving-the-output"><i class="fa fa-check"></i><b>7.2.4</b> Saving the output</a></li>
<li class="chapter" data-level="7.2.5" data-path="modchapter.html"><a href="modchapter.html#multipletesting"><i class="fa fa-check"></i><b>7.2.5</b> Multiple testing</a></li>
<li class="chapter" data-level="7.2.6" data-path="modchapter.html"><a href="modchapter.html#hotellingst2"><i class="fa fa-check"></i><b>7.2.6</b> Multivariate testing with Hotelling’s <span class="math inline">\(T^2\)</span></a></li>
<li class="chapter" data-level="7.2.7" data-path="modchapter.html"><a href="modchapter.html#sample-size-computations-for-the-t-test"><i class="fa fa-check"></i><b>7.2.7</b> Sample size computations for the t-test</a></li>
<li class="chapter" data-level="7.2.8" data-path="modchapter.html"><a href="modchapter.html#a-bayesian-approach"><i class="fa fa-check"></i><b>7.2.8</b> A Bayesian approach</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="modchapter.html"><a href="modchapter.html#other-common-hypothesis-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>7.3</b> Other common hypothesis tests and confidence intervals</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="modchapter.html"><a href="modchapter.html#nonparametric-tests-of-location"><i class="fa fa-check"></i><b>7.3.1</b> Nonparametric tests of location</a></li>
<li class="chapter" data-level="7.3.2" data-path="modchapter.html"><a href="modchapter.html#tests-for-correlation"><i class="fa fa-check"></i><b>7.3.2</b> Tests for correlation</a></li>
<li class="chapter" data-level="7.3.3" data-path="modchapter.html"><a href="modchapter.html#chi2-tests"><i class="fa fa-check"></i><b>7.3.3</b> <span class="math inline">\(\chi^2\)</span>-tests</a></li>
<li class="chapter" data-level="7.3.4" data-path="modchapter.html"><a href="modchapter.html#confprop"><i class="fa fa-check"></i><b>7.3.4</b> Confidence intervals for proportions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="modchapter.html"><a href="modchapter.html#ethicsinference"><i class="fa fa-check"></i><b>7.4</b> Ethical issues in statistical inference</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="modchapter.html"><a href="modchapter.html#p-hacking-and-the-file-drawer-problem"><i class="fa fa-check"></i><b>7.4.1</b> p-hacking and the file-drawer problem</a></li>
<li class="chapter" data-level="7.4.2" data-path="modchapter.html"><a href="modchapter.html#reproducibility"><i class="fa fa-check"></i><b>7.4.2</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="modchapter.html"><a href="modchapter.html#simeval"><i class="fa fa-check"></i><b>7.5</b> Evaluating statistical methods using simulation</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="modchapter.html"><a href="modchapter.html#comparing-estimators"><i class="fa fa-check"></i><b>7.5.1</b> Comparing estimators</a></li>
<li class="chapter" data-level="7.5.2" data-path="modchapter.html"><a href="modchapter.html#simtypeI"><i class="fa fa-check"></i><b>7.5.2</b> Type I error rate of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.3" data-path="modchapter.html"><a href="modchapter.html#simpower"><i class="fa fa-check"></i><b>7.5.3</b> Power of hypothesis tests</a></li>
<li class="chapter" data-level="7.5.4" data-path="modchapter.html"><a href="modchapter.html#powerlocation"><i class="fa fa-check"></i><b>7.5.4</b> Power of some tests of location</a></li>
<li class="chapter" data-level="7.5.5" data-path="modchapter.html"><a href="modchapter.html#simadvice"><i class="fa fa-check"></i><b>7.5.5</b> Some advice on simulation studies</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="modchapter.html"><a href="modchapter.html#sscus"><i class="fa fa-check"></i><b>7.6</b> Sample size computations using simulation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="modchapter.html"><a href="modchapter.html#simcorpower"><i class="fa fa-check"></i><b>7.6.1</b> Writing your own simulation</a></li>
<li class="chapter" data-level="7.6.2" data-path="modchapter.html"><a href="modchapter.html#the-wilcoxon-mann-whitney-test"><i class="fa fa-check"></i><b>7.6.2</b> The Wilcoxon-Mann-Whitney test</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="modchapter.html"><a href="modchapter.html#bootstrap"><i class="fa fa-check"></i><b>7.7</b> Bootstrapping</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="modchapter.html"><a href="modchapter.html#a-general-approach"><i class="fa fa-check"></i><b>7.7.1</b> A general approach</a></li>
<li class="chapter" data-level="7.7.2" data-path="modchapter.html"><a href="modchapter.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>7.7.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="7.7.3" data-path="modchapter.html"><a href="modchapter.html#intervalinversion"><i class="fa fa-check"></i><b>7.7.3</b> Bootstrap hypothesis tests</a></li>
<li class="chapter" data-level="7.7.4" data-path="modchapter.html"><a href="modchapter.html#parametricbootstrap"><i class="fa fa-check"></i><b>7.7.4</b> The parametric bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="modchapter.html"><a href="modchapter.html#reporting-statistical-results"><i class="fa fa-check"></i><b>7.8</b> Reporting statistical results</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="modchapter.html"><a href="modchapter.html#what-should-you-include"><i class="fa fa-check"></i><b>7.8.1</b> What should you include?</a></li>
<li class="chapter" data-level="7.8.2" data-path="modchapter.html"><a href="modchapter.html#citing-r-packages"><i class="fa fa-check"></i><b>7.8.2</b> Citing R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>8</b> Regression models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression.html"><a href="regression.html#linearmodels"><i class="fa fa-check"></i><b>8.1</b> Linear models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression.html"><a href="regression.html#fitting-linear-models"><i class="fa fa-check"></i><b>8.1.1</b> Fitting linear models</a></li>
<li class="chapter" data-level="8.1.2" data-path="regression.html"><a href="regression.html#interactions-and-polynomial-terms"><i class="fa fa-check"></i><b>8.1.2</b> Interactions and polynomial terms</a></li>
<li class="chapter" data-level="8.1.3" data-path="regression.html"><a href="regression.html#dummy-variables"><i class="fa fa-check"></i><b>8.1.3</b> Dummy variables</a></li>
<li class="chapter" data-level="8.1.4" data-path="regression.html"><a href="regression.html#model-diagnostics"><i class="fa fa-check"></i><b>8.1.4</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.1.5" data-path="regression.html"><a href="regression.html#transformations"><i class="fa fa-check"></i><b>8.1.5</b> Transformations</a></li>
<li class="chapter" data-level="8.1.6" data-path="regression.html"><a href="regression.html#alternatives-to-lm"><i class="fa fa-check"></i><b>8.1.6</b> Alternatives to <code>lm</code></a></li>
<li class="chapter" data-level="8.1.7" data-path="regression.html"><a href="regression.html#regbootstrap"><i class="fa fa-check"></i><b>8.1.7</b> Bootstrap confidence intervals for regression coefficients</a></li>
<li class="chapter" data-level="8.1.8" data-path="regression.html"><a href="regression.html#broom"><i class="fa fa-check"></i><b>8.1.8</b> Alternative summaries with <code>broom</code></a></li>
<li class="chapter" data-level="8.1.9" data-path="regression.html"><a href="regression.html#stepwise"><i class="fa fa-check"></i><b>8.1.9</b> Variable selection</a></li>
<li class="chapter" data-level="8.1.10" data-path="regression.html"><a href="regression.html#prediction"><i class="fa fa-check"></i><b>8.1.10</b> Prediction</a></li>
<li class="chapter" data-level="8.1.11" data-path="regression.html"><a href="regression.html#multipredict"><i class="fa fa-check"></i><b>8.1.11</b> Prediction for multiple datasets</a></li>
<li class="chapter" data-level="8.1.12" data-path="regression.html"><a href="regression.html#ANOVA"><i class="fa fa-check"></i><b>8.1.12</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.13" data-path="regression.html"><a href="regression.html#bayeslm"><i class="fa fa-check"></i><b>8.1.13</b> Bayesian estimation of linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression.html"><a href="regression.html#ethical-issues-in-regression-modelling"><i class="fa fa-check"></i><b>8.2</b> Ethical issues in regression modelling</a></li>
<li class="chapter" data-level="8.3" data-path="regression.html"><a href="regression.html#generalised-linear-models"><i class="fa fa-check"></i><b>8.3</b> Generalised linear models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression.html"><a href="regression.html#logreg"><i class="fa fa-check"></i><b>8.3.1</b> Modelling proportions: Logistic regression</a></li>
<li class="chapter" data-level="8.3.2" data-path="regression.html"><a href="regression.html#bootstrap-confidence-intervals-1"><i class="fa fa-check"></i><b>8.3.2</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="8.3.3" data-path="regression.html"><a href="regression.html#model-diagnostics-1"><i class="fa fa-check"></i><b>8.3.3</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.3.4" data-path="regression.html"><a href="regression.html#prediction-1"><i class="fa fa-check"></i><b>8.3.4</b> Prediction</a></li>
<li class="chapter" data-level="8.3.5" data-path="regression.html"><a href="regression.html#modelling-count-data"><i class="fa fa-check"></i><b>8.3.5</b> Modelling count data</a></li>
<li class="chapter" data-level="8.3.6" data-path="regression.html"><a href="regression.html#modelling-rates"><i class="fa fa-check"></i><b>8.3.6</b> Modelling rates</a></li>
<li class="chapter" data-level="8.3.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-generalised-linear-models"><i class="fa fa-check"></i><b>8.3.7</b> Bayesian estimation of generalised linear models</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression.html"><a href="regression.html#mixedmodels"><i class="fa fa-check"></i><b>8.4</b> Mixed models</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="regression.html"><a href="regression.html#fitting-a-linear-mixed-model"><i class="fa fa-check"></i><b>8.4.1</b> Fitting a linear mixed model</a></li>
<li class="chapter" data-level="8.4.2" data-path="regression.html"><a href="regression.html#model-diagnostics-2"><i class="fa fa-check"></i><b>8.4.2</b> Model diagnostics</a></li>
<li class="chapter" data-level="8.4.3" data-path="regression.html"><a href="regression.html#lmmbootstrap"><i class="fa fa-check"></i><b>8.4.3</b> Bootstrapping</a></li>
<li class="chapter" data-level="8.4.4" data-path="regression.html"><a href="regression.html#nested-random-effects-and-multilevelhierarchical-models"><i class="fa fa-check"></i><b>8.4.4</b> Nested random effects and multilevel/hierarchical models</a></li>
<li class="chapter" data-level="8.4.5" data-path="regression.html"><a href="regression.html#anova-with-random-effects"><i class="fa fa-check"></i><b>8.4.5</b> ANOVA with random effects</a></li>
<li class="chapter" data-level="8.4.6" data-path="regression.html"><a href="regression.html#generalised-linear-mixed-models"><i class="fa fa-check"></i><b>8.4.6</b> Generalised linear mixed models</a></li>
<li class="chapter" data-level="8.4.7" data-path="regression.html"><a href="regression.html#bayesian-estimation-of-mixed-models"><i class="fa fa-check"></i><b>8.4.7</b> Bayesian estimation of mixed models</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regression.html"><a href="regression.html#survival"><i class="fa fa-check"></i><b>8.5</b> Survival analysis</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="regression.html"><a href="regression.html#comparing-groups"><i class="fa fa-check"></i><b>8.5.1</b> Comparing groups</a></li>
<li class="chapter" data-level="8.5.2" data-path="regression.html"><a href="regression.html#the-cox-proportional-hazards-model"><i class="fa fa-check"></i><b>8.5.2</b> The Cox proportional hazards model</a></li>
<li class="chapter" data-level="8.5.3" data-path="regression.html"><a href="regression.html#accelerated-failure-time-models"><i class="fa fa-check"></i><b>8.5.3</b> Accelerated failure time models</a></li>
<li class="chapter" data-level="8.5.4" data-path="regression.html"><a href="regression.html#bayesian-survival-analysis"><i class="fa fa-check"></i><b>8.5.4</b> Bayesian survival analysis</a></li>
<li class="chapter" data-level="8.5.5" data-path="regression.html"><a href="regression.html#multivariate-survival-analysis"><i class="fa fa-check"></i><b>8.5.5</b> Multivariate survival analysis</a></li>
<li class="chapter" data-level="8.5.6" data-path="regression.html"><a href="regression.html#power-estimates-for-the-logrank-test"><i class="fa fa-check"></i><b>8.5.6</b> Power estimates for the logrank test</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="regression.html"><a href="regression.html#left-censored-data-and-nondetects"><i class="fa fa-check"></i><b>8.6</b> Left-censored data and nondetects</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="regression.html"><a href="regression.html#estimation"><i class="fa fa-check"></i><b>8.6.1</b> Estimation</a></li>
<li class="chapter" data-level="8.6.2" data-path="regression.html"><a href="regression.html#tests-of-means"><i class="fa fa-check"></i><b>8.6.2</b> Tests of means</a></li>
<li class="chapter" data-level="8.6.3" data-path="regression.html"><a href="regression.html#censored-regression"><i class="fa fa-check"></i><b>8.6.3</b> Censored regression</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="regression.html"><a href="regression.html#creating-matched-samples"><i class="fa fa-check"></i><b>8.7</b> Creating matched samples</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="regression.html"><a href="regression.html#propensity-score-matching"><i class="fa fa-check"></i><b>8.7.1</b> Propensity score matching</a></li>
<li class="chapter" data-level="8.7.2" data-path="regression.html"><a href="regression.html#stepwise-matching"><i class="fa fa-check"></i><b>8.7.2</b> Stepwise matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mlchapter.html"><a href="mlchapter.html"><i class="fa fa-check"></i><b>9</b> Predictive modelling and machine learning</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-predictive-models"><i class="fa fa-check"></i><b>9.1</b> Evaluating predictive models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="mlchapter.html"><a href="mlchapter.html#evaluating-regression-models"><i class="fa fa-check"></i><b>9.1.1</b> Evaluating regression models</a></li>
<li class="chapter" data-level="9.1.2" data-path="mlchapter.html"><a href="mlchapter.html#test-training-splits"><i class="fa fa-check"></i><b>9.1.2</b> Test-training splits</a></li>
<li class="chapter" data-level="9.1.3" data-path="mlchapter.html"><a href="mlchapter.html#loocv"><i class="fa fa-check"></i><b>9.1.3</b> Leave-one-out cross-validation and <code>caret</code></a></li>
<li class="chapter" data-level="9.1.4" data-path="mlchapter.html"><a href="mlchapter.html#kfoldcv"><i class="fa fa-check"></i><b>9.1.4</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="9.1.5" data-path="mlchapter.html"><a href="mlchapter.html#twinned-observations"><i class="fa fa-check"></i><b>9.1.5</b> Twinned observations</a></li>
<li class="chapter" data-level="9.1.6" data-path="mlchapter.html"><a href="mlchapter.html#bootstrapping"><i class="fa fa-check"></i><b>9.1.6</b> Bootstrapping</a></li>
<li class="chapter" data-level="9.1.7" data-path="mlchapter.html"><a href="mlchapter.html#classifieraccuracy"><i class="fa fa-check"></i><b>9.1.7</b> Evaluating classification models</a></li>
<li class="chapter" data-level="9.1.8" data-path="mlchapter.html"><a href="mlchapter.html#decisionboundaries"><i class="fa fa-check"></i><b>9.1.8</b> Visualising decision boundaries</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="mlchapter.html"><a href="mlchapter.html#ethical-issues-in-predictive-modelling"><i class="fa fa-check"></i><b>9.2</b> Ethical issues in predictive modelling</a></li>
<li class="chapter" data-level="9.3" data-path="mlchapter.html"><a href="mlchapter.html#modellingchallenges"><i class="fa fa-check"></i><b>9.3</b> Challenges in predictive modelling</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mlchapter.html"><a href="mlchapter.html#imbalanced"><i class="fa fa-check"></i><b>9.3.1</b> Handling class imbalance</a></li>
<li class="chapter" data-level="9.3.2" data-path="mlchapter.html"><a href="mlchapter.html#varimportance"><i class="fa fa-check"></i><b>9.3.2</b> Assessing variable importance</a></li>
<li class="chapter" data-level="9.3.3" data-path="mlchapter.html"><a href="mlchapter.html#extrapolation"><i class="fa fa-check"></i><b>9.3.3</b> Extrapolation</a></li>
<li class="chapter" data-level="9.3.4" data-path="mlchapter.html"><a href="mlchapter.html#missing-data-and-imputation"><i class="fa fa-check"></i><b>9.3.4</b> Missing data and imputation</a></li>
<li class="chapter" data-level="9.3.5" data-path="mlchapter.html"><a href="mlchapter.html#endless-waiting"><i class="fa fa-check"></i><b>9.3.5</b> Endless waiting</a></li>
<li class="chapter" data-level="9.3.6" data-path="mlchapter.html"><a href="mlchapter.html#overfittingtestset"><i class="fa fa-check"></i><b>9.3.6</b> Overfitting to the test set</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mlchapter.html"><a href="mlchapter.html#regularised"><i class="fa fa-check"></i><b>9.4</b> Regularised regression models</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="mlchapter.html"><a href="mlchapter.html#ridge-regression"><i class="fa fa-check"></i><b>9.4.1</b> Ridge regression</a></li>
<li class="chapter" data-level="9.4.2" data-path="mlchapter.html"><a href="mlchapter.html#lasso"><i class="fa fa-check"></i><b>9.4.2</b> The lasso</a></li>
<li class="chapter" data-level="9.4.3" data-path="mlchapter.html"><a href="mlchapter.html#elastic-net"><i class="fa fa-check"></i><b>9.4.3</b> Elastic net</a></li>
<li class="chapter" data-level="9.4.4" data-path="mlchapter.html"><a href="mlchapter.html#choosing-the-best-model"><i class="fa fa-check"></i><b>9.4.4</b> Choosing the best model</a></li>
<li class="chapter" data-level="9.4.5" data-path="mlchapter.html"><a href="mlchapter.html#regularised-mixed-models"><i class="fa fa-check"></i><b>9.4.5</b> Regularised mixed models</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="mlchapter.html"><a href="mlchapter.html#mlmethods"><i class="fa fa-check"></i><b>9.5</b> Machine learning models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mlchapter.html"><a href="mlchapter.html#decisiontrees"><i class="fa fa-check"></i><b>9.5.1</b> Decision trees</a></li>
<li class="chapter" data-level="9.5.2" data-path="mlchapter.html"><a href="mlchapter.html#randomforests"><i class="fa fa-check"></i><b>9.5.2</b> Random forests</a></li>
<li class="chapter" data-level="9.5.3" data-path="mlchapter.html"><a href="mlchapter.html#boosted-trees"><i class="fa fa-check"></i><b>9.5.3</b> Boosted trees</a></li>
<li class="chapter" data-level="9.5.4" data-path="mlchapter.html"><a href="mlchapter.html#model-trees"><i class="fa fa-check"></i><b>9.5.4</b> Model trees</a></li>
<li class="chapter" data-level="9.5.5" data-path="mlchapter.html"><a href="mlchapter.html#discriminant-analysis"><i class="fa fa-check"></i><b>9.5.5</b> Discriminant analysis</a></li>
<li class="chapter" data-level="9.5.6" data-path="mlchapter.html"><a href="mlchapter.html#support-vector-machines"><i class="fa fa-check"></i><b>9.5.6</b> Support vector machines</a></li>
<li class="chapter" data-level="9.5.7" data-path="mlchapter.html"><a href="mlchapter.html#nearest-neighbours-classifiers"><i class="fa fa-check"></i><b>9.5.7</b> Nearest neighbours classifiers</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="mlchapter.html"><a href="mlchapter.html#tsforecast"><i class="fa fa-check"></i><b>9.6</b> Forecasting time series</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="mlchapter.html"><a href="mlchapter.html#decomposition"><i class="fa fa-check"></i><b>9.6.1</b> Decomposition</a></li>
<li class="chapter" data-level="9.6.2" data-path="mlchapter.html"><a href="mlchapter.html#forecasting-using-arima-models"><i class="fa fa-check"></i><b>9.6.2</b> Forecasting using ARIMA models</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="mlchapter.html"><a href="mlchapter.html#deploying-models"><i class="fa fa-check"></i><b>9.7</b> Deploying models</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="mlchapter.html"><a href="mlchapter.html#creating-apis-with-plumber"><i class="fa fa-check"></i><b>9.7.1</b> Creating APIs with <code>plumber</code></a></li>
<li class="chapter" data-level="9.7.2" data-path="mlchapter.html"><a href="mlchapter.html#different-types-of-output"><i class="fa fa-check"></i><b>9.7.2</b> Different types of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="advancedchapter.html"><a href="advancedchapter.html"><i class="fa fa-check"></i><b>10</b> Advanced topics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="advancedchapter.html"><a href="advancedchapter.html#moreonpackages"><i class="fa fa-check"></i><b>10.1</b> More on packages</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="advancedchapter.html"><a href="advancedchapter.html#loading-and-auto-installing-packages"><i class="fa fa-check"></i><b>10.1.1</b> Loading and auto-installing packages</a></li>
<li class="chapter" data-level="10.1.2" data-path="advancedchapter.html"><a href="advancedchapter.html#updating-r-and-your-packages"><i class="fa fa-check"></i><b>10.1.2</b> Updating R and your packages</a></li>
<li class="chapter" data-level="10.1.3" data-path="advancedchapter.html"><a href="advancedchapter.html#alternative-repositories"><i class="fa fa-check"></i><b>10.1.3</b> Alternative repositories</a></li>
<li class="chapter" data-level="10.1.4" data-path="advancedchapter.html"><a href="advancedchapter.html#removing-packages"><i class="fa fa-check"></i><b>10.1.4</b> Removing packages</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallel"><i class="fa fa-check"></i><b>10.2</b> Speeding up computations with parallelisation</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-for-loops"><i class="fa fa-check"></i><b>10.2.1</b> Parallelising <code>for</code> loops</a></li>
<li class="chapter" data-level="10.2.2" data-path="advancedchapter.html"><a href="advancedchapter.html#parallelising-functionals"><i class="fa fa-check"></i><b>10.2.2</b> Parallelising functionals</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="advancedchapter.html"><a href="advancedchapter.html#linearalgebra"><i class="fa fa-check"></i><b>10.3</b> Linear algebra and matrices</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="advancedchapter.html"><a href="advancedchapter.html#creating-matrices"><i class="fa fa-check"></i><b>10.3.1</b> Creating matrices</a></li>
<li class="chapter" data-level="10.3.2" data-path="advancedchapter.html"><a href="advancedchapter.html#sparse-matrices"><i class="fa fa-check"></i><b>10.3.2</b> Sparse matrices</a></li>
<li class="chapter" data-level="10.3.3" data-path="advancedchapter.html"><a href="advancedchapter.html#matrix-operations"><i class="fa fa-check"></i><b>10.3.3</b> Matrix operations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration"><i class="fa fa-check"></i><b>10.4</b> Integration with other programming languages</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-c"><i class="fa fa-check"></i><b>10.4.1</b> Integration with C++</a></li>
<li class="chapter" data-level="10.4.2" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-python"><i class="fa fa-check"></i><b>10.4.2</b> Integration with Python</a></li>
<li class="chapter" data-level="10.4.3" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-tensorflow-and-pytorch"><i class="fa fa-check"></i><b>10.4.3</b> Integration with Tensorflow and PyTorch</a></li>
<li class="chapter" data-level="10.4.4" data-path="advancedchapter.html"><a href="advancedchapter.html#integration-with-spark"><i class="fa fa-check"></i><b>10.4.4</b> Integration with Spark</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="errorchapter.html"><a href="errorchapter.html"><i class="fa fa-check"></i><b>11</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1" data-path="errorchapter.html"><a href="errorchapter.html#debugging"><i class="fa fa-check"></i><b>11.1</b> Debugging</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="errorchapter.html"><a href="errorchapter.html#find-out-where-the-error-occured-with-traceback"><i class="fa fa-check"></i><b>11.1.1</b> Find out where the error occured with <code>traceback</code></a></li>
<li class="chapter" data-level="11.1.2" data-path="errorchapter.html"><a href="errorchapter.html#interactive-debugging-of-functions-with-debug"><i class="fa fa-check"></i><b>11.1.2</b> Interactive debugging of functions with <code>debug</code></a></li>
<li class="chapter" data-level="11.1.3" data-path="errorchapter.html"><a href="errorchapter.html#investigate-the-environment-with-recover"><i class="fa fa-check"></i><b>11.1.3</b> Investigate the environment with <code>recover</code></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="errorchapter.html"><a href="errorchapter.html#commonerrors"><i class="fa fa-check"></i><b>11.2</b> Common error messages</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="errorchapter.html"><a href="errorchapter.html#section-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>+</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="errorchapter.html"><a href="errorchapter.html#could-not-find-function"><i class="fa fa-check"></i><b>11.2.2</b> <code>could not find function</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="errorchapter.html"><a href="errorchapter.html#object-not-found"><i class="fa fa-check"></i><b>11.2.3</b> <code>object not found</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="errorchapter.html"><a href="errorchapter.html#cannot-open-the-connection-and-no-such-file-or-directory"><i class="fa fa-check"></i><b>11.2.4</b> <code>cannot open the connection</code> and <code>No such file or directory</code></a></li>
<li class="chapter" data-level="11.2.5" data-path="errorchapter.html"><a href="errorchapter.html#invalid-description-argument"><i class="fa fa-check"></i><b>11.2.5</b> <code>invalid 'description' argument</code></a></li>
<li class="chapter" data-level="11.2.6" data-path="errorchapter.html"><a href="errorchapter.html#missing-value-where-truefalse-needed"><i class="fa fa-check"></i><b>11.2.6</b> <code>missing value where TRUE/FALSE needed</code></a></li>
<li class="chapter" data-level="11.2.7" data-path="errorchapter.html"><a href="errorchapter.html#unexpected-in-..."><i class="fa fa-check"></i><b>11.2.7</b> <code>unexpected '=' in ...</code></a></li>
<li class="chapter" data-level="11.2.8" data-path="errorchapter.html"><a href="errorchapter.html#attempt-to-apply-non-function"><i class="fa fa-check"></i><b>11.2.8</b> <code>attempt to apply non-function</code></a></li>
<li class="chapter" data-level="11.2.9" data-path="errorchapter.html"><a href="errorchapter.html#undefined-columns-selected"><i class="fa fa-check"></i><b>11.2.9</b> <code>undefined columns selected</code></a></li>
<li class="chapter" data-level="11.2.10" data-path="errorchapter.html"><a href="errorchapter.html#subscript-out-of-bounds"><i class="fa fa-check"></i><b>11.2.10</b> <code>subscript out of bounds</code></a></li>
<li class="chapter" data-level="11.2.11" data-path="errorchapter.html"><a href="errorchapter.html#object-of-type-closure-is-not-subsettable"><i class="fa fa-check"></i><b>11.2.11</b> <code>Object of type ‘closure’ is not subsettable</code></a></li>
<li class="chapter" data-level="11.2.12" data-path="errorchapter.html"><a href="errorchapter.html#operator-is-invalid-for-atomic-vectors"><i class="fa fa-check"></i><b>11.2.12</b> <code>$ operator is invalid for atomic vectors</code></a></li>
<li class="chapter" data-level="11.2.13" data-path="errorchapter.html"><a href="errorchapter.html#list-object-cannot-be-coerced-to-type-double"><i class="fa fa-check"></i><b>11.2.13</b> <code>(list) object cannot be coerced to type ‘double’</code></a></li>
<li class="chapter" data-level="11.2.14" data-path="errorchapter.html"><a href="errorchapter.html#arguments-imply-differing-number-of-rows"><i class="fa fa-check"></i><b>11.2.14</b> <code>arguments imply differing number of rows</code></a></li>
<li class="chapter" data-level="11.2.15" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-a-binary-operator"><i class="fa fa-check"></i><b>11.2.15</b> <code>non-numeric argument to a binary operator</code></a></li>
<li class="chapter" data-level="11.2.16" data-path="errorchapter.html"><a href="errorchapter.html#non-numeric-argument-to-mathematical-function"><i class="fa fa-check"></i><b>11.2.16</b> <code>non-numeric argument to mathematical function</code></a></li>
<li class="chapter" data-level="11.2.17" data-path="errorchapter.html"><a href="errorchapter.html#cannot-allocate-vector-of-size-..."><i class="fa fa-check"></i><b>11.2.17</b> <code>cannot allocate vector of size ...</code></a></li>
<li class="chapter" data-level="11.2.18" data-path="errorchapter.html"><a href="errorchapter.html#error-in-plot.new-figure-margins-too-large"><i class="fa fa-check"></i><b>11.2.18</b> <code>Error in plot.new() : figure margins too large</code></a></li>
<li class="chapter" data-level="11.2.19" data-path="errorchapter.html"><a href="errorchapter.html#error-in-.call.graphicsc_palette2-.callc_palette2-null-invalid-graphics-state"><i class="fa fa-check"></i><b>11.2.19</b> <code>Error in .Call.graphics(C_palette2, .Call(C_palette2, NULL)) : invalid graphics state</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="errorchapter.html"><a href="errorchapter.html#commonwarnings"><i class="fa fa-check"></i><b>11.3</b> Common warning messages</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="errorchapter.html"><a href="errorchapter.html#replacement-has-...-rows-..."><i class="fa fa-check"></i><b>11.3.1</b> <code>replacement has ... rows ...</code></a></li>
<li class="chapter" data-level="11.3.2" data-path="errorchapter.html"><a href="errorchapter.html#iferror"><i class="fa fa-check"></i><b>11.3.2</b> <code>the condition has length &gt; 1 and only the first element will be used</code></a></li>
<li class="chapter" data-level="11.3.3" data-path="errorchapter.html"><a href="errorchapter.html#number-of-items-to-replace-is-not-a-multiple-of-replacement-length"><i class="fa fa-check"></i><b>11.3.3</b> <code>number of items to replace is not a multiple of replacement length</code></a></li>
<li class="chapter" data-level="11.3.4" data-path="errorchapter.html"><a href="errorchapter.html#longer-object-length-is-not-a-multiple-of-shorter-object-length"><i class="fa fa-check"></i><b>11.3.4</b> <code>longer object length is not a multiple of shorter object length</code></a></li>
<li class="chapter" data-level="11.3.5" data-path="errorchapter.html"><a href="errorchapter.html#nas-introduced-by-coercion"><i class="fa fa-check"></i><b>11.3.5</b> <code>NAs introduced by coercion</code></a></li>
<li class="chapter" data-level="11.3.6" data-path="errorchapter.html"><a href="errorchapter.html#package-is-not-available-for-r-version-4.x.x"><i class="fa fa-check"></i><b>11.3.6</b> <code>package is not available (for R version 4.x.x)</code></a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="errorchapter.html"><a href="errorchapter.html#installationmessages"><i class="fa fa-check"></i><b>11.4</b> Messages printed when installing <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mathschap.html"><a href="mathschap.html"><i class="fa fa-check"></i><b>12</b> Mathematical appendix</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mathschap.html"><a href="mathschap.html#bootstrapcimaths"><i class="fa fa-check"></i><b>12.1</b> Bootstrap confidence intervals</a></li>
<li class="chapter" data-level="12.2" data-path="mathschap.html"><a href="mathschap.html#confintequal"><i class="fa fa-check"></i><b>12.2</b> The equivalence between confidence intervals and hypothesis tests</a></li>
<li class="chapter" data-level="12.3" data-path="mathschap.html"><a href="mathschap.html#twotypesofpvalues"><i class="fa fa-check"></i><b>12.3</b> Two types of p-values</a></li>
<li class="chapter" data-level="12.4" data-path="mathschap.html"><a href="mathschap.html#deviance"><i class="fa fa-check"></i><b>12.4</b> Deviance tests</a></li>
<li class="chapter" data-level="12.5" data-path="mathschap.html"><a href="mathschap.html#regreg"><i class="fa fa-check"></i><b>12.5</b> Regularised regression</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i><b>13</b> Solutions to exercises</a>
<ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch2"><i class="fa fa-check"></i>Chapter 2</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch3"><i class="fa fa-check"></i>Chapter 3</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#solutionsch4"><i class="fa fa-check"></i>Chapter 4</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch5solutions"><i class="fa fa-check"></i>Chapter 5</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch6solutions"><i class="fa fa-check"></i>Chapter 6</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7solutions"><i class="fa fa-check"></i>Chapter 7</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch7bsolutions"><i class="fa fa-check"></i>Chapter 8</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#ch8solutions"><i class="fa fa-check"></i>Chapter 9</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>Bibliography</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references1"><i class="fa fa-check"></i>Further reading</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references2"><i class="fa fa-check"></i>Online resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="divider"></li>
<li>&copy; 2021 Mans Thulin.</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="eda" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Exploratory data analysis and unsupervised learning<a href="eda.html#eda" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Exploratory data analysis (EDA) is a process in which we summarise and visually explore a dataset. An important part of EDA is unsupervised learning, which is a collection of methods for finding interesting subgroups and patterns in our data. Unlike statistical hypothesis testing, which is used to reject hypotheses, EDA can be used to <em>generate</em> hypotheses (which can then be confirmed or rejected by new studies). Another purpose of EDA is to find outliers and incorrect observations, which can lead to a cleaner and more useful dataset. In EDA we ask questions about our data and then try to answer them using summary statistics and graphics. Some questions will prove to be important, and some will not. The key to finding important questions is to ask a lot of questions. This chapter will provide you with a wide range of tools for question-asking.</p>
<p>After working with the material in this chapter, you will be able to use R to:</p>
<ul>
<li>Create reports using R Markdown,</li>
<li>Customise the look of your plots,</li>
<li>Visualise the distribution of a variable,</li>
<li>Create interactive plots,</li>
<li>Detect and label outliers,</li>
<li>Investigate patterns in missing data,</li>
<li>Visualise trends,</li>
<li>Plot time series data,</li>
<li>Visualise multiple variables at once using scatterplot matrices, correlograms and bubble plots,</li>
<li>Visualise multivariate data using principal component analysis,</li>
<li>Use unsupervised learning techniques for clustering,</li>
<li>Use factor analysis to find latent variables in your data.</li>
</ul>
<div id="rmarkdown" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Reports with R Markdown<a href="eda.html#rmarkdown" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R Markdown files can be used to create nicely formatted documents using R, that are easy to export to other formats, like HTML, Word or pdf. They allow you to mix R code with results and text. They can be used to create reproducible reports that are easy to update with new data, because they include the code for making tables and figures. Additionally, they can be used as notebooks for keeping track of your work and your thoughts as you carry out an analysis. You can even use them for writing books - in fact, this entire book was written using R Markdown.</p>
<p>It is often a good idea to use R Markdown for exploratory analyses, as it allows you to write down your thoughts and comments as the analysis progresses, as well as to save the results of the exploratory journey. For that reason, we’ll start this chapter by looking at some examples of what you can do using R Markdown. According to your preference, you can use either R Markdown or ordinary R scripts for the analyses in the remainder of the chapter. The R code used is the same and the results are identical, but if you use R Markdown, you can also save the output of the analysis in a nicely formatted document.</p>
<div id="a-first-example" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> A first example<a href="eda.html#a-first-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you create a new R Markdown document in RStudio by clicking <em>File &gt; New File &gt; R Markdown</em> in the menu, a document similar to that below is created :</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Måns Thulin&quot;
date: &quot;10/20/2020&quot;
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax
for authoring HTML, PDF, and MS Word documents. For more details on
using R Markdown see
&lt;http://rmarkdown.rstudio.com&gt;.

When you click the **Knit** button a document will be generated that
includes both content as well as the output of any embedded R code
chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to
prevent printing of the R code that generated the plot.</code></pre>
<p>Press the <em>Knit</em> button at the top of the Script panel to create an HTML document using this Markdown file. It will be saved in the same folder as your Markdown file. Once the HTML document has been created, it will open so that you can see the results. You may have to install additional packages for this to work, in which case RStudio will prompt you.</p>
<p>Now, let’s have a look at what the different parts of the Markdown document do. The first part is called the <em>document header</em> or <em>YAML header</em>. It contains information about the document, including its title, the name of its author, and the date on which it was first created:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Måns Thulin&quot;
date: &quot;10/20/2020&quot;
output: html_document
---</code></pre>
<p>The part that says <code>output: html_document</code> specifies what type of document should be created when you press <em>Knit</em>. In this case, it’s set to <code>html_document</code>, meaning that an HTML document will be created. By changing this to <code>output: word_document</code> you can create a <code>.docx</code> Word document instead. By changing it to <code>output: pdf_document</code>, you can create a <code>.pdf</code> document using LaTeX (you’ll have to install LaTeX if you haven’t already - RStudio will notify you if that is the case).</p>
<p>The second part sets the default behaviour of <em>code chunks</em> included in the document, specifying that the output from running the chunks should be printed unless otherwise specified:</p>
<pre><code>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```</code></pre>
<p>The third part contains the first proper section of the document. First, a header is created using <code>##</code>. Then there is some text with formatting: <code>&lt; &gt;</code> is used to create a link and <code>**</code> is used to get <strong>bold text</strong>. Finally, there is a code chunk, delimited by <code>```</code>:</p>
<pre><code>## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax
for authoring HTML, PDF, and MS Word documents. For more details on
using R Markdown see
&lt;http://rmarkdown.rstudio.com&gt;.

When you click the **Knit** button a document will be generated that
includes both content as well as the output of any embedded R code
chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```</code></pre>
<p>The fourth and final part contains another section, this time with a figure created using R. A setting is added to the code chunk used to create the figure, which prevents the underlying code from being printed in the document:</p>
<pre><code>## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to
prevent printing of the R code that generated the plot.</code></pre>
<p>In the next few sections, we will look at how formatting and code chunks work in R Markdown.</p>
</div>
<div id="formatting-text" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Formatting text<a href="eda.html#formatting-text" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create plain text in a Markdown file, you simply have to write plain text. If you wish to add some formatting to your text, you can use the following:</p>
<ul>
<li><code>_italics_</code> or <code>*italics*</code>: to create text in <em>italics</em>.</li>
<li><code>__bold__</code> or <code>**bold**</code>: to create <strong>bold</strong> text.</li>
<li><code>[linked text](http://www.modernstatisticswithr.com)</code>: to create <a href="http://www.modernstatisticswithr.com">linked text</a>.</li>
<li><code>`code`</code>: to include inline <code>code</code> in your document.</li>
<li><code>$a^2 + b^2 = c^2$</code>: to create inline equations like <span class="math inline">\(a^2 + b^2 = c^2\)</span> using LaTeX syntax.</li>
<li><code>$$a^2 + b^2 = c^2$$</code>: to create a centred equation on a new line, like <span class="math display">\[a^2 + b^2 = c^2.\]</span></li>
</ul>
<p>To add headers and subheaders, and to divide your document into section, start a new line with <code>#</code>’s as follows:</p>
<pre><code># Header text
## Sub-header text
### Sub-sub-header text
...and so on.</code></pre>
</div>
<div id="lists-tables-and-images" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Lists, tables, and images<a href="eda.html#lists-tables-and-images" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create a bullet list, you can use <code>*</code> as follows. Note that you need a blank line between your list and the previous paragraph to begin a list.</p>
<pre><code>* Item 1
* Item 2
   + Sub-item 1
   + Sub-item 2
* Item 3</code></pre>
<p>yielding:</p>
<ul>
<li>Item 1</li>
<li>Item 2
<ul>
<li>Sub-item 1</li>
<li>Sub-item 2</li>
</ul></li>
<li>Item 3</li>
</ul>
<p>To create an ordered list, use:</p>
<pre><code>1. First item
2. Second item
  i) Sub-item 1
  ii) Sub-item 2
3. Item 3</code></pre>
<p>yielding:</p>
<ol style="list-style-type: decimal">
<li>First item</li>
<li>Second item</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Sub-item 1</li>
<li>Sub-item 2</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>Item 3</li>
</ol>
<p>To create a table, use <code>|</code> and <code>---------</code> as follows:</p>
<pre><code>Column 1  | Column 2
--------- | ---------
Content  | More content
Even more  | And some here
Even more?  | Yes!</code></pre>
<p>which yields the following output:</p>
<table>
<thead>
<tr class="header">
<th>Column 1</th>
<th>Column 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Content</td>
<td>More content</td>
</tr>
<tr class="even">
<td>Even more</td>
<td>And some here</td>
</tr>
<tr class="odd">
<td>Even more?</td>
<td>Yes!</td>
</tr>
</tbody>
</table>
<p>To include an image, use the same syntax as when creating linked text with a link to the image path (either local or on the web), but with a <code>!</code> in front:</p>
<pre><code>![](https://www.r-project.org/Rlogo.png)

![Put some text here if you want a caption](https://www.r-project.org/Rlogo.png)</code></pre>
<p>which yields the following:</p>
<p><img src="Rlogo.png" /></p>
<div class="figure">
<img src="Rlogo.png" alt="" />
<p class="caption">Put some text here if you want a caption</p>
</div>
</div>
<div id="code-chunks" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Code chunks<a href="eda.html#code-chunks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest way to define a code chunk is to write:</p>
<pre><code>```{r}
plot(pressure)
```</code></pre>
<p>In RStudio, Ctrl+Alt+I is a keyboard shortcut for inserting this kind of code chunk.</p>
<p>We can add a name and a caption to the chunk, which lets us reference objects created by the chunk:</p>
<pre><code>```{r pressureplot, fig.cap = &quot;Plot of the pressure data.&quot;}
plot(pressure)
```

As we can see in Figure \@ref(fig:cars-plot), the relationship between
temperature and pressure resembles a banana.</code></pre>
<p>This yields the following output:</p>
<hr />
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="eda.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pressure)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pressureplot"></span>
<img src="_main_files/figure-html/pressureplot-1.png" alt="Plot of the pressure data." width="672" />
<p class="caption">
[그림] 4.1: Plot of the pressure data.
</p>
</div>
<p>As we can see in Figure <a href="eda.html#fig:pressureplot">4.1</a>, the relationship between
temperature and pressure resembles a banana.</p>
<hr />
<p>In addition, you can add settings to the chunk header to control its behaviour. For instance, you can include a code chunk without running it by adding <code>echo = FALSE</code>:</p>
<pre><code>```{r, eval = FALSE}
plot(pressure)
```</code></pre>
<p>You can add the following settings to your chunks:</p>
<ul>
<li><code>echo = FALSE</code> to run the code without printing it,</li>
<li><code>eval = FALSE</code> to print the code without running it,</li>
<li><code>results = "hide"</code> to hide printed output,</li>
<li><code>fig.show = "hide"</code> to hide plots,</li>
<li><code>warning = FALSE</code> to suppress warning messages from being printed in your document,</li>
<li><code>message = FALSE</code> to suppress other messages from being printed in your document,</li>
<li><code>include = FALSE</code> to run a chunk without showing the code or results in the document,</li>
<li><code>error = TRUE</code> to continue running your R Markdown document even if there is an error in the chunk (by default, the documentation creation stops if there is an error).</li>
</ul>
<p>Data frames can be printed either as in the Console or as a nicely formatted table. For example,</p>
<pre><code>```{r, echo = FALSE}
head(airquality)
```</code></pre>
<p>yields:</p>
<pre><code>##   Ozone Solar.R Wind Temp Month
## 1    41     190  7.4   67     5
## 2    36     118  8.0   72     5
## 3    12     149 12.6   74     5
## 4    18     313 11.5   62     5
## 5    NA      NA 14.3   56     5
## 6    28      NA 14.9   66     5
##   Day
## 1   1
## 2   2
## 3   3
## 4   4
## 5   5
## 6   6</code></pre>
<p>whereas</p>
<pre><code>```{r, echo = FALSE}
knitr::kable(
  head(airquality),
  caption = &quot;Some data I found.&quot;
)
```</code></pre>
<p>yields the table below.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-187"><표> 4.1: </span>Some data I found.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Ozone
</th>
<th style="text-align:right;">
Solar.R
</th>
<th style="text-align:right;">
Wind
</th>
<th style="text-align:right;">
Temp
</th>
<th style="text-align:right;">
Month
</th>
<th style="text-align:right;">
Day
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
190
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
118
</td>
<td style="text-align:right;">
8.0
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
149
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
313
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
14.3
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
14.9
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>Further help and documentation for R Markdown can be found through the RStudio menus, by clicking <em>Help &gt; Cheatsheets &gt; R Markdown Cheat Sheet</em> or <em>Help &gt; Cheatsheets &gt; R Markdown Reference Guide</em>.</p>
</div>
</div>
<div id="themes" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Customising <code>ggplot2</code> plots<a href="eda.html#themes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll be using <code>ggplot2</code> a lot in this chapter, so before we get started with exploratory analyses, we’ll take some time to learn how we can customise the look of <code>ggplot2</code>-plots.</p>
<p>Consider the following facetted plot from Section <a href="thebasics.html#comparinggroups">2.5.4</a>:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="eda.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb187-2"><a href="eda.html#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="eda.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb187-4"><a href="eda.html#cb187-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb187-5"><a href="eda.html#cb187-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-6"><a href="eda.html#cb187-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-7"><a href="eda.html#cb187-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb187-8"><a href="eda.html#cb187-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> vore)</span></code></pre></div>
<p>It looks nice, sure, but there may be things that you’d like to change. Maybe you’d like the plot’s background to be white instead of grey, or perhaps you’d like to use a different font. These, and many other things, can be modified using <em>themes</em>.</p>
<div id="using-themes" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Using themes<a href="eda.html#using-themes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>ggplot2</code> comes with a number of basic themes. All are fairly similar, but differ in things like background colour, grids and borders. You can add them to your plot using <code>theme_themeName</code>, where <code>themeName</code> is the name of the theme<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>. Here are some examples:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="eda.html#cb188-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">colour =</span> vore)) <span class="sc">+</span> </span>
<span id="cb188-2"><a href="eda.html#cb188-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb188-3"><a href="eda.html#cb188-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-4"><a href="eda.html#cb188-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-5"><a href="eda.html#cb188-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb188-6"><a href="eda.html#cb188-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> vore)</span>
<span id="cb188-7"><a href="eda.html#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="eda.html#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot with different themes:</span></span>
<span id="cb188-9"><a href="eda.html#cb188-9" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_grey</span>() <span class="co"># The default theme</span></span>
<span id="cb188-10"><a href="eda.html#cb188-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb188-11"><a href="eda.html#cb188-11" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_linedraw</span>()</span>
<span id="cb188-12"><a href="eda.html#cb188-12" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_light</span>()</span>
<span id="cb188-13"><a href="eda.html#cb188-13" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_dark</span>()</span>
<span id="cb188-14"><a href="eda.html#cb188-14" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb188-15"><a href="eda.html#cb188-15" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>There are several packages available that contain additional themes. Let’s download a few:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="eda.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggthemes&quot;</span>)</span>
<span id="cb189-2"><a href="eda.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb189-3"><a href="eda.html#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="eda.html#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot with different themes from ggthemes:</span></span>
<span id="cb189-5"><a href="eda.html#cb189-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_tufte</span>() <span class="co"># Minimalist Tufte theme</span></span>
<span id="cb189-6"><a href="eda.html#cb189-6" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_wsj</span>() <span class="co"># Wall Street Journal</span></span>
<span id="cb189-7"><a href="eda.html#cb189-7" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_solarized</span>() <span class="sc">+</span> <span class="fu">scale_colour_solarized</span>() <span class="co"># Solarized colours</span></span>
<span id="cb189-8"><a href="eda.html#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="eda.html#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb189-10"><a href="eda.html#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="eda.html#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;hrbrthemes&quot;</span>)</span>
<span id="cb189-12"><a href="eda.html#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb189-13"><a href="eda.html#cb189-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-14"><a href="eda.html#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot with different themes from hrbrthemes:</span></span>
<span id="cb189-15"><a href="eda.html#cb189-15" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_ipsum</span>() <span class="co"># Ipsum theme</span></span>
<span id="cb189-16"><a href="eda.html#cb189-16" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_ft_rc</span>() <span class="co"># Suitable for use with dark RStudio themes</span></span>
<span id="cb189-17"><a href="eda.html#cb189-17" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_modern_rc</span>() <span class="co"># Suitable for use with dark RStudio themes</span></span></code></pre></div>
</div>
<div id="colourpalettes" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Colour palettes<a href="eda.html#colourpalettes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unlike e.g. background colours, the <em>colour palette</em>, i.e. the list of colours used for plotting, is not part of the theme that you’re using. Next, we’ll have a look at how to change the colour palette used for your plot.</p>
<p>Let’s start by creating a <code>ggplot</code> object:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="eda.html#cb190-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">colour =</span> vore)) <span class="sc">+</span> </span>
<span id="cb190-2"><a href="eda.html#cb190-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-3"><a href="eda.html#cb190-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-4"><a href="eda.html#cb190-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-5"><a href="eda.html#cb190-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>You can change the colour palette using <code>scale_colour_brewer</code>. Three types of colour palettes are available:</p>
<ul>
<li><strong>Sequential palettes</strong>: that range from a colour to white. These are useful for representing ordinal (i.e. ordered) categorical variables and numerical variables.</li>
<li><strong>Diverging palettes</strong>: these range from one colour to another, with white in between. Diverging palettes are useful when there is a meaningful middle or 0 value (e.g. when your variables represent temperatures or profit/loss), which can be mapped to white.</li>
<li><strong>Qualitative palettes</strong>: which contain multiple distinct colours. These are useful for nominal (i.e. with no natural ordering) categorical variables.</li>
</ul>
<p>See <code>?scale_colour_brewer</code> or <a href="http://www.colorbrewer2.org" class="uri">http://www.colorbrewer2.org</a> for a list of the available palettes. Here are some examples:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="eda.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequential palette:</span></span>
<span id="cb191-2"><a href="eda.html#cb191-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;OrRd&quot;</span>)</span>
<span id="cb191-3"><a href="eda.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette:</span></span>
<span id="cb191-4"><a href="eda.html#cb191-4" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;RdBu&quot;</span>)</span>
<span id="cb191-5"><a href="eda.html#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Qualitative palette:</span></span>
<span id="cb191-6"><a href="eda.html#cb191-6" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p>In this case, because <code>vore</code> is a nominal categorical variable, a qualitative palette is arguably the best choice.</p>
</div>
<div id="theme-settings" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Theme settings<a href="eda.html#theme-settings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The point of using a theme is that you get a combination of colours, fonts and other choices that are supposed to go well together, meaning that you don’t have to spend too much time picking combinations. But if you like, you can override the default options and customise any and all parts of a theme.</p>
<p>The theme controls all visual aspects of the plot not related to the aesthetics. You can change the theme settings using the <code>theme</code> function. For instance, you can use <code>theme</code> to remove the legend or change its position:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="eda.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No legend:</span></span>
<span id="cb192-2"><a href="eda.html#cb192-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb192-3"><a href="eda.html#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="eda.html#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend below figure:</span></span>
<span id="cb192-5"><a href="eda.html#cb192-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb192-6"><a href="eda.html#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="eda.html#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend inside plot:</span></span>
<span id="cb192-8"><a href="eda.html#cb192-8" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.7</span>))</span></code></pre></div>
<p>In the last example, the vector <code>c(0.9, 0.7)</code> gives the relative coordinates of the legend, with <code>c(0 0)</code> representing the bottom left corner of the plot and <code>c(1, 1)</code> the upper right corner. Try to change the coordinates to different values between <code>0</code> and <code>1</code> and see what happens.</p>
<p><code>theme</code> has a lot of other settings, including for the colours of the background, the grid and the text in the plot. Here are a few examples that you can use as starting point for experimenting with the settings:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="eda.html#cb193-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb193-2"><a href="eda.html#cb193-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;purple&quot;</span>,</span>
<span id="cb193-3"><a href="eda.html#cb193-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>),</span>
<span id="cb193-4"><a href="eda.html#cb193-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>),</span>
<span id="cb193-5"><a href="eda.html#cb193-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>),</span>
<span id="cb193-6"><a href="eda.html#cb193-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;mono&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb193-7"><a href="eda.html#cb193-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>, <span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div>
<p>To find a complete list of settings, see <code>?theme</code>, <code>?element_line</code> (lines), <code>?element_rect</code> (borders and backgrounds), <code>?element_text</code> (text), and <code>element_blank</code> (for suppressing plotting of elements). As before, you can use <code>colors()</code> to get a list of built-in colours, or use colour hex codes.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc0" class="exercise"><strong>Exercise 4.1  </strong></span>Use the documentation for <code>theme</code> and the <code>element_...</code> functions to change the plot object <code>p</code> created above as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Change the background colour of the entire plot to <code>lightblue</code>.</p></li>
<li><p>Change the font of the legend to <code>serif</code>.</p></li>
<li><p>Remove the grid.</p></li>
<li><p>Change the colour of the axis ticks to <code>orange</code> and make them thicker.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions0">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="exploring-distributions" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Exploring distributions<a href="eda.html#exploring-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is often useful to visualise the distribution of a numerical variable. Comparing the distributions of different groups can lead to important insights. Visualising distributions is also essential when checking assumptions used for various statistical tests (sometimes called <em>initial data analysis</em>). In this section we will illustrate how this can be done using the <code>diamonds</code> data from the <code>ggplot2</code> package, which you started to explore in Chapter <a href="thebasics.html#thebasics">2</a>.</p>
<div id="density-plots-and-frequency-polygons" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Density plots and frequency polygons<a href="eda.html#density-plots-and-frequency-polygons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We already know how to visualise the distribution of the data by dividing it into bins and plotting a histogram:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="eda.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb194-2"><a href="eda.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat)) <span class="sc">+</span></span>
<span id="cb194-3"><a href="eda.html#cb194-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>A similar plot is created using frequency polygons, which uses lines instead of bars to display the counts in the bins:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="eda.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat)) <span class="sc">+</span></span>
<span id="cb195-2"><a href="eda.html#cb195-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_freqpoly</span>()</span></code></pre></div>
<p>An advantage with frequency polygons is that they can be used to compare groups, e.g. diamonds with different cuts, without facetting:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="eda.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb196-2"><a href="eda.html#cb196-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_freqpoly</span>()</span></code></pre></div>
<p>It is clear from this figure that there are more diamonds with ideal cuts than diamonds with fair cuts in the data. The polygons have roughly the same shape, except perhaps for the polygon for diamonds with fair cuts.</p>
<p>In some cases, we are more interested in the shape of the distribution than in the actual counts in the different bins. Density plots are similar to frequency polygons but show an estimate of the density function of the underlying random variable. These estimates are smooth curves that are scaled so that the area below them is 1 (i.e. scaled to be proper density functions):</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="eda.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb197-2"><a href="eda.html#cb197-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>()</span></code></pre></div>
<p>From this figure, it becomes clear that low-carat diamonds tend to have better cuts, which wasn’t obvious from the frequency polygons. However, the plot does not provide any information about <em>how</em> common different cuts are. Use density plots if you’re more interested in the shape of a variable’s distribution, and frequency polygons if you’re more interested in counts.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc9" class="exercise"><strong>Exercise 4.2  </strong></span>Using the density plot created above and the documentation for <code>geom_density</code>, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Increase the smoothness of the density curves.</p></li>
<li><p>Fill the area under the density curves with the same colour as the curves themselves.</p></li>
<li><p>Make the colours that fill the areas under the curves transparent.</p></li>
<li><p>The figure still isn’t that easy to interpret. Install and load the <code>ggridges</code> package, an extension of <code>ggplot2</code> that allows you to make so-called ridge plots (density plots that are separated along the y-axis, similar to facetting). Read the documentation for <code>geom_density_ridges</code> and use it to make a ridge plot of diamond prices for different cuts.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions9">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch4exc10" class="exercise"><strong>Exercise 4.3  </strong></span>Return to the histogram created by <code>ggplot(diamonds, aes(carat)) + geom_histogram()</code> above. As there are very few diamonds with carat greater than 3, cut the x-axis at 3. Then decrease the bin width to 0.01. Do any interesting patterns emerge?</p>
</div>
<p><a href="solutions.html#ch4solutions10">(Click here to go to the solution.)</a></p>
</div>
<div id="asking-questions" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Asking questions<a href="eda.html#asking-questions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise <a href="eda.html#exr:ch4exc10">4.3</a> causes us to ask why diamonds with carat values that are multiples of 0.25 are more common than others. Perhaps the price is involved? Unfortunately, a plot of <code>carat</code> versus <code>price</code> is not that informative:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="eda.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb198-2"><a href="eda.html#cb198-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p>Maybe we could compute the average price in each bin of the histogram? In that case, we need to extract the bin breaks from the histogram somehow. We could then create a new categorical variable using the breaks with <code>cut</code> (as we did in Exercise <a href="datachapter.html#exr:ch3exc3b">3.7</a>). It turns out that extracting the bins is much easier using base graphics than <code>ggplot2</code>, so let’s do that:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="eda.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract information from a histogram with bin width 0.01,</span></span>
<span id="cb199-2"><a href="eda.html#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="co"># which corresponds to 481 breaks:</span></span>
<span id="cb199-3"><a href="eda.html#cb199-3" aria-hidden="true" tabindex="-1"></a>carat_br <span class="ot">&lt;-</span> <span class="fu">hist</span>(diamonds<span class="sc">$</span>carat, <span class="at">breaks =</span> <span class="dv">481</span>, <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb199-4"><a href="eda.html#cb199-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb199-5"><a href="eda.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Of interest to us are:</span></span>
<span id="cb199-6"><a href="eda.html#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="co"># carat_br$breaks, which contains the breaks for the bins</span></span>
<span id="cb199-7"><a href="eda.html#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="co"># carat_br$mid, which contains the midpoints of the bins</span></span>
<span id="cb199-8"><a href="eda.html#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="co">#               (useful for plotting!)</span></span>
<span id="cb199-9"><a href="eda.html#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="eda.html#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create categories for each bin:</span></span>
<span id="cb199-11"><a href="eda.html#cb199-11" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>carat_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(diamonds<span class="sc">$</span>carat, <span class="dv">481</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We now have a variable, <code>carat_cat</code>, that shows to which bin each observation belongs. Next, we’d like to compute the mean for each bin. This is a grouped summary - mean by category. After we’ve computed the bin means, we could then plot them against the bin midpoints. Let’s try it:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="eda.html#cb200-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(price <span class="sc">~</span> carat_cat, <span class="at">data =</span> diamonds, <span class="at">FUN =</span> mean)</span>
<span id="cb200-2"><a href="eda.html#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="eda.html#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(carat_br<span class="sc">$</span>mid, means<span class="sc">$</span>price)</span></code></pre></div>
<p>That didn’t work as intended. We get an error message when attempting to plot the results:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="eda.html#cb201-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">xy.coords</span>(x, y, xlabel, ylabel, log) <span class="sc">:</span> </span>
<span id="cb201-2"><a href="eda.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;x&#39;</span> and <span class="st">&#39;y&#39;</span> lengths differ</span></code></pre></div>
<p>The error message implies that the number of bins and the number of mean values that have been computed differ. But we’ve just computed the mean for each bin, haven’t we? So what’s going on?</p>
<p>By default, <code>aggregate</code> ignores groups for which there are no values when computing grouped summaries. In this case, there are a lot of empty bins - there is for instance no observation in the <code>[4.99,5)</code> bin. In fact, only 272 out of the 481 bins are non-empty.</p>
<p>We can solve this in different ways. One way is to remove the empty bins. We can do this using the <code>match</code> function, which returns the positions of <em>matching values</em> in two vectors. If we use it with the bins from the grouped summary and the vector containing all bins, we can find the indices of the non-empty bins. This requires the use of the <code>levels</code> function, that you’ll learn more about in Section <a href="messychapter.html#factors">5.4</a>:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="eda.html#cb202-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(price <span class="sc">~</span> carat_cat, <span class="at">data =</span> diamonds, <span class="at">FUN =</span> mean)</span>
<span id="cb202-2"><a href="eda.html#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="eda.html#cb202-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">match</span>(means<span class="sc">$</span>carat_cat, <span class="fu">levels</span>(diamonds<span class="sc">$</span>carat_cat))</span></code></pre></div>
<p>Finally, we’ll also add some vertical lines to our plot, to call attention to multiples of 0.25.</p>
<table>
<div class="column-left">
<p>Using base graphics is faster here:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="eda.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(carat_br<span class="sc">$</span>mid[id], means<span class="sc">$</span>price,</span>
<span id="cb203-2"><a href="eda.html#cb203-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb203-3"><a href="eda.html#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="eda.html#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines at multiples</span></span>
<span id="cb203-5"><a href="eda.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co"># of 0.25:</span></span>
<span id="cb203-6"><a href="eda.html#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>,</span>
<span id="cb203-7"><a href="eda.html#cb203-7" aria-hidden="true" tabindex="-1"></a>             <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span></code></pre></div>
</div>
<div class="column-right">
<p>But we can of course stick to <code>ggplot2</code> if we like:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="eda.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb204-2"><a href="eda.html#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="eda.html#cb204-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb204-4"><a href="eda.html#cb204-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">bin =</span> carat_br<span class="sc">$</span>mid[id],</span>
<span id="cb204-5"><a href="eda.html#cb204-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> means<span class="sc">$</span>price)</span>
<span id="cb204-6"><a href="eda.html#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="eda.html#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d2, <span class="fu">aes</span>(bin, mean)) <span class="sc">+</span></span>
<span id="cb204-8"><a href="eda.html#cb204-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb204-9"><a href="eda.html#cb204-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> </span>
<span id="cb204-10"><a href="eda.html#cb204-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>,</span>
<span id="cb204-11"><a href="eda.html#cb204-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span>
<span id="cb204-12"><a href="eda.html#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_vline add vertical lines at</span></span>
<span id="cb204-13"><a href="eda.html#cb204-13" aria-hidden="true" tabindex="-1"></a><span class="co"># multiples of 0.25</span></span></code></pre></div>
</div>
</table>
<p>It appears that there are small jumps in the prices at some of the 0.25-marks. This explains why there are more diamonds just above these marks than just below.</p>
<p>The above example illustrates three crucial things regarding exploratory data analysis:</p>
<ul>
<li><p>Plots (in our case, the histogram) often lead to new questions.</p></li>
<li><p>Often, we must transform, summarise or otherwise manipulate our data to answer a question. Sometimes this is straightforward and sometimes it means diving deep into R code.</p></li>
<li><p>Sometimes the thing that we’re trying to do doesn’t work straight away. There is almost always a solution though (and oftentimes more than one!). The more you work with R, the more problem-solving tricks you will learn.</p></li>
</ul>
</div>
<div id="violin-plots" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Violin plots<a href="eda.html#violin-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Density curves can also be used as alternatives to boxplots. In Exercise <a href="thebasics.html#exr:ch2exc7">2.16</a>, you created boxplots to visualise price differences between diamonds of different cuts:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="eda.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb205-2"><a href="eda.html#cb205-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p>Instead of using a boxplot, we can use a violin plot. Each group is represented by a “violin”, given by a rotated and duplicated density plot:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="eda.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb206-2"><a href="eda.html#cb206-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>()</span></code></pre></div>
<p>Compared to boxplots, violin plots capture the entire distribution of the data rather than just a few numerical summaries. If you like numerical summaries (and you should!) you can add the median and the quartiles (corresponding to the borders of the box in the boxplot) using the <code>draw_quantiles</code> argument:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="eda.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price)) <span class="sc">+</span></span>
<span id="cb207-2"><a href="eda.html#cb207-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>(<span class="at">draw_quantiles =</span>  <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc11" class="exercise"><strong>Exercise 4.4  </strong></span>Using the first boxplot created above, i.e. <code>ggplot(diamonds, aes(cut, price)) + geom_violin()</code>, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Add some colour to the plot by giving different colours to each violin.</p></li>
<li><p>Because the categories are shown along the x-axis, we don’t really need the legend. Remove it.</p></li>
<li><p>Both boxplots and violin plots are useful. Maybe we can have the best of both worlds? Add the corresponding boxplot inside each violin. Hint: the <code>width</code> and <code>alpha</code> arguments in <code>geom_boxplot</code> are useful for creating a nice-looking figure here.</p></li>
<li><p>Flip the coordinate system to create horizontal violins and boxes instead.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions11">(Click here to go to the solution.)</a></p>
</div>
<div id="patchwork" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Combine multiple plots into a single graphic<a href="eda.html#patchwork" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When exploring data with many variables, you’ll often want to make the same kind of plot (e.g. a violin plot) for several variables. It will frequently make sense to place these side-by-side in the same plot window. The <code>patchwork</code> package extends <code>ggplot2</code> by letting you do just that. Let’s install it:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="eda.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;patchwork&quot;</span>)</span></code></pre></div>
<p>To use it, save each plot as a plot object and then add them together:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="eda.html#cb209-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, carat, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb209-2"><a href="eda.html#cb209-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb209-3"><a href="eda.html#cb209-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb209-4"><a href="eda.html#cb209-4" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, price, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb209-5"><a href="eda.html#cb209-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb209-6"><a href="eda.html#cb209-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb209-7"><a href="eda.html#cb209-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-8"><a href="eda.html#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb209-9"><a href="eda.html#cb209-9" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2</span></code></pre></div>
<p>You can also arrange the plots on multiple lines, with different numbers of plots on each line. This is particularly useful if you are combining different types of plots in a single plot window. In this case, you separate plots that are same line by <code>|</code> and mark the beginning of a new line with <code>/</code>:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="eda.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create two more plot objects:</span></span>
<span id="cb210-2"><a href="eda.html#cb210-2" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(cut, depth, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb210-3"><a href="eda.html#cb210-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb210-4"><a href="eda.html#cb210-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb210-5"><a href="eda.html#cb210-5" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb210-6"><a href="eda.html#cb210-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb210-7"><a href="eda.html#cb210-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.6</span>))</span>
<span id="cb210-8"><a href="eda.html#cb210-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-9"><a href="eda.html#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One row with three plots and one row with a single plot:</span></span>
<span id="cb210-10"><a href="eda.html#cb210-10" aria-hidden="true" tabindex="-1"></a>(plot1 <span class="sc">|</span> plot2 <span class="sc">|</span> plot3) <span class="sc">/</span> plot4</span>
<span id="cb210-11"><a href="eda.html#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="eda.html#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="co"># One column with three plots and one column with a single plot:</span></span>
<span id="cb210-13"><a href="eda.html#cb210-13" aria-hidden="true" tabindex="-1"></a>(plot1 <span class="sc">/</span> plot2 <span class="sc">/</span> plot3) <span class="sc">|</span> plot4</span></code></pre></div>
<p>(You may need to enlarge your plot window for this to look good!)</p>
</div>
</div>
<div id="outliers-and-missing-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Outliers and missing data<a href="eda.html#outliers-and-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="detecting-outliers" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Detecting outliers<a href="eda.html#detecting-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Both boxplots and scatterplots are helpful in detecting deviating observations - often called outliers. Outliers can be caused by measurement errors or errors in the data input but can also be interesting rare cases that can provide valuable insights about the process that generated the data. Either way, it is often of interest to detect outliers, for instance because that may influence the choice of what statistical tests to use.</p>
<p>Let’s return to the scatterplot of diamond carats versus prices:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="eda.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb211-2"><a href="eda.html#cb211-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>There are some outliers which we may want to study further. For instance, there is a surprisingly cheap 5 carat diamond, and some cheap 3 carat diamonds<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>. But how can we identify those points?</p>
<p>One option is to use the <code>plotly</code> package to make an interactive version of the plot, where we can hover interesting points to see more information about them. Start by installing it:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="eda.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;plotly&quot;</span>)</span></code></pre></div>
<p>To use <code>plotly</code> with a <code>ggplot</code> graphic, we store the graphic in a variable and then use it as input to the <code>ggplotly</code> function. The resulting (interactive!) plot takes a little longer than usual to load. Try hovering the points:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="eda.html#cb213-1" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb213-2"><a href="eda.html#cb213-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span>
<span id="cb213-3"><a href="eda.html#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="eda.html#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb213-5"><a href="eda.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>By default, <code>plotly</code> only shows the carat and price of each diamond. But we can add more information to the box by adding a <code>text</code> aesthetic:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="eda.html#cb214-1" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price, <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Row:&quot;</span>,</span>
<span id="cb214-2"><a href="eda.html#cb214-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">rownames</span>(diamonds)))) <span class="sc">+</span></span>
<span id="cb214-3"><a href="eda.html#cb214-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">geom_point</span>()</span>
<span id="cb214-4"><a href="eda.html#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="eda.html#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>We can now find the row numbers of the outliers visually, which is very useful when exploring data.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc12" class="exercise"><strong>Exercise 4.5  </strong></span>The variables <code>x</code> and <code>y</code> in the <code>diamonds</code> data describe the length and width of the diamonds (in mm). Use an interactive scatterplot to identify outliers in these variables. Check prices, carat and other information and think about if any of the outliers can be due to data errors.</p>
</div>
<p><a href="solutions.html#ch4solutions12">(Click here to go to the solution.)</a></p>
</div>
<div id="labelling-outliers" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Labelling outliers<a href="eda.html#labelling-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Interactive plots are great when exploring a dataset but are not always possible to use in other contexts, e.g. for printed reports and some presentations. In these other cases, we can instead annotate the plot with notes about outliers. One way to do this is to use a geom called <code>geom_text</code>.</p>
<p>For instance, we may want to add the row numbers of outliers to a plot. To do so, we use <code>geom_text</code> along with a condition that specifies for which points we should add annotations. Like in Section <a href="datachapter.html#conditionsintro">3.2.3</a>, if we e.g. wish to add row numbers for diamonds with carats greater than four, our condition would be <code>carat &gt; 4</code>. The <code>ifelse</code> function, which we’ll look closer at in Section <a href="progchapter.html#conditions">6.3</a>, is perfect to use here. The syntax will be <code>ifelse(condition, what text to write if the condition is satisfied, what text to write else)</code>. To add row names for observations that fulfil the condition but not for other observations, we use <code>ifelse(condition, rownames(diamonds), "")</code>. If instead, we wanted to print the price of the diamonds, we’d use <code>ifelse(condition, price, "")</code>.</p>
<p>Here are some different examples of conditions used to plot text:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="eda.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Using the row number (the 5 carat diamond is on row 27,416)</span></span>
<span id="cb215-2"><a href="eda.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb215-3"><a href="eda.html#cb215-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb215-4"><a href="eda.html#cb215-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(<span class="fu">rownames</span>(diamonds) <span class="sc">==</span> <span class="dv">27416</span>,</span>
<span id="cb215-5"><a href="eda.html#cb215-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">rownames</span>(diamonds), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb215-6"><a href="eda.html#cb215-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fl">1.1</span>)</span>
<span id="cb215-7"><a href="eda.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="do">## (hjust=1.1 shifts the text to the left of the point)</span></span>
<span id="cb215-8"><a href="eda.html#cb215-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-9"><a href="eda.html#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot text next to all diamonds with carat&gt;4</span></span>
<span id="cb215-10"><a href="eda.html#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb215-11"><a href="eda.html#cb215-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb215-12"><a href="eda.html#cb215-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(carat <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="fu">rownames</span>(diamonds), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb215-13"><a href="eda.html#cb215-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">hjust =</span> <span class="fl">1.1</span>)</span>
<span id="cb215-14"><a href="eda.html#cb215-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-15"><a href="eda.html#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot text next to 3 carat diamonds with a price below 7500</span></span>
<span id="cb215-16"><a href="eda.html#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb215-17"><a href="eda.html#cb215-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb215-18"><a href="eda.html#cb215-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(carat <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> price <span class="sc">&lt;</span> <span class="dv">7500</span>,</span>
<span id="cb215-19"><a href="eda.html#cb215-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">rownames</span>(diamonds), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb215-20"><a href="eda.html#cb215-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fl">1.1</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc13" class="exercise"><strong>Exercise 4.6  </strong></span>Create a static (i.e. non-interactive) scatterplot of <code>x</code> versus <code>y</code> from the <code>diamonds</code> data. Label the diamonds with suspiciously high <span class="math inline">\(y\)</span>-values.</p>
</div>
<p><a href="solutions.html#ch4solutions13">(Click here to go to the solution.)</a></p>
</div>
<div id="missing-data" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Missing data<a href="eda.html#missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Like many datasets, the mammal sleep data <code>msleep</code> contains a lot of missing values, represented by <code>NA</code> (Not Available) in R. This becomes evident when we have a look at the data:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="eda.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb216-2"><a href="eda.html#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(msleep)</span></code></pre></div>
<p>We can check if a particular observation is missing using the <code>is.na</code> function:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="eda.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(msleep<span class="sc">$</span>sleep_rem[<span class="dv">4</span>])</span>
<span id="cb217-2"><a href="eda.html#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(msleep<span class="sc">$</span>sleep_rem)</span></code></pre></div>
<p>We can count the number of missing values for each variable using:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="eda.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(msleep))</span></code></pre></div>
<p>Here, <code>colSums</code> computes the sum of <code>is.na(msleep)</code> for each column of <code>msleep</code> (remember that in summation, <code>TRUE</code> counts as <code>1</code> and <code>FALSE</code> as <code>0</code>), yielding the number of missing values for each variable. In total, there are 136 missing values in the dataset:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="eda.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(msleep))</span></code></pre></div>
<p>You’ll notice that <code>ggplot2</code> prints a warning in the Console when you create a plot with missing data:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="eda.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span></span>
<span id="cb220-2"><a href="eda.html#cb220-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb220-3"><a href="eda.html#cb220-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>Sometimes data are missing simply because the information is not yet available (for instance, the brain weight of the mountain beaver could be missing because no one has ever weighed the brain of a mountain beaver). In other cases, data can be missing because something about them is different (for instance, values for a male patient in a medical trial can be missing because the patient died, or because some values only were collected for female patients). Therefore, it is of interest to see if there are any differences in non-missing variables between subjects that have missing data and subjects that don’t.</p>
<p>In <code>msleep</code>, all animals have recorded values for <code>sleep_total</code> and <code>bodywt</code>. To check if the animals that have missing <code>brainwt</code> values differ from the others, we can plot them in a different colour in a scatterplot:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="eda.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, sleep_total, <span class="at">colour =</span> <span class="fu">is.na</span>(brainwt))) <span class="sc">+</span></span>
<span id="cb221-2"><a href="eda.html#cb221-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb221-3"><a href="eda.html#cb221-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>(If <code>is.na(brainwt)</code> is <code>TRUE</code> then the brain weight is missing in the dataset.) In this case, there are no apparent differences between the animals with missing data and those without.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc14" class="exercise"><strong>Exercise 4.7  </strong></span>Create a version of the diamonds dataset where the <code>x</code> value is missing for all diamonds with <span class="math inline">\(x&gt;9\)</span>. Make a scatterplot of carat versus price, with points where the <code>x</code> value is missing plotted in a different colour. How would you interpret this plot?</p>
</div>
<p><a href="solutions.html#ch4solutions14">(Click here to go to the solution.)</a></p>
</div>
<div id="exploring-data" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Exploring data<a href="eda.html#exploring-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>nycflights13</code> package contains data about flights to and from three airports in New York, USA, in 2013. As a summary exercise, we will study a subset of these, namely all flights departing from New York on 1 January that year:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="eda.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;nycflights13&quot;</span>)</span>
<span id="cb222-2"><a href="eda.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb222-3"><a href="eda.html#cb222-3" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights[flights<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>day <span class="sc">==</span> <span class="dv">1</span>,]</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc15" class="exercise"><strong>Exercise 4.8  </strong></span>Explore the <code>flights2</code> dataset, focusing on delays and the amount of time spent in the air. Are there any differences between the different carriers? Are there missing data? Are there any outliers?</p>
</div>
<p><a href="solutions.html#ch4solutions15">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="trends-in-scatterplots" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Trends in scatterplots<a href="eda.html#trends-in-scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s return to a familiar example - the relationship between animal brain size and sleep times:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="eda.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb223-2"><a href="eda.html#cb223-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb223-3"><a href="eda.html#cb223-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-4"><a href="eda.html#cb223-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-5"><a href="eda.html#cb223-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>There appears to be a decreasing trend in the plot. To aid the eye, we can add a smoothed line by adding a new geom, <code>geom_smooth</code>, to the figure:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="eda.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total)) <span class="sc">+</span> </span>
<span id="cb224-2"><a href="eda.html#cb224-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb224-3"><a href="eda.html#cb224-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb224-4"><a href="eda.html#cb224-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Brain weight (logarithmic scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb224-5"><a href="eda.html#cb224-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time&quot;</span>) <span class="sc">+</span></span>
<span id="cb224-6"><a href="eda.html#cb224-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>This technique is useful for bivariate data as well as for time series, which we’ll delve into next.</p>
<p>By default, <code>geom_smooth</code> adds a line fitted using either LOESS<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> or GAM<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>, as well as the corresponding 95 % confidence interval describing the uncertainty in the estimate. There are several useful arguments that can be used with <code>geom_smooth</code>. You will explore some of these in the exercise below.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc1" class="exercise"><strong>Exercise 4.9  </strong></span>Check the documentation for <code>geom_smooth</code>. Starting with the plot of brain weight vs. sleep time created above, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Decrease the degree of smoothing for the LOESS line that was fitted to the data. What is better in this case, more or less smoothing?</p></li>
<li><p>Fit a straight line to the data instead of a non-linear LOESS line.</p></li>
<li><p>Remove the confidence interval from the plot.</p></li>
<li><p>Change the colour of the fitted line to red.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions1">(Click here to go to the solution.)</a></p>
</div>
<div id="tsplots" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Exploring time series<a href="eda.html#tsplots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we have a look at time series, you should install four useful packages: <code>forecast</code>, <code>nlme</code>, <code>fma</code> and <code>fpp2</code>. The first contains useful functions for plotting time series data, and the latter three contain datasets that we’ll use.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="eda.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;nlme&quot;</span>, <span class="st">&quot;forecast&quot;</span>, <span class="st">&quot;fma&quot;</span>, <span class="st">&quot;fpp2&quot;</span>),</span>
<span id="cb225-2"><a href="eda.html#cb225-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The <code>a10</code> dataset contains information about the monthly anti-diabetic drug sales in Australia during the period July 1991 to June 2008. By checking its structure, we see that it is saved as a time series object<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="eda.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb226-2"><a href="eda.html#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a10)</span></code></pre></div>
<p><code>ggplot2</code> requires that data is saved as a data frame in order for it to be plotted. In order to plot the time series, we could first convert it to a data frame and then plot each point using <code>geom_points</code>:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="eda.html#cb227-1" aria-hidden="true" tabindex="-1"></a>a10_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">time</span>(a10), <span class="at">sales =</span> a10)</span>
<span id="cb227-2"><a href="eda.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(a10_df, <span class="fu">aes</span>(time, sales)) <span class="sc">+</span></span>
<span id="cb227-3"><a href="eda.html#cb227-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>It is however usually preferable to plot time series using lines instead of points. This is done using a different geom: <code>geom_line</code>:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="eda.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(a10_df, <span class="fu">aes</span>(time, sales)) <span class="sc">+</span></span>
<span id="cb228-2"><a href="eda.html#cb228-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span></code></pre></div>
<p>Having to convert the time series object to a data frame is a little awkward. Luckily, there is a way around this. <code>ggplot2</code> offers a function called <code>autoplot</code>, that automatically draws an appropriate plot for certain types of data. <code>forecast</code> extends this function to time series objects:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="eda.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb229-2"><a href="eda.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10)</span></code></pre></div>
<p>We can still add other geoms, axis labels and other things just as before. <code>autoplot</code> has simply replaced the <code>ggplot(data, aes()) + geom</code> part that would be the first two rows of the <code>ggplot2</code> figure, and has implicitly converted the data to a data frame.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc2" class="exercise"><strong>Exercise 4.10  </strong></span>Using the <code>autoplot(a10)</code> figure, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Add a smoothed line describing the trend in the data. Make sure that it is smooth enough <em>not</em> to capture the seasonal variation in the data.</p></li>
<li><p>Change the label of the x-axis to “Year” and the label of the y-axis to “Sales ($ million)”.</p></li>
<li><p>Check the documentation for the <code>ggtitle</code> function. What does it do? Use it with the figure.</p></li>
<li><p>Change the colour of the time series line to red.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions2">(Click here to go to the solution.)</a></p>
<div id="annotations-and-reference-lines" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Annotations and reference lines<a href="eda.html#annotations-and-reference-lines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We sometimes wish to add text or symbols to plots, for instance to highlight interesting observations. Consider the following time series plot of daily morning gold prices, based on the <code>gold</code> data from the <code>forecast</code> package:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="eda.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb230-2"><a href="eda.html#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gold)</span></code></pre></div>
<p>There is a sharp spike a few weeks before day 800, which is due to an incorrect value in the data series. We’d like to add a note about that to the plot. First, we wish to find out on which day the spike appears. This can be done by checking the data manually or using some code:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="eda.html#cb231-1" aria-hidden="true" tabindex="-1"></a>spike_date <span class="ot">&lt;-</span> <span class="fu">which.max</span>(gold)</span></code></pre></div>
<p>To add a circle around that point, we add a call to <code>annotate</code> to the plot:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="eda.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gold) <span class="sc">+</span></span>
<span id="cb232-2"><a href="eda.html#cb232-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">x =</span> spike_date, <span class="at">y =</span> gold[spike_date], </span>
<span id="cb232-3"><a href="eda.html#cb232-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb232-4"><a href="eda.html#cb232-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb232-5"><a href="eda.html#cb232-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>)</span></code></pre></div>
<p><code>annotate</code> can be used to annotate the plot with both geometrical objects and text (and can therefore be used as an alternative to <code>geom_text</code>).</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc3" class="exercise"><strong>Exercise 4.11  </strong></span>Using the figure created above and the documentation for <code>annotate</code>, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Add the text “Incorrect value” next to the circle.</p></li>
<li><p>Create a second plot where the incorrect value has been removed.</p></li>
<li><p>Read the documentation for the geom <code>geom_hline</code>. Use it to add a red reference line to the plot, at <span class="math inline">\(y=400\)</span>.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions3">(Click here to go to the solution.)</a></p>
</div>
<div id="longitudinal-data" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Longitudinal data<a href="eda.html#longitudinal-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Multiple time series with identical time points, known as longitudinal data or panel data, are common in many fields. One example of this is given by the <code>elecdaily</code> time series from the <code>fpp2</code> package, which contains information about electricity demand in Victoria, Australia during 2014. As with a single time series, we can plot these data using <code>autoplot</code>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="eda.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb233-2"><a href="eda.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily)</span></code></pre></div>
<p>In this case, it is probably a good idea to facet the data, i.e. to plot each series in a different figure:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="eda.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elecdaily, <span class="at">facets =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc4" class="exercise"><strong>Exercise 4.12  </strong></span>Make the following changes to the <code>autoplot(elecdaily, facets = TRUE)</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Remove the <code>WorkDay</code> variable from the plot (it describes whether or not a given date is a workday, and while it is useful for modelling purposes, we do not wish to include it in our figure).</p></li>
<li><p>Add smoothed trend lines to the time series plots.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions4">(Click here to go to the solution.)</a></p>
</div>
<div id="path-plots" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Path plots<a href="eda.html#path-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another option for plotting multiple time series is path plots. A path plot is a scatterplot where the points are connected with lines in the order they appear in the data (which, for time series data, should correspond to time). The lines and points can be coloured to represent time.</p>
<p>To make a path plot of Temperature versus Demand for the <code>elecdaily</code> data, we first convert the time series object to a data frame and create a scatterplot:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="eda.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb235-2"><a href="eda.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(elecdaily), <span class="fu">aes</span>(Temperature, Demand)) <span class="sc">+</span></span>
<span id="cb235-3"><a href="eda.html#cb235-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>Next, we connect the points by lines using the <code>geom_path</code> geom:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="eda.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(elecdaily), <span class="fu">aes</span>(Temperature, Demand)) <span class="sc">+</span></span>
<span id="cb236-2"><a href="eda.html#cb236-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb236-3"><a href="eda.html#cb236-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>()</span></code></pre></div>
<p>The resulting figure is quite messy. Using colour to indicate the passing of time helps a little. For this, we need to add the day of the year to the data frame. To get the values right, we use <code>nrow</code>, which gives us the number of rows in the data frame.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="eda.html#cb237-1" aria-hidden="true" tabindex="-1"></a>elecdaily2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(elecdaily)</span>
<span id="cb237-2"><a href="eda.html#cb237-2" aria-hidden="true" tabindex="-1"></a>elecdaily2<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(elecdaily2)</span>
<span id="cb237-3"><a href="eda.html#cb237-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb237-4"><a href="eda.html#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elecdaily2, <span class="fu">aes</span>(Temperature, Demand, <span class="at">colour =</span> day)) <span class="sc">+</span></span>
<span id="cb237-5"><a href="eda.html#cb237-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb237-6"><a href="eda.html#cb237-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>()</span></code></pre></div>
<p>It becomes clear from the plot that temperatures were the highest at the beginning of the year and lower in the winter months (July-August).</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc5" class="exercise"><strong>Exercise 4.13  </strong></span>Make the following changes to the plot you created above:</p>
<ol style="list-style-type: decimal">
<li><p>Decrease the size of the points.</p></li>
<li><p>Add text annotations showing the dates of the highest and lowest temperatures, next to the corresponding points in the figure.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions5">(Click here to go to the solution.)</a></p>
</div>
<div id="spaghetti-plots" class="section level3 hasAnchor" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> Spaghetti plots<a href="eda.html#spaghetti-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In cases where we’ve observed multiple subjects over time, we often wish to visualise their individual time series together using so-called spaghetti plots. With <code>ggplot2</code> this is done using the <code>geom_line</code> geom. To illustrate this, we use the <code>Oxboys</code> data from the <code>nlme</code> package, showing the heights of 26 boys over time.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="eda.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb238-2"><a href="eda.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height, <span class="at">group =</span> Subject)) <span class="sc">+</span> </span>
<span id="cb238-3"><a href="eda.html#cb238-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb238-4"><a href="eda.html#cb238-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span></code></pre></div>
<p>The first two <code>aes</code> arguments specify the x and y-axes, and the third specifies that there should be one line per subject (i.e. per boy) rather than a single line interpolating all points. The latter would be a rather useless figure that looks like this:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="eda.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height)) <span class="sc">+</span> </span>
<span id="cb239-2"><a href="eda.html#cb239-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb239-3"><a href="eda.html#cb239-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb239-4"><a href="eda.html#cb239-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;A terrible plot&quot;</span>)</span></code></pre></div>
<p>Returning to the original plot, if we wish to be able to identify which time series corresponds to which boy, we can add a colour aesthetic:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="eda.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height, <span class="at">group =</span> Subject, <span class="at">colour =</span> Subject)) <span class="sc">+</span> </span>
<span id="cb240-2"><a href="eda.html#cb240-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb240-3"><a href="eda.html#cb240-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span></code></pre></div>
<p>Note that the boys are ordered by height, rather than subject number, in the legend.</p>
<p>Now, imagine that we wish to add a trend line describing the general growth trend for all boys. The growth appears approximately linear, so it seems sensible to use <code>geom_smooth(method = "lm")</code> to add the trend:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="eda.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Oxboys, <span class="fu">aes</span>(age, height, <span class="at">group =</span> Subject, <span class="at">colour =</span> Subject)) <span class="sc">+</span> </span>
<span id="cb241-2"><a href="eda.html#cb241-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb241-3"><a href="eda.html#cb241-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb241-4"><a href="eda.html#cb241-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Unfortunately, because we have specified in the aesthetics that the data should be grouped by <code>Subject</code>, <code>geom_smooth</code> produces one trend line for each boy. The “problem” is that when we specify an aesthetic in the <code>ggplot</code> call, it is used for all geoms.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc6" class="exercise"><strong>Exercise 4.14  </strong></span>Figure out how to produce a spaghetti plot of the <code>Oxboys</code> data with a single red trend line based on the data from all 26 boys.</p>
</div>
<p><a href="solutions.html#ch4solutions6">(Click here to go to the solution.)</a></p>
</div>
<div id="stlsec" class="section level3 hasAnchor" number="4.6.5">
<h3><span class="header-section-number">4.6.5</span> Seasonal plots and decompositions<a href="eda.html#stlsec" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>forecast</code> package includes a number of useful functions when working with time series. One of them is <code>ggseasonplot</code>, which allows us to easily create a spaghetti plot of different periods of a time series with seasonality, i.e. with patterns that repeat seasonally over time. It works similar to the <code>autoplot</code> function, in that it replaces the <code>ggplot(data, aes) + geom</code> part of the code.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="eda.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb242-2"><a href="eda.html#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb242-3"><a href="eda.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(a10)</span></code></pre></div>
<p>This function is very useful when visually inspecting seasonal patterns.</p>
<p>The <code>year.labels</code> and <code>year.labels.left</code> arguments removes the legend in favour of putting the years at the end and beginning of the lines:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="eda.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(a10, <span class="at">year.labels =</span> <span class="cn">TRUE</span>, <span class="at">year.labels.left =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>As always, we can add more things to our plot if we like:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="eda.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(a10, <span class="at">year.labels =</span> <span class="cn">TRUE</span>, <span class="at">year.labels.left =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb244-2"><a href="eda.html#cb244-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sales ($ million)&quot;</span>) <span class="sc">+</span></span>
<span id="cb244-3"><a href="eda.html#cb244-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Seasonal plot of anti-diabetic drug sales&quot;</span>)</span></code></pre></div>
<p>When working with seasonal time series, it is common to decompose the series into a seasonal component, a trend component and a remainder. In R, this is typically done using the <code>stl</code> function, which uses repeated LOESS smoothing to decompose the series. There is an <code>autoplot</code> function for <code>stl</code> objects:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="eda.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">stl</span>(a10, <span class="at">s.window =</span> <span class="dv">365</span>))</span></code></pre></div>
<p>This plot can too be manipulated in the same way as other <code>ggplot</code> objects. You can access the different parts of the decomposition as follows:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="eda.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stl</span>(a10, <span class="at">s.window =</span> <span class="dv">365</span>)<span class="sc">$</span>time.series[,<span class="st">&quot;seasonal&quot;</span>]</span>
<span id="cb246-2"><a href="eda.html#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stl</span>(a10, <span class="at">s.window =</span> <span class="dv">365</span>)<span class="sc">$</span>time.series[,<span class="st">&quot;trend&quot;</span>]</span>
<span id="cb246-3"><a href="eda.html#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stl</span>(a10, <span class="at">s.window =</span> <span class="dv">365</span>)<span class="sc">$</span>time.series[,<span class="st">&quot;remainder&quot;</span>]</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc7" class="exercise"><strong>Exercise 4.15  </strong></span>Investigate the <code>writing</code> dataset from the <code>fma</code> package graphically. Make a time series plot with a smoothed trend line, a seasonal plot and an <code>stl</code>-decomposition plot. Add appropriate plot titles and labels to the axes. Can you see any interesting patterns?</p>
</div>
<p><a href="solutions.html#ch4solutions7">(Click here to go to the solution.)</a></p>
</div>
<div id="detecting-changepoints" class="section level3 hasAnchor" number="4.6.6">
<h3><span class="header-section-number">4.6.6</span> Detecting changepoints<a href="eda.html#detecting-changepoints" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>changepoint</code> package contains a number of methods for detecting <em>changepoints</em> in time series, i.e. time points at which either the mean or the variance of the series changes. Finding changepoints can be important for detecting changes in the process underlying the time series. The <code>ggfortify</code> package extends <code>ggplot2</code> by adding <code>autoplot</code> functions for a variety of tools, including those in <code>changepoint</code>. Let’s install the packages:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="eda.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;changepoint&quot;</span>, <span class="st">&quot;ggfortify&quot;</span>))</span></code></pre></div>
<p>We can now look at some examples with the anti-diabetic drug sales data:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="eda.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb248-2"><a href="eda.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb248-3"><a href="eda.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(changepoint)</span>
<span id="cb248-4"><a href="eda.html#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb248-5"><a href="eda.html#cb248-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-6"><a href="eda.html#cb248-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the time series:</span></span>
<span id="cb248-7"><a href="eda.html#cb248-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10)</span>
<span id="cb248-8"><a href="eda.html#cb248-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-9"><a href="eda.html#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the seasonal part and plot the series again:</span></span>
<span id="cb248-10"><a href="eda.html#cb248-10" aria-hidden="true" tabindex="-1"></a>a10_ns <span class="ot">&lt;-</span> a10 <span class="sc">-</span> <span class="fu">stl</span>(a10, <span class="at">s.window =</span> <span class="dv">365</span>)<span class="sc">$</span>time.series[,<span class="st">&quot;seasonal&quot;</span>]</span>
<span id="cb248-11"><a href="eda.html#cb248-11" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(a10_ns)</span>
<span id="cb248-12"><a href="eda.html#cb248-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-13"><a href="eda.html#cb248-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot points where there are changes in the mean:</span></span>
<span id="cb248-14"><a href="eda.html#cb248-14" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cpt.mean</span>(a10_ns))</span>
<span id="cb248-15"><a href="eda.html#cb248-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-16"><a href="eda.html#cb248-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Choosing a different method for finding changepoints</span></span>
<span id="cb248-17"><a href="eda.html#cb248-17" aria-hidden="true" tabindex="-1"></a><span class="co"># changes the result:</span></span>
<span id="cb248-18"><a href="eda.html#cb248-18" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cpt.mean</span>(a10_ns, <span class="at">method =</span> <span class="st">&quot;BinSeg&quot;</span>))</span>
<span id="cb248-19"><a href="eda.html#cb248-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-20"><a href="eda.html#cb248-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot points where there are changes in the variance:</span></span>
<span id="cb248-21"><a href="eda.html#cb248-21" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cpt.var</span>(a10_ns))</span>
<span id="cb248-22"><a href="eda.html#cb248-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-23"><a href="eda.html#cb248-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot points where there are changes in either the mean or</span></span>
<span id="cb248-24"><a href="eda.html#cb248-24" aria-hidden="true" tabindex="-1"></a><span class="co"># the variance:</span></span>
<span id="cb248-25"><a href="eda.html#cb248-25" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cpt.meanvar</span>(a10_ns))</span></code></pre></div>
<p>As you can see, the different methods from <code>changepoint</code> all yield different results. The results for changes in the mean are a bit dubious - which isn’t all that strange as we are using a method that looks for jumps in the mean on a time series where the increase actually is more or less continuous. The changepoint for the variance looks more reliable - there is a clear change towards the end of the series where the sales become more volatile. We won’t go into details about the different methods here, but mention that the documentation at <code>?cpt.mean</code>, <code>?cpt.var</code>, and <code>?cpt.meanvar</code> contains descriptions of and references for the available methods.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc75" class="exercise"><strong>Exercise 4.16  </strong></span>Are there any changepoints for variance in the <code>Demand</code> time series in <code>elecdaily</code>? Can you explain why the behaviour of the series changes?</p>
</div>
<p><a href="solutions.html#ch4solutions75">(Click here to go to the solution.)</a></p>
</div>
<div id="interactivets" class="section level3 hasAnchor" number="4.6.7">
<h3><span class="header-section-number">4.6.7</span> Interactive time series plots<a href="eda.html#interactivets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>plotly</code> packages can be used to create interactive time series plots. As before, you create a <code>ggplot2</code> object as usual, assigning it to a variable and then call the <code>ggplotly</code> function. Here is an example with the <code>elecdaily</code> data:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="eda.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb249-2"><a href="eda.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb249-3"><a href="eda.html#cb249-3" aria-hidden="true" tabindex="-1"></a>myPlot <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(elecdaily[,<span class="st">&quot;Demand&quot;</span>])</span>
<span id="cb249-4"><a href="eda.html#cb249-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-5"><a href="eda.html#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(myPlot)</span></code></pre></div>
<p>When you hover the mouse pointer over a point, a box appears, displaying information about that data point. Unfortunately, the date formatting isn’t great in this example - dates are shown as weeks with decimal points. We’ll see how to fix this in Section <a href="messychapter.html#datetime">5.6</a>.</p>
</div>
</div>
<div id="polar" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Using polar coordinates<a href="eda.html#polar" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most plots are made using <em>Cartesian coordinates systems</em>, in which the axes are orthogonal to each other and values are placed in an even spacing along each axis. In some cases, nonlinear axes (e.g. log-transformed) are used instead, as we have already seen.</p>
<p>Another option is to use a <em>polar</em> coordinate system, in which positions are specified using an angle and a (radial) distance from the origin. Here is an example of a polar scatterplot:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="eda.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(sleep_rem, sleep_total, <span class="at">colour =</span> vore)) <span class="sc">+</span> </span>
<span id="cb250-2"><a href="eda.html#cb250-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb250-3"><a href="eda.html#cb250-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;REM sleep (circular axis)&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-4"><a href="eda.html#cb250-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Total sleep time (radial axis)&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-5"><a href="eda.html#cb250-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>()</span></code></pre></div>
<div id="visualising-periodic-data" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Visualising periodic data<a href="eda.html#visualising-periodic-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Polar coordinates are particularly useful when the data is periodic. Consider for instance the following dataset, describing monthly weather averages for Cape Town, South Africa:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="eda.html#cb251-1" aria-hidden="true" tabindex="-1"></a>Cape_Town_weather <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb251-2"><a href="eda.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="at">Month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb251-3"><a href="eda.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="at">Temp_C =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">13</span>, <span class="dv">13</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">20</span>),</span>
<span id="cb251-4"><a href="eda.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="at">Rain_mm =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">70</span>, <span class="dv">50</span>, <span class="dv">40</span>, <span class="dv">20</span>, <span class="dv">20</span>),</span>
<span id="cb251-5"><a href="eda.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="at">Sun_h =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>))</span></code></pre></div>
<p>We can visualise the monthly average temperature using lines in a Cartesian coordinate system:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="eda.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Cape_Town_weather, <span class="fu">aes</span>(Month, Temp_C)) <span class="sc">+</span></span>
<span id="cb252-2"><a href="eda.html#cb252-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>()</span></code></pre></div>
<p>What this plot doesn’t show is that the 12th month and the 1st month actually are consecutive months. If we instead use polar coordinates, this becomes clearer:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="eda.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Cape_Town_weather, <span class="fu">aes</span>(Month, Temp_C)) <span class="sc">+</span></span>
<span id="cb253-2"><a href="eda.html#cb253-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb253-3"><a href="eda.html#cb253-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>()</span></code></pre></div>
<p>To improve the presentation, we can change the scale of the x-axis (i.e. the circular axis) so that January and December aren’t plotted at the same angle:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="eda.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Cape_Town_weather, <span class="fu">aes</span>(Month, Temp_C)) <span class="sc">+</span></span>
<span id="cb254-2"><a href="eda.html#cb254-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb254-3"><a href="eda.html#cb254-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb254-4"><a href="eda.html#cb254-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">12</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc75b" class="exercise"><strong>Exercise 4.17  </strong></span>In the plot that we just created, the last and first month of the year aren’t connected. You can fix manually this by adding a cleverly designed faux data point to <code>Cape_Town_weather</code>. How?</p>
</div>
<p><a href="solutions.html#ch4solutions75b">(Click here to go to the solution.)</a></p>
</div>
<div id="pie-charts" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Pie charts<a href="eda.html#pie-charts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider the stacked bar chart that we plotted in Section <a href="thebasics.html#catdata2">2.6</a>:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="eda.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="fu">factor</span>(<span class="dv">1</span>), <span class="at">fill =</span> vore)) <span class="sc">+</span></span>
<span id="cb255-2"><a href="eda.html#cb255-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>()</span></code></pre></div>
<p>What would happen if we plotted this figure in a polar coordinate system instead? If we map the height of the bars (the y-axis of the Cartesian coordinate system) to both the angle and the radial distance, we end up with a pie chart:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="eda.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(<span class="fu">factor</span>(<span class="dv">1</span>), <span class="at">fill =</span> vore)) <span class="sc">+</span></span>
<span id="cb256-2"><a href="eda.html#cb256-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb256-3"><a href="eda.html#cb256-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p>There are many arguments against using pie charts for visualisations. Most boil down to the fact that the same information is easier to interpret when conveyed as a bar chart. This is at least partially due to the fact that most people are more used to reading plots in Cartesian coordinates than in polar coordinates.</p>
<p>If we make a similar transformation of a grouped bar chart, we get a different type of pie chart, in which the height of the bars are mapped to both the angle and the radial distance<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="eda.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cartestian bar chart:</span></span>
<span id="cb257-2"><a href="eda.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(vore, <span class="at">fill =</span> vore)) <span class="sc">+</span></span>
<span id="cb257-3"><a href="eda.html#cb257-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>()</span>
<span id="cb257-4"><a href="eda.html#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="eda.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Polar bar chart:</span></span>
<span id="cb257-6"><a href="eda.html#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(vore, <span class="at">fill =</span> vore)) <span class="sc">+</span></span>
<span id="cb257-7"><a href="eda.html#cb257-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb257-8"><a href="eda.html#cb257-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>()</span></code></pre></div>
</div>
</div>
<div id="visualising-multiple-variables" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Visualising multiple variables<a href="eda.html#visualising-multiple-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="scatterplotmatrix" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> Scatterplot matrices<a href="eda.html#scatterplotmatrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we have a large enough number of <code>numeric</code> variables in our data, plotting scatterplots of all pairs of variables becomes tedious. Luckily there are some R functions that speed up this process.</p>
<p>The <code>GGally</code> package is an extension to <code>ggplot2</code> which contains several functions for plotting multivariate data. They work similarly to the <code>autoplot</code> functions that we have used in previous sections. One of these is <code>ggpairs</code>, which creates a scatterplot matrix, a grid with scatterplots of all pairs of variables in <code>data</code>. In addition, it also plots density estimates (along the diagonal) and shows the (Pearson) correlation for each pair. Let’s start by installing <code>GGally</code>:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="eda.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;GGally&quot;</span>)</span></code></pre></div>
<p>To create a scatterplot matrix for the <code>airquality</code> dataset, simply write:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="eda.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb259-2"><a href="eda.html#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(airquality)</span></code></pre></div>
<p>(Enlarging your Plot window can make the figure look better.)</p>
<p>If we want to create a scatterplot matrix but only want to include some of the variables in a dataset, we can do so by providing a vector with variable names. Here is an example for the animal sleep data <code>msleep</code>:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="eda.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(msleep[, <span class="fu">c</span>(<span class="st">&quot;sleep_total&quot;</span>, <span class="st">&quot;sleep_rem&quot;</span>, <span class="st">&quot;sleep_cycle&quot;</span>, <span class="st">&quot;awake&quot;</span>,</span>
<span id="cb260-2"><a href="eda.html#cb260-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;brainwt&quot;</span>, <span class="st">&quot;bodywt&quot;</span>)])</span></code></pre></div>
<p>Optionally, if we wish to create a scatterplot involving all <code>numeric</code> variables, we can replace the vector with variable names with some R code that extracts the columns containing <code>numeric</code> variables:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="eda.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(msleep[, <span class="fu">which</span>(<span class="fu">sapply</span>(msleep, class) <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>)])</span></code></pre></div>
<p>(You’ll learn more about the <code>sapply</code> function in Section <a href="progchapter.html#vectorloops">6.5</a>.)</p>
<p>The resulting plot is identical to the previous one, because the list of names contained all <code>numeric</code> variables. The grab-all-numeric-variables approach is often convenient, because we don’t have to write all the variable names. On the other hand, it’s not very helpful in case we only want to include some of the <code>numeric</code> variables.</p>
<p>If we include a categorical variable in the list of variables (such as the feeding behaviour <code>vore</code>), the matrix will include a bar plot of the categorical variable as well as boxplots and facetted histograms to show differences between different categories in the continuous variables:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="eda.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(msleep[, <span class="fu">c</span>(<span class="st">&quot;vore&quot;</span>, <span class="st">&quot;sleep_total&quot;</span>, <span class="st">&quot;sleep_rem&quot;</span>, <span class="st">&quot;sleep_cycle&quot;</span>,</span>
<span id="cb262-2"><a href="eda.html#cb262-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;awake&quot;</span>, <span class="st">&quot;brainwt&quot;</span>, <span class="st">&quot;bodywt&quot;</span>)])</span></code></pre></div>
<p>Alternatively, we can use a categorical variable to colour points and density estimates using <code>aes(colour = ...)</code>. The syntax for this is follows the same pattern as that for a standard <code>ggplot</code> call - <code>ggpairs(data, aes)</code>. The only exception is that if the categorical variable is not included in the <code>data</code> argument, we much specify which data frame it belongs to:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="eda.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(msleep[, <span class="fu">c</span>(<span class="st">&quot;sleep_total&quot;</span>, <span class="st">&quot;sleep_rem&quot;</span>, <span class="st">&quot;sleep_cycle&quot;</span>, <span class="st">&quot;awake&quot;</span>,</span>
<span id="cb263-2"><a href="eda.html#cb263-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;brainwt&quot;</span>, <span class="st">&quot;bodywt&quot;</span>)],</span>
<span id="cb263-3"><a href="eda.html#cb263-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">colour =</span> msleep<span class="sc">$</span>vore, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p>As a side note, if all variables in your data frame are <code>numeric</code>, and if you only are looking for a quick-and-dirty scatterplot matrix without density estimates and correlations, you can also use the base R <code>plot</code>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="eda.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(airquality)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc16" class="exercise"><strong>Exercise 4.18  </strong></span>Create a scatterplot matrix for all <code>numeric</code> variables in <code>diamonds</code>. Differentiate different cuts by colour. Add a suitable title to the plot. (<code>diamonds</code> is a fairly large dataset, and it may take a minute or so for R to create the plot.)</p>
</div>
<p><a href="solutions.html#ch4solutions16">(Click here to go to the solution.)</a></p>
</div>
<div id="d-scatterplots" class="section level3 hasAnchor" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> 3D scatterplots<a href="eda.html#d-scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>plotly</code> package lets us make three-dimensional scatterplots with the <code>plot_ly</code> function, which can be a useful alternative to scatterplot matrices in some cases. Here is an example using the <code>airquality</code> data:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="eda.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb265-2"><a href="eda.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(airquality, <span class="at">x =</span> <span class="sc">~</span>Ozone, <span class="at">y =</span> <span class="sc">~</span>Wind, <span class="at">z =</span> <span class="sc">~</span>Temp,</span>
<span id="cb265-3"><a href="eda.html#cb265-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">~</span><span class="fu">factor</span>(Month))</span></code></pre></div>
<p>Note that you can drag and rotate the plot, to see it from different angles.</p>
</div>
<div id="correlograms" class="section level3 hasAnchor" number="4.8.3">
<h3><span class="header-section-number">4.8.3</span> Correlograms<a href="eda.html#correlograms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Scatterplot matrices are not a good choice when we have too many variables, partially because the plot window needs to be very large to fit all variables and partially because it becomes difficult to get a good overview of the data. In such cases, a correlogram, where the strength of the correlation between each pair of variables is plotted instead of scatterplots, can be used instead. It is effectively a visualisation of the correlation matrix of the data, where the strengths and signs of the correlations are represented by different colours.</p>
<p>The <code>GGally</code> package contains the function <code>ggcorr</code>, which can be used to create a correlogram:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="eda.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(msleep[, <span class="fu">c</span>(<span class="st">&quot;sleep_total&quot;</span>, <span class="st">&quot;sleep_rem&quot;</span>, <span class="st">&quot;sleep_cycle&quot;</span>, <span class="st">&quot;awake&quot;</span>,</span>
<span id="cb266-2"><a href="eda.html#cb266-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;brainwt&quot;</span>, <span class="st">&quot;bodywt&quot;</span>)])</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc17" class="exercise"><strong>Exercise 4.19  </strong></span>Using the <code>diamonds</code> dataset and the documentation for <code>ggcorr</code>, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Create a correlogram for all <code>numeric</code> variables in the dataset.</p></li>
<li><p>The Pearson correlation that <code>ggcorr</code> uses by default isn’t always the best choice. A commonly used alternative is the Spearman correlation. Change the type of correlation used to create the plot to the Spearman correlation.</p></li>
<li><p>Change the colour scale from a categorical scale with 5 categories.</p></li>
<li><p>Change the colours on the scale to go from yellow (low correlation) to black (high correlation).</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions17">(Click here to go to the solution.)</a></p>
</div>
<div id="adding-more-variables-to-scatterplots" class="section level3 hasAnchor" number="4.8.4">
<h3><span class="header-section-number">4.8.4</span> Adding more variables to scatterplots<a href="eda.html#adding-more-variables-to-scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have already seen how scatterplots can be used to visualise two continuous and one categorical variable by plotting the two continuous variables against each other and using the categorical variable to set the colours of the points. There are however more ways we can incorporate information about additional variables into a scatterplot.</p>
<p>So far, we have set three aesthetics in our scatterplots: <code>x</code>, <code>y</code> and <code>colour</code>. Two other important aesthetics are <code>shape</code> and <code>size</code>, which, as you’d expect, allow us to control the shape and size of the points. As a first example using the <code>msleep</code> data, we use feeding behaviour (<code>vore</code>) to set the shapes used for the points:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="eda.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">shape =</span> vore)) <span class="sc">+</span></span>
<span id="cb267-2"><a href="eda.html#cb267-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb267-3"><a href="eda.html#cb267-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>The plot looks a little nicer if we increase the <code>size</code> of the points:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="eda.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">shape =</span> vore, <span class="at">size =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb268-2"><a href="eda.html#cb268-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb268-3"><a href="eda.html#cb268-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>Another option is to let <code>size</code> represent a continuous variable, in what is known as a bubble plot:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="eda.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">colour =</span> vore,</span>
<span id="cb269-2"><a href="eda.html#cb269-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> bodywt)) <span class="sc">+</span></span>
<span id="cb269-3"><a href="eda.html#cb269-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb269-4"><a href="eda.html#cb269-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p>The size of each “bubble” now represents the weight of the animal. Because some animals are much heavier (i.e. have higher <code>bodywt</code> values) than most others, almost all points are quite small. There are a couple of things we can do to remedy this. First, we can transform <code>bodywt</code>, e.g. using the square root transformation <code>sqrt(bodywt)</code>, to decrease the differences between large and small animals. This can be done by adding <code>scale_size(trans = "sqrt")</code> to the plot. Second, we can also use <code>scale_size</code> to control the range of point sizes (e.g. from size 1 to size 20). This will cause some points to overlap, so we add <code>alpha = 0.5</code> to the geom, to make the points transparent:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="eda.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">colour =</span> vore,</span>
<span id="cb270-2"><a href="eda.html#cb270-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> bodywt)) <span class="sc">+</span></span>
<span id="cb270-3"><a href="eda.html#cb270-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb270-4"><a href="eda.html#cb270-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb270-5"><a href="eda.html#cb270-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">trans =</span> <span class="st">&quot;sqrt&quot;</span>)</span></code></pre></div>
<p>This produces a fairly nice-looking plot, but it’d look even better if we changed the axes labels and legend texts. We can change the legend text for the size scale by adding the argument <code>name</code> to <code>scale_size</code>. Including a <code>\n</code> in the text lets us create a line break - you’ll learn more tricks like that in Section <a href="messychapter.html#strings">5.5</a>. Similarly, we can use <code>scale_colour_discrete</code> to change the legend text for the colours:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="eda.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(brainwt, sleep_total, <span class="at">colour =</span> vore,</span>
<span id="cb271-2"><a href="eda.html#cb271-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> bodywt)) <span class="sc">+</span></span>
<span id="cb271-3"><a href="eda.html#cb271-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb271-4"><a href="eda.html#cb271-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;log(Brain weight)&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-5"><a href="eda.html#cb271-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Sleep total (h)&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-6"><a href="eda.html#cb271-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb271-7"><a href="eda.html#cb271-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">trans =</span> <span class="st">&quot;sqrt&quot;</span>,</span>
<span id="cb271-8"><a href="eda.html#cb271-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">name =</span> <span class="st">&quot;Square root of</span><span class="sc">\n</span><span class="st">body weight&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-9"><a href="eda.html#cb271-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Feeding behaviour&quot;</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc18" class="exercise"><strong>Exercise 4.20  </strong></span>Using the bubble plot created above, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Replace <code>colour = vore</code> in the <code>aes</code> by <code>fill = vore</code> and add <code>colour = "black", shape = 21</code> to <code>geom_point</code>. What happens?</p></li>
<li><p>Use <code>ggplotly</code> to create an interactive version of the bubble plot above, where variable information and the animal name are displayed when you hover a point.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions18">(Click here to go to the solution.)</a></p>
</div>
<div id="overplotting" class="section level3 hasAnchor" number="4.8.5">
<h3><span class="header-section-number">4.8.5</span> Overplotting<a href="eda.html#overplotting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s make a scatterplot of <code>table</code> versus <code>depth</code> based on the <code>diamonds</code> dataset:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="eda.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb272-2"><a href="eda.html#cb272-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()</span></code></pre></div>
<p>This plot is cluttered. There are too many points, which makes it difficult to see if, for instance, high <code>table</code> values are more common than low <code>table</code> values. In this section, we’ll look at some ways to deal with this problem, known as overplotting.</p>
<p>The first thing we can try is to decrease the point size:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="eda.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb273-2"><a href="eda.html#cb273-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p>This helps a little, but now the outliers become a bit difficult to spot. We can try changing the opacity using <code>alpha</code> instead:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="eda.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb274-2"><a href="eda.html#cb274-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p>This is also better than the original plot, but neither plot is great. Instead of plotting each individual point, maybe we can try plotting the counts or densities in different regions of the plot instead? Effectively, this would be a 2D version of a histogram. There are several ways of doing this in <code>ggplot2</code>.</p>
<p>First, we bin the points and count the numbers in each bin, using <code>geom_bin2d</code>:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="eda.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb275-2"><a href="eda.html#cb275-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bin2d</span>()</span></code></pre></div>
<p>By default, <code>geom_bin2d</code> uses 30 bins. Increasing that number can sometimes give us a better idea about the distribution of the data:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="eda.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb276-2"><a href="eda.html#cb276-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>If you prefer, you can get a similar plot with hexagonal bins by using <code>geom_hex</code> instead:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="eda.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb277-2"><a href="eda.html#cb277-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hex</span>(<span class="at">bins =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>As an alternative to bin counts, we could create a 2-dimensional density estimate and create a contour plot showing the levels of the density:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="eda.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth)) <span class="sc">+</span></span>
<span id="cb278-2"><a href="eda.html#cb278-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_density_2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> ..level..), <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>,</span>
<span id="cb278-3"><a href="eda.html#cb278-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p>The <code>fill = ..level..</code> bit above probably looks a little strange to you. It means that an internal function (the level of the contours) is used to choose the fill colours. It also means that we’ve reached a point where we’re reaching deep into the depths of <code>ggplot2</code>!</p>
<p>We can use a similar approach to show a summary statistic for a third variable in a plot. For instance, we may want to plot the average price as a function of <code>table</code> and <code>depth</code>. This is called a tile plot:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="eda.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(table, depth, <span class="at">z =</span> price)) <span class="sc">+</span></span>
<span id="cb279-2"><a href="eda.html#cb279-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_tile</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;summary_2d&quot;</span>, <span class="at">fun =</span> mean) <span class="sc">+</span></span>
<span id="cb279-3"><a href="eda.html#cb279-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggtitle</span>(<span class="st">&quot;Mean prices for diamonds with different depths and</span></span>
<span id="cb279-4"><a href="eda.html#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="st">             tables&quot;</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc19" class="exercise"><strong>Exercise 4.21  </strong></span>The following tasks involve the <code>diamonds</code> dataset:</p>
<ol style="list-style-type: decimal">
<li><p>Create a tile plot of <code>table</code> versus <code>depth</code>, showing the highest price for a diamond in each bin.</p></li>
<li><p>Create a bin plot of <code>carat</code> versus <code>price</code>. What type of diamonds have the highest bin counts?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions19">(Click here to go to the solution.)</a></p>
</div>
<div id="categorical-data" class="section level3 hasAnchor" number="4.8.6">
<h3><span class="header-section-number">4.8.6</span> Categorical data<a href="eda.html#categorical-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When visualising a pair of categorical variables, plots similar to those in the previous section prove to be useful. One way of doing this is to use the <code>geom_count</code> geom. We illustrate this with an example using <code>diamonds</code>, showing how common different combinations of colours and cuts are:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="eda.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(color, cut)) <span class="sc">+</span></span>
<span id="cb280-2"><a href="eda.html#cb280-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_count</span>()</span></code></pre></div>
<p>However, it is often better to use colour rather than point size to visualise counts, which we can do using a tile plot. First, we have to compute the counts though, using <code>aggregate</code>. We now wish to have two grouping variables, <code>color</code> and <code>cut</code>, which we can put on the right-hand side of the formula as follows:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="eda.html#cb281-1" aria-hidden="true" tabindex="-1"></a>diamonds2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(carat <span class="sc">~</span> cut <span class="sc">+</span> color, <span class="at">data =</span> diamonds,</span>
<span id="cb281-2"><a href="eda.html#cb281-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> length)</span>
<span id="cb281-3"><a href="eda.html#cb281-3" aria-hidden="true" tabindex="-1"></a>diamonds2</span></code></pre></div>
<p><code>diamonds2</code> is now a data frame containing the different combinations of <code>color</code> and <code>cut</code> along with counts of how many diamonds belong to each combination (labelled <code>carat</code>, because we put <code>carat</code> in our formula). Let’s change the name of the last column from <code>carat</code> to <code>Count</code>:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="eda.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diamonds2)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Count&quot;</span></span></code></pre></div>
<p>Next, we can plot the counts using <code>geom_tile</code>:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="eda.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(color, cut, <span class="at">fill =</span> Count)) <span class="sc">+</span></span>
<span id="cb283-2"><a href="eda.html#cb283-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>()</span></code></pre></div>
<p>It is also possible to combine point size and colours:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="eda.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds2, <span class="fu">aes</span>(color, cut, <span class="at">colour =</span> Count, <span class="at">size =</span> Count)) <span class="sc">+</span></span>
<span id="cb284-2"><a href="eda.html#cb284-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_count</span>()</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc20" class="exercise"><strong>Exercise 4.22  </strong></span>Using the <code>diamonds</code> dataset, do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Use a plot to find out what the most common combination of cut and clarity is.</p></li>
<li><p>Use a plot to find out which combination of cut and clarity has the highest average price.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions20">(Click here to go to the solution.)</a></p>
</div>
<div id="putting-it-all-together" class="section level3 hasAnchor" number="4.8.7">
<h3><span class="header-section-number">4.8.7</span> Putting it all together<a href="eda.html#putting-it-all-together" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the next two exercises, you will repeat what you have learned so far by investigating the <code>gapminder</code> and <code>planes</code> datasets. First, load the corresponding libraries and have a look at the documentation for each dataset:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="eda.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;gapminder&quot;</span>)</span>
<span id="cb285-2"><a href="eda.html#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb285-3"><a href="eda.html#cb285-3" aria-hidden="true" tabindex="-1"></a>?gapminder</span>
<span id="cb285-4"><a href="eda.html#cb285-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-5"><a href="eda.html#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb285-6"><a href="eda.html#cb285-6" aria-hidden="true" tabindex="-1"></a>?planes</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc21" class="exercise"><strong>Exercise 4.23  </strong></span>Do the following using the <code>gapminder</code> dataset:</p>
<ol style="list-style-type: decimal">
<li><p>Create a scatterplot matrix showing life expectancy, population and GDP per capita for all countries, using the data from the year 2007. Use colours to differentiate countries from different continents. Note: you’ll probably need to add the argument <code>upper = list(continuous = "na")</code> when creating the scatterplot matrix. By default, correlations are shown above the diagonal, but the fact that there only are two countries from Oceania will cause a problem there - at least 3 points are needed for a correlation test.</p></li>
<li><p>Create an interactive bubble plot, showing information about each country when you hover the points. Use data from the year 2007. Put log(GDP per capita) on the x-axis and life expectancy on the y-axis. Let population determine point size. Plot each country in a different colour and facet by continent.
Tip: the <code>gapminder</code> package provides a pretty colour scheme for different countries, called <code>country_colors</code>. You can use that scheme by adding <code>scale_colour_manual(values = country_colors)</code> to your plot.</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions21">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch4exc22" class="exercise"><strong>Exercise 4.24  </strong></span>Use graphics to answer the following questions regarding the <code>planes</code> dataset:</p>
<ol style="list-style-type: decimal">
<li><p>What is the most common combination of manufacturer and plane type in the dataset?</p></li>
<li><p>Which combination of manufacturer and plane type has the highest average number of seats?</p></li>
<li><p>Do the numbers of seats on planes change over time? Which plane had the highest number of seats?</p></li>
<li><p>Does the type of engine used change over time?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions22">(Click here to go to the solution.)</a></p>
</div>
</div>
<div id="pca" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Principal component analysis<a href="eda.html#pca" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If there are many variables in your data, it can often be difficult to detect differences between groups or create a perspicuous visualisation. A useful tool in this context is <em>principal component analysis</em> (PCA, for short), which can reduce high-dimensional data to a lower number of variables that can be visualised in one or two scatterplots. The idea is to compute new variables, called <em>principal components</em>, that are linear combinations of the original variables<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>. These are constructed with two goals in mind: the principal components should capture as much of the variance in the data as possible, and each principal component should be uncorrelated to the other components. You can then plot the principal components to get a low-dimensional representation of your data, which hopefully captures most of its variation.</p>
<p>By design, the number of principal components computed are as many as the original number of variables, with the first having the largest variance, the second having the second largest variance, and so on. We hope that it will suffice to use just the first few of these to represent most of the variation in the data, but this is not guaranteed. Principal component analysis is more likely to yield a useful result if several variables are correlated.</p>
<p>To illustrate the principles of PCA we will use a dataset from Charytanowicz et al. (2010), containing measurements on wheat kernels for three varieties of wheat. A description of the variables is available at</p>
<p><a href="http://archive.ics.uci.edu/ml/datasets/seeds" class="uri">http://archive.ics.uci.edu/ml/datasets/seeds</a></p>
<p>We are interested to find out if these measurements can be used to distinguish between the varieties. The data is stored in a <code>.txt</code> file, which we import using <code>read.table</code> (which works just like <code>read.csv</code>, but is tailored to text files) and convert the <code>Variety</code> column to a categorical <code>factor</code> variable (which you’ll learn more about in Section <a href="messychapter.html#factors">5.4</a>):</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="eda.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is downloaded from the UCI Machine Learning Repository:</span></span>
<span id="cb286-2"><a href="eda.html#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="co"># http://archive.ics.uci.edu/ml/datasets/seeds</span></span>
<span id="cb286-3"><a href="eda.html#cb286-3" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb286-4"><a href="eda.html#cb286-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb286-5"><a href="eda.html#cb286-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb286-6"><a href="eda.html#cb286-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb286-7"><a href="eda.html#cb286-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>If we make a scatterplot matrix of all variables, it becomes evident that there are differences between the varieties, but that no single pair of variables is enough to separate them:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="eda.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb287-2"><a href="eda.html#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb287-3"><a href="eda.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>], <span class="fu">aes</span>(<span class="at">colour =</span> seeds<span class="sc">$</span>Variety, <span class="at">alpha =</span> <span class="fl">0.2</span>))</span></code></pre></div>
<p>Moreover, for presentation purposes, the amount of information in the scatterplot matrix is a bit overwhelming. It would be nice to be able to present the data in a single scatterplot, without losing too much information. We’ll therefore compute the principal components using the <code>prcomp</code> function. It is usually recommended that PCA is performed using standardised data, i.e. using data that has been scaled to have mean 0 and standard deviation 1. The reason for this is that it puts all variables on the same scale. If we don’t standardise our data then variables with a high variance will completely dominate the principal components. This isn’t desirable, as variance is affected by the scale of the measurements, meaning that the choice of measurement scale would influence the results (as an example, the variance of kernel length will be a million times greater if lengths are measured in millimetres instead of in metres).</p>
<p>We don’t have to standardise the data ourselves, but can let <code>prcomp</code> do that for us using the arguments <code>center = TRUE</code> (to get mean 0) and <code>scale. = TRUE</code> (to get standard deviation 1):</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="eda.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute principal components:</span></span>
<span id="cb288-2"><a href="eda.html#cb288-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(seeds[,<span class="sc">-</span><span class="dv">8</span>], <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To see the <em>loadings</em> of the components, i.e. how much each variable contributes to the components, simply type the name of the object <code>prcomp</code> created:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="eda.html#cb289-1" aria-hidden="true" tabindex="-1"></a>pca</span></code></pre></div>
<p>The first principal component is more or less a weighted average of all variables, but has stronger weights on <code>Area</code>, <code>Perimeter</code>, <code>Kernel_length</code>, <code>Kernel_width</code>, and <code>Groove_length</code>, all of which are measures of size. We can therefore interpret it as a size variable. The second component has higher loadings for <code>Compactness</code> and <code>Asymmetry</code>, meaning that it mainly measures those shape features. In Exercise <a href="eda.html#exr:ch4exc24">4.26</a> you’ll see how the loadings can be visualised in a <em>biplot</em>.</p>
<p>To see how much of the variance each component represents, use <code>summary</code>:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="eda.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code></pre></div>
<p>The first principal component accounts for 71.87 % of the variance, and the first three combined account for 98.67 %.</p>
<p>To visualise this, we can draw a <em>scree plot</em>, which shows the variance of each principal component - the total variance of the data is the sum of the variances of the principal components:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="eda.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(pca, <span class="at">type =</span> <span class="st">&quot;lines&quot;</span>)</span></code></pre></div>
<p>We can use this to choose how many principal components to use when visualising or summarising our data. In that case, we look for an “elbow”, i.e. a bend after which increases the number of components doesn’t increase the amount of variance explained much.</p>
<p>We can access the values of the principal components using <code>pca$x</code>. Let’s check that the first two components really are uncorrelated:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="eda.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>])</span></code></pre></div>
<p>In this case, almost all of the variance is summarised by the first two or three principal components. It appears that we have successfully reduced the data from 7 variables to 2-3, which should make visualisation much easier. The <code>ggfortify</code> package contains an <code>autoplot</code> function for PCA objects, that creates a scatterplot of the first two principal components:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="eda.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb293-2"><a href="eda.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> <span class="st">&quot;Variety&quot;</span>)</span></code></pre></div>
<p>That is much better! The groups are almost completely separated, which shows that the variables can be used to discriminate between the three varieties. The first principal component accounts for 71.87 % of the total variance in the data, and the second for 17.11 %.</p>
<p>If you like, you can plot other pairs of principal components than just components 1 and 2. In this case, component 3 may be of interest, as its variance is almost as high as that of component 2. You can specify which components to plot with the <code>x</code> and <code>y</code> arguments:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="eda.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2nd and 3rd PC:</span></span>
<span id="cb294-2"><a href="eda.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> <span class="st">&quot;Variety&quot;</span>,</span>
<span id="cb294-3"><a href="eda.html#cb294-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Here, the separation is nowhere near as clear as in the previous figure. In this particular example, plotting the first two principal components is the better choice.</p>
<p>Judging from these plots, it appears that the kernel measurements can be used to discriminate between the three varieties of wheat. In Chapters <a href="modchapter.html#modchapter">7</a> and <a href="mlchapter.html#mlchapter">9</a> you’ll learn how to use R to build models that can be used to do just that, e.g. by predicting which variety of wheat a kernel comes from given its measurements. If we wanted to build a statistical model that could be used for this purpose, we could use the original measurements. But we could also try using the first two principal components as the only input to the model. Principal component analysis is very useful as a pre-processing tool, used to create simpler models based on fewer variables (or ostensibly simpler, because the new variables are typically more difficult to interpret than the original ones).</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc23" class="exercise"><strong>Exercise 4.25  </strong></span>Use principal components on the <code>carat</code>, <code>x</code>, <code>y</code>, <code>z</code>, <code>depth</code>, and <code>table</code> variables in the <code>diamonds</code> data, and answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>How much of the total variance does the first principal component account for? How many components are needed to account for at least 90 % of the total variance?</p></li>
<li><p>Judging by the loadings, what do the first two principal components measure?</p></li>
<li><p>What is the correlation between the first principal component and <code>price</code>?</p></li>
<li><p>Can the first two principal components be used to distinguish between diamonds with different cuts?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions23">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch4exc24" class="exercise"><strong>Exercise 4.26  </strong></span>Return to the scatterplot of the first two principal components for the <code>seeds</code> data, created above. Adding the arguments <code>loadings = TRUE</code> and <code>loadings.label = TRUE</code> to the <code>autoplot</code> call creates a <em>biplot</em>, which shows the loadings for the principal components on top of the scatterplot. Create a biplot and compare the result to those obtained by looking at the loadings numerically. Do the conclusions from the two approaches agree?</p>
</div>
<p><a href="solutions.html#ch4solutions24">(Click here to go to the solution.)</a></p>
</div>
<div id="clustering" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> Cluster analysis<a href="eda.html#clustering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cluster analysis is concerned with grouping observations into groups, <em>clusters</em>, that in some sense are similar. Numerous methods are available for this task, approaching the problem from different angles. Many of these are available in the <code>cluster</code> package, which ships with R. In this section, we’ll look at a smorgasbord of clustering techniques.</p>
<div id="hierarchical-clustering" class="section level3 hasAnchor" number="4.10.1">
<h3><span class="header-section-number">4.10.1</span> Hierarchical clustering<a href="eda.html#hierarchical-clustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a first example where clustering can be of interest, we’ll consider the <code>votes.repub</code> data from <code>cluster</code>. It describes the proportion of votes for the Republican candidate in US presidential elections from 1856 to 1976 in 50 different states:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="eda.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb295-2"><a href="eda.html#cb295-2" aria-hidden="true" tabindex="-1"></a>?votes.repub</span>
<span id="cb295-3"><a href="eda.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(votes.repub)</span></code></pre></div>
<p>We are interested in finding subgroups - clusters - of states with similar voting patterns.</p>
<p>To find clusters of similar observations (states, in this case), we could start by assigning each observation to its own cluster. We’d then start with 50 clusters, one for each observation. Next, we could merge the two clusters that are the most similar, yielding 49 clusters, one of which consisted of two observations and 48 consisting of a single observation. We could repeat this process, merging the two most similar clusters in each iteration until only a single cluster was left. This would give us a <em>hierarchy</em> of clusters, which could be plotted in a tree-like structure, where observations from the same cluster would be one the same branch. Like this:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="eda.html#cb296-1" aria-hidden="true" tabindex="-1"></a>clusters_agnes <span class="ot">&lt;-</span> <span class="fu">agnes</span>(votes.repub)</span>
<span id="cb296-2"><a href="eda.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clusters_agnes, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>This type of plot is known as a <em>dendrogram</em>.</p>
<p>We’ve just used <code>agnes</code>, a function from <code>cluster</code> that can be used to carry out <em>hierarchical clustering</em> in the manner described above. There are a couple of things that need to be clarified, though.</p>
<p>First, how do we measure how similar two <span class="math inline">\(p\)</span>-dimensional observations <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> are? <code>agnes</code> provides two measures of distance between points:</p>
<ul>
<li><code>metric = "euclidean"</code> (the default), uses the Euclidean <span class="math inline">\(L_2\)</span> distance <span class="math inline">\(||x-y||=\sqrt{\sum_{i=1}^p(x_i-y_i)^2}\)</span>,</li>
<li><code>metric = "manhattan"</code>, uses the Manhattan <span class="math inline">\(L_1\)</span> distance <span class="math inline">\(||x-y||={\sum_{i=1}^p|x_i-y_i|}\)</span>.</li>
</ul>
<p>Note that neither of these will work create if you have categorical variables in your data. If all your variables are binary, i.e. categorical with two values, you can use <code>mona</code> instead of <code>agnes</code> for hierarchical clustering.</p>
<p>Second, how do we measure how similar two clusters of observations are? <code>agnes</code> offers a number of options here. Among them are:</p>
<ul>
<li><code>method = "average</code> (the default), unweighted average linkage, uses the average distance between points from the two clusters,</li>
<li><code>method = "single</code>, single linkage, uses the smallest distance between points from the two clusters,</li>
<li><code>method = "complete</code>, complete linkage, uses the largest distance between points from the two clusters,</li>
<li><code>method = "ward"</code>, Ward’s method, uses the within-cluster variance to compare different possible clusterings, with the clustering with the lowest within-cluster variance being chosen.</li>
</ul>
<p>Regardless of which of these that you use, it is often a good idea to standardise the numeric variables in your dataset so that they all have the same variance. If you don’t, your distance measure is likely to be dominated by variables with larger variance, while variables with low variances will have little or no impact on the clustering. To standardise your data, you can use <code>scale</code>:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="eda.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform clustering on standardised data:</span></span>
<span id="cb297-2"><a href="eda.html#cb297-2" aria-hidden="true" tabindex="-1"></a>clusters_agnes <span class="ot">&lt;-</span> <span class="fu">agnes</span>(<span class="fu">scale</span>(votes.repub))</span>
<span id="cb297-3"><a href="eda.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot dendrogram:</span></span>
<span id="cb297-4"><a href="eda.html#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clusters_agnes, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>At this point, we’re starting to use several functions after another, and so this looks like a perfect job for a pipeline. To carry out the same analysis uses <code>%&gt;%</code> pipes, we write:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="eda.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb298-2"><a href="eda.html#cb298-2" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb298-3"><a href="eda.html#cb298-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">agnes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb298-4"><a href="eda.html#cb298-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot</span>(<span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>We can now try changing the metric and clustering method used as described above. Let’s use the Manhattan distance and complete linkage:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="eda.html#cb299-1" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb299-2"><a href="eda.html#cb299-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">agnes</span>(<span class="at">metric =</span> <span class="st">&quot;manhattan&quot;</span>, <span class="at">method =</span> <span class="st">&quot;complete&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb299-3"><a href="eda.html#cb299-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot</span>(<span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>We can change the look of the dendrogram by adding <code>hang = -1</code>, which causes all observations to be placed at the same level:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="eda.html#cb300-1" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb300-2"><a href="eda.html#cb300-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">agnes</span>(<span class="at">metric =</span> <span class="st">&quot;manhattan&quot;</span>, <span class="at">method =</span> <span class="st">&quot;complete&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb300-3"><a href="eda.html#cb300-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot</span>(<span class="at">which =</span> <span class="dv">2</span>, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<p>As an alternative to <code>agnes</code>, we can consider <code>diana</code>. <code>agnes</code> is an <em>agglomerative</em> method, which starts with a lot of clusters and then merge them step-by-step. <code>diana</code>, in contrast, is a <em>divisive</em> method, which starts with one large cluster and then step-by-step splits it into several smaller clusters.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="eda.html#cb301-1" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="eda.html#cb301-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">diana</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb301-3"><a href="eda.html#cb301-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot</span>(<span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>You can change the distance measure used by setting <code>metric</code> in the <code>diana</code> call. Euclidean distance is the default.</p>
<p>To wrap this section up, we’ll look at two packages that are useful for plotting the results of hierarchical clustering: <code>dendextend</code> and <code>factoextra</code>. We installed <code>factoextra</code> in the previous section, but still need to install <code>dendextend</code>:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="eda.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dendextend&quot;</span>)</span></code></pre></div>
<p>To compare the dendrograms from produced by different methods (or the same method with different settings), in a <em>tanglegram</em>, where the dendrograms are plotted against each other, we can use <code>tanglegram</code> from <code>dendextend</code>:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="eda.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb303-2"><a href="eda.html#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create clusters using agnes:</span></span>
<span id="cb303-3"><a href="eda.html#cb303-3" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb303-4"><a href="eda.html#cb303-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">agnes</span>() <span class="ot">-&gt;</span> clusters_agnes</span>
<span id="cb303-5"><a href="eda.html#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create clusters using diana:</span></span>
<span id="cb303-6"><a href="eda.html#cb303-6" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb303-7"><a href="eda.html#cb303-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">diana</span>() <span class="ot">-&gt;</span> clusters_diana</span>
<span id="cb303-8"><a href="eda.html#cb303-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-9"><a href="eda.html#cb303-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the results:</span></span>
<span id="cb303-10"><a href="eda.html#cb303-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tanglegram</span>(<span class="fu">as.dendrogram</span>(clusters_agnes), </span>
<span id="cb303-11"><a href="eda.html#cb303-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.dendrogram</span>(clusters_diana))</span></code></pre></div>
<p>Some clusters are quite similar here, whereas others are very different.</p>
<p>Often, we are interested in finding a comparatively small number of clusters, <span class="math inline">\(k\)</span>. In hierarchical clustering, we can reduce the number of clusters by “cutting” the dendrogram tree. To do so using the <code>factoextra</code> package, we first use <code>hcut</code> to cut the tree into <span class="math inline">\(k\)</span> parts, and then <code>fviz_dend</code> to plot the dendrogram, with each cluster plotted in a different colour. If, for instance, we want <span class="math inline">\(k=5\)</span> clusters<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> and want to use <code>agnes</code> with average linkage and Euclidean distance for the clustering, we’d do the following:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="eda.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb304-2"><a href="eda.html#cb304-2" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb304-3"><a href="eda.html#cb304-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">hcut</span>(<span class="at">k =</span> <span class="dv">5</span>, <span class="at">hc_func =</span> <span class="st">&quot;agnes&quot;</span>,</span>
<span id="cb304-4"><a href="eda.html#cb304-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_method =</span> <span class="st">&quot;average&quot;</span>,</span>
<span id="cb304-5"><a href="eda.html#cb304-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hc_metric =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb304-6"><a href="eda.html#cb304-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_dend</span>()</span></code></pre></div>
<p>There is no inherent meaning to the colours - they are simply a way to visually distinguish between clusters.</p>
<p>Hierarchical clustering is especially suitable for data with named observations. For other types of data, other methods may be better. We will consider some alternatives next.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc25" class="exercise"><strong>Exercise 4.27  </strong></span>Continue the last example above by changing the clustering method to complete linkage with the Manhattan distance.</p>
<ol style="list-style-type: decimal">
<li><p>Do any of the 5 coloured clusters remain the same?</p></li>
<li><p>How can you produce a tanglegram with 5 coloured clusters, to better compare the results from the two clusterings?</p></li>
</ol>
</div>
<p><a href="solutions.html#ch4solutions25">(Click here to go to the solution.)</a></p>
<p><br></p>
<div class="exercise">
<p><span id="exr:ch4exc25b" class="exercise"><strong>Exercise 4.28  </strong></span>The <code>USArrests</code> data contains statistics on violent crime rates in 50 US states. Perform a hierarchical cluster analysis of the data. With which states are Maryland clustered?</p>
</div>
<p><a href="solutions.html#ch4solutions25b">(Click here to go to the solution.)</a></p>
</div>
<div id="heatmaps-and-clustering-variables" class="section level3 hasAnchor" number="4.10.2">
<h3><span class="header-section-number">4.10.2</span> Heatmaps and clustering variables<a href="eda.html#heatmaps-and-clustering-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When looking at a dendrogram, you may ask why and how different observations are similar. Similarities between observations can be visualised using a <em>heatmap</em>, which displays the levels of different variables using colour hues or intensities. The <code>heatmap</code> function creates a heatmap from a <code>matrix</code> object. Let’s try it with the <code>votes.repub</code> voting data. Because <code>votes.repub</code> is a <code>data.frame</code> object, we have to convert it to a matrix with <code>as.matrix</code> first (see Section <a href="datachapter.html#typesoftables">3.1.2</a>):</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="eda.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb305-2"><a href="eda.html#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb305-3"><a href="eda.html#cb305-3" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="fu">heatmap</span>()</span></code></pre></div>
<p>You may want to increase the height of your Plot window so that the names of all states are displayed properly. Using the default colours, low values are represented by a light yellow and high values by a dark red. White represents missing values.</p>
<p>You’ll notice that dendrograms are plotted along the margins. <code>heatmap</code> performs hierarchical clustering (by default, agglomerative with complete linkage) of the observations as well as of the variables. In the latter case, variables are grouped together based on <em>similarities between observations</em>, creating <em>clusters of variables</em>. In essence, this is just a hierarchical clustering of the transposed data matrix, but it does offer a different view of the data, which at times can be very revealing. The rows and columns are sorted according to the two hierarchical clusterings.</p>
<p>As per usual, it is a good idea to standardise the data before clustering, which can be done using the <code>scale</code> argument in <code>heatmap</code>. There are two options for scaling, either in the row direction (preferable if you wish to cluster variables) or the column direction (preferable if you wish to cluster observations):</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="eda.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardisation suitable for clustering variables:</span></span>
<span id="cb306-2"><a href="eda.html#cb306-2" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="fu">heatmap</span>(<span class="at">scale =</span> <span class="st">&quot;row&quot;</span>)</span>
<span id="cb306-3"><a href="eda.html#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="eda.html#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardisation suitable for clustering observations:</span></span>
<span id="cb306-5"><a href="eda.html#cb306-5" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="fu">heatmap</span>(<span class="at">scale =</span> <span class="st">&quot;col&quot;</span>)</span></code></pre></div>
<p>Looking at the first of these plots, we can see which elections (i.e. which variables) had similar outcomes in terms of Republican votes. For instance, we can see that the elections in 1960, 1976, 1888, 1884, 1880, and 1876 all had similar outcomes, with the large number of orange rows indicating that the Republicans neither did great nor did poorly.</p>
<p>If you like, you can change the colour palette used. As in Section <a href="eda.html#colourpalettes">4.2.2</a>, you can choose between palettes from <a href="http://www.colorbrewer2.org" class="uri">http://www.colorbrewer2.org</a>. <code>heatmap</code> is not a <code>ggplot2</code> function, so this is done in a slightly different way to what you’re used to from other examples. Here are two examples, with the white-blue-purple sequential palette <code>"BuPu"</code> and the red-white-blue diverging palette <code>"RdBu"</code>:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="eda.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb307-2"><a href="eda.html#cb307-2" aria-hidden="true" tabindex="-1"></a>col_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;BuPu&quot;</span>))(<span class="dv">25</span>)</span>
<span id="cb307-3"><a href="eda.html#cb307-3" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb307-4"><a href="eda.html#cb307-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">heatmap</span>(<span class="at">scale =</span> <span class="st">&quot;row&quot;</span>, <span class="at">col =</span> col_palette)</span>
<span id="cb307-5"><a href="eda.html#cb307-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-6"><a href="eda.html#cb307-6" aria-hidden="true" tabindex="-1"></a>col_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;RdBu&quot;</span>))(<span class="dv">25</span>)</span>
<span id="cb307-7"><a href="eda.html#cb307-7" aria-hidden="true" tabindex="-1"></a>votes.repub <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb307-8"><a href="eda.html#cb307-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">heatmap</span>(<span class="at">scale =</span> <span class="st">&quot;row&quot;</span>, <span class="at">col =</span> col_palette)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc25c" class="exercise"><strong>Exercise 4.29  </strong></span>Draw a heatmap for the <code>USArrests</code> data. Have a look at Maryland and the states with which it is clustered. Do they have high or low crime rates?</p>
</div>
<p><a href="solutions.html#ch4solutions25c">(Click here to go to the solution.)</a></p>
</div>
<div id="centroid" class="section level3 hasAnchor" number="4.10.3">
<h3><span class="header-section-number">4.10.3</span> Centroid-based clustering<a href="eda.html#centroid" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s return to the <code>seeds</code> data that we explored in Section <a href="eda.html#pca">4.9</a>:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="eda.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the data:</span></span>
<span id="cb308-2"><a href="eda.html#cb308-2" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://tinyurl.com/seedsdata&quot;</span>,</span>
<span id="cb308-3"><a href="eda.html#cb308-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Area&quot;</span>, <span class="st">&quot;Perimeter&quot;</span>, <span class="st">&quot;Compactness&quot;</span>,</span>
<span id="cb308-4"><a href="eda.html#cb308-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Kernel_length&quot;</span>, <span class="st">&quot;Kernel_width&quot;</span>, <span class="st">&quot;Asymmetry&quot;</span>,</span>
<span id="cb308-5"><a href="eda.html#cb308-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Groove_length&quot;</span>, <span class="st">&quot;Variety&quot;</span>))</span>
<span id="cb308-6"><a href="eda.html#cb308-6" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>Variety <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds<span class="sc">$</span>Variety)</span></code></pre></div>
<p>We know that there are three varieties of seeds in this dataset, but what if we didn’t? Or what if we’d lost the labels and didn’t know what seeds are of what type? There are no rows names for this data, and plotting a dendrogram may therefore not be that useful. Instead, we can use <span class="math inline">\(k\)</span>-means clustering, where the points are clustered into <span class="math inline">\(k\)</span> clusters based on their distances to the cluster means, or <em>centroids</em>.</p>
<p>When performing <span class="math inline">\(k\)</span>-means clustering (using the algorithm of Hartigan &amp; Wong (1979) that is the default in the function that we’ll use), the data is split into <span class="math inline">\(k\)</span> clusters based on their distance to the mean of all points. Points are then moved between clusters, one at a time, based on how close they are (as measured by Euclidean distance) to the mean of each cluster. The algorithm finishes when no point can be moved between clusters without increasing the average distance between points and the means of their clusters.</p>
<p>To run a <span class="math inline">\(k\)</span>-means clustering in R, we can use <code>kmeans</code>. Let’s start by using <span class="math inline">\(k=3\)</span> clusters:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="eda.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we standardise the data, and then we do a k-means</span></span>
<span id="cb309-2"><a href="eda.html#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="co"># clustering.</span></span>
<span id="cb309-3"><a href="eda.html#cb309-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We ignore variable 8, Variety, which is the group label.</span></span>
<span id="cb309-4"><a href="eda.html#cb309-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb309-5"><a href="eda.html#cb309-5" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb309-6"><a href="eda.html#cb309-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb309-7"><a href="eda.html#cb309-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-8"><a href="eda.html#cb309-8" aria-hidden="true" tabindex="-1"></a>seeds_cluster</span></code></pre></div>
<p>To visualise the results, we’ll plot the first two principal components. We’ll use colour to show the clusters. Moreover, we’ll plot the different varieties in different shapes, to see if the clusters found correspond to different varieties:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="eda.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute principal components:</span></span>
<span id="cb310-2"><a href="eda.html#cb310-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(seeds[,<span class="sc">-</span><span class="dv">8</span>])</span>
<span id="cb310-3"><a href="eda.html#cb310-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb310-4"><a href="eda.html#cb310-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> seeds_cluster<span class="sc">$</span>cluster,</span>
<span id="cb310-5"><a href="eda.html#cb310-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Variety&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p>In this case, the clusters more or less overlap with the varieties! Of course, in a lot of cases, we don’t know the number of clusters beforehand. What happens if we change <span class="math inline">\(k\)</span>?</p>
<p>First, we try <span class="math inline">\(k=2\)</span>:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="eda.html#cb311-1" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb311-2"><a href="eda.html#cb311-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">2</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb311-3"><a href="eda.html#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> seeds_cluster<span class="sc">$</span>cluster,</span>
<span id="cb311-4"><a href="eda.html#cb311-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Variety&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p>Next, <span class="math inline">\(k=4\)</span>:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="eda.html#cb312-1" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb312-2"><a href="eda.html#cb312-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">4</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb312-3"><a href="eda.html#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> seeds_cluster<span class="sc">$</span>cluster,</span>
<span id="cb312-4"><a href="eda.html#cb312-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Variety&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p>And finally, a larger number of clusters, say <span class="math inline">\(k=12\)</span>:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="eda.html#cb313-1" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb313-2"><a href="eda.html#cb313-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">12</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb313-3"><a href="eda.html#cb313-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> seeds_cluster<span class="sc">$</span>cluster,</span>
<span id="cb313-4"><a href="eda.html#cb313-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Variety&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p>If it weren’t for the fact that the different varieties were shown as different shapes, we’d have no way to say, based on this plot alone, which choice of <span class="math inline">\(k\)</span> that is preferable here. Before we go into methods for choosing <span class="math inline">\(k\)</span> though, we’ll mention <code>pam</code>. <code>pam</code> is an alternative to <span class="math inline">\(k\)</span>-means that works in the same way, but uses median-like points, <em>medoids</em> instead of cluster means. This makes it more robust to outliers. Let’s try it with <span class="math inline">\(k=3\)</span> clusters:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="eda.html#cb314-1" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb314-2"><a href="eda.html#cb314-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pam</span>(<span class="at">k =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb314-3"><a href="eda.html#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca, <span class="at">data =</span> seeds, <span class="at">colour =</span> seeds_cluster<span class="sc">$</span>clustering,</span>
<span id="cb314-4"><a href="eda.html#cb314-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Variety&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p>For both <code>kmeans</code> and <code>pam</code>, there are visual tools that can help us choose the value of <span class="math inline">\(k\)</span> in the <code>factoextra</code> package. Let’s install it:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="eda.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;factoextra&quot;</span>)</span></code></pre></div>
<p>The <code>fviz_nbclust</code> function in <code>factoextra</code> can be used to obtain plots that can guide the choice of <span class="math inline">\(k\)</span>. It takes three arguments as input: the data, the clustering function (e.g. <code>kmeans</code> or <code>pam</code>) and the method used for evaluating different choices of <span class="math inline">\(k\)</span>. There are three options for the latter: <code>"wss"</code>, <code>"silhouette"</code> and <code>"gap_stat"</code>.</p>
<p><code>method = "wss"</code> yields a plot that relies on the within-cluster sum of squares, WSS, which is a measure of the within-cluster variation. The smaller this is, the more compact are the clusters. The WSS is plotted for several choices of <span class="math inline">\(k\)</span>, and we look for an “elbow”, just as we did when using a scree plot for PCA. That is, we look for the value of <span class="math inline">\(k\)</span> such that increasing <span class="math inline">\(k\)</span> further doesn’t improve the WSS much. Let’s have a look at an example, using <code>pam</code> for clustering:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="eda.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb316-2"><a href="eda.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(<span class="fu">scale</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>]), pam, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>)</span>
<span id="cb316-3"><a href="eda.html#cb316-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-4"><a href="eda.html#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or, using a pipeline instead:</span></span>
<span id="cb316-5"><a href="eda.html#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb316-6"><a href="eda.html#cb316-6" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb316-7"><a href="eda.html#cb316-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(pam, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>)</span></code></pre></div>
<p><span class="math inline">\(k=3\)</span> seems like a good choice here.</p>
<p><code>method = "silhouette"</code> produces a silhouette plot. The silhouette value measures how similar a point is compared to other points in its cluster. The closer to 1 this value is, the better. In a silhouette plot, the average silhouette value for points in the data are plotted against <span class="math inline">\(k\)</span>:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="eda.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(<span class="fu">scale</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>]), pam, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>)</span></code></pre></div>
<p>Judging by this plot, <span class="math inline">\(k=2\)</span> appears to be the best choice.</p>
<p>Finally, <code>method = "gap_stat"</code> yields a plot of the gap statistic (Tibshirani et al., 2001), which is based on comparing the WSS to its expected value under a null distribution obtained using the bootstrap (Section <a href="modchapter.html#bootstrap">7.7</a>). Higher values of the gap statistic are preferable:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="eda.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(<span class="fu">scale</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>]), pam, <span class="at">method =</span> <span class="st">&quot;gap_stat&quot;</span>)</span></code></pre></div>
<p>In this case, <span class="math inline">\(k=3\)</span> gives the best value.</p>
<p>In addition to plots for choosing <span class="math inline">\(k\)</span>, <code>factoextra</code> provides the function <code>fviz_cluster</code> for creating PCA-based plots, with an option to add convex hulls or ellipses around the clusters:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="eda.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, find the clusters:</span></span>
<span id="cb319-2"><a href="eda.html#cb319-2" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="eda.html#cb319-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb319-4"><a href="eda.html#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="eda.html#cb319-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot clusters and their convex hulls:</span></span>
<span id="cb319-6"><a href="eda.html#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb319-7"><a href="eda.html#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(seeds_cluster, <span class="at">data =</span> seeds[, <span class="sc">-</span><span class="dv">8</span>])</span>
<span id="cb319-8"><a href="eda.html#cb319-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-9"><a href="eda.html#cb319-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Without row numbers:</span></span>
<span id="cb319-10"><a href="eda.html#cb319-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(seeds_cluster, <span class="at">data =</span> seeds[, <span class="sc">-</span><span class="dv">8</span>], <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>)</span>
<span id="cb319-11"><a href="eda.html#cb319-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-12"><a href="eda.html#cb319-12" aria-hidden="true" tabindex="-1"></a><span class="co"># With ellipses based on the multivariate normal distribution:</span></span>
<span id="cb319-13"><a href="eda.html#cb319-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(seeds_cluster, <span class="at">data =</span> seeds[, <span class="sc">-</span><span class="dv">8</span>],</span>
<span id="cb319-14"><a href="eda.html#cb319-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">ellipse.type =</span> <span class="st">&quot;norm&quot;</span>)</span></code></pre></div>
<p>Note that in this plot, the shapes correspond to the clusters and not the varieties of seeds.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc26" class="exercise"><strong>Exercise 4.30  </strong></span>The <code>chorSub</code> data from <code>cluster</code> contains measurements of 10 chemicals in 61 geological samples from the Kola Peninsula. Cluster this data using using either <code>kmeans</code> or <code>pam</code> (does either seem to be a better choice here?). What is a good choice of <span class="math inline">\(k\)</span> here? Visualise the results.</p>
</div>
<p><a href="solutions.html#ch4solutions26">(Click here to go to the solution.)</a></p>
<!--### A hybrid approach

```r
library(factoextra)
seeds_cluster <- hkmeans(seeds[, -8], 3)
autoplot(pca, data = seeds, colour = seeds_cluster$cluster,
         shape = "Variety", size = 2, alpha = 0.75)
```
-->
</div>
<div id="fuzzy-clustering" class="section level3 hasAnchor" number="4.10.4">
<h3><span class="header-section-number">4.10.4</span> Fuzzy clustering<a href="eda.html#fuzzy-clustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An alternative to <span class="math inline">\(k\)</span>-means clustering is <em>fuzzy clustering</em>, in which each point is “spread out” over the <span class="math inline">\(k\)</span> clusters instead of being placed in a single cluster. The more similar it is to other observations in a cluster, the higher is its membership in that cluster. Points can have a high degree of membership to several clusters, which is useful in applications where points should be allowed to belong to more than one cluster. An important example is genetics, where genes can encode proteins with more than one function. If each point corresponds to a gene, it then makes sense to allow the points to belong to several clusters, potentially associated with different functions. The opposite of fuzzy clustering is <em>hard clustering</em>, in which each point only belongs to one cluster.</p>
<p><code>fanny</code> from <code>cluster</code> can be used to perform fuzzy clustering:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="eda.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb320-2"><a href="eda.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb320-3"><a href="eda.html#cb320-3" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb320-4"><a href="eda.html#cb320-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fanny</span>(<span class="at">k =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb320-5"><a href="eda.html#cb320-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-6"><a href="eda.html#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check membership of each cluster for the different points:</span></span>
<span id="cb320-7"><a href="eda.html#cb320-7" aria-hidden="true" tabindex="-1"></a>seeds_cluster<span class="sc">$</span>membership</span>
<span id="cb320-8"><a href="eda.html#cb320-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-9"><a href="eda.html#cb320-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the closest hard clustering:</span></span>
<span id="cb320-10"><a href="eda.html#cb320-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb320-11"><a href="eda.html#cb320-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(seeds_cluster, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>)</span></code></pre></div>
<p>As for <code>kmeans</code> and <code>pam</code>, we can use <code>fviz_nbclust</code> to determine how many clusters to use:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="eda.html#cb321-1" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-2"><a href="eda.html#cb321-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(fanny, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>)</span>
<span id="cb321-3"><a href="eda.html#cb321-3" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-4"><a href="eda.html#cb321-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(fanny, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>)</span>
<span id="cb321-5"><a href="eda.html#cb321-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Producing the gap statistic plot takes a while here, so</span></span>
<span id="cb321-6"><a href="eda.html#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="co"># you may want to skip it in this case:</span></span>
<span id="cb321-7"><a href="eda.html#cb321-7" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-8"><a href="eda.html#cb321-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fviz_nbclust</span>(fanny, <span class="at">method =</span> <span class="st">&quot;gap&quot;</span>)</span></code></pre></div>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc27" class="exercise"><strong>Exercise 4.31  </strong></span>Do a fuzzy clustering of the <code>USArrests</code> data. Is Maryland strongly associated with a single cluster, or with several clusters? What about New Jersey?</p>
</div>
<p><a href="solutions.html#ch4solutions27">(Click here to go to the solution.)</a></p>
</div>
<div id="modelbasedclustering" class="section level3 hasAnchor" number="4.10.5">
<h3><span class="header-section-number">4.10.5</span> Model-based clustering<a href="eda.html#modelbasedclustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a last option, we’ll consider model-based clustering, in which each cluster is assumed to come from a multivariate normal distribution. This will yield ellipsoidal clusters. <code>Mclust</code> from the <code>mclust</code> package fits such a model, called a Gaussian finite mixture model, using the EM-algorithm (Scrucca et al., 2016). First, let’s install the package:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="eda.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;mclust&quot;</span>)</span></code></pre></div>
<p>Now, let’s cluster the <code>seeds</code> data. The number of clusters is chosen as part of the clustering procedure. We’ll use a function from the <code>factoextra</code> for plotting the clusters with ellipsoids, and so start by installing that:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="eda.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;factoextra&quot;</span>)</span>
<span id="cb323-2"><a href="eda.html#cb323-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-3"><a href="eda.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb323-4"><a href="eda.html#cb323-4" aria-hidden="true" tabindex="-1"></a>seeds_cluster <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(<span class="fu">scale</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>]))</span>
<span id="cb323-5"><a href="eda.html#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(seeds_cluster)</span>
<span id="cb323-6"><a href="eda.html#cb323-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-7"><a href="eda.html#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results with ellipsoids:</span></span>
<span id="cb323-8"><a href="eda.html#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb323-9"><a href="eda.html#cb323-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(seeds_cluster, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">ellipse.type =</span> <span class="st">&quot;norm&quot;</span>)</span></code></pre></div>
<p>Gaussian finite mixture models are based on the assumption that the data is numerical. For categorical data, we can use latent class analysis, which we’ll discuss in Section <a href="eda.html#lca">4.11.2</a>, instead.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc28" class="exercise"><strong>Exercise 4.32  </strong></span>Return to the <code>chorSub</code> data from Exercise <a href="eda.html#exr:ch4exc26">4.30</a>. Cluster it using a Gaussian finite mixture model. How many clusters do you find?</p>
</div>
<p><a href="solutions.html#ch4solutions28">(Click here to go to the solution.)</a></p>
</div>
<div id="comparing-clusters" class="section level3 hasAnchor" number="4.10.6">
<h3><span class="header-section-number">4.10.6</span> Comparing clusters<a href="eda.html#comparing-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Having found some interesting clusters, we are often interested in exploring differences between the clusters. To do so, we much first extract the cluster labels from our clustering (which are contained in the variables <code>clustering</code> for methods with Western female names, <code>cluster</code> for <code>kmeans</code>, and <code>classification</code> for <code>Mclust</code>). We can then add those labels to our data frame and use them when plotting.</p>
<p>For instance, using the <code>seeds</code> data, we can compare the area of seeds from different clusters:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="eda.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster the seeds using k-means with k=3:</span></span>
<span id="cb324-2"><a href="eda.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb324-3"><a href="eda.html#cb324-3" aria-hidden="true" tabindex="-1"></a>seeds[, <span class="sc">-</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> <span class="fu">scale</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb324-4"><a href="eda.html#cb324-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">3</span>) <span class="ot">-&gt;</span> seeds_cluster</span>
<span id="cb324-5"><a href="eda.html#cb324-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-6"><a href="eda.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the results to the data frame:</span></span>
<span id="cb324-7"><a href="eda.html#cb324-7" aria-hidden="true" tabindex="-1"></a>seeds<span class="sc">$</span>clusters <span class="ot">&lt;-</span> <span class="fu">factor</span>(seeds_cluster<span class="sc">$</span>cluster)</span>
<span id="cb324-8"><a href="eda.html#cb324-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Instead of $cluster, we&#39;d use $clustering for agnes, pam, and fanny</span></span>
<span id="cb324-9"><a href="eda.html#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="co"># objects, and $classification for an Mclust object.</span></span>
<span id="cb324-10"><a href="eda.html#cb324-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-11"><a href="eda.html#cb324-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the areas of the 3 clusters using boxplots:</span></span>
<span id="cb324-12"><a href="eda.html#cb324-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb324-13"><a href="eda.html#cb324-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(<span class="at">x =</span> Area, <span class="at">group =</span> clusters, <span class="at">fill =</span> clusters)) <span class="sc">+</span></span>
<span id="cb324-14"><a href="eda.html#cb324-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>()</span>
<span id="cb324-15"><a href="eda.html#cb324-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-16"><a href="eda.html#cb324-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Or using density estimates:</span></span>
<span id="cb324-17"><a href="eda.html#cb324-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seeds, <span class="fu">aes</span>(<span class="at">x =</span> Area, <span class="at">group =</span> clusters, <span class="at">fill =</span> clusters)) <span class="sc">+</span></span>
<span id="cb324-18"><a href="eda.html#cb324-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<p>We can also create a scatterplot matrix to look at all variables simultaneously:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="eda.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb325-2"><a href="eda.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(seeds[, <span class="sc">-</span><span class="dv">8</span>], <span class="fu">aes</span>(<span class="at">colour =</span> seeds<span class="sc">$</span>clusters, <span class="at">alpha =</span> <span class="fl">0.2</span>))</span></code></pre></div>
<p>It may be tempting to run some statistical tests (e.g. a t-test) to see if there are differences between the clusters. Note, however, that in statistical hypothesis testing, it is typically assumed that the hypotheses that are being tested have been generated independently from the data. <em>Double-dipping</em>, where the data first is used to generate a hypothesis (“judging from this boxplot, there seems to be a difference in means between these two groups!” or “I found these clusters, and now I’ll run a test to see if they are different”) and then test that hypothesis, is generally frowned upon, as that substantially inflates the risk of a type I error. Recently, there have however been some advances in valid techniques for testing differences in means between clusters found using hierarchical clustering; see Gao et al. (2020).</p>
</div>
</div>
<div id="exploratory-factor-analysis" class="section level2 hasAnchor" number="4.11">
<h2><span class="header-section-number">4.11</span> Exploratory factor analysis<a href="eda.html#exploratory-factor-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The purpose of <em>factor analysis</em> is to describe and understand the correlation structure for a set of observable variables through a smaller number of unobservable underlying variables, called <em>factors</em> or <em>latent variables</em>. These are thought to explain the values of the observed variables in a causal manner. Factor analysis is a popular tool in psychometrics, where it for instance is used to identify latent variables that explain people’s results on different tests, e.g. related to personality, intelligence, or attitude.</p>
<div id="factor-analysis" class="section level3 hasAnchor" number="4.11.1">
<h3><span class="header-section-number">4.11.1</span> Factor analysis<a href="eda.html#factor-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll use the <code>psych</code> package, along with the associated package <code>GPArotation</code>, for our analyses. Let’s install them:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="eda.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;psych&quot;</span>, <span class="st">&quot;GPArotation&quot;</span>))</span></code></pre></div>
<p>For our first example of factor analysis, we’ll be using the <code>attitude</code> data that comes with R. It describes the outcome of a survey of employees at a financial organisation. Have a look at its documentation to read about the variables in the dataset:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="eda.html#cb327-1" aria-hidden="true" tabindex="-1"></a>?attitude</span>
<span id="cb327-2"><a href="eda.html#cb327-2" aria-hidden="true" tabindex="-1"></a>attitude</span></code></pre></div>
<p>To fit a factor analysis model to these data, we can use <code>fa</code> from <code>psych</code>. <code>fa</code> requires us to specify the number of factors used in the model. We’ll get back to how to choose the number of factors, but for now, let’s go with 2:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="eda.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb328-2"><a href="eda.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit factor model:</span></span>
<span id="cb328-3"><a href="eda.html#cb328-3" aria-hidden="true" tabindex="-1"></a>attitude_fa <span class="ot">&lt;-</span> <span class="fu">fa</span>(attitude, <span class="at">nfactors =</span> <span class="dv">2</span>,</span>
<span id="cb328-4"><a href="eda.html#cb328-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rotate =</span> <span class="st">&quot;oblimin&quot;</span>, <span class="at">fm =</span> <span class="st">&quot;ml&quot;</span>)</span></code></pre></div>
<p><code>fa</code> does two things for us. First, it fits a factor model to the data, which yields a table of <em>factor loadings</em>, i.e. the correlation between the two unobserved factors and the observed variables. However, there is an infinite number of mathematically valid factor models for any given dataset. Therefore, the factors are <em>rotated</em> according to some rule to obtain a factor model that hopefully allows for easy and useful interpretation. Several methods can be used to fit the factor model (set using the <code>fm</code> argument in <code>fa</code>) and for rotation the solution (set using <code>rotate</code>). We’ll look at some of the options shortly.</p>
<p>First, we’ll print the result, showing the factor loadings (after rotation). We’ll also plot the resulting model using <code>fa.diagram</code>, showing the correlation between the factors and the observed variables:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="eda.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results:</span></span>
<span id="cb329-2"><a href="eda.html#cb329-2" aria-hidden="true" tabindex="-1"></a>attitude_fa</span>
<span id="cb329-3"><a href="eda.html#cb329-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-4"><a href="eda.html#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results:</span></span>
<span id="cb329-5"><a href="eda.html#cb329-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(attitude_fa, <span class="at">simple =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The first factor is correlated to the variables <code>advance</code>, <code>learning</code> and <code>raises</code>. We can perhaps interpret this factor as measuring the employees’ career opportunity at the organisation. The second factor is strongly correlated to <code>complaints</code> and (overall) <code>rating</code>, but also to a lesser degree correlated to <code>raises</code>, <code>learning</code> and <code>privileges</code>. This can maybe be interpreted as measuring how the employees’ feel that they are treated at the organisation.</p>
<p>We can also see that the two factors are correlated. In some cases, it makes sense to expect the factors to be uncorrelated. In that case, we can change the rotation method used, from <code>oblimin</code> (which yields <em>oblique rotations</em>, allowing for correlations - usually a good default) to <code>varimax</code>, which yields uncorrelated factors:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="eda.html#cb330-1" aria-hidden="true" tabindex="-1"></a>attitude_fa <span class="ot">&lt;-</span> <span class="fu">fa</span>(attitude, <span class="at">nfactors =</span> <span class="dv">2</span>,</span>
<span id="cb330-2"><a href="eda.html#cb330-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rotate =</span> <span class="st">&quot;varimax&quot;</span>, <span class="at">fm =</span> <span class="st">&quot;ml&quot;</span>)</span>
<span id="cb330-3"><a href="eda.html#cb330-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(attitude_fa, <span class="at">simple =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>In this case, the results are fairly similar.</p>
<p>The <code>fm = "ml"</code> setting means that maximum likelihood estimation of the factor model is performed, under the assumption of a normal distribution for the data. Maximum likelihood estimation is widely recommended for estimation of factor models, and can often work well even for non-normal data (Costello &amp; Osborne, 2005). However, there are cases where it fails to find useful factors. <code>fa</code> offers several different estimation methods. A good alternative is <code>minres</code>, which often works well when maximum likelihood fails:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="eda.html#cb331-1" aria-hidden="true" tabindex="-1"></a>attitude_fa <span class="ot">&lt;-</span> <span class="fu">fa</span>(attitude, <span class="at">nfactors =</span> <span class="dv">2</span>,</span>
<span id="cb331-2"><a href="eda.html#cb331-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rotate =</span> <span class="st">&quot;oblimin&quot;</span>, <span class="at">fm =</span> <span class="st">&quot;minres&quot;</span>)</span>
<span id="cb331-3"><a href="eda.html#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(attitude_fa, <span class="at">simple =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Once again, the results are similar to what we saw before. In other examples, the results differ more. When choosing which estimation method and rotation to use, bear in mind that in an exploratory study, there is no harm in playing around with a few different methods. After all, your purpose is to generate hypotheses rather than confirm them, and looking at the data in a few different ways will help you do that.</p>
<p>To determine the number of factors that are appropriate for a particular dataset, we can draw a scree plot with <code>scree</code>. This is interpreted in the same way as for principal components analysis (Section <a href="eda.html#pca">4.9</a>) and centroid-based clustering (Section <a href="eda.html#centroid">4.10.3</a>) - we look for an “elbow” in the plot, which tells us at which point adding more factors no longer contributes much to the model:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="eda.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scree</span>(attitude, <span class="at">pc =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>A useful alternative version of this is provided by <code>fa.parallel</code>, which adds lines showing what the scree plot would look like for randomly generated uncorrelated data of the same size as the original dataset. As long as the blue line, representing the actual data, is higher than the red line, representing randomly generated data, adding more factors improves the model:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="eda.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(attitude, <span class="at">fm =</span> <span class="st">&quot;ml&quot;</span>, <span class="at">fa =</span> <span class="st">&quot;fa&quot;</span>)</span></code></pre></div>
<p>Some older texts recommend that only factors with an eigenvalue (the y-axis in the scree plot) greater than 1 be kept in the model. It is widely agreed that this so-called Kaiser rule is inappropriate (Costello &amp; Osborne, 2005), as it runs the risk of leaving out important factors.</p>
<p>Similarly, some older texts also recommend using principal components analysis to fit factor models. While the two are mathematically similar in that both in some sense reduce the dimensionality of the data, PCA and factor analysis are designed to target different problems. Factor analysis is concerned with an underlying causal structure where the unobserved factors affect the observed variables. In contrast, PCA simply seeks to create a small number of variables that summarise the variation in the data, which can work well even if there are no unobserved factors affecting the variables.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc29" class="exercise"><strong>Exercise 4.33  </strong></span>Factor analysis only relies on the covariance or correlation matrix of your data. When using <code>fa</code> and other functions for factor analysis, you can input either a data frame or a covariance/correlation matrix. Read about the <code>ability.cov</code> data that comes shipped with R, and perform a factor analysis of it.</p>
</div>
<p><a href="solutions.html#ch4solutions29">(Click here to go to the solution.)</a></p>
</div>
<div id="lca" class="section level3 hasAnchor" number="4.11.2">
<h3><span class="header-section-number">4.11.2</span> Latent class analysis<a href="eda.html#lca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When there is a single categorical latent variable, factor analysis overlaps with clustering, which we studied in Section <a href="eda.html#clustering">4.10</a>. Whether we think of the values of the latent variable as clusters, classes, factor levels, or something else is mainly a philosophical question - from a mathematical perspective, it doesn’t matter what name we use for them.</p>
<p>When observations from the same cluster are assumed to be uncorrelated, the resulting model is called <em>latent profile analysis</em>, which typically is handled using model-based clustering (Section <a href="eda.html#modelbasedclustering">4.10.5</a>). The special case where the observed variables are categorical is instead known as <em>latent class analysis</em>. This is common e.g. in analyses of survey data, and we’ll have a look at such an example in this section. The package that we’ll use for our analyses is called <code>poLCA</code> - let’s install it:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="eda.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;poLCA&quot;</span>)</span></code></pre></div>
<p>The <a href="https://www.datafiles.samhsa.gov/study-dataset/national-mental-health-services-survey-2019-n-mhss-2019-ds0001-nid18959">National Mental Health Services Survey</a> is an annual survey collecting information about mental health treatment facilities in the US. We’ll analyse data from the 2019 survey, courtesy of the Substance Abuse and Mental Health Data Archive, and try to find latent classes. <a href="http://www.modernstatisticswithr.com/data.zip">Download <code>nmhss-puf-2019.csv</code> from the book’s web page</a>, and set <code>file_path</code> to its path. We can then load and look at a summary of the data using:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="eda.html#cb335-1" aria-hidden="true" tabindex="-1"></a>nmhss <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb335-2"><a href="eda.html#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nmhss)</span></code></pre></div>
<p>All variables are categorical (except perhaps for the first one, which is an identifier). According to the <a href="https://www.datafiles.samhsa.gov/sites/default/files/field-uploads-protected/studies/N-MHSS-2019/N-MHSS-2019-datasets/N-MHSS-2019-DS0001/N-MHSS-2019-DS0001-info/N-MHSS-2019-DS0001-info-codebook.pdf">survey’s documentation</a>, negative values are used to represent missing values. For binary variables, <code>0</code> means no/non-presence and <code>1</code> means yes/presence.</p>
<p>Next, we’ll load the <code>poLCA</code> package and read the documentation for the function that we’ll use for the analysis.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="eda.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA)</span>
<span id="cb336-2"><a href="eda.html#cb336-2" aria-hidden="true" tabindex="-1"></a>?poLCA</span></code></pre></div>
<p>As you can see in the description of the <code>data</code> argument, the observed variables (called <em>manifest variables</em> here) are only allowed to contain consecutive integer values, starting from 1. Moreover, missing values should be represented by <code>NA</code>, and not by negative numbers (just as elsewhere in R!). We therefore need to make two changes to our data:</p>
<ul>
<li>Change negative values to <code>NA</code>,</li>
<li>Change the levels of binary variables so that <code>1</code> means no/non-presence and <code>2</code> means yes/presence.</li>
</ul>
<p>In our example, we’ll look at variables describing what treatments are available at the different facilities. Let’s create a new data frame for those variables:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="eda.html#cb337-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> nmhss[, <span class="fu">names</span>(nmhss)[<span class="dv">17</span><span class="sc">:</span><span class="dv">30</span>]]</span>
<span id="cb337-2"><a href="eda.html#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(treatments)</span></code></pre></div>
<p>To make the changes to the data that we need, we can do the following:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="eda.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change negative values to NA:</span></span>
<span id="cb338-2"><a href="eda.html#cb338-2" aria-hidden="true" tabindex="-1"></a>treatments[treatments <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb338-3"><a href="eda.html#cb338-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-4"><a href="eda.html#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Change binary variables from 0 and 1 to</span></span>
<span id="cb338-5"><a href="eda.html#cb338-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 and 2:</span></span>
<span id="cb338-6"><a href="eda.html#cb338-6" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> treatments <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb338-7"><a href="eda.html#cb338-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-8"><a href="eda.html#cb338-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results:</span></span>
<span id="cb338-9"><a href="eda.html#cb338-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(treatments)</span></code></pre></div>
<p>We are now ready to get started with our analysis. To begin with, we will try to find classes based on whether or not the facilities offer the following five treatments:</p>
<ul>
<li><code>TREATPSYCHOTHRPY</code>: The facility offers individual psychotherapy,</li>
<li><code>TREATFAMTHRPY</code>: The facility offers couples/family therapy,</li>
<li><code>TREATGRPTHRPY</code>: The facility offers group therapy,</li>
<li><code>TREATCOGTHRPY</code>: The facility offers cognitive behavioural therapy,</li>
<li><code>TREATPSYCHOMED</code>: The facility offers psychotropic medication.
The <code>poLCA</code> function needs three inputs: a formula describing what observed variables to use, a data frame containing the observations, and <code>nclass</code>, the number of latent classes to find. To begin with, let’s try two classes:</li>
</ul>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="eda.html#cb339-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(TREATPSYCHOTHRPY, TREATFAMTHRPY,</span>
<span id="cb339-2"><a href="eda.html#cb339-2" aria-hidden="true" tabindex="-1"></a>                 TREATGRPTHRPY, TREATCOGTHRPY,</span>
<span id="cb339-3"><a href="eda.html#cb339-3" aria-hidden="true" tabindex="-1"></a>                 TREATPSYCHOMED) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb339-4"><a href="eda.html#cb339-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> treatments, <span class="at">nclass =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>The output shows the probabilities of 1’s (no/non-presence) and 2’s (yes/presence) for the two classes. So, for instance, from the output</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="eda.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATPSYCHOTHRPY</span>
<span id="cb340-2"><a href="eda.html#cb340-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb340-3"><a href="eda.html#cb340-3" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.6628</span> <span class="fl">0.3372</span></span>
<span id="cb340-4"><a href="eda.html#cb340-4" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">0.0073</span> <span class="fl">0.9927</span></span></code></pre></div>
<p>we gather that 34 % of facilities belonging to the first class offer individual psychotherapy, whereas 99 % of facilities from the second class offer individual psychotherapy. Looking at the other variables, we see that the second class always has high probabilities of offering therapies, while the first class doesn’t. Interpreting this, we’d say that the second class contains facilities that offer a wide variety of treatments, and the first facilities that only offer some therapies. Finally, we see from the output that 88 % of the facilities belong to the second class:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="eda.html#cb341-1" aria-hidden="true" tabindex="-1"></a>Estimated class population shares </span>
<span id="cb341-2"><a href="eda.html#cb341-2" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.1167</span> <span class="fl">0.8833</span> </span></code></pre></div>
<p>We can visualise the class differences in a plot:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="eda.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p>To see which classes different observations belong to, we can use:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="eda.html#cb343-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>predclass</span></code></pre></div>
<p>Just as in a cluster analysis, it is often a good idea to run the analysis with different numbers of classes. Next, let’s try 3 classes:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="eda.html#cb344-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(TREATPSYCHOTHRPY, TREATFAMTHRPY,</span>
<span id="cb344-2"><a href="eda.html#cb344-2" aria-hidden="true" tabindex="-1"></a>                 TREATGRPTHRPY, TREATCOGTHRPY,</span>
<span id="cb344-3"><a href="eda.html#cb344-3" aria-hidden="true" tabindex="-1"></a>                 TREATPSYCHOMED) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb344-4"><a href="eda.html#cb344-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> treatments, <span class="at">nclass =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>This time, we run into numerical problems - the model estimation has failed, as indicated by the following warning message:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="eda.html#cb345-1" aria-hidden="true" tabindex="-1"></a>ALERT<span class="sc">:</span> iterations finished, MAXIMUM LIKELIHOOD NOT FOUND </span></code></pre></div>
<p><code>poLCA</code> fits the model using a method known as the <em>EM algorithm</em>, which finds maximum likelihood estimates numerically. First, the observations are randomly assigned to the classes. Step by step, the observations are then moved between classes, until the optimal split has been found. It can however happen that more steps are needed to find the optimum (by default 1,000 steps are used), or that we end up with unfortunate initial class assignments that prevent the algorithm from finding the optimum. To attenuate this problem, we can increase the number of steps used, or run the algorithm multiple times, each with new initial class assignments. The <code>poLCA</code> arguments for this are <code>maxiter</code>, which controls the number of steps (or iterations) used, and <code>nrep</code>, which controls the number of repetitions with different initial assignments. We’ll increase both, and see if that helps. Note that this means that the algorithm will take longer to run:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="eda.html#cb346-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(TREATPSYCHOTHRPY, TREATFAMTHRPY,</span>
<span id="cb346-2"><a href="eda.html#cb346-2" aria-hidden="true" tabindex="-1"></a>                 TREATGRPTHRPY, TREATCOGTHRPY,</span>
<span id="cb346-3"><a href="eda.html#cb346-3" aria-hidden="true" tabindex="-1"></a>                 TREATPSYCHOMED) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb346-4"><a href="eda.html#cb346-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> treatments, <span class="at">nclass =</span> <span class="dv">3</span>,</span>
<span id="cb346-5"><a href="eda.html#cb346-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">maxiter =</span> <span class="dv">2500</span>, <span class="at">nrep =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>These setting should do the trick for this dataset, and you probably won’t see a warning message this time. If you do, try increasing either number and run the code again.</p>
<p>The output that you get can differ between runs - in particular, the order of the classes can differ depending on initial assignments. Here is part of the output from my run:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="eda.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATPSYCHOTHRPY</span>
<span id="cb347-2"><a href="eda.html#cb347-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb347-3"><a href="eda.html#cb347-3" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.0076</span> <span class="fl">0.9924</span></span>
<span id="cb347-4"><a href="eda.html#cb347-4" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">0.0068</span> <span class="fl">0.9932</span></span>
<span id="cb347-5"><a href="eda.html#cb347-5" aria-hidden="true" tabindex="-1"></a>class <span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.6450</span> <span class="fl">0.3550</span></span>
<span id="cb347-6"><a href="eda.html#cb347-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-7"><a href="eda.html#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATFAMTHRPY</span>
<span id="cb347-8"><a href="eda.html#cb347-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb347-9"><a href="eda.html#cb347-9" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.1990</span> <span class="fl">0.8010</span></span>
<span id="cb347-10"><a href="eda.html#cb347-10" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">0.0223</span> <span class="fl">0.9777</span></span>
<span id="cb347-11"><a href="eda.html#cb347-11" aria-hidden="true" tabindex="-1"></a>class <span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.9435</span> <span class="fl">0.0565</span></span>
<span id="cb347-12"><a href="eda.html#cb347-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-13"><a href="eda.html#cb347-13" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATGRPTHRPY</span>
<span id="cb347-14"><a href="eda.html#cb347-14" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb347-15"><a href="eda.html#cb347-15" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.0712</span> <span class="fl">0.9288</span></span>
<span id="cb347-16"><a href="eda.html#cb347-16" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">0.3753</span> <span class="fl">0.6247</span></span>
<span id="cb347-17"><a href="eda.html#cb347-17" aria-hidden="true" tabindex="-1"></a>class <span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.4935</span> <span class="fl">0.5065</span></span>
<span id="cb347-18"><a href="eda.html#cb347-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-19"><a href="eda.html#cb347-19" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATCOGTHRPY</span>
<span id="cb347-20"><a href="eda.html#cb347-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb347-21"><a href="eda.html#cb347-21" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.0291</span> <span class="fl">0.9709</span></span>
<span id="cb347-22"><a href="eda.html#cb347-22" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">0.0515</span> <span class="fl">0.9485</span></span>
<span id="cb347-23"><a href="eda.html#cb347-23" aria-hidden="true" tabindex="-1"></a>class <span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.5885</span> <span class="fl">0.4115</span></span>
<span id="cb347-24"><a href="eda.html#cb347-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-25"><a href="eda.html#cb347-25" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>TREATPSYCHOMED</span>
<span id="cb347-26"><a href="eda.html#cb347-26" aria-hidden="true" tabindex="-1"></a>           <span class="fu">Pr</span>(<span class="dv">1</span>)  <span class="fu">Pr</span>(<span class="dv">2</span>)</span>
<span id="cb347-27"><a href="eda.html#cb347-27" aria-hidden="true" tabindex="-1"></a>class <span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.0825</span> <span class="fl">0.9175</span></span>
<span id="cb347-28"><a href="eda.html#cb347-28" aria-hidden="true" tabindex="-1"></a>class <span class="dv">2</span><span class="sc">:</span>  <span class="fl">1.0000</span> <span class="fl">0.0000</span></span>
<span id="cb347-29"><a href="eda.html#cb347-29" aria-hidden="true" tabindex="-1"></a>class <span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.3406</span> <span class="fl">0.6594</span></span>
<span id="cb347-30"><a href="eda.html#cb347-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-31"><a href="eda.html#cb347-31" aria-hidden="true" tabindex="-1"></a>Estimated class population shares </span>
<span id="cb347-32"><a href="eda.html#cb347-32" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.8059</span> <span class="fl">0.0746</span> <span class="fl">0.1196</span> </span></code></pre></div>
<p>We can interpret this as follows:</p>
<ul>
<li>Class 1 (81 % of facilities): Offer all treatments, including psychotropic medication.</li>
<li>Class 2 (7 % of facilities): Offer all treatments, except for psychotropic medication.</li>
<li>Class 3 (12 % of facilities): Only offer some treatments, which may include psychotropic medication.</li>
</ul>
<p>You can either let interpretability guide your choice of how many classes to include in your analysis, our use model fit measures like <span class="math inline">\(AIC\)</span> and <span class="math inline">\(BIC\)</span>, which are printed in the output and can be obtained from the model using:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="eda.html#cb348-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>aic</span>
<span id="cb348-2"><a href="eda.html#cb348-2" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span>bic</span></code></pre></div>
<p>The lower these are, the better is the model fit.</p>
<p>If you like, you can add a covariate to your latent class analysis, which allows you to simultaneously find classes and study their relationship with the covariate. Let’s add the variable <code>PAYASST</code> (which says whether a facility offers treatment at no charge or minimal payment to clients who cannot afford to pay) to our data, and then use that as a covariate.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="eda.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add PAYASST variable to data, then change negative values</span></span>
<span id="cb349-2"><a href="eda.html#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to NA&#39;s:</span></span>
<span id="cb349-3"><a href="eda.html#cb349-3" aria-hidden="true" tabindex="-1"></a>treatments<span class="sc">$</span>PAYASST <span class="ot">&lt;-</span> nmhss<span class="sc">$</span>PAYASST</span>
<span id="cb349-4"><a href="eda.html#cb349-4" aria-hidden="true" tabindex="-1"></a>treatments<span class="sc">$</span>PAYASST[treatments<span class="sc">$</span>PAYASST <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb349-5"><a href="eda.html#cb349-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-6"><a href="eda.html#cb349-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run LCA with covariate:</span></span>
<span id="cb349-7"><a href="eda.html#cb349-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(<span class="fu">cbind</span>(TREATPSYCHOTHRPY, TREATFAMTHRPY,</span>
<span id="cb349-8"><a href="eda.html#cb349-8" aria-hidden="true" tabindex="-1"></a>                 TREATGRPTHRPY, TREATCOGTHRPY,</span>
<span id="cb349-9"><a href="eda.html#cb349-9" aria-hidden="true" tabindex="-1"></a>                 TREATPSYCHOMED) <span class="sc">~</span> PAYASST,</span>
<span id="cb349-10"><a href="eda.html#cb349-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> treatments, <span class="at">nclass =</span> <span class="dv">3</span>,</span>
<span id="cb349-11"><a href="eda.html#cb349-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">maxiter =</span> <span class="dv">2500</span>, <span class="at">nrep =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>My output from this model includes the following tables:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="eda.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=======================================================</span> </span>
<span id="cb350-2"><a href="eda.html#cb350-2" aria-hidden="true" tabindex="-1"></a>Fit <span class="cf">for</span> <span class="dv">3</span> latent classes<span class="sc">:</span> </span>
<span id="cb350-3"><a href="eda.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="er">=========================================================</span> </span>
<span id="cb350-4"><a href="eda.html#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">1</span> </span>
<span id="cb350-5"><a href="eda.html#cb350-5" aria-hidden="true" tabindex="-1"></a>            Coefficient  Std. error  t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb350-6"><a href="eda.html#cb350-6" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="fl">0.10616</span>     <span class="fl">0.18197</span>    <span class="fl">0.583</span>     <span class="fl">0.570</span></span>
<span id="cb350-7"><a href="eda.html#cb350-7" aria-hidden="true" tabindex="-1"></a>PAYASST         <span class="fl">0.43302</span>     <span class="fl">0.11864</span>    <span class="fl">3.650</span>     <span class="fl">0.003</span></span>
<span id="cb350-8"><a href="eda.html#cb350-8" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=======================================================</span> </span>
<span id="cb350-9"><a href="eda.html#cb350-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">1</span> </span>
<span id="cb350-10"><a href="eda.html#cb350-10" aria-hidden="true" tabindex="-1"></a>            Coefficient  Std. error  t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb350-11"><a href="eda.html#cb350-11" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="fl">1.88482</span>     <span class="fl">0.20605</span>    <span class="fl">9.147</span>         <span class="dv">0</span></span>
<span id="cb350-12"><a href="eda.html#cb350-12" aria-hidden="true" tabindex="-1"></a>PAYASST         <span class="fl">0.59124</span>     <span class="fl">0.10925</span>    <span class="fl">5.412</span>         <span class="dv">0</span></span>
<span id="cb350-13"><a href="eda.html#cb350-13" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=======================================================</span></span></code></pre></div>
<p>The interpretation is that both class 2 and class 3 differ significantly from class 1 (the p-values in the <code>Pr(&gt;|t|)</code> column are low), with the positive coefficients for <code>PAYASST</code> telling us that class 2 and 3 facilities are more likely to offer pay assistance than class 1 facilities.</p>
<p><span class="math display">\[\sim\]</span></p>
<div class="exercise">
<p><span id="exr:ch4exc30" class="exercise"><strong>Exercise 4.34  </strong></span>The <code>cheating</code> dataset from <code>poLCA</code> contains students’ answers to four questions about cheating, along with their grade point averages (GPA). Perform a latent class analysis using GPA as a covariate. What classes do you find? Does having a high GPA increase the probability of belonging to either class?</p>
</div>
<p><a href="solutions.html#ch4solutions30">(Click here to go to the solution.)</a></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="22">
<li id="fn22"><p>See <code>?theme_grey</code> for a list of available themes.<a href="eda.html#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p>Note that it is not just the prices nor just the carats of these diamonds that make them outliers, but the unusual combinations of prices and carats!<a href="eda.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p>LOESS, LOcally Estimated Scatterplot Smoothing, is a non-parametric regression method that fits a polynomial to local areas of the data.<a href="eda.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>GAM, Generalised Additive Model, is a generalised linear model where the response variable is a linear function of smooth functions of the predictors.<a href="eda.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>Time series objects are a special class of vectors, with data sampled at equispaced points in time. Each observation can have a year/date/time associated with it.<a href="eda.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>Florence Nightingale, who famously pioneered the use of the pie chart, drew her pie charts this way.<a href="eda.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>A linear combination is a weighted sum of the form <span class="math inline">\(a_1x_1+a_2x_2+\cdots+a_px_p\)</span>. If you like, you can think of principal components as weighted averages of variables, computed for each row in your data.<a href="eda.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>Just to be clear, 5 is just an arbitrary number here. We could of course want 4, 14, or any other number of clusters.<a href="eda.html#fnref29" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datachapter.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="messychapter.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
