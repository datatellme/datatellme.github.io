<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://example.com/blog/posts/2024-05-12-ex016-MySql%EC%97%90%20%EC%97%B0%EB%8B%A8%EC%9C%84%20%EC%A3%BC%EA%B0%80%EC%A0%95%EB%B3%B4%20%EC%88%98%EC%A7%91%ED%95%98%EA%B8%B0/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.20"><title>MySql에 연단위 주가정보 수집하기01 - Data-Tell-Me</title><link rel=stylesheet href=../../../assets/stylesheets/main.66ac8b77.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Source Code Pro"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mysql-01gppjm07_0404 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=Data-Tell-Me class="md-header__button md-logo" aria-label=Data-Tell-Me data-md-component=logo> <img src=../../../img/peterpark_01.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Data-Tell-Me </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MySql에 연단위 주가정보 수집하기01 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=lime aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../statistics/R-Introduction_K/ class=md-tabs__link> Statistics </a> </li> <li class=md-tabs__item> <a href=../../../data/01_mkdocs/ class=md-tabs__link> Data Skill </a> </li> <li class=md-tabs__item> <a href=../../../bibledata/01_Ge/ class=md-tabs__link> Text Mining </a> </li> <li class=md-tabs__item> <a href=../../../shot/01_movipy/ class=md-tabs__link> Shot </a> </li> <li class=md-tabs__item> <a href=../../../quant/01_quant/ class=md-tabs__link> Quant </a> </li> <li class=md-tabs__item> <a href=../../ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Data-Tell-Me class="md-nav__button md-logo" aria-label=Data-Tell-Me data-md-component=logo> <img src=../../../img/peterpark_01.jpg alt=logo> </a> Data-Tell-Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Statistics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Statistics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../statistics/R-Introduction_K/ class=md-nav__link> <span class=md-ellipsis> R-Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../../statistics/R-basics_K/ class=md-nav__link> <span class=md-ellipsis> R-basics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Data Skill </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Data Skill </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data/01_mkdocs/ class=md-nav__link> <span class=md-ellipsis> mkdocs </span> </a> </li> <li class=md-nav__item> <a href=../../../data/02_Jupyter_nb_to_md/ class=md-nav__link> <span class=md-ellipsis> Jupyter_to_md </span> </a> </li> <li class=md-nav__item> <a href=../../../data/03_python_rmd/ class=md-nav__link> <span class=md-ellipsis> python_rmd </span> </a> </li> <li class=md-nav__item> <a href=../../../data/04_python_reticulate/ class=md-nav__link> <span class=md-ellipsis> python_reticulate </span> </a> </li> <li class=md-nav__item> <a href=../../../data/05_batch_script/ class=md-nav__link> <span class=md-ellipsis> batch script </span> </a> </li> <li class=md-nav__item> <a href=../../../data/06_Xaringan/ class=md-nav__link> <span class=md-ellipsis> Xaringan </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Text Mining </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Text Mining </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../bibledata/01_Ge/ class=md-nav__link> <span class=md-ellipsis> 창세기 </span> </a> </li> <li class=md-nav__item> <a href=../../../bibledata/02_Ex/ class=md-nav__link> <span class=md-ellipsis> 출애굽기 </span> </a> </li> <li class=md-nav__item> <a href=../../../bibledata/03_Lev/ class=md-nav__link> <span class=md-ellipsis> 레위기 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Shot </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Shot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../shot/01_movipy/ class=md-nav__link> <span class=md-ellipsis> movipy </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Quant </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Quant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../quant/01_quant/ class=md-nav__link> <span class=md-ellipsis> quant </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=mysql-01gppjm07_0404>MySql에 연단위 주가정보 수집하기01(gppjm07_0404)</h1> <h2 id=_1>들어가며</h2> <ul> <li> <p>MySql에 주가정보 수집을 위한 자동화 프로그램을 만들기 위해서 Chat GPT의 도움을 받으려 합니다.</p> </li> <li> <p>예전 경험상 웹 크롤링이나 주가정보 수집을 위한 코드를 물어보면 어뚱한 답을 한 경험이 있었습니다. </p> </li> </ul> <p><strong>목표(Goal)</strong></p> <ul> <li> <p>이번 실습의 목표는 한국 상장 전체 주가 정보를 MySql에 수집하는 자동화 프로그램을 만드는 것입니다.</p> </li> <li> <p>주가 정보를 수집하는 방법을 알아보고 이것을 어떻게 자동화 프로그램으로 만들어 주가정보 데이터를 최신 정보로 업데이트 하는 것입니다.</p> </li> </ul> <p><strong>목적(Why)</strong></p> <ul> <li> <p>한국 상장 전체 주가 정보를 수집하여 퀀트 투자 분석을 위한 주가 정보 데이터 베이스를 구축하는 것입니다. </p> </li> <li> <p>특히 MySql 데인터 베이스에 주식정보를 어떻게 저장하는지 알아보기 위하여 이번 실습이 진행되겠습니다.</p> </li> </ul> <h2 id=how>질문 작성 방법(How)</h2> <ul> <li> <p>한국 상장 전체 주가 정보를 수집하는 방법은 여려 가지 있습니다. </p> </li> <li> <p>네이버 주식 사이트를 크롤링 하는 방법 부터 FinanceDataReader를 사용하여 KRX 주가 정보를 가져오는 방법 등 여러가지가 있습니다.</p> </li> <li> <p>특히 FinanceDataReader 주가정보 데이터는 주식의 액면 분할 시 가격을 반영한 조정 주가로 이루어져 있어 많이 사용하는 데이터 입니다.</p> </li> <li> <p>그런데 FinanceDataReader가 2021년과 현재의 컬럼 명이 변경되고 없어진 것도 있어서 확인이 반드시 필요합니다.</p> </li> <li> <p>파이썬에 먼저 FinanceDataReader를 아래와 같이 인스톨해야 합니다</p> </li> </ul> <div class=highlight><pre><span></span><code>pip install -U finance-datareader
</code></pre></div> <ul> <li>그리고 아래와 같이 실행해서 커럼 정보를 확인하고 csv데이터로 다운로드 받아 데이터 확인을 하셔야 합니다.</li> </ul> <div class=highlight><pre><span></span><code>import pandas as pd
import FinanceDataReader as fdr

df_krx = fdr.StockListing(&quot;KRX&quot;)

df_krx.info()

df_krx.to_csv(&quot;krx.csv&quot;, index=False)
</code></pre></div> <ul> <li> <p>특히 Chat GPT는 2021년 1월까지의 정보로 질문에 답하기 때문에 FinanceDataReader의 정보가 예전 것입니다.</p> </li> <li> <p>그래서 그것을 고려하여 Chat GPT의 답변에서 컬럼 명의 변경이 필요합니다. </p> </li> </ul> <p><strong>질문 내용(프롬프트)</strong></p> <ul> <li> <p>이번에는 Chat GPT에게 질문을 할 때 관련 파이썬 코드의 설명을 요청하는 방법을 사용하였습니다.</p> </li> <li> <p>설명해달라는 파이썬 코드는 "금용 디이터 분석" 에 예시로 나와 있는 주가정보 수집함수입니다.</p> </li> <li> <p>이 함수는 예시문의 가장 마지막에 있는 함수로 파이썬 주가정보 수집하여 MySql에 입력하는 코드의 일부입니다.</p> </li> <li> <p>질문을 아래와 같이 하였습니다. </p> </li> </ul> <div class=highlight><pre><span></span><code>Q01: 다음 파이썬 코드 좀 설명 부탁해.  

다음: def stock_data_collect(year):
    create_table(db_conf)
    df_krx = fdr.StockListing(&#39;KRX&#39;)
    df_krx = df_krx.fillna(&quot;&quot;)
    insert_code(df_krx)

    # 주가 데이터
    symbol=&#39;005930&#39;
    year=&quot;2023&quot;

    symbol_list = df_krx[&quot;Code&quot;]

    for symbol in tqdm(symbol_list):
        try:
            df_sto = fdr.DataReader(symbol, year)
            insert_stock_data(db_conf, symbol, df_sto)
        except Exception as e:
            print(symbol, end=&quot;,&quot;)
            print(e)

    return 0


if __name__ == &#39;__main__&#39;:

    year = str(datetime.now().year)
    stock_data_collect(year) 


Q02: 전체 파이썬 코드 작성 부탁해.
</code></pre></div> <h2 id=chat-gpt-what>질문에 대한 Chat GPT 답변 결과(What)</h2> <p><strong>핵심주제</strong> </p> <ul> <li>핵심주제01</li> <li>핵심주제02</li> </ul> <p><strong>Chat GPT 답변</strong></p> <div class=highlight><pre><span></span><code>A01: 이 코드는 주식 데이터를 수집하고 데이터베이스에 저장하는 파이썬 함수를 정의하고 있습니다. 함수의 동작은 다음과 같습니다:

stock_data_collect(year): 이 함수는 주어진 연도에 해당하는 주식 데이터를 수집하고 데이터베이스에 저장합니다. 주요 기능은 다음과 같습니다:

create_table(db_conf): 데이터베이스에 필요한 테이블을 생성합니다. db_conf는 데이터베이스 연결 구성을 나타내는 변수입니다.
df_krx = fdr.StockListing(&#39;KRX&#39;): FinanceDataReader를 사용하여 한국거래소(KRX)의 주식 목록을 가져옵니다.
df_krx = df_krx.fillna(&quot;&quot;): 데이터프레임에서 NaN 값을 빈 문자열로 대체합니다.
insert_code(df_krx): 주식 목록을 데이터베이스에 삽입합니다.
for symbol in tqdm(symbol_list):: 주식 목록을 반복하면서 각 주식에 대한 데이터를 수집합니다.
df_sto = fdr.DataReader(symbol, year): FinanceDataReader를 사용하여 해당 주식의 주가 데이터를 가져옵니다.
insert_stock_data(db_conf, symbol, df_sto): 주가 데이터를 데이터베이스에 삽입합니다. db_conf는 데이터베이스 연결 구성을 나타내는 변수입니다.
수집 중 오류가 발생하면 해당 주식의 코드와 오류 메시지를 출력합니다.
함수는 0을 반환합니다.
if __name__ == &#39;__main__&#39;:: 이 부분은 코드가 직접 실행될 때만 실행됩니다. 현재 연도를 가져와서 stock_data_collect() 함수를 호출합니다.

이 코드는 FinanceDataReader 라이브러리를 사용하여 한국거래소의 주식 데이터를 수집하고, 데이터베이스에 저장하는 과정을 자동화하는 기능을 수행합니다.


A02: 아래는 주어진 코드를 바탕으로 완전한 파이썬 코드입니다. 데이터베이스 관련 설정은 적절히 수정하여 사용하셔야 합니다.

python
Copy code
import pymysql
import pandas as pd
from datetime import datetime
import FinanceDataReader as fdr
from tqdm import tqdm

# 데이터베이스 연결 설정
db_conf = {
    &#39;host&#39;: &#39;localhost&#39;,    # 호스트 이름
    &#39;user&#39;: &#39;root&#39;,         # 사용자 이름
    &#39;password&#39;: &#39;password&#39;, # 비밀번호
    &#39;database&#39;: &#39;stock_data&#39; # 데이터베이스 이름
}

def create_table(db_conf):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 테이블 생성 쿼리 실행
            create_table_query = &quot;&quot;&quot;
            CREATE TABLE IF NOT EXISTS stock_list (
                code VARCHAR(20),
                name VARCHAR(100),
                PRIMARY KEY (code)
            )
            &quot;&quot;&quot;
            cursor.execute(create_table_query)
        connection.commit()
    finally:
        connection.close()

def insert_code(df_krx):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 주식 목록을 데이터베이스에 삽입
            for index, row in df_krx.iterrows():
                insert_query = &quot;&quot;&quot;
                INSERT INTO stock_list (code, name)
                VALUES (%s, %s)
                &quot;&quot;&quot;
                cursor.execute(insert_query, (row[&#39;Code&#39;], row[&#39;Name&#39;]))
        connection.commit()
    finally:
        connection.close()

def insert_stock_data(db_conf, symbol, df_sto):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 주식 데이터를 데이터베이스에 삽입
            for index, row in df_sto.iterrows():
                insert_query = &quot;&quot;&quot;
                INSERT INTO stock_data (date, code, open, high, low, close, volume)
                VALUES (%s, %s, %s, %s, %s, %s, %s)
                &quot;&quot;&quot;
                cursor.execute(insert_query, (index.strftime(&#39;%Y-%m-%d&#39;), symbol, row[&#39;Open&#39;], row[&#39;High&#39;], row[&#39;Low&#39;], row[&#39;Close&#39;], row[&#39;Volume&#39;]))
        connection.commit()
    finally:
        connection.close()

def stock_data_collect(year):
    create_table(db_conf)
    df_krx = fdr.StockListing(&#39;KRX&#39;)
    df_krx = df_krx.fillna(&quot;&quot;)
    insert_code(df_krx)

    symbol_list = df_krx[&quot;Code&quot;]

    for symbol in tqdm(symbol_list):
        try:
            df_sto = fdr.DataReader(symbol, year)
            insert_stock_data(db_conf, symbol, df_sto)
        except Exception as e:
            print(symbol, end=&quot;, &quot;)
            print(e)

    return 0

if __name__ == &#39;__main__&#39;:
    year = str(datetime.now().year)
    stock_data_collect(year)

이 코드는 주어진 연도의 KRX 주식 데이터를 수집하여 MySQL 데이터베이스에 저장합니다. 이때 stock_list 테이블에는 주식 코드와 이름이, stock_data 테이블에는 날짜, 주식 코드, 시가, 고가, 저가, 종가, 거래량이 저장됩니다.
</code></pre></div> <h2 id=_2>답변 결과 디버깅 및 수정</h2> <p><strong>주식가격 수집 파이썬 코드의 함수 구조</strong></p> <ul> <li> <p>데이터베이스 연결 설정</p> </li> <li> <p>MySql에 테이블 stock_list와 stock_data 테이블 만들기 함수</p> </li> <li> <p>stock_list 데이터 삽입하기 함수</p> </li> <li> <p>stock_data 데이터 삽입하기 함수</p> </li> <li> <p>주식데이터 수집하기 함수</p> </li> </ul> <p><strong>수정 사항</strong></p> <ul> <li> <p>누락되어 있는 MySql stock_data 테이블 만들기 쿼리를 추가하였습니다.</p> </li> <li> <p>각각의 테이블 칼럼을 수정하였습니다.</p> </li> <li> <p>stock_list 데이터 삽입 함수를 테이블 칼럼에 맞게 수정하였습니다.</p> </li> <li> <p>stock_data 데이터 삽입하기 함수 테이블 칼럼에 맞게 수정(symbol 위치 변경)하였습니다.</p> </li> <li> <p>기간 설정(2023)을 추가하였습니다.</p> </li> </ul> <p><strong>완성된 최종 프로그램</strong></p> <div class=highlight><pre><span></span><code>import pymysql
import pandas as pd
from datetime import datetime
import FinanceDataReader as fdr
from tqdm import tqdm

# 데이터베이스 연결 설정
db_conf = {
    &#39;host&#39;: &#39;localhost&#39;,    # 호스트 이름
    &#39;user&#39;: &#39;root&#39;,         # 사용자 이름
    &#39;password&#39;: &#39;password&#39;, # 비밀번호
    &#39;database&#39;: &#39;test02_db&#39; # 데이터베이스 이름
}

# MySql에 테이블 stock_list와 stock_data 테이블 만들기 
def create_table(db_conf):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 테이블 생성 쿼리 실행
            create_table_query01 = &quot;&quot;&quot;
            CREATE TABLE IF NOT EXISTS stock_list (
                code VARCHAR(6),
                name VARCHAR(30),
                market VARCHAR(30),
                collected_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                PRIMARY KEY (code)
            )
            &quot;&quot;&quot;
            create_table_query02 = &quot;&quot;&quot;
            CREATE TABLE IF NOT EXISTS stock_data (
                date date,
                open int,
                high int,
                low int,
                close int,
                volume int,
                code VARCHAR(6),
                collected_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                PRIMARY KEY (date, code)
            )
            &quot;&quot;&quot;    

            cursor.execute(create_table_query01)
            cursor.execute(create_table_query02)
        connection.commit()
    finally:
        connection.close()

# stock_list 데이터 삽입하기
def insert_code(df_krx):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 주식 목록을 데이터베이스에 삽입
            for index, row in df_krx.iterrows():
                insert_query = &quot;&quot;&quot;
                INSERT INTO stock_list (code, name, market)
                VALUES (%s, %s, %s)
                &quot;&quot;&quot;
                cursor.execute(insert_query, (row[&#39;Code&#39;], row[&#39;Name&#39;], row[&#39;Market&#39;]))
        connection.commit()
    finally:
        connection.close()

# stock_data 데이터 삽입하기
def insert_stock_data(db_conf, symbol, df_sto):
    # 데이터베이스 연결
    connection = pymysql.connect(**db_conf)
    try:
        with connection.cursor() as cursor:
            # 주식 데이터를 데이터베이스에 삽입
            for index, row in df_sto.iterrows():
                insert_query = &quot;&quot;&quot;
                INSERT INTO stock_data (date, open, high, low, close, volume, code)
                VALUES (%s, %s, %s, %s, %s, %s, %s)
                &quot;&quot;&quot;
                cursor.execute(insert_query, (index.strftime(&#39;%Y-%m-%d&#39;), row[&#39;Open&#39;], row[&#39;High&#39;], row[&#39;Low&#39;], row[&#39;Close&#39;], row[&#39;Volume&#39;],symbol))
        connection.commit()
    finally:
        connection.close()

# 주식데이터 수집하기
def stock_data_collect(year):
    create_table(db_conf)
    df_krx = fdr.StockListing(&#39;KRX&#39;)
    df_krx = df_krx.fillna(&quot;&quot;)
    insert_code(df_krx)

    # 기간 설정
    year=&quot;2023&quot;

    symbol_list = df_krx[&quot;Code&quot;]

    for symbol in tqdm(symbol_list):
        try:
            df_sto = fdr.DataReader(symbol, year)
            insert_stock_data(db_conf, symbol, df_sto)
        except Exception as e:
            print(symbol, end=&quot;, &quot;)
            print(e)

    return 0

if __name__ == &#39;__main__&#39;:
    year = str(datetime.now().year)
    stock_data_collect(year)
</code></pre></div> <h2 id=_3>결어</h2> <ul> <li>정리하기01</li> <li>정리하기02</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2023 <a href=https://github.com/datatellme target=_blank rel=noopener>Data Tell Me</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.dd8806f2.min.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>